---
import Title from '../../components/Title.astro';
import Layout from '../../layouts/Layout.astro';
import cmsService from '../../lib/CMSService';
import MarkdownService from '../../lib/MarkdownService';
import type { BlogPost } from '../../types/types';

export async function getStaticPaths() {
  return (await cmsService.getAllPosts()).map(post => ({
    params: { slug: post.slug },
  }));
};

const { slug } = Astro.params;
const post = await cmsService.getPost(slug as string) as BlogPost;
const { code: markdownCode } = await (new MarkdownService()).processMarkdown(
  post.markdown as string
);
---

<Layout title={post.title} pageType={"normal"}>
  <Title>
    {post.title}
  </Title>

  <div class="prose lg:prose-md" set:html={markdownCode}></div>
</Layout>
