{
  "data": {
    "posts": [
      {
        "id": 1,
        "title": "More Elegant Destructuring with JavaScript Generators",
        "slug": "destructuring-with-generators",
        "html": "<p>JavaScript has a standard for defining an object’s iteration behavior. In fact, it’s at work whenever you destructure an array or use it in a <code>for..of</code> loop.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> arr <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'first'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'second'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'third'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Using destructuring: </span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>first<span class=\"token punctuation\">,</span> second<span class=\"token punctuation\">,</span> third<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> arr<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Using a `for..of` loop: </span>\n<span class=\"token keyword control-flow\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> item <span class=\"token keyword\">of</span> arr<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">doStuff</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>But it’s not just for built-in objects. You can make <em>any</em> object iterable by giving it a <code>Symbol.iterator</code> function property that returns an object adhering to the <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Iterators_and_Generators#iterables\" target=\"_blank\" rel=\"noopener\">iterator protocol</a>. In its most basic form, that returned object has <code>next()</code> method returning <em>another</em> object with <code>value</code> and <code>done</code> properties.</p>\n<p>For example, here’s an iterable that provides a range of numbers (<code>1</code> through <code>3</code>):</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> count <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> iterableObj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">[</span><span class=\"token known-class-name class-name\">Symbol</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">iterator</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">done</span><span class=\"token operator\">:</span> count <span class=\"token operator\">===</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> count<span class=\"token operator\">++</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> item <span class=\"token keyword\">of</span> iterableObj<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 1</span>\n<span class=\"token comment\">// 2</span>\n<span class=\"token comment\">// 3</span>\n</code></pre></div>\n<p>Correctly setting that <code>done</code> property is critical, because that’s how the <code>for</code> loop will know when to discontinue execution, or, if you’re destructuring, when you’ll start getting <code>undefined</code> values:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">,</span> d<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> iterableObj<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 1, 2, 3, undefined</span>\n</code></pre></div>\n<h2>Interesting, but… practical?</h2>\n<p>While all that’s cool, there’s a notorious lack of “real” use cases for custom iterables in the wild. At least, that’s the story as I’ve experienced it.</p>\n<p>And then I saw this tweet from <a href=\"https://twitter.com/alexandereardon/status/1534762394848636928\" target=\"_blank\" rel=\"noopener\">Alex Reardon</a>. In his example, an iterator and destructuring are used to generate an arbitrary number of objects on the fly (DOM elements, in his case). Here’s that implementation (a smidge modified, but the same spirit):</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">getElements</span><span class=\"token punctuation\">(</span>tagName <span class=\"token operator\">=</span> <span class=\"token string\">'div'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">[</span><span class=\"token known-class-name class-name\">Symbol</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">iterator</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">done</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createElement</span><span class=\"token punctuation\">(</span>tagName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>el1<span class=\"token punctuation\">,</span> el2<span class=\"token punctuation\">,</span> el3<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">getElements</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>el1<span class=\"token punctuation\">,</span> el2<span class=\"token punctuation\">,</span> el3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n<span class=\"token comment\">// HTMLDivElement, HTMLDivElement, HTMLDivElement</span>\n</code></pre></div>\n<p>At first, it looked unnecessarily complicated, especially when considering what I’d personally otherwise do with an array:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">getElements</span><span class=\"token punctuation\">(</span>tagName <span class=\"token operator\">=</span> <span class=\"token string\">'div'</span><span class=\"token punctuation\">,</span> number<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Array</span><span class=\"token punctuation\">(</span>number<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">fill</span><span class=\"token punctuation\">(</span><span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">i</span> <span class=\"token arrow operator\">=></span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createElement</span><span class=\"token punctuation\">(</span>tagName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>el1<span class=\"token punctuation\">,</span> el2<span class=\"token punctuation\">,</span> el3<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">getElements</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>el1<span class=\"token punctuation\">,</span> el2<span class=\"token punctuation\">,</span> el3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// HTMLDivElement, HTMLDivElement, HTMLDivElement</span>\n</code></pre></div>\n<p>Despite needing to specify how many items you’d like to generate up front, this sort of approach had always satisfied me (despite <code>.fill()</code> always feeling a little weird). But then I remembered that there’s more than one way to make your own iterable in JavaScript.</p>\n<h2>Generators: Write Simpler Iterables</h2>\n<p>If using <code>Symbol.iterator</code> is too verbose, you can syntactically sweeten it with a <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Generator\" target=\"_blank\" rel=\"noopener\">generator</a>, a special function returning a <code>Generator</code> object that functions the same way as a hand-written iterable. Here’s that same method written as a generator function:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span><span class=\"token operator\">*</span> <span class=\"token function\">getElements</span><span class=\"token punctuation\">(</span>tagName <span class=\"token operator\">=</span> <span class=\"token string\">'div'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">yield</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createElement</span><span class=\"token punctuation\">(</span>tagName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>el1<span class=\"token punctuation\">,</span> el2<span class=\"token punctuation\">,</span> el3<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">getElements</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>el1<span class=\"token punctuation\">,</span> el2<span class=\"token punctuation\">,</span> el3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>That infinite <code>while</code> loop may be startling, but it’s safe — the <code>yield</code> keyword won’t allow it to continue to run until the generator is invoked each time, whether it be via <code>for..of</code> (which you can even use asynchronously), destructuring, or something else.</p>\n<h2>Some Perks to Destructuring with a Generator</h2>\n<p>This change made it much more appealing to use iterables in destructuring items, for a few reasons:</p>\n<ol>\n<li><strong>I don’t need to specify how many items I want to generate up front.</strong> As such, the function’s signature is a little simpler (the <code>number</code> parameter is no longer required).</li>\n<li><strong>There’s a (small) performance advantage.</strong> Items are produced on demand, not up front. I’ll never accidentally generate five items, end up only needing three, and leaving two orphans.</li>\n<li><strong>In my opinion, it’s</strong> <em><strong>more</strong></em> <strong>elegant than filling an array.</strong> You can even get the function body down to a single line:</li>\n</ol>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span><span class=\"token operator\">*</span> <span class=\"token function\">getElements</span><span class=\"token punctuation\">(</span>tagName <span class=\"token operator\">=</span> <span class=\"token string\">'div'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token keyword control-flow\">yield</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createElement</span><span class=\"token punctuation\">(</span>tagName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>And in addition to those benefits, an honorable mention: the increased social credibility that comes with telling people you’ve had a reason to use a generator.</p>\n<h2>Time Will Yield More</h2>\n<p>When you’ve used a certain set of tools for countless jobs, it’s not easy to be given a <em>new</em> tool and expect to immediately know how it’s uniquely suited to solve certain problems. So, despite this being one of the first “practical” use cases I’ve for a generator, I don’t expect it to be the last. After all, it’s still a new tool for me.</p>\n<p>That said, I’m eager to hear about other reasons iterators and generators are useful for a job, no matter how insignificant. If you have ‘em, <code>yield</code> ’em!</p>\n",
        "feature_image": "https://images.unsplash.com/photo-1548683726-203119be6a39?ixlib=rb-4.0.3&q=80&fm=jpg&crop=entropy&cs=tinysrgb",
        "status": "published",
        "created_at": 1677301200000,
        "published_at": 1677301200000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "meta_description": "Exploring one of the few practical-ish use cases for iterables and generators I’ve come across so far — destructuring an arbitrary number of entities on demand.",
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>JavaScript has a standard for defining an object’s iteration behavior. In fact, it’s at work whenever you destructure an array or use it in a <code>for..of</code> loop.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> arr <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token string\\\">'first'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">'second'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">'third'</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// Using destructuring: </span>\\n<span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">[</span>first<span class=\\\"token punctuation\\\">,</span> second<span class=\\\"token punctuation\\\">,</span> third<span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">=</span> arr<span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// Using a `for..of` loop: </span>\\n<span class=\\\"token keyword control-flow\\\">for</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">const</span> item <span class=\\\"token keyword\\\">of</span> arr<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n\\t<span class=\\\"token function\\\">doStuff</span><span class=\\\"token punctuation\\\">(</span>item<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p>But it’s not just for built-in objects. You can make <em>any</em> object iterable by giving it a <code>Symbol.iterator</code> function property that returns an object adhering to the <a href=\\\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Iterators_and_Generators#iterables\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">iterator protocol</a>. In its most basic form, that returned object has <code>next()</code> method returning <em>another</em> object with <code>value</code> and <code>done</code> properties.</p>\\n<p>For example, here’s an iterable that provides a range of numbers (<code>1</code> through <code>3</code>):</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">let</span> count <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> iterableObj <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token punctuation\\\">[</span><span class=\\\"token known-class-name class-name\\\">Symbol</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">iterator</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token function\\\">next</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token punctuation\\\">{</span>\\n          <span class=\\\"token literal-property property\\\">done</span><span class=\\\"token operator\\\">:</span> count <span class=\\\"token operator\\\">===</span> <span class=\\\"token number\\\">4</span><span class=\\\"token punctuation\\\">,</span>\\n          <span class=\\\"token literal-property property\\\">value</span><span class=\\\"token operator\\\">:</span> count<span class=\\\"token operator\\\">++</span><span class=\\\"token punctuation\\\">,</span>\\n        <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword control-flow\\\">for</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">const</span> item <span class=\\\"token keyword\\\">of</span> iterableObj<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span>item<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token comment\\\">// 1</span>\\n<span class=\\\"token comment\\\">// 2</span>\\n<span class=\\\"token comment\\\">// 3</span>\\n</code></pre></div>\\n<p>Correctly setting that <code>done</code> property is critical, because that’s how the <code>for</code> loop will know when to discontinue execution, or, if you’re destructuring, when you’ll start getting <code>undefined</code> values:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">[</span>a<span class=\\\"token punctuation\\\">,</span> b<span class=\\\"token punctuation\\\">,</span> c<span class=\\\"token punctuation\\\">,</span> d<span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">=</span> iterableObj<span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// 1, 2, 3, undefined</span>\\n</code></pre></div>\\n<h2>Interesting, but… practical?</h2>\\n<p>While all that’s cool, there’s a notorious lack of “real” use cases for custom iterables in the wild. At least, that’s the story as I’ve experienced it.</p>\\n<p>And then I saw this tweet from <a href=\\\"https://twitter.com/alexandereardon/status/1534762394848636928\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Alex Reardon</a>. In his example, an iterator and destructuring are used to generate an arbitrary number of objects on the fly (DOM elements, in his case). Here’s that implementation (a smidge modified, but the same spirit):</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\">getElements</span><span class=\\\"token punctuation\\\">(</span>tagName <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">'div'</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token punctuation\\\">[</span><span class=\\\"token known-class-name class-name\\\">Symbol</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">iterator</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token function\\\">next</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n          <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token punctuation\\\">{</span>\\n            <span class=\\\"token literal-property property\\\">done</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">,</span>\\n            <span class=\\\"token literal-property property\\\">value</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">createElement</span><span class=\\\"token punctuation\\\">(</span>tagName<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span>\\n          <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n        <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">[</span>el1<span class=\\\"token punctuation\\\">,</span> el2<span class=\\\"token punctuation\\\">,</span> el3<span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">getElements</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'div'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span>el1<span class=\\\"token punctuation\\\">,</span> el2<span class=\\\"token punctuation\\\">,</span> el3<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span> \\n<span class=\\\"token comment\\\">// HTMLDivElement, HTMLDivElement, HTMLDivElement</span>\\n</code></pre></div>\\n<p>At first, it looked unnecessarily complicated, especially when considering what I’d personally otherwise do with an array:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\">getElements</span><span class=\\\"token punctuation\\\">(</span>tagName <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">'div'</span><span class=\\\"token punctuation\\\">,</span> number<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Array</span><span class=\\\"token punctuation\\\">(</span>number<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">fill</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword null nil\\\">null</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">map</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">i</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">createElement</span><span class=\\\"token punctuation\\\">(</span>tagName<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">[</span>el1<span class=\\\"token punctuation\\\">,</span> el2<span class=\\\"token punctuation\\\">,</span> el3<span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">getElements</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'div'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">3</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span>el1<span class=\\\"token punctuation\\\">,</span> el2<span class=\\\"token punctuation\\\">,</span> el3<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token comment\\\">// HTMLDivElement, HTMLDivElement, HTMLDivElement</span>\\n</code></pre></div>\\n<p>Despite needing to specify how many items you’d like to generate up front, this sort of approach had always satisfied me (despite <code>.fill()</code> always feeling a little weird). But then I remembered that there’s more than one way to make your own iterable in JavaScript.</p>\\n<h2>Generators: Write Simpler Iterables</h2>\\n<p>If using <code>Symbol.iterator</code> is too verbose, you can syntactically sweeten it with a <a href=\\\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Generator\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">generator</a>, a special function returning a <code>Generator</code> object that functions the same way as a hand-written iterable. Here’s that same method written as a generator function:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">function</span><span class=\\\"token operator\\\">*</span> <span class=\\\"token function\\\">getElements</span><span class=\\\"token punctuation\\\">(</span>tagName <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">'div'</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword control-flow\\\">while</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword control-flow\\\">yield</span> <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">createElement</span><span class=\\\"token punctuation\\\">(</span>tagName<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">[</span>el1<span class=\\\"token punctuation\\\">,</span> el2<span class=\\\"token punctuation\\\">,</span> el3<span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">getElements</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'div'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span>el1<span class=\\\"token punctuation\\\">,</span> el2<span class=\\\"token punctuation\\\">,</span> el3<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>That infinite <code>while</code> loop may be startling, but it’s safe — the <code>yield</code> keyword won’t allow it to continue to run until the generator is invoked each time, whether it be via <code>for..of</code> (which you can even use asynchronously), destructuring, or something else.</p>\\n<h2>Some Perks to Destructuring with a Generator</h2>\\n<p>This change made it much more appealing to use iterables in destructuring items, for a few reasons:</p>\\n<ol>\\n<li><strong>I don’t need to specify how many items I want to generate up front.</strong> As such, the function’s signature is a little simpler (the <code>number</code> parameter is no longer required).</li>\\n<li><strong>There’s a (small) performance advantage.</strong> Items are produced on demand, not up front. I’ll never accidentally generate five items, end up only needing three, and leaving two orphans.</li>\\n<li><strong>In my opinion, it’s</strong> <em><strong>more</strong></em> <strong>elegant than filling an array.</strong> You can even get the function body down to a single line:</li>\\n</ol>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">function</span><span class=\\\"token operator\\\">*</span> <span class=\\\"token function\\\">getElements</span><span class=\\\"token punctuation\\\">(</span>tagName <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">'div'</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword control-flow\\\">while</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token keyword control-flow\\\">yield</span> <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">createElement</span><span class=\\\"token punctuation\\\">(</span>tagName<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p>And in addition to those benefits, an honorable mention: the increased social credibility that comes with telling people you’ve had a reason to use a generator.</p>\\n<h2>Time Will Yield More</h2>\\n<p>When you’ve used a certain set of tools for countless jobs, it’s not easy to be given a <em>new</em> tool and expect to immediately know how it’s uniquely suited to solve certain problems. So, despite this being one of the first “practical” use cases I’ve for a generator, I don’t expect it to be the last. After all, it’s still a new tool for me.</p>\\n<p>That said, I’m eager to hear about other reasons iterators and generators are useful for a job, no matter how insignificant. If you have ‘em, <code>yield</code> ’em!</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 2,
        "title": "Use a MutationObserver to Handle DOM Nodes that Don’t Exist Yet",
        "slug": "use-mutation-observer-to-handle-nodes-that-dont-exist-yet",
        "html": "<p>Occasionally, you need to mess with a part of the DOM that doesn’t exist… yet.</p>\n<p>There’s a variety of reasons the need could arise, but you might most often see it when dealing with third-party scripts that inject markup onto a page asynchronously. For example, I recently needed to update the UI whenever a user closed Google reCAPTCHA’s (v2) challenge. Responding to <code>blur</code> events like this isn’t officially supported by the tool, so I intended to wire up a listener myself. However, trying to access the node via something like <code>.querySelector()</code> yielded <code>null</code> because it hadn’t yet been rendered by the browser on page load, and I couldn’t know exactly when it’d happen.</p>\n<p>To explore this a little more with a more contrived example, I’ve wired up a button to be mounted to the DOM after a random amount of time (between zero and five seconds). If I were to try to add an event listener to that button from the get-go, I’d get an exception.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Simulating lazily-rendered HTML:</span>\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> button <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  button<span class=\"token punctuation\">.</span><span class=\"token property-access\">id</span> <span class=\"token operator\">=</span> <span class=\"token string\">'button'</span><span class=\"token punctuation\">;</span>\n  button<span class=\"token punctuation\">.</span><span class=\"token property-access\">innerText</span> <span class=\"token operator\">=</span> <span class=\"token string\">'Do Something!'</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">body</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">append</span><span class=\"token punctuation\">(</span>button<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token function\">randomBetweenMs</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'clicked!'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Error: Cannot read properties of null (reading 'addEventListener')</span>\n</code></pre></div>\n<p>Not surprising. All the code you see is being thrown onto the call stack and executed immediately (except, of course, <code>setTimeout()</code>’s callback), so by the time I try to access my button, all I find is <code>null</code>.</p>\n<h2>You Could Try Polling</h2>\n<p>To get around this, it’s common to use polling, querying the DOM every so often until the node appears. You might’ve seen approaches like this using <code>setInterval</code> or <code>setTimeout</code>, like this example using recursion:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">attachListenerToButton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> button <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>button<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    button<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'clicked!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n\t<span class=\"token comment\">// If the node doesn't exist yet, try</span>\n\t<span class=\"token comment\">// again on the next turn of the event loop.</span>\n  <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>attachListenerToButton<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">attachListenerToButton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Or, you might’ve come across a Promise-based approach that <em>feels</em> a little more modern:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">attachListenerToButton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> button <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword control-flow\">while</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>button<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token comment\">// If the node doesn't exist yet, try</span>\n\t\t<span class=\"token comment\">// again on the next turn of the event loop.</span>\n    button <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">await</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  button<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'clicked!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">attachListenerToButton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Either way, there are non-trivial costs to this sort of tactic — the primary one being performance. In both versions, removing <code>setTimeout()</code> would cause the script to run completely synchronously, blocking the main thread, along with any other task that needs to take place on it. No input events would be handled. Your tab would freeze. Chaos wouldn’t ensue.</p>\n<p>Sticking a <code>setTimeout()</code> (or <code>setInterval</code>) in there kicks the next attempt onto the following iteration of the event loop, which allows other tasks to execute in the meantime. <strong>But you’re still repeatedly hogging the call stack waiting for your node to appear.</strong> Far less than ideal if you want your code to steward the event loop well.</p>\n<p>You <em>could</em> lessen the call stack bloat by increasing the interval by which you query (like every 200ms). But you then risk something unexpected occurring between the time the node appears and when your work is performed. For example, if you’re doing something like adding a click event listener, you don’t want the user to have the chance to click the element <em>before</em> you’ve attached a listener several milliseconds later. Issues like this are probably few and far between, but they’ll certainly cause distress when you’re later debugging what might’ve gone wrong.</p>\n<h2>MutationObserver(): A Tool Built for the Job</h2>\n<p>The <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver\" target=\"_blank\" rel=\"noopener\">MutationObserver API</a> has been around for a bit now, and is <a href=\"https://caniuse.com/mutationobserver\" target=\"_blank\" rel=\"noopener\">extremely well-supported in modern browsers</a>. It has a straightforward purpose: do something when the DOM tree changes (including when a node gets inserted). But as a native browser API, you don’t have the same performance concerns as you would with polling. A basic set up for observing any changes within the <code>body</code> looks like so:</p>\n<div class=\"remark-highlight\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> domObserver <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MutationObserver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>mutationList<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">// document.body has changed! Do something.</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\ndomObserver<span class=\"token punctuation\">.</span><span class=\"token function\">observe</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> childList<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> subtree<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Taking it a little further for our contrived example is fairly straightforward. Every time the tree has changed, we’ll query for the specific node. If exists, attach the listener.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> domObserver <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MutationObserver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> button <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>button<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    button<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'clicked!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\ndomObserver<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">observe</span><span class=\"token punctuation\">(</span><span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">body</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">childList</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">subtree</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>The options we’re passing to <code>.observe()</code> are important. Setting <code>childList</code> to <code>true</code> makes the observer watch for changes to the node we’re targeting (<code>document.body</code>), and <code>subtree: true</code> will cause all descendants to also be monitored. Admittedly, the API here wasn’t tremendously easy (for me) to grok, and it’s <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver/observe\" target=\"_blank\" rel=\"noopener\">worth spending a bit of time thinking through</a> before you use it for your own needs.</p>\n<p>Regardless, this particular configuration is best for cases when you don’t know where the node might be injected. If you’re confident it’ll appear within a certain element, however, it’d be wise to target more narrowly.</p>\n<h2>Important Step: Cleanup!</h2>\n<p>If we left the observer as it is, we’d be at risk for adding another click event listener to the same button after <em>every</em> proceeding change to the DOM. You could remedy this by pulling click event callback into its own variable outside the MutationObserver’s callback (<code>.addEventListener()</code> won’t add a listener to a node with the same callback reference), but it’s far more intuitive to imperatively clean up the observer it’s once it’s no longer needed. There’s a nice method available on the observer to do that:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> domObserver <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MutationObserver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">_mutationList<span class=\"token punctuation\">,</span> observer</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> button <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>button<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    button<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'clicked!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token comment\">// No need to observe anymore. Clean up!</span>\n    observer<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">disconnect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h2>So, how responsive is it?</h2>\n<p>I mentioned earlier how polling can introduce a small amount of deadweight time when responding to a DOM change. Much of this risk hinges on the size of the interval you’re using, but it doesn’t help that both <code>setTimeout()</code> and <code>setInterval()</code> run their callbacks on the primary task queue, which means they’ll always run on a <em>future</em> iteration of the event loop.</p>\n<p>A MutationObserver, however, fires its callback on the <a href=\"https://dom.spec.whatwg.org/#queue-a-mutation-observer-compound-microtask\" target=\"_blank\" rel=\"noopener\">microtask queue</a>, which means it doesn’t need to wait around for a full rotation of the event loop before firing its callback. It’s far more responsive.</p>\n<p>I did a rudimentary experiment with this using <code>performance.now()</code> in the browser to see how long it took for the click event listener to be added to the button after it was mounted to the DOM. Remember, this was with a no delay being set in our <code>setTimeout()</code>, so the delay we see is likely the pace of the event loop turning itself (plus. Here are the results:</p>\n<table>\n<thead>\n<tr>\n<th><strong>Approach</strong></th>\n<th><strong>Delay to Add Listener</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>polling</td>\n<td>~8ms</td>\n</tr>\n<tr>\n<td>MutationObserver()</td>\n<td>~.09ms</td>\n</tr>\n</tbody>\n</table>\n<p>That’s a pretty staggering difference. Using polling with a zero-delay <code>setTimeout()</code> to attach a listener was around around 88 times slower than the MutationObserver. Not bad.</p>\n<h2>Stop Polling, Start Observing</h2>\n<p>Considering the performance benefits, the simpler API, and the ubiquitous browser support, it’s hard to bet on DOM polling when matched against a MutationObserver. I’m hoping you find it useful when working with eventually-mounted nodes in your own projects. I’ll be looking for other scenarios when it might come in handy myself.</p>\n",
        "feature_image": "https://images.unsplash.com/photo-1496096265110-f83ad7f96608?ixlib=rb-4.0.3&q=80&fm=jpg&crop=entropy&cs=tinysrgb",
        "status": "published",
        "created_at": 1676264400000,
        "published_at": 1676264400000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "meta_description": "Exploring how the MutationObserver API stacks up against the more traditional approach of polling for nodes that’ll eventually be created.",
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>Occasionally, you need to mess with a part of the DOM that doesn’t exist… yet.</p>\\n<p>There’s a variety of reasons the need could arise, but you might most often see it when dealing with third-party scripts that inject markup onto a page asynchronously. For example, I recently needed to update the UI whenever a user closed Google reCAPTCHA’s (v2) challenge. Responding to <code>blur</code> events like this isn’t officially supported by the tool, so I intended to wire up a listener myself. However, trying to access the node via something like <code>.querySelector()</code> yielded <code>null</code> because it hadn’t yet been rendered by the browser on page load, and I couldn’t know exactly when it’d happen.</p>\\n<p>To explore this a little more with a more contrived example, I’ve wired up a button to be mounted to the DOM after a random amount of time (between zero and five seconds). If I were to try to add an event listener to that button from the get-go, I’d get an exception.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token comment\\\">// Simulating lazily-rendered HTML:</span>\\n<span class=\\\"token function\\\">setTimeout</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n\\t<span class=\\\"token keyword\\\">const</span> button <span class=\\\"token operator\\\">=</span> <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">createElement</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'button'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  button<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">id</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">'button'</span><span class=\\\"token punctuation\\\">;</span>\\n  button<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">innerText</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">'Do Something!'</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">body</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">append</span><span class=\\\"token punctuation\\\">(</span>button<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token function\\\">randomBetweenMs</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token number\\\">1000</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">5000</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">querySelector</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'#button'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">addEventListener</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'click'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n\\t<span class=\\\"token function\\\">alert</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'clicked!'</span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// Error: Cannot read properties of null (reading 'addEventListener')</span>\\n</code></pre></div>\\n<p>Not surprising. All the code you see is being thrown onto the call stack and executed immediately (except, of course, <code>setTimeout()</code>’s callback), so by the time I try to access my button, all I find is <code>null</code>.</p>\\n<h2>You Could Try Polling</h2>\\n<p>To get around this, it’s common to use polling, querying the DOM every so often until the node appears. You might’ve seen approaches like this using <code>setInterval</code> or <code>setTimeout</code>, like this example using recursion:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\">attachListenerToButton</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">let</span> button <span class=\\\"token operator\\\">=</span> <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getElementById</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'button'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span>button<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    button<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">addEventListener</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'click'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token function\\\">alert</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'clicked!'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword control-flow\\\">return</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n\\t<span class=\\\"token comment\\\">// If the node doesn't exist yet, try</span>\\n\\t<span class=\\\"token comment\\\">// again on the next turn of the event loop.</span>\\n  <span class=\\\"token function\\\">setTimeout</span><span class=\\\"token punctuation\\\">(</span>attachListenerToButton<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token function\\\">attachListenerToButton</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>Or, you might’ve come across a Promise-based approach that <em>feels</em> a little more modern:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">async</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\">attachListenerToButton</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">let</span> button <span class=\\\"token operator\\\">=</span> <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getElementById</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'button'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword control-flow\\\">while</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>button<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n\\t\\t<span class=\\\"token comment\\\">// If the node doesn't exist yet, try</span>\\n\\t\\t<span class=\\\"token comment\\\">// again on the next turn of the event loop.</span>\\n    button <span class=\\\"token operator\\\">=</span> <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getElementById</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'button'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword control-flow\\\">await</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Promise</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">resolve</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token function\\\">setTimeout</span><span class=\\\"token punctuation\\\">(</span>resolve<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  button<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">addEventListener</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'click'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token function\\\">alert</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'clicked!'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token function\\\">attachListenerToButton</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>Either way, there are non-trivial costs to this sort of tactic — the primary one being performance. In both versions, removing <code>setTimeout()</code> would cause the script to run completely synchronously, blocking the main thread, along with any other task that needs to take place on it. No input events would be handled. Your tab would freeze. Chaos wouldn’t ensue.</p>\\n<p>Sticking a <code>setTimeout()</code> (or <code>setInterval</code>) in there kicks the next attempt onto the following iteration of the event loop, which allows other tasks to execute in the meantime. <strong>But you’re still repeatedly hogging the call stack waiting for your node to appear.</strong> Far less than ideal if you want your code to steward the event loop well.</p>\\n<p>You <em>could</em> lessen the call stack bloat by increasing the interval by which you query (like every 200ms). But you then risk something unexpected occurring between the time the node appears and when your work is performed. For example, if you’re doing something like adding a click event listener, you don’t want the user to have the chance to click the element <em>before</em> you’ve attached a listener several milliseconds later. Issues like this are probably few and far between, but they’ll certainly cause distress when you’re later debugging what might’ve gone wrong.</p>\\n<h2>MutationObserver(): A Tool Built for the Job</h2>\\n<p>The <a href=\\\"https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">MutationObserver API</a> has been around for a bit now, and is <a href=\\\"https://caniuse.com/mutationobserver\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">extremely well-supported in modern browsers</a>. It has a straightforward purpose: do something when the DOM tree changes (including when a node gets inserted). But as a native browser API, you don’t have the same performance concerns as you would with polling. A basic set up for observing any changes within the <code>body</code> looks like so:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-typescript\\\"><code class=\\\"language-typescript\\\"><span class=\\\"token keyword\\\">const</span> domObserver <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">MutationObserver</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span>mutationList<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n\\t<span class=\\\"token comment\\\">// document.body has changed! Do something.</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\ndomObserver<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">observe</span><span class=\\\"token punctuation\\\">(</span>document<span class=\\\"token punctuation\\\">.</span>body<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span> childList<span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">,</span> subtree<span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">true</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>Taking it a little further for our contrived example is fairly straightforward. Every time the tree has changed, we’ll query for the specific node. If exists, attach the listener.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> domObserver <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">MutationObserver</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> button <span class=\\\"token operator\\\">=</span> <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getElementById</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'button'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span>button<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    button<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">addEventListener</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'click'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token function\\\">alert</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'clicked!'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\ndomObserver<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">observe</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">body</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token literal-property property\\\">childList</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token literal-property property\\\">subtree</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">true</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>The options we’re passing to <code>.observe()</code> are important. Setting <code>childList</code> to <code>true</code> makes the observer watch for changes to the node we’re targeting (<code>document.body</code>), and <code>subtree: true</code> will cause all descendants to also be monitored. Admittedly, the API here wasn’t tremendously easy (for me) to grok, and it’s <a href=\\\"https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver/observe\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">worth spending a bit of time thinking through</a> before you use it for your own needs.</p>\\n<p>Regardless, this particular configuration is best for cases when you don’t know where the node might be injected. If you’re confident it’ll appear within a certain element, however, it’d be wise to target more narrowly.</p>\\n<h2>Important Step: Cleanup!</h2>\\n<p>If we left the observer as it is, we’d be at risk for adding another click event listener to the same button after <em>every</em> proceeding change to the DOM. You could remedy this by pulling click event callback into its own variable outside the MutationObserver’s callback (<code>.addEventListener()</code> won’t add a listener to a node with the same callback reference), but it’s far more intuitive to imperatively clean up the observer it’s once it’s no longer needed. There’s a nice method available on the observer to do that:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> domObserver <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">MutationObserver</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">_mutationList<span class=\\\"token punctuation\\\">,</span> observer</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> button <span class=\\\"token operator\\\">=</span> <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getElementById</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'button'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span>button<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    button<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">addEventListener</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'click'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'clicked!'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n\\t\\t<span class=\\\"token comment\\\">// No need to observe anymore. Clean up!</span>\\n    observer<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">disconnect</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<h2>So, how responsive is it?</h2>\\n<p>I mentioned earlier how polling can introduce a small amount of deadweight time when responding to a DOM change. Much of this risk hinges on the size of the interval you’re using, but it doesn’t help that both <code>setTimeout()</code> and <code>setInterval()</code> run their callbacks on the primary task queue, which means they’ll always run on a <em>future</em> iteration of the event loop.</p>\\n<p>A MutationObserver, however, fires its callback on the <a href=\\\"https://dom.spec.whatwg.org/#queue-a-mutation-observer-compound-microtask\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">microtask queue</a>, which means it doesn’t need to wait around for a full rotation of the event loop before firing its callback. It’s far more responsive.</p>\\n<p>I did a rudimentary experiment with this using <code>performance.now()</code> in the browser to see how long it took for the click event listener to be added to the button after it was mounted to the DOM. Remember, this was with a no delay being set in our <code>setTimeout()</code>, so the delay we see is likely the pace of the event loop turning itself (plus. Here are the results:</p>\\n<table>\\n<thead>\\n<tr>\\n<th><strong>Approach</strong></th>\\n<th><strong>Delay to Add Listener</strong></th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td>polling</td>\\n<td>~8ms</td>\\n</tr>\\n<tr>\\n<td>MutationObserver()</td>\\n<td>~.09ms</td>\\n</tr>\\n</tbody>\\n</table>\\n<p>That’s a pretty staggering difference. Using polling with a zero-delay <code>setTimeout()</code> to attach a listener was around around 88 times slower than the MutationObserver. Not bad.</p>\\n<h2>Stop Polling, Start Observing</h2>\\n<p>Considering the performance benefits, the simpler API, and the ubiquitous browser support, it’s hard to bet on DOM polling when matched against a MutationObserver. I’m hoping you find it useful when working with eventually-mounted nodes in your own projects. I’ll be looking for other scenarios when it might come in handy myself.</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 3,
        "title": "You’ve Got Options for Removing Event Listeners",
        "slug": "options-for-removing-event-listeners",
        "html": "<p>Cleaning up your code in runtime is a non-negotiable part of building efficient, predictable applications. One of the ways that’s done in JavaScript is by stewarding event listeners well — specifically, removing them when they’re no longer needed.</p>\n<p>There are several approaches available to do this, each with its own set of trade-offs that make it more appropriate in certain circumstances. We’re gonna run through a few of the most often used tactics, as well as a few considerations to keep in mind when you’re trying to decide which is best for the job at any given time.</p>\n<p>We’ll be tinkering with the following setup — a button with a single <code>click</code> event listener attached:</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>button</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>button<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Do Something<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>button</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n<span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'clicked!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>script</span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<p>Using <a href=\"https://developer.chrome.com/docs/devtools/console/utilities/#getEventListeners-function\" target=\"_blank\" rel=\"noopener\">Chrome’s </a><a href=\"https://developer.chrome.com/docs/devtools/console/utilities/#getEventListeners-function\" target=\"_blank\" rel=\"noopener\"><code>getEventListeners()</code></a><a href=\"https://developer.chrome.com/docs/devtools/console/utilities/#getEventListeners-function\" target=\"_blank\" rel=\"noopener\"> function</a>, you’d see just one listener attached to that element:</p>\n<p><img src='/proxy/0cbf857b-cf0d-46dc-9841-a7da5629d310' alt='' loading='lazy' /></p>\n<p>In the event that you’d need to remove that listener, here’s what you might reach for.</p>\n<h2>Using .removeEventListener()</h2>\n<p>It’s probably the most obvious, but also the one with the most potential to threaten your sanity. The <code>.removeEventListener()</code> method accepts three parameters: the type of listener to remove, the callback function for that listener, and an options object.</p>\n<p>But herein lies the (potentially) tricky part: those exact parameters must <em>exactly</em> match what were used when then the listener was set up, including the <em>same reference</em> in to the callback in memory. Otherwise, <code>.removeEventListener()</code> does nothing.</p>\n<p>With that in mind, this would be totally ineffective:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'clicked!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'clicked!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Even though that callback <em>looks</em> identical to the one originally attached, it’s not the <em>same reference</em>. The solution to this is to set the callback to a variable and reference it in both <code>.addEventListener()</code> and <code>.removeEventListener()</code>.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">myCallback</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'clicked!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> myCallback<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> myCallback<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Or, for particular use cases, you could also remove the listener by referencing a pseudo-anonymous function from within the function itself:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token dom variable\">document</span>\n  <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token function\">myCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'clicked!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> myCallback<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Despite its particularity, <code>.removeEventListener()</code> has the advantages of being very explicit in its purpose. There’s zero doubt as to what it’s doing when you’re reading through the code.</p>\n<h2>Using <code>.addEventListener()</code>’s <code>once</code> Option</h2>\n<p>The <code>.addEventListener()</code> method comes with a tool to help clean itself up if it’s intended for a one-time use: the <code>once</code> option. It’s about as simple as it sounds. If it’s set to <code>true</code>, the listener will automatically remove itself after first being invoked:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> button <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nbutton<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'clicked!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">once</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 'clicked!'</span>\nbutton<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">click</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// No more listeners!</span>\n<span class=\"token function\">getEventListeners</span><span class=\"token punctuation\">(</span>button<span class=\"token punctuation\">)</span> <span class=\"token comment\">// {} </span>\n</code></pre></div>\n<p>Assuming it fits your use case, this approach might be appropriate if you’re keen on using an anonymous function, given that your listener only needs to be invoked once.</p>\n<h2>Cloning &#x26; Replacing the Node</h2>\n<p>Sometimes, you don’t know about all the listeners active on a given node, but you do know you want to nuke them. In that case, it’s possible to clone the entire node and replace itself with that clone. Using the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Node/cloneNode\" target=\"_blank\" rel=\"noopener\"><code>.cloneNode()</code></a><a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Node/cloneNode\" target=\"_blank\" rel=\"noopener\"> method</a>, none of the listeners attached via <code>.addEventListener()</code> will be carried over, giving it a clean slate.</p>\n<p>Back in the stone age of client-side JavaScript, you would’ve seen this done by querying up to the parent, and replacing a particular child node with a clone:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\">button<span class=\"token punctuation\">.</span><span class=\"token property-access\">parentNode</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">replaceChild</span><span class=\"token punctuation\">(</span>button<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">cloneNode</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> button<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>But in modern browsers, that can be simplified with <code>.replaceWith()</code>:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\">button<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">replaceWith</span><span class=\"token punctuation\">(</span>button<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">cloneNode</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>The one thing that could potentially trip you up here is that intrinsic listeners <em>are preserved,</em> meaning a button with an <code>onclick</code> attribute would still fire as defined:</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>button</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>button<span class=\"token punctuation\">\"</span></span> <span class=\"token special-attr\"><span class=\"token attr-name\">onclick</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token value javascript language-javascript\"><span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'clicked!'</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">\"</span></span></span><span class=\"token punctuation\">></span></span>\n\tDo Something\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>button</span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<p>In all, it’s an option worth reaching for if you need to indiscriminately remove listeners of any sort with brute force. On the downside, however, it suffers from being less obvious about its purpose. Some might go so far as to call it a hack.</p>\n<h2>Using <code>AbortController()</code></h2>\n<p>This one’s new to me. I literally just read about it when I came across <a href=\"https://twitter.com/calebporzio/status/1617939346786779136?s=20&#x26;t=hudHTQt9g3BBoDVpLwoM9A\" target=\"_blank\" rel=\"noopener\">this tweet</a> from Caleb Porzio. If you’re like me, you might’ve only heard of an <code>AbortController</code> being used to <a href=\"https://javascript.info/fetch-abort#using-with-fetch\" target=\"_blank\" rel=\"noopener\">cancel </a><a href=\"https://javascript.info/fetch-abort#using-with-fetch\" target=\"_blank\" rel=\"noopener\"><code>fetch()</code></a><a href=\"https://javascript.info/fetch-abort#using-with-fetch\" target=\"_blank\" rel=\"noopener\"> requests</a>. But it’s apparently more flexible than that.</p>\n<p>As of recently, <code>.addEventListener()</code> can be configured with a <code>signal</code> for imperatively aborting/removing a listener. When the respective controller calls <code>.abort()</code>, that signal will trigger the listener to be removed:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> button <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> controller <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AbortController</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> signal <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> controller<span class=\"token punctuation\">;</span>\n\nbutton<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'clicked!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> signal <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Remove the listener!</span>\ncontroller<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">abort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>The most apparent advantage to this might be the ergonomics. It’s (in my opinion) a much clearer way of removing a listener without the potential gotcha of dealing with <code>.removeEventListener()</code>. But there’s a more tactical advantage too: you can use one signal to remove multiple listeners, of any sort, all at once. And using anonymous functions is totally fine too:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> button <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> controller <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AbortController</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> signal <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> controller<span class=\"token punctuation\">;</span>\n\nbutton<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'clicked!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> signal <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'resize'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'resized!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> signal <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'keyup'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'pressed!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> signal <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Remove all listeners at once:</span>\ncontroller<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">abort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>The only cause for hesitancy I came across is browser support. It’s a relatively new feature, with full support existing in Chrome <a href=\"https://chromium-review.googlesource.com/c/chromium/src/+/2657187\" target=\"_blank\" rel=\"noopener\">only since 2021</a> (v90). So, keep this in mind if you need to support browser versions beyond only a couple years old.</p>\n<h2>Which Should I Choose?</h2>\n<p>As with everything else, “it depends.” Still, here’s how I might choose one over the other at a moment’s notice:</p>\n<ul>\n<li>Use <code>.removeEventListener()</code> if the callback function is assigned to a variable and within easy reach of where the listener was added.</li>\n<li>Use the <code>once</code> option in <code>.addEventListener()</code> if you need to fire a callback only once (duh).</li>\n<li>Use the clone &#x26; replace approach if you need to indiscriminately nuke multiple listeners in one fell swoop.</li>\n<li>Use <code>AbortController()</code> if you have a series of listeners you’d like to imperatively remove at once, or if you just like the syntax.</li>\n</ul>\n<h2>What’s Missing?</h2>\n<p>It’s very possible I’m missing another option in addition to these. If you happen to have one, feel free to drop a comment or let me know by some other means. At the very least, I hope this helps to mentally organize some of the the several paths available to clean up event listeners, and to also help prep your brain for the next time you need to manage them in your code.</p>\n",
        "feature_image": "https://images.unsplash.com/photo-1493953659556-556b14bdaca8?ixlib=rb-4.0.3&q=80&fm=jpg&crop=entropy&cs=tinysrgb",
        "status": "published",
        "created_at": 1674882000000,
        "published_at": 1674882000000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "meta_description": "Reviewing some of the most common approaches available to remove event listeners in JavaScript.",
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>Cleaning up your code in runtime is a non-negotiable part of building efficient, predictable applications. One of the ways that’s done in JavaScript is by stewarding event listeners well — specifically, removing them when they’re no longer needed.</p>\\n<p>There are several approaches available to do this, each with its own set of trade-offs that make it more appropriate in certain circumstances. We’re gonna run through a few of the most often used tactics, as well as a few considerations to keep in mind when you’re trying to decide which is best for the job at any given time.</p>\\n<p>We’ll be tinkering with the following setup — a button with a single <code>click</code> event listener attached:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>button</span> <span class=\\\"token attr-name\\\">id</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>button<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>Do Something<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>button</span><span class=\\\"token punctuation\\\">></span></span>\\n\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>script</span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token script\\\"><span class=\\\"token language-javascript\\\">\\n<span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getElementById</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'button'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">addEventListener</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'click'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n\\t<span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'clicked!'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</span></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>script</span><span class=\\\"token punctuation\\\">></span></span>\\n</code></pre></div>\\n<p>Using <a href=\\\"https://developer.chrome.com/docs/devtools/console/utilities/#getEventListeners-function\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Chrome’s </a><a href=\\\"https://developer.chrome.com/docs/devtools/console/utilities/#getEventListeners-function\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\"><code>getEventListeners()</code></a><a href=\\\"https://developer.chrome.com/docs/devtools/console/utilities/#getEventListeners-function\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\"> function</a>, you’d see just one listener attached to that element:</p>\\n<p><img src='/proxy/0cbf857b-cf0d-46dc-9841-a7da5629d310' alt='' loading='lazy' /></p>\\n<p>In the event that you’d need to remove that listener, here’s what you might reach for.</p>\\n<h2>Using .removeEventListener()</h2>\\n<p>It’s probably the most obvious, but also the one with the most potential to threaten your sanity. The <code>.removeEventListener()</code> method accepts three parameters: the type of listener to remove, the callback function for that listener, and an options object.</p>\\n<p>But herein lies the (potentially) tricky part: those exact parameters must <em>exactly</em> match what were used when then the listener was set up, including the <em>same reference</em> in to the callback in memory. Otherwise, <code>.removeEventListener()</code> does nothing.</p>\\n<p>With that in mind, this would be totally ineffective:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getElementById</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'button'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">addEventListener</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'click'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n\\t<span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'clicked!'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getElementById</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'button'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">removeEventListener</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'click'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n\\t<span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'clicked!'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>Even though that callback <em>looks</em> identical to the one originally attached, it’s not the <em>same reference</em>. The solution to this is to set the callback to a variable and reference it in both <code>.addEventListener()</code> and <code>.removeEventListener()</code>.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">myCallback</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'clicked!'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getElementById</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'button'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">addEventListener</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'click'</span><span class=\\\"token punctuation\\\">,</span> myCallback<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getElementById</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'button'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">removeEventListener</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'click'</span><span class=\\\"token punctuation\\\">,</span> myCallback<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>Or, for particular use cases, you could also remove the listener by referencing a pseudo-anonymous function from within the function itself:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token dom variable\\\">document</span>\\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getElementById</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'button'</span><span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">addEventListener</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'click'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\">myCallback</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'clicked!'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">removeEventListener</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'click'</span><span class=\\\"token punctuation\\\">,</span> myCallback<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>Despite its particularity, <code>.removeEventListener()</code> has the advantages of being very explicit in its purpose. There’s zero doubt as to what it’s doing when you’re reading through the code.</p>\\n<h2>Using <code>.addEventListener()</code>’s <code>once</code> Option</h2>\\n<p>The <code>.addEventListener()</code> method comes with a tool to help clean itself up if it’s intended for a one-time use: the <code>once</code> option. It’s about as simple as it sounds. If it’s set to <code>true</code>, the listener will automatically remove itself after first being invoked:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> button <span class=\\\"token operator\\\">=</span> <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getElementById</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'button'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\nbutton<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">addEventListener</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'click'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n\\t<span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'clicked!'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token literal-property property\\\">once</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">true</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// 'clicked!'</span>\\nbutton<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">click</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// No more listeners!</span>\\n<span class=\\\"token function\\\">getEventListeners</span><span class=\\\"token punctuation\\\">(</span>button<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token comment\\\">// {} </span>\\n</code></pre></div>\\n<p>Assuming it fits your use case, this approach might be appropriate if you’re keen on using an anonymous function, given that your listener only needs to be invoked once.</p>\\n<h2>Cloning &#x26; Replacing the Node</h2>\\n<p>Sometimes, you don’t know about all the listeners active on a given node, but you do know you want to nuke them. In that case, it’s possible to clone the entire node and replace itself with that clone. Using the <a href=\\\"https://developer.mozilla.org/en-US/docs/Web/API/Node/cloneNode\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\"><code>.cloneNode()</code></a><a href=\\\"https://developer.mozilla.org/en-US/docs/Web/API/Node/cloneNode\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\"> method</a>, none of the listeners attached via <code>.addEventListener()</code> will be carried over, giving it a clean slate.</p>\\n<p>Back in the stone age of client-side JavaScript, you would’ve seen this done by querying up to the parent, and replacing a particular child node with a clone:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\">button<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">parentNode</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">replaceChild</span><span class=\\\"token punctuation\\\">(</span>button<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">cloneNode</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> button<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>But in modern browsers, that can be simplified with <code>.replaceWith()</code>:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\">button<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">replaceWith</span><span class=\\\"token punctuation\\\">(</span>button<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">cloneNode</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>The one thing that could potentially trip you up here is that intrinsic listeners <em>are preserved,</em> meaning a button with an <code>onclick</code> attribute would still fire as defined:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>button</span> <span class=\\\"token attr-name\\\">id</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>button<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token special-attr\\\"><span class=\\\"token attr-name\\\">onclick</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span><span class=\\\"token value javascript language-javascript\\\"><span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'clicked!'</span><span class=\\\"token punctuation\\\">)</span></span><span class=\\\"token punctuation\\\">\\\"</span></span></span><span class=\\\"token punctuation\\\">></span></span>\\n\\tDo Something\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>button</span><span class=\\\"token punctuation\\\">></span></span>\\n</code></pre></div>\\n<p>In all, it’s an option worth reaching for if you need to indiscriminately remove listeners of any sort with brute force. On the downside, however, it suffers from being less obvious about its purpose. Some might go so far as to call it a hack.</p>\\n<h2>Using <code>AbortController()</code></h2>\\n<p>This one’s new to me. I literally just read about it when I came across <a href=\\\"https://twitter.com/calebporzio/status/1617939346786779136?s=20&#x26;t=hudHTQt9g3BBoDVpLwoM9A\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">this tweet</a> from Caleb Porzio. If you’re like me, you might’ve only heard of an <code>AbortController</code> being used to <a href=\\\"https://javascript.info/fetch-abort#using-with-fetch\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">cancel </a><a href=\\\"https://javascript.info/fetch-abort#using-with-fetch\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\"><code>fetch()</code></a><a href=\\\"https://javascript.info/fetch-abort#using-with-fetch\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\"> requests</a>. But it’s apparently more flexible than that.</p>\\n<p>As of recently, <code>.addEventListener()</code> can be configured with a <code>signal</code> for imperatively aborting/removing a listener. When the respective controller calls <code>.abort()</code>, that signal will trigger the listener to be removed:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> button <span class=\\\"token operator\\\">=</span> <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getElementById</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'button'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">const</span> controller <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">AbortController</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">{</span> signal <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token operator\\\">=</span> controller<span class=\\\"token punctuation\\\">;</span>\\n\\nbutton<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">addEventListener</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'click'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'clicked!'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span> signal <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// Remove the listener!</span>\\ncontroller<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">abort</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>The most apparent advantage to this might be the ergonomics. It’s (in my opinion) a much clearer way of removing a listener without the potential gotcha of dealing with <code>.removeEventListener()</code>. But there’s a more tactical advantage too: you can use one signal to remove multiple listeners, of any sort, all at once. And using anonymous functions is totally fine too:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> button <span class=\\\"token operator\\\">=</span> <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getElementById</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'button'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">const</span> controller <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">AbortController</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">{</span> signal <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token operator\\\">=</span> controller<span class=\\\"token punctuation\\\">;</span>\\n\\nbutton<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">addEventListener</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'click'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'clicked!'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span> signal <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token dom variable\\\">window</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">addEventListener</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'resize'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'resized!'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span> signal <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">addEventListener</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'keyup'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'pressed!'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span> signal <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// Remove all listeners at once:</span>\\ncontroller<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">abort</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>The only cause for hesitancy I came across is browser support. It’s a relatively new feature, with full support existing in Chrome <a href=\\\"https://chromium-review.googlesource.com/c/chromium/src/+/2657187\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">only since 2021</a> (v90). So, keep this in mind if you need to support browser versions beyond only a couple years old.</p>\\n<h2>Which Should I Choose?</h2>\\n<p>As with everything else, “it depends.” Still, here’s how I might choose one over the other at a moment’s notice:</p>\\n<ul>\\n<li>Use <code>.removeEventListener()</code> if the callback function is assigned to a variable and within easy reach of where the listener was added.</li>\\n<li>Use the <code>once</code> option in <code>.addEventListener()</code> if you need to fire a callback only once (duh).</li>\\n<li>Use the clone &#x26; replace approach if you need to indiscriminately nuke multiple listeners in one fell swoop.</li>\\n<li>Use <code>AbortController()</code> if you have a series of listeners you’d like to imperatively remove at once, or if you just like the syntax.</li>\\n</ul>\\n<h2>What’s Missing?</h2>\\n<p>It’s very possible I’m missing another option in addition to these. If you happen to have one, feel free to drop a comment or let me know by some other means. At the very least, I hope this helps to mentally organize some of the the several paths available to clean up event listeners, and to also help prep your brain for the next time you need to manage them in your code.</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 4,
        "title": "Use the .matches() Method to Determine if a Selector Matches an Element",
        "slug": "ways-to-check-if-element-matches-selector",
        "html": "<p>I’m rather late to the party, but I recently ran across JavaScript’s <code>Element.matches()</code>, which allows you to check if a given CSS selector matches an element. Put another way, it tells you if an element <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Element/matches\" target=\"_blank\" rel=\"noopener\"><em>would be</em></a><a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Element/matches\" target=\"_blank\" rel=\"noopener\"> selected</a> if the DOM were being queried by something like <code>document.querySelector()</code>.</p>\n<h3>Why I Needed It</h3>\n<p><a href=\"https://typeitjs.com/\" target=\"_blank\" rel=\"noopener\">TypeIt</a> offers a <code>.move()</code> method that allows someone to move the cursor through a string to a certain selector (<em>any</em> valid CSS selector in the HTML). As a part of that somewhat complex process, I’m searching an array of nodes for the index that has this selector. Again, because I can’t know what the selector is, I couldn’t reach for something like <code>.classList.contains('my-selector')</code>. At a super zoomed-in level, I’m instead doing a version of this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> nodeIndex <span class=\"token operator\">=</span> allNodes<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">findIndex</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span> <span class=\"token arrow operator\">=></span> n<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">matches</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.selector'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>It’s a little bit of a face-palm moment, because although it’s supported in browsers going back to IE9, I’ve been using less-than-ideal techniques used in the past. This is post was written to honor them before saying goodbye forever.</p>\n<h2>Using Element.closest()</h2>\n<p>Using <code>.closest()</code> allows you to query <em>up</em> through the DOM tree rather than down, and it starts that query with the element on which it’s called. So, if the node itself matches that selector, you’ll get a truthy result. But this approach requires you to verify that the node you’ve found is the same node you’re interested in checking. Otherwise, you’ll still get a truthy result when <code>.closest()</code> matches against a parent element that happens to have the same selector.</p>\n<p>Wrapping up this functionality might look like so:</p>\n<div class=\"remark-highlight\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">function</span> <span class=\"token function\">hasSelector</span><span class=\"token punctuation\">(</span>element<span class=\"token operator\">:</span> HTMLElement<span class=\"token punctuation\">,</span> selector<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> matchedNode <span class=\"token operator\">=</span> node<span class=\"token punctuation\">.</span><span class=\"token function\">closest</span><span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>matchedNode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> matchedNode <span class=\"token operator\">===</span> element<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>There’s another downside worth noting. Because <code>.closest()</code> will continue traversing up the tree when it doesn’t find a match, you’re taking on some performance baggage. After all, you’re only actually interested in checking <em>one</em> element, but <code>.closest()</code> will keep searching all the way up the tree if it hasn’t found a match.</p>\n<h2>Checking the Parent’s Children for Same Node</h2>\n<p>You can’t use <code>.querySelector()</code> on an element to check itself for a selector, but you <em>can</em> check each of the parent’s children for it. If any of those matched elements are the same node as the target, you’ve got what you need.</p>\n<div class=\"remark-highlight\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">function</span> <span class=\"token function\">hasSelector</span><span class=\"token punctuation\">(</span>element<span class=\"token operator\">:</span> HTMLElement<span class=\"token punctuation\">,</span> selector<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>element<span class=\"token punctuation\">.</span>parentElement<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">return</span> <span class=\"token builtin\">Array</span><span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">.</span>parentElement<span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">some</span><span class=\"token punctuation\">(</span>\n\t\t<span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> node <span class=\"token operator\">===</span> element\n\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>In terms of performance, this approach is better than the previous because the maximum amount of DOM you’ll crawl is the target element’s direct parent. But readability arguably suffers, and depending on your DOM tree, you still carry some performance overhead because you’re evaluating multiple sibling elements, even though you’re concerned with only one.</p>\n<h2>Welcome to the 21st Century</h2>\n<p>With the <code>.matches()</code> method available, neither performance nor verbosity are problems anymore. Only one element — the target element — is ever being handled at a time. On top of that, the API is extremely clear. I’m still kicking myself that this thing has been around for years (and even longer if you consider the <a href=\"https://sd.blackball.lv/library/DOM_Enlightenment_(2013).pdf\" target=\"_blank\" rel=\"noopener\">browser-specific implementations</a> that existed before that). Hope you find it as useful as I have!</p>\n",
        "feature_image": "https://images.unsplash.com/photo-1520500807606-4ac9ae633574?ixlib=rb-4.0.3&q=80&fm=jpg&crop=entropy&cs=tinysrgb",
        "status": "published",
        "created_at": 1674277200000,
        "published_at": 1674277200000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "meta_description": "A Superior, Native Alternative to the Lame Approaches I’ve Used in the Past",
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>I’m rather late to the party, but I recently ran across JavaScript’s <code>Element.matches()</code>, which allows you to check if a given CSS selector matches an element. Put another way, it tells you if an element <a href=\\\"https://developer.mozilla.org/en-US/docs/Web/API/Element/matches\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\"><em>would be</em></a><a href=\\\"https://developer.mozilla.org/en-US/docs/Web/API/Element/matches\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\"> selected</a> if the DOM were being queried by something like <code>document.querySelector()</code>.</p>\\n<h3>Why I Needed It</h3>\\n<p><a href=\\\"https://typeitjs.com/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">TypeIt</a> offers a <code>.move()</code> method that allows someone to move the cursor through a string to a certain selector (<em>any</em> valid CSS selector in the HTML). As a part of that somewhat complex process, I’m searching an array of nodes for the index that has this selector. Again, because I can’t know what the selector is, I couldn’t reach for something like <code>.classList.contains('my-selector')</code>. At a super zoomed-in level, I’m instead doing a version of this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> nodeIndex <span class=\\\"token operator\\\">=</span> allNodes<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">findIndex</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">n</span> <span class=\\\"token arrow operator\\\">=></span> n<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">matches</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'.selector'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>It’s a little bit of a face-palm moment, because although it’s supported in browsers going back to IE9, I’ve been using less-than-ideal techniques used in the past. This is post was written to honor them before saying goodbye forever.</p>\\n<h2>Using Element.closest()</h2>\\n<p>Using <code>.closest()</code> allows you to query <em>up</em> through the DOM tree rather than down, and it starts that query with the element on which it’s called. So, if the node itself matches that selector, you’ll get a truthy result. But this approach requires you to verify that the node you’ve found is the same node you’re interested in checking. Otherwise, you’ll still get a truthy result when <code>.closest()</code> matches against a parent element that happens to have the same selector.</p>\\n<p>Wrapping up this functionality might look like so:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-typescript\\\"><code class=\\\"language-typescript\\\"><span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\">hasSelector</span><span class=\\\"token punctuation\\\">(</span>element<span class=\\\"token operator\\\">:</span> HTMLElement<span class=\\\"token punctuation\\\">,</span> selector<span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">string</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">boolean</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> matchedNode <span class=\\\"token operator\\\">=</span> node<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">closest</span><span class=\\\"token punctuation\\\">(</span>selector<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>matchedNode<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">return</span> <span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token keyword\\\">return</span> matchedNode <span class=\\\"token operator\\\">===</span> element<span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p>There’s another downside worth noting. Because <code>.closest()</code> will continue traversing up the tree when it doesn’t find a match, you’re taking on some performance baggage. After all, you’re only actually interested in checking <em>one</em> element, but <code>.closest()</code> will keep searching all the way up the tree if it hasn’t found a match.</p>\\n<h2>Checking the Parent’s Children for Same Node</h2>\\n<p>You can’t use <code>.querySelector()</code> on an element to check itself for a selector, but you <em>can</em> check each of the parent’s children for it. If any of those matched elements are the same node as the target, you’ve got what you need.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-typescript\\\"><code class=\\\"language-typescript\\\"><span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\">hasSelector</span><span class=\\\"token punctuation\\\">(</span>element<span class=\\\"token operator\\\">:</span> HTMLElement<span class=\\\"token punctuation\\\">,</span> selector<span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">string</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">boolean</span> <span class=\\\"token punctuation\\\">{</span>\\n\\t<span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>element<span class=\\\"token punctuation\\\">.</span>parentElement<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n\\t\\t<span class=\\\"token keyword\\\">return</span> <span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">;</span>\\n\\t<span class=\\\"token punctuation\\\">}</span>\\n\\n\\t<span class=\\\"token keyword\\\">return</span> <span class=\\\"token builtin\\\">Array</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">from</span><span class=\\\"token punctuation\\\">(</span>element<span class=\\\"token punctuation\\\">.</span>parentElement<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">querySelectorAll</span><span class=\\\"token punctuation\\\">(</span>selector<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">some</span><span class=\\\"token punctuation\\\">(</span>\\n\\t\\t<span class=\\\"token punctuation\\\">(</span>node<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> node <span class=\\\"token operator\\\">===</span> element\\n\\t<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p>In terms of performance, this approach is better than the previous because the maximum amount of DOM you’ll crawl is the target element’s direct parent. But readability arguably suffers, and depending on your DOM tree, you still carry some performance overhead because you’re evaluating multiple sibling elements, even though you’re concerned with only one.</p>\\n<h2>Welcome to the 21st Century</h2>\\n<p>With the <code>.matches()</code> method available, neither performance nor verbosity are problems anymore. Only one element — the target element — is ever being handled at a time. On top of that, the API is extremely clear. I’m still kicking myself that this thing has been around for years (and even longer if you consider the <a href=\\\"https://sd.blackball.lv/library/DOM_Enlightenment_(2013).pdf\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">browser-specific implementations</a> that existed before that). Hope you find it as useful as I have!</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 5,
        "title": "What I Like About Astro",
        "slug": "what-i-like-about-astro",
        "html": "<p>This site’s been on Next.js since 2021, and I’ve had very few complaints about it. I’ve appreciated things like its slick developer experience, the first-class support it enjoys from Vercel for features like incremental static regeneration, and the constant innovation driven by its community. It’s a great tool, and my high view of it hasn’t really changed since I first took it on.</p>\n<p>But in the meantime, a couple of things started to happen. First off, I began to feel more uncomfortable with the amount of JavaScript I was shipping for a very small amount of interactivity on my site (it’s mainly just content). In terms of standard performance metrics, Next does a great job at generating a fast experience by default. The built output loads assets in the right way, at the right time, and with the right priority. But even so, it still comes with a lot of code that users needs to download, parse, and execute, even though they’re only there to read a blog post. “Irresponsible” is too strong of a word, but the feeling I started to foster was in that same vein.</p>\n<p>Second, the tooling landscape changed (as it always does), and Astro came onto the scene. It promised a lot of the ergonomics Next offers, but even more flexibility (you can use any mainstream framework you want while also shipping no JavaScript by default). It touted some big value propositions, but it wasn’t a bandwagon I immediately joined.</p>\n<p>But after many months of waiting for the hype to cool down, I decided to try building an integration for <a href=\"https://jamcomments.com/\" target=\"_blank\" rel=\"noopener\">JamComments</a>. I was floored by how easy it was. So, I took the next step and moved over my entire site. As I made that migration, I began to mentally organize some of my favorite things about the framework. Here they are. Keep in mind, these items don’t take into account the breadth of what Astro can do. It only considers what I encountered in migrating over my personal blog.</p>\n<h2>#1. It supports extremely unopinionated data sourcing.</h2>\n<p>I was a victim of the Gatsby.js hype a few years ago. It was one of the first React-based static site generators with some momentum behind it at the time, and it also went all-in on using GraphQL as the protocol that supported its “<a href=\"https://www.gatsbyjs.com/blog/2018-10-04-journey-to-the-content-mesh/\" target=\"_blank\" rel=\"noopener\">content mesh</a>.” These bold opinions and big words wooed me and several others, making us completely blind to the overabundance of complexity the approach brought with it. It didn’t take long for the excitement to wear off and the overbearing friction to become apparent.</p>\n<p>Next was better. It didn’t care about how you sourced your data, so long as you did so using hooks like <code>getStaticProps()</code> within a file that exists inside the <code>pages</code> directory. (This was before the entrance of React Server Components and Next 13+ that permits you to <a href=\"https://nextjs.org/docs/data-fetching/fundamentals\" target=\"_blank\" rel=\"noopener\">collocate your components &#x26; data fetching</a>.) Still, there were some moments when I wished I could break free from those constraints a bit.</p>\n<p>Astro takes it multiple steps further, however. There’s no particular function I need to export. In fact, I don’t need to use a separate function at all — top-level <code>await</code> is <a href=\"https://docs.astro.build/en/guides/data-fetching/#fetch-in-astro\" target=\"_blank\" rel=\"noopener\">supported out-of-the box</a>. All I need to do is set my variables and use them in my template. Done.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token operator\">--</span><span class=\"token operator\">-</span>\n<span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://an-endpoint.com/api'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> response<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">--</span><span class=\"token operator\">-</span>\n\n<span class=\"token operator\">&#x3C;</span>p<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">.</span><span class=\"token property-access\">a_property</span><span class=\"token punctuation\">}</span><span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>p<span class=\"token operator\">></span>\n</code></pre></div>\n<p>Crazily enough, you can even do stuff like this (stolen straight from <a href=\"https://docs.astro.build/en/reference/directives-reference/#sethtml\" target=\"_blank\" rel=\"noopener\">their documentation</a>):</p>\n<p><img src='/proxy/cb36379e-46dd-4f8f-97e4-187ed3d5b728' alt='' loading='lazy' /></p>\n<p>I imagine many don’t find this prescriptive enough. There are probably very good reasons to be wary of the risk this introduces for shooting yourself in the foot. But for a dude just looking to build a simple blog, I highly appreciate this freedom.</p>\n<h2>#2. There’s first-class (or readily available) support for integrations to take care of the boring stuff.</h2>\n<p>It’s easy enough to spit out some posts and pages. That’s the fun part. But if you’re going to build a site that’s syndication-ready, SEO-friendly, and as fast as possible, you also need worry about things like RSS feeds, sitemaps, and asset optimization. In my opinion, these are pretty boring processes to set up.</p>\n<p>These are things that Gatsby, with its rich ecosystem of plugins, does well. If it doesn’t have an official plugin available, there’s likely one supported by the community at large. I recall relying on these plugins for <a href=\"https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-plugin-sitemap\" target=\"_blank\" rel=\"noopener\">my sitemap</a>, <a href=\"https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-plugin-image\" target=\"_blank\" rel=\"noopener\">image optimization</a>, and <a href=\"https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-plugin-feed\" target=\"_blank\" rel=\"noopener\">RSS feed</a> with little issue. And for the things they didn’t directly support, there was often dedicated documentation on standing it up on my own. Like <a href=\"https://www.gatsbyjs.com/docs/how-to/adding-common-features/adding-seo-component/\" target=\"_blank\" rel=\"noopener\">how to build an SEO component</a> for my blog.</p>\n<p>Next, however, has some room for improvement. To be fair, I don’t believe Next has ever billed itself as a content-focused framework to the same degree as Gatsby. At any rate, I remember it being more than trivial to get my site going with these must-haves. I ended up rolling my own <a href=\"https://github.com/alexmacarthur/macarthur-me-next/blob/main/scripts/generateSitemap.ts\" target=\"_blank\" rel=\"noopener\">sitemap</a> and <a href=\"https://github.com/alexmacarthur/macarthur-me-next/blob/main/scripts/generateRssFeed.tsx\" target=\"_blank\" rel=\"noopener\">RSS feed</a> (with the help of a couple other dependencies), and I believe I built <a href=\"https://github.com/alexmacarthur/macarthur-me-next/blob/main/components/meta.tsx\" target=\"_blank\" rel=\"noopener\">my own component to handle basic SEO configuration</a> after seeking inspiration from some other blogs.</p>\n<p>Doing all of this with Astro was pretty darn straightforward. It has official support for things like <a href=\"https://docs.astro.build/en/guides/integrations-guide/sitemap/\" target=\"_blank\" rel=\"noopener\">generating a sitemap</a>, <a href=\"https://docs.astro.build/en/guides/rss/\" target=\"_blank\" rel=\"noopener\">exposing an RSS feed</a>, and <a href=\"https://docs.astro.build/en/guides/images/#astros-image-integration\" target=\"_blank\" rel=\"noopener\">optimizing images.</a> And for stuff like managing SEO meta data, some <a href=\"https://github.com/jonasmerlin/astro-seo\" target=\"_blank\" rel=\"noopener\">pretty good open source packages</a> exist. In the end, there wasn’t much pain in setting up these non-negotiables.</p>\n<h2>#3. It’s really hard to write an unperformant site.</h2>\n<p>This is where Astro really shines. By default, there’s no JavaScript shipped to the client for an Astro site. Coming off of multiple React-based frameworks from the past few years, it’s still a little bonkers to me that I get to keep the ergonomics of writing modular components, but without consequence to the user.</p>\n<p>In fact, I’ve been so happy with the feel of <a href=\"https://docs.astro.build/en/core-concepts/astro-components/\" target=\"_blank\" rel=\"noopener\">Astro’s proprietary component syntax</a>, that I’ve been using them exclusively. The learning curve was minimal, especially since it’s so heavily inspired by React’s API. As I built out the pieces of my site, I came to truly realize how much I didn’t enjoy writing <em>React</em> so much as I liked the <em>mental modal</em> that React’s adopted. With any given Astro component, I get all the benefits of writing basic presentational components — a bit of logic, a templating system that I like, and even props. But unlike React, <em>none</em> of that code results in any more JavaScript being shipped to my users. And that makes it <em>really hard</em> to build a slow, bloated site.</p>\n<p>But there’s more available in Astro to aid in strong site performance too. It’s been really pioneering its <a href=\"https://docs.astro.build/en/concepts/islands/\" target=\"_blank\" rel=\"noopener\">“islands” architecture</a>, which allows you to easily opt into client-side interactivity on a per-component basis. But even if you don’t go that route, you’re free to use a good, ol’ <code>&#x3C;script></code> tag in any of your components. <a href=\"https://docs.astro.build/en/guides/client-side-scripts/#using-script-in-astro\" target=\"_blank\" rel=\"noopener\">Each of them will be automatically hoisted</a>, deduplicated, and optimized on build. So, where interactivity is needed, it’s easy enough to sprinkle it in without a huge impact to your bundle. You get the banana without the gorilla.</p>\n<h2>#4. Much of the API is built on web standards.</h2>\n<p>This is a smaller one, but still something I really admire. Much of Astro’s lower-level API is based on web standards, which makes the learning curve a little smoother. For example, the <code>Astro.request</code> object is just an <a href=\"https://docs.astro.build/en/reference/api-reference/#astrorequest\" target=\"_blank\" rel=\"noopener\">instance of Request</a>. You can freely use <code>fetch()</code> for <a href=\"https://docs.astro.build/en/guides/data-fetching/#fetch-in-astro\" target=\"_blank\" rel=\"noopener\">retrieving any data</a>. Its <a href=\"https://docs.astro.build/en/guides/server-side-rendering/#response\" target=\"_blank\" rel=\"noopener\">server-side rendering mode</a> depends heavily on basic Response objects.</p>\n<p>For my migration, I didn’t use these a whole lot. Even so, in a world where frameworks run rampant and so many tools are introducing new DSLs and syntax, it’s refreshing to have something so fundamental to the web remain consistent.</p>\n<h2>Honeymoon’s Not Over Yet</h2>\n<p>This post will likely need an update at some point, because I’m admittedly still in the honeymoon phase. So far, there really hasn’t been much of what I’d like to see changed or introduced (aside from <a href=\"https://docs.astro.build/en/guides/markdown-content/#fetching-remote-markdown\" target=\"_blank\" rel=\"noopener\">built-in support for parsing remote Markdown</a>). But that’ll undoubtedly shift as my site does. That said, I don’t recall feeling quite the same way about first adopting Gatsby or Next. For both of those tools, despite enjoying the experience and being generally pleased with the result, I always felt a tinge of guilt at the end of the day, mainly because I knew there was so much code being sent on every page load that my site didn’t really need.</p>\n<p>So, yes, I could be caught up in a haze of hype as I continue to dive into Astro. Or, maybe it’s actually a tool that has finally struck a good balance between developer experience and build quality. Time will tell.</p>\n",
        "feature_image": "https://images.unsplash.com/photo-1457365050282-c53d772ef8b2?ixlib=rb-4.0.3&q=80&fm=jpg&crop=entropy&cs=tinysrgb",
        "status": "published",
        "created_at": 1673845200000,
        "published_at": 1673845200000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "meta_description": "What Stuck Out While Migrating My Blog from Next.js to Astro",
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>This site’s been on Next.js since 2021, and I’ve had very few complaints about it. I’ve appreciated things like its slick developer experience, the first-class support it enjoys from Vercel for features like incremental static regeneration, and the constant innovation driven by its community. It’s a great tool, and my high view of it hasn’t really changed since I first took it on.</p>\\n<p>But in the meantime, a couple of things started to happen. First off, I began to feel more uncomfortable with the amount of JavaScript I was shipping for a very small amount of interactivity on my site (it’s mainly just content). In terms of standard performance metrics, Next does a great job at generating a fast experience by default. The built output loads assets in the right way, at the right time, and with the right priority. But even so, it still comes with a lot of code that users needs to download, parse, and execute, even though they’re only there to read a blog post. “Irresponsible” is too strong of a word, but the feeling I started to foster was in that same vein.</p>\\n<p>Second, the tooling landscape changed (as it always does), and Astro came onto the scene. It promised a lot of the ergonomics Next offers, but even more flexibility (you can use any mainstream framework you want while also shipping no JavaScript by default). It touted some big value propositions, but it wasn’t a bandwagon I immediately joined.</p>\\n<p>But after many months of waiting for the hype to cool down, I decided to try building an integration for <a href=\\\"https://jamcomments.com/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">JamComments</a>. I was floored by how easy it was. So, I took the next step and moved over my entire site. As I made that migration, I began to mentally organize some of my favorite things about the framework. Here they are. Keep in mind, these items don’t take into account the breadth of what Astro can do. It only considers what I encountered in migrating over my personal blog.</p>\\n<h2>#1. It supports extremely unopinionated data sourcing.</h2>\\n<p>I was a victim of the Gatsby.js hype a few years ago. It was one of the first React-based static site generators with some momentum behind it at the time, and it also went all-in on using GraphQL as the protocol that supported its “<a href=\\\"https://www.gatsbyjs.com/blog/2018-10-04-journey-to-the-content-mesh/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">content mesh</a>.” These bold opinions and big words wooed me and several others, making us completely blind to the overabundance of complexity the approach brought with it. It didn’t take long for the excitement to wear off and the overbearing friction to become apparent.</p>\\n<p>Next was better. It didn’t care about how you sourced your data, so long as you did so using hooks like <code>getStaticProps()</code> within a file that exists inside the <code>pages</code> directory. (This was before the entrance of React Server Components and Next 13+ that permits you to <a href=\\\"https://nextjs.org/docs/data-fetching/fundamentals\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">collocate your components &#x26; data fetching</a>.) Still, there were some moments when I wished I could break free from those constraints a bit.</p>\\n<p>Astro takes it multiple steps further, however. There’s no particular function I need to export. In fact, I don’t need to use a separate function at all — top-level <code>await</code> is <a href=\\\"https://docs.astro.build/en/guides/data-fetching/#fetch-in-astro\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">supported out-of-the box</a>. All I need to do is set my variables and use them in my template. Done.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token operator\\\">--</span><span class=\\\"token operator\\\">-</span>\\n<span class=\\\"token keyword\\\">const</span> response <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword control-flow\\\">await</span> <span class=\\\"token function\\\">fetch</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'https://an-endpoint.com/api'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">const</span> data <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword control-flow\\\">await</span> response<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">json</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token operator\\\">--</span><span class=\\\"token operator\\\">-</span>\\n\\n<span class=\\\"token operator\\\">&#x3C;</span>p<span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">{</span>data<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">a_property</span><span class=\\\"token punctuation\\\">}</span><span class=\\\"token operator\\\">&#x3C;</span><span class=\\\"token operator\\\">/</span>p<span class=\\\"token operator\\\">></span>\\n</code></pre></div>\\n<p>Crazily enough, you can even do stuff like this (stolen straight from <a href=\\\"https://docs.astro.build/en/reference/directives-reference/#sethtml\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">their documentation</a>):</p>\\n<p><img src='/proxy/cb36379e-46dd-4f8f-97e4-187ed3d5b728' alt='' loading='lazy' /></p>\\n<p>I imagine many don’t find this prescriptive enough. There are probably very good reasons to be wary of the risk this introduces for shooting yourself in the foot. But for a dude just looking to build a simple blog, I highly appreciate this freedom.</p>\\n<h2>#2. There’s first-class (or readily available) support for integrations to take care of the boring stuff.</h2>\\n<p>It’s easy enough to spit out some posts and pages. That’s the fun part. But if you’re going to build a site that’s syndication-ready, SEO-friendly, and as fast as possible, you also need worry about things like RSS feeds, sitemaps, and asset optimization. In my opinion, these are pretty boring processes to set up.</p>\\n<p>These are things that Gatsby, with its rich ecosystem of plugins, does well. If it doesn’t have an official plugin available, there’s likely one supported by the community at large. I recall relying on these plugins for <a href=\\\"https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-plugin-sitemap\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">my sitemap</a>, <a href=\\\"https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-plugin-image\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">image optimization</a>, and <a href=\\\"https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-plugin-feed\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">RSS feed</a> with little issue. And for the things they didn’t directly support, there was often dedicated documentation on standing it up on my own. Like <a href=\\\"https://www.gatsbyjs.com/docs/how-to/adding-common-features/adding-seo-component/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">how to build an SEO component</a> for my blog.</p>\\n<p>Next, however, has some room for improvement. To be fair, I don’t believe Next has ever billed itself as a content-focused framework to the same degree as Gatsby. At any rate, I remember it being more than trivial to get my site going with these must-haves. I ended up rolling my own <a href=\\\"https://github.com/alexmacarthur/macarthur-me-next/blob/main/scripts/generateSitemap.ts\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">sitemap</a> and <a href=\\\"https://github.com/alexmacarthur/macarthur-me-next/blob/main/scripts/generateRssFeed.tsx\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">RSS feed</a> (with the help of a couple other dependencies), and I believe I built <a href=\\\"https://github.com/alexmacarthur/macarthur-me-next/blob/main/components/meta.tsx\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">my own component to handle basic SEO configuration</a> after seeking inspiration from some other blogs.</p>\\n<p>Doing all of this with Astro was pretty darn straightforward. It has official support for things like <a href=\\\"https://docs.astro.build/en/guides/integrations-guide/sitemap/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">generating a sitemap</a>, <a href=\\\"https://docs.astro.build/en/guides/rss/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">exposing an RSS feed</a>, and <a href=\\\"https://docs.astro.build/en/guides/images/#astros-image-integration\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">optimizing images.</a> And for stuff like managing SEO meta data, some <a href=\\\"https://github.com/jonasmerlin/astro-seo\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">pretty good open source packages</a> exist. In the end, there wasn’t much pain in setting up these non-negotiables.</p>\\n<h2>#3. It’s really hard to write an unperformant site.</h2>\\n<p>This is where Astro really shines. By default, there’s no JavaScript shipped to the client for an Astro site. Coming off of multiple React-based frameworks from the past few years, it’s still a little bonkers to me that I get to keep the ergonomics of writing modular components, but without consequence to the user.</p>\\n<p>In fact, I’ve been so happy with the feel of <a href=\\\"https://docs.astro.build/en/core-concepts/astro-components/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Astro’s proprietary component syntax</a>, that I’ve been using them exclusively. The learning curve was minimal, especially since it’s so heavily inspired by React’s API. As I built out the pieces of my site, I came to truly realize how much I didn’t enjoy writing <em>React</em> so much as I liked the <em>mental modal</em> that React’s adopted. With any given Astro component, I get all the benefits of writing basic presentational components — a bit of logic, a templating system that I like, and even props. But unlike React, <em>none</em> of that code results in any more JavaScript being shipped to my users. And that makes it <em>really hard</em> to build a slow, bloated site.</p>\\n<p>But there’s more available in Astro to aid in strong site performance too. It’s been really pioneering its <a href=\\\"https://docs.astro.build/en/concepts/islands/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">“islands” architecture</a>, which allows you to easily opt into client-side interactivity on a per-component basis. But even if you don’t go that route, you’re free to use a good, ol’ <code>&#x3C;script></code> tag in any of your components. <a href=\\\"https://docs.astro.build/en/guides/client-side-scripts/#using-script-in-astro\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Each of them will be automatically hoisted</a>, deduplicated, and optimized on build. So, where interactivity is needed, it’s easy enough to sprinkle it in without a huge impact to your bundle. You get the banana without the gorilla.</p>\\n<h2>#4. Much of the API is built on web standards.</h2>\\n<p>This is a smaller one, but still something I really admire. Much of Astro’s lower-level API is based on web standards, which makes the learning curve a little smoother. For example, the <code>Astro.request</code> object is just an <a href=\\\"https://docs.astro.build/en/reference/api-reference/#astrorequest\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">instance of Request</a>. You can freely use <code>fetch()</code> for <a href=\\\"https://docs.astro.build/en/guides/data-fetching/#fetch-in-astro\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">retrieving any data</a>. Its <a href=\\\"https://docs.astro.build/en/guides/server-side-rendering/#response\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">server-side rendering mode</a> depends heavily on basic Response objects.</p>\\n<p>For my migration, I didn’t use these a whole lot. Even so, in a world where frameworks run rampant and so many tools are introducing new DSLs and syntax, it’s refreshing to have something so fundamental to the web remain consistent.</p>\\n<h2>Honeymoon’s Not Over Yet</h2>\\n<p>This post will likely need an update at some point, because I’m admittedly still in the honeymoon phase. So far, there really hasn’t been much of what I’d like to see changed or introduced (aside from <a href=\\\"https://docs.astro.build/en/guides/markdown-content/#fetching-remote-markdown\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">built-in support for parsing remote Markdown</a>). But that’ll undoubtedly shift as my site does. That said, I don’t recall feeling quite the same way about first adopting Gatsby or Next. For both of those tools, despite enjoying the experience and being generally pleased with the result, I always felt a tinge of guilt at the end of the day, mainly because I knew there was so much code being sent on every page load that my site didn’t really need.</p>\\n<p>So, yes, I could be caught up in a haze of hype as I continue to dive into Astro. Or, maybe it’s actually a tool that has finally struck a good balance between developer experience and build quality. Time will tell.</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 6,
        "title": "How to Lazy Load Disqus for Improved Site Performance",
        "slug": "lazy-load-disqus",
        "html": "<p>I’ve been a vocal opponent of using Disqus for a number of reasons, one of which being what it does to the performance of your website. It’s actually one of the reasons I built <a href=\"https://jamcomments.com/\" target=\"_blank\" rel=\"noopener\">an alternative</a>.</p>\n<p>Despite that, <a href=\"https://trends.builtwith.com/widgets/Disqus\" target=\"_blank\" rel=\"noopener\">it’s a widely used service</a> that won’t be going away anytime soon. And if people are going to continue to rely on it, there’s at least one thing they should do to help soften that performance hit: lazy load it. Let it wreak havoc on the user only when the user is <em>actually going to see it</em>.</p>\n<p>This one change can have a hefty impact on metrics like overall page load time, the amount of time the main thread of the browser is blocked, and how much code you require your readers (specifically those that don’t even reach your comments) to download, parse, and execute. And it’s rather simple to implement.</p>\n<h2>How a Typical Implementation Falls Short</h2>\n<p>By default, setting up Disqus requires including a bit of HTML and some inline JavaScript. It’s not much:</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>disqus_thread<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>div</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token keyword\">var</span> <span class=\"token function-variable function\">disqus_config</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">page</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">url</span> <span class=\"token operator\">=</span> <span class=\"token constant\">PAGE_URL</span><span class=\"token punctuation\">;</span>\n\t\t  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">page</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">identifier</span> <span class=\"token operator\">=</span> <span class=\"token constant\">PAGE_IDENTIFIER</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> d <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">,</span> s <span class=\"token operator\">=</span> d<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'script'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    s<span class=\"token punctuation\">.</span><span class=\"token property-access\">src</span> <span class=\"token operator\">=</span> <span class=\"token string\">'https://EXAMPLE.disqus.com/embed.js'</span><span class=\"token punctuation\">;</span>\n    s<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data-timestamp'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">+</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">(</span>d<span class=\"token punctuation\">.</span><span class=\"token property-access\">head</span> <span class=\"token operator\">||</span> d<span class=\"token punctuation\">.</span><span class=\"token property-access\">body</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">appendChild</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>script</span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<p>But that <code>&#x3C;script></code> tag shouldn’t be underestimated. When it executes, <a href=\"https://www.macarthur.me/posts/keep-using-disqus-if-you-dont-care\">it loads and executes a </a><a href=\"https://www.macarthur.me/posts/keep-using-disqus-if-you-dont-care\"><em>lot</em></a> of code. And what’s particularly bad is that <strong>it happens even if your user doesn’t scroll down to the part of the page where any of it’s used.</strong></p>\n<h2>Initialize When in View</h2>\n<p>In order help users only pay that cost only when necessary, the <code>IntersectionObserver</code> API is a great one to leverage. Using it, we can set up an “observer” and tell it to fire some code only when an “intersection” occurs between two elements. In this case, the intersection we’re concerned with is when the root HTML element where Disqus will be rendered meets the browser’s viewport. So, let’s stub some things out.</p>\n<p>The first step is to set up the observer itself.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> observer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IntersectionObserver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">entries<span class=\"token punctuation\">,</span> observer</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n\tentries<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">entry</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>entry<span class=\"token punctuation\">.</span><span class=\"token property-access\">isIntersecting</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Initializing Disqus!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Start listening:</span>\n<span class=\"token keyword\">const</span> mountNode <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#disqus_thread\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nobserver<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">observe</span><span class=\"token punctuation\">(</span>mountNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>When this is loaded onto a page, we wouldn’t see that log until the <code>#disqus_thread</code> element came into the browser’s viewport. It’s worth noting that if we wanted to, we could configure this to fire when the element came <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API#intersection_observer_options\" target=\"_blank\" rel=\"noopener\">within a certain number of pixels of the viewport</a>. That’s probably a good thing to consider for a production site, but for the sake of simplicity, I’m leaving things more basic here.</p>\n<p>Next, we can run the code necessary for initializing Disqus on our target element. There’s nothing custom going on here. We’re literally just copying in the code Disqus gives you to embed from the beginning. It’s just that it won’t be executed until the mount element is in view.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> observer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IntersectionObserver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">entries<span class=\"token punctuation\">,</span> observer</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n\tentries<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">entry</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>entry<span class=\"token punctuation\">.</span><span class=\"token property-access\">isIntersecting</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Initializing Disqus!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t\t<span class=\"token comment\">// Starting Disqus's universal embed code.</span>\n\t\t\t<span class=\"token keyword\">var</span> <span class=\"token function-variable function\">disqus_config</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">page</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">url</span> <span class=\"token operator\">=</span> <span class=\"token constant\">PAGE_URL</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">page</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">identifier</span> <span class=\"token operator\">=</span> <span class=\"token constant\">PAGE_IDENTIFIER</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n\t\t\t<span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token keyword\">var</span> d <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">,</span> s <span class=\"token operator\">=</span> d<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'script'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\ts<span class=\"token punctuation\">.</span><span class=\"token property-access\">src</span> <span class=\"token operator\">=</span> <span class=\"token string\">'https://EXAMPLE.disqus.com/embed.js'</span><span class=\"token punctuation\">;</span>\n\t\t\t\ts<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data-timestamp'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">+</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token punctuation\">(</span>d<span class=\"token punctuation\">.</span><span class=\"token property-access\">head</span> <span class=\"token operator\">||</span> d<span class=\"token punctuation\">.</span><span class=\"token property-access\">body</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">appendChild</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token comment\">// Ending Disqus's universal embed code.</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Start listening:</span>\n<span class=\"token keyword\">const</span> mountNode <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#disqus_thread\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nobserver<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">observe</span><span class=\"token punctuation\">(</span>mountNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h3>Important! Destroy the Observer After Triggering</h3>\n<p>That gets the job mostly done, but we’re missing a critical piece. As soon as we’ve initialized Disqus, we need to destroy the observer we set up. If we don’t, Disqus will be reinitialized every time another intersection is made, which would occur anytime the user scrolls away from the mount element and back to it once again.</p>\n<div class=\"remark-highlight\"><pre class=\"language-diff\"><code class=\"language-diff\">const observer = new IntersectionObserver((entries, observer) => {\n\tentries.forEach((entry) => {\n\t\tif (entry.isIntersecting) {\n\t\t\tconsole.log(\"Initializing Disqus!\");\n\n\t\t\t// Starting Disqus's universal embed code.\n\t\t\tvar disqus_config = function () {\n\t\t\t\tthis.page.url = PAGE_URL;\n\t\t\t\tthis.page.identifier = PAGE_IDENTIFIER;\n\t\t\t};\n\n\t\t\t(function() {\n\t\t\t\tvar d = document, s = d.createElement('script');\n\t\t\t\ts.src = 'https://EXAMPLE.disqus.com/embed.js';\n\t\t\t\ts.setAttribute('data-timestamp', +new Date());\n\t\t\t\t(d.head || d.body).appendChild(s);\n\t\t\t})();\n\t\t\t// Ending Disqus's universal embed code.\n\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">\t\t\t// Stop observing to prevent reinitializing Disqus.</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">\t\t\tobserver.unobserve(entry.target);</span>\n<span class=\"token line\"></span></span>\t\t}\n\t});\n});\n\n// Start listening:\nconst mountNode = document.querySelector(\"#disqus_thread\");\nobserver.observe(mountNode);\n</code></pre></div>\n<p>And with that, we’re set. Disqus won’t download or execute any of its JavaScript until it’s necessary:</p>\n<p><img src='/proxy/099f8e3e-e67b-48ad-8bf5-4f75eb39765a' alt='' loading='lazy' /></p>\n<h2>The Impact</h2>\n<p>Initializing Disqus lazily means far fewer requests to handle and much less code to execute on page load for a good chunk of users. Here’s the number of requests a sample page was handling before lazy loading. It’s significant, especially if your users are on low-end mobile devices with limited data availability.</p>\n<p><img src='/proxy/4ab2c34a-6036-49c8-883f-7c75315e9c7d' alt='' loading='lazy' /></p>\n<p>After, however, things look much better (until the user scrolls to where comments are placed, of course).</p>\n<p><img src='/proxy/035651ab-20ac-41c6-bdd4-e75753582ecd' alt='' loading='lazy' /></p>\n<h2>It’s a Bandage</h2>\n<p>It’s important to render that an approach like this is nothing more than a bandage on an open wound. There’s still a big cost to pay if you choose to use Disqus, albeit not monetary. It’s just that the cost will now only be realized for those who interact with your comments.</p>\n<p>Without question, the best path forward is to pivot to a more performant comment service. But for the time being, consider an approach like this to minimize the impact to your users and maybe make your site a little more enjoyable to visit.</p>\n",
        "feature_image": "https://images.unsplash.com/photo-1485402073834-c95f3eac2fcd?ixlib=rb-4.0.3&q=80&fm=jpg&crop=entropy&cs=tinysrgb",
        "status": "published",
        "created_at": 1673672400000,
        "published_at": 1673672400000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>I’ve been a vocal opponent of using Disqus for a number of reasons, one of which being what it does to the performance of your website. It’s actually one of the reasons I built <a href=\\\"https://jamcomments.com/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">an alternative</a>.</p>\\n<p>Despite that, <a href=\\\"https://trends.builtwith.com/widgets/Disqus\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">it’s a widely used service</a> that won’t be going away anytime soon. And if people are going to continue to rely on it, there’s at least one thing they should do to help soften that performance hit: lazy load it. Let it wreak havoc on the user only when the user is <em>actually going to see it</em>.</p>\\n<p>This one change can have a hefty impact on metrics like overall page load time, the amount of time the main thread of the browser is blocked, and how much code you require your readers (specifically those that don’t even reach your comments) to download, parse, and execute. And it’s rather simple to implement.</p>\\n<h2>How a Typical Implementation Falls Short</h2>\\n<p>By default, setting up Disqus requires including a bit of HTML and some inline JavaScript. It’s not much:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>div</span> <span class=\\\"token attr-name\\\">id</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>disqus_thread<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>div</span><span class=\\\"token punctuation\\\">></span></span>\\n\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>script</span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token script\\\"><span class=\\\"token language-javascript\\\">\\n    <span class=\\\"token keyword\\\">var</span> <span class=\\\"token function-variable function\\\">disqus_config</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n\\t    <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">page</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">url</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">PAGE_URL</span><span class=\\\"token punctuation\\\">;</span>\\n\\t\\t  <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">page</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">identifier</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">PAGE_IDENTIFIER</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">function</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">var</span> d <span class=\\\"token operator\\\">=</span> <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">,</span> s <span class=\\\"token operator\\\">=</span> d<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">createElement</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'script'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    s<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">src</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">'https://EXAMPLE.disqus.com/embed.js'</span><span class=\\\"token punctuation\\\">;</span>\\n    s<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">setAttribute</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'data-timestamp'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token operator\\\">+</span><span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Date</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">(</span>d<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">head</span> <span class=\\\"token operator\\\">||</span> d<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">body</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">appendChild</span><span class=\\\"token punctuation\\\">(</span>s<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</span></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>script</span><span class=\\\"token punctuation\\\">></span></span>\\n</code></pre></div>\\n<p>But that <code>&#x3C;script></code> tag shouldn’t be underestimated. When it executes, <a href=\\\"https://www.macarthur.me/posts/keep-using-disqus-if-you-dont-care\\\">it loads and executes a </a><a href=\\\"https://www.macarthur.me/posts/keep-using-disqus-if-you-dont-care\\\"><em>lot</em></a> of code. And what’s particularly bad is that <strong>it happens even if your user doesn’t scroll down to the part of the page where any of it’s used.</strong></p>\\n<h2>Initialize When in View</h2>\\n<p>In order help users only pay that cost only when necessary, the <code>IntersectionObserver</code> API is a great one to leverage. Using it, we can set up an “observer” and tell it to fire some code only when an “intersection” occurs between two elements. In this case, the intersection we’re concerned with is when the root HTML element where Disqus will be rendered meets the browser’s viewport. So, let’s stub some things out.</p>\\n<p>The first step is to set up the observer itself.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> observer <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">IntersectionObserver</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">entries<span class=\\\"token punctuation\\\">,</span> observer</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n\\tentries<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">forEach</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">entry</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n\\t\\t<span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span>entry<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">isIntersecting</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n\\t\\t\\t<span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"Initializing Disqus!\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\t\\t<span class=\\\"token punctuation\\\">}</span>\\n\\t<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// Start listening:</span>\\n<span class=\\\"token keyword\\\">const</span> mountNode <span class=\\\"token operator\\\">=</span> <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">querySelector</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"#disqus_thread\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nobserver<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">observe</span><span class=\\\"token punctuation\\\">(</span>mountNode<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>When this is loaded onto a page, we wouldn’t see that log until the <code>#disqus_thread</code> element came into the browser’s viewport. It’s worth noting that if we wanted to, we could configure this to fire when the element came <a href=\\\"https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API#intersection_observer_options\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">within a certain number of pixels of the viewport</a>. That’s probably a good thing to consider for a production site, but for the sake of simplicity, I’m leaving things more basic here.</p>\\n<p>Next, we can run the code necessary for initializing Disqus on our target element. There’s nothing custom going on here. We’re literally just copying in the code Disqus gives you to embed from the beginning. It’s just that it won’t be executed until the mount element is in view.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> observer <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">IntersectionObserver</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">entries<span class=\\\"token punctuation\\\">,</span> observer</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n\\tentries<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">forEach</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">entry</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n\\t\\t<span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span>entry<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">isIntersecting</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n\\t\\t\\t<span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"Initializing Disqus!\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n\\t\\t\\t<span class=\\\"token comment\\\">// Starting Disqus's universal embed code.</span>\\n\\t\\t\\t<span class=\\\"token keyword\\\">var</span> <span class=\\\"token function-variable function\\\">disqus_config</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n\\t\\t\\t\\t<span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">page</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">url</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">PAGE_URL</span><span class=\\\"token punctuation\\\">;</span>\\n\\t\\t\\t\\t<span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">page</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">identifier</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">PAGE_IDENTIFIER</span><span class=\\\"token punctuation\\\">;</span>\\n\\t\\t\\t<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n\\t\\t\\t<span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">function</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n\\t\\t\\t\\t<span class=\\\"token keyword\\\">var</span> d <span class=\\\"token operator\\\">=</span> <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">,</span> s <span class=\\\"token operator\\\">=</span> d<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">createElement</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'script'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\t\\t\\t\\ts<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">src</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">'https://EXAMPLE.disqus.com/embed.js'</span><span class=\\\"token punctuation\\\">;</span>\\n\\t\\t\\t\\ts<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">setAttribute</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'data-timestamp'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token operator\\\">+</span><span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Date</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\t\\t\\t\\t<span class=\\\"token punctuation\\\">(</span>d<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">head</span> <span class=\\\"token operator\\\">||</span> d<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">body</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">appendChild</span><span class=\\\"token punctuation\\\">(</span>s<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\t\\t\\t<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\t\\t\\t<span class=\\\"token comment\\\">// Ending Disqus's universal embed code.</span>\\n\\t\\t<span class=\\\"token punctuation\\\">}</span>\\n\\t<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// Start listening:</span>\\n<span class=\\\"token keyword\\\">const</span> mountNode <span class=\\\"token operator\\\">=</span> <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">querySelector</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"#disqus_thread\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nobserver<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">observe</span><span class=\\\"token punctuation\\\">(</span>mountNode<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<h3>Important! Destroy the Observer After Triggering</h3>\\n<p>That gets the job mostly done, but we’re missing a critical piece. As soon as we’ve initialized Disqus, we need to destroy the observer we set up. If we don’t, Disqus will be reinitialized every time another intersection is made, which would occur anytime the user scrolls away from the mount element and back to it once again.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-diff\\\"><code class=\\\"language-diff\\\">const observer = new IntersectionObserver((entries, observer) => {\\n\\tentries.forEach((entry) => {\\n\\t\\tif (entry.isIntersecting) {\\n\\t\\t\\tconsole.log(\\\"Initializing Disqus!\\\");\\n\\n\\t\\t\\t// Starting Disqus's universal embed code.\\n\\t\\t\\tvar disqus_config = function () {\\n\\t\\t\\t\\tthis.page.url = PAGE_URL;\\n\\t\\t\\t\\tthis.page.identifier = PAGE_IDENTIFIER;\\n\\t\\t\\t};\\n\\n\\t\\t\\t(function() {\\n\\t\\t\\t\\tvar d = document, s = d.createElement('script');\\n\\t\\t\\t\\ts.src = 'https://EXAMPLE.disqus.com/embed.js';\\n\\t\\t\\t\\ts.setAttribute('data-timestamp', +new Date());\\n\\t\\t\\t\\t(d.head || d.body).appendChild(s);\\n\\t\\t\\t})();\\n\\t\\t\\t// Ending Disqus's universal embed code.\\n\\n<span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">\\t\\t\\t// Stop observing to prevent reinitializing Disqus.</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">\\t\\t\\tobserver.unobserve(entry.target);</span>\\n<span class=\\\"token line\\\"></span></span>\\t\\t}\\n\\t});\\n});\\n\\n// Start listening:\\nconst mountNode = document.querySelector(\\\"#disqus_thread\\\");\\nobserver.observe(mountNode);\\n</code></pre></div>\\n<p>And with that, we’re set. Disqus won’t download or execute any of its JavaScript until it’s necessary:</p>\\n<p><img src='/proxy/099f8e3e-e67b-48ad-8bf5-4f75eb39765a' alt='' loading='lazy' /></p>\\n<h2>The Impact</h2>\\n<p>Initializing Disqus lazily means far fewer requests to handle and much less code to execute on page load for a good chunk of users. Here’s the number of requests a sample page was handling before lazy loading. It’s significant, especially if your users are on low-end mobile devices with limited data availability.</p>\\n<p><img src='/proxy/4ab2c34a-6036-49c8-883f-7c75315e9c7d' alt='' loading='lazy' /></p>\\n<p>After, however, things look much better (until the user scrolls to where comments are placed, of course).</p>\\n<p><img src='/proxy/035651ab-20ac-41c6-bdd4-e75753582ecd' alt='' loading='lazy' /></p>\\n<h2>It’s a Bandage</h2>\\n<p>It’s important to render that an approach like this is nothing more than a bandage on an open wound. There’s still a big cost to pay if you choose to use Disqus, albeit not monetary. It’s just that the cost will now only be realized for those who interact with your comments.</p>\\n<p>Without question, the best path forward is to pivot to a more performant comment service. But for the time being, consider an approach like this to minimize the impact to your users and maybe make your site a little more enjoyable to visit.</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 7,
        "title": "Keep Using Disqus if You Don’t Care About SEO, Performance, and User Privacy",
        "slug": "keep-using-disqus-if-you-dont-care",
        "html": "<p>I remember when I first started to get a little more serious about blogging. It was with a statically generated Gatsby site, with posts stored in flat Markdown files, and deployed on Netlify. I loved it. But I knew it was still missing something I wanted: a way for readers to post comments.</p>\n<p>As many did, I reached for Disqus to do the job. Sheltered by naïveté, I thought it was great! But soon enough, I began to notice some of the limitations and annoyances with the platform. I became more aware of how the tool is built and operates as a business. And eventually, I regretted ever setting it up to begin with.</p>\n<p>If you even slightly care about the effectiveness of your own website and the privacy of your readers’ data, you ought feel this way too. There are plenty of products out there that offer a slick setup experience and an incredible set of features for “free.” But many times (most?), there’s a decent chance some pretty serious trade-offs being made behind your back. Disqus is one of them.</p>\n<h2>What Trade-Offs?</h2>\n<p>There are three buckets that deserve the most attention: SEO, privacy, and performance.</p>\n<h3>Privacy</h3>\n<p>Disqus has long carried a questionable reputation in how it handles pretty much any information it can get its hands on, including that which is very personal. If you take a few minutes and read through <a href=\"https://help.disqus.com/en/articles/1717103-disqus-privacy-policy\" target=\"_blank\" rel=\"noopener\">its privacy policy</a>, you’ll get a better idea of why that is.</p>\n<p>The list of data types they collect is long, including technical details, biological traits, personal preferences, location, and your contact information:</p>\n<blockquote>\n<p>i. Identity Data includes first name, last name, username or similar identifier, date of birth, email address, telephone number, and mailing address.<br>\nii. Technical Data includes internet protocol (IP) address, unique Cookie ID, Device ID, your login data, browser type and version, time zone setting and location, browser plug-in types and versions, operating system and platform and other technology on the devices you use to access the Service.<br>\niii. Profile Data includes your username and password, your interests, preferences, feedback and survey responses, marital status, gender, title.<br>\niv. Usage Data includes information about how you use the Service, and the content of comments that you post.<br>\nv. Aggregated Data includes statistical or demographic data for any purpose. <br>\nvi. Sensitive Personal We do not intentionally collect any personal data about your race or ethnicity, religious or philosophical beliefs, sex life, sexual orientation, political opinions, trade union membership, information about your health or genetic or biometric data, or information about criminal convictions and offences. However, if you make comments using the Service that include such data about yourself it will be publicly available and may be processed by Disqus or others.</p>\n</blockquote>\n<p>Don’t miss that list bit. If you happen to include any other details about yourself in a comment you submit, it “may be processed by Disqus or others” too. If “processed” sounds ambiguously ominous, it’s because it is. According to that policy, it at least includes selling information directly to third parties. <a href=\"https://help.disqus.com/en/articles/1944034-third-party-advertising-partners\" target=\"_blank\" rel=\"noopener\">And there are a lot of them</a> — I counted 21.</p>\n<p>All of this collection starts the second you load a page with Disqus installed, even if you’re not logged in. Using Brave (which aggressively blocks third-party pixels and trackers), I pulled up a site with it installed and found seven different third-party requests blocked out of the gate. If you’re logged in, by the way, this number increases to 10.</p>\n<p><img src='/proxy/76462919-7cf9-4618-87ff-119b88d0094a' alt='' loading='lazy' /></p>\n<p>After discovering the extent to which their poor data stewardship goes, it wasn’t much of a surprise to see they had recently been hit for a hefty fine for <a href=\"https://techcrunch.com/2021/05/05/disqus-facing-3m-fine-in-norway-for-tracking-users-without-consent/\" target=\"_blank\" rel=\"noopener\">tracking users without their consent</a> in Europe.</p>\n<p>Especially if you just need a simple comment form on your site, it’s bonkers to me that so many people permit Disqus to wrap their tentacles around &#x26; squeeze your data profile as much as they do.</p>\n<h3>SEO</h3>\n<p>The amount of SEO value that comments brings to a website is debatable, but the general consensus is that they’re beneficial it as long as they’re <a href=\"https://www.searchenginejournal.com/google-on-the-seo-value-of-user-comments-on-websites/438870/\" target=\"_blank\" rel=\"noopener\">moderated for high-quality content.</a> And if that’s true, it’s important for that content to be easy to crawl &#x26; index.</p>\n<p>Unfortunately, Disqus makes that aim more difficult by rendering comments client-side via JavaScript. Yes, Google <em>is able</em> to index JavaScript-rendered content. But it’s no secret that <a href=\"https://developers.google.com/search/docs/crawling-indexing/javascript/javascript-seo-basics\" target=\"_blank\" rel=\"noopener\">indexing single-page applications is slow and inefficient</a>. And some search engines don’t do it at all, meaning that even in the age of the SPA, traditional, server-rendered HTML is the most SEO-friendly way to serve the content you want crawled.</p>\n<p>Just to verify comments are <em>for sure</em> being indexed, I did a quick search for the exact phrase from a comment on my own site. <a href=\"https://www.google.com/search?q=%22Thanks.+Super+clear+and+useful+for+some+issues+I+was+just+experiencing.%22&#x26;oq=%22Thanks.+Super+clear+and+useful+for+some+issues+I+was+just+experiencing.%22\" target=\"_blank\" rel=\"noopener\">One result came up.</a> Mine.</p>\n<p><img src='/proxy/c918fa30-87b9-440d-8aa4-d95b1458eddb' alt='' loading='lazy' /></p>\n<p>If there’s a chance a search could pull up one of my posts by matching on a comment, you better believe I want that content to be rendered as a first-class citizen of my site, and not just a client-side-rendered afterthought.</p>\n<p>By the way, there’s also one more characteristic of Disqus that can negatively impact SEO — <a href=\"https://www.cloudflare.com/learning/performance/how-website-speed-boosts-seo/\" target=\"_blank\" rel=\"noopener\">site performance</a>.</p>\n<h3>Performance</h3>\n<p>Disqus compromises your site’s ability to deliver a performant experience in three ways: page weight, load time, and number of requests. To explore this with some hard numbers, I spun up a basic Eleventy site and deployed it to Netlify. I wanted to play around with three different versions of a simple blog post — one with <strong>no comments</strong>, one with <strong>Disqus</strong>, and one with <a href=\"https://jamcomments.com/\" target=\"_blank\" rel=\"noopener\"><strong>JamComments</strong></a><strong>,</strong> a performance-minded service that integrates with a number of Jamstack platforms.</p>\n<p>A blog post on the first version of this site is pretty plain. In all, it involved three HTTP requests, none of which were for JavaScript assets. Then, I took at look at the version with Disqus. This time, things started getting a little hairy, especially with respect to the amount of JavaScript that was being requested waterfall-style.</p>\n<p><img src='/proxy/79380d5a-9f2f-4706-b33c-620ab817ce62' alt='' loading='lazy' /></p>\n<p>That simple addition led to 12 additional network requests. A travesty, especially considering that most of those requests depended on the first being completed, so they weren’t being loaded in parallel. And that’s <em>just JavaScript</em>. When accounting for all of the assets requested — JavaScript and otherwise — it got worse. In all, adding the Disqus snippet led to 51 total requests being fired when that simple blog post was loaded. Again, from 3 to 51.</p>\n<p>Finally, I deployed a version with JamComments installed. A rendered page with it installed totaled four requests. Just looking at request count, here’s the comparison:</p>\n<p><img src='/proxy/336e0af6-6fc6-4fc9-984b-e7730873f012' alt='' loading='lazy' /></p>\n<p><strong>Total Resources</strong></p>\n<p>Next, let’s look at the total amount of resources that were requested from the three variants. The plain page and that with JamComments were within range of each other. Disqus, on the other hand, blew it out of the water.</p>\n<p><img src='/proxy/0421f6ce-a857-4e6f-97cd-fe4b91999b41' alt='' loading='lazy' /></p>\n<p>If you notice above, 1.5 megabytes of (uncompressed) JavaScript were downloaded with Disqus was installed. But when you factor in all of the other assets it downloaded after that JavaScript executed, it bumps up by another 400kb.</p>\n<p><strong>Request Duration</strong></p>\n<p>Finally, the amount of time for everything to be downloaded &#x26; made ready to go. As you might expect, Disqus didn’t fare well, and JamComments’ hit to the page was marginal.</p>\n<p><img src='/proxy/b8c657a5-e82c-446c-a09e-7a71751028c4' alt='' loading='lazy' /></p>\n<h3>What the Numbers Mean for Performance</h3>\n<p>Those ridiculous numbers translate into some dismal performance scores, which has been shown to have <a href=\"https://web.dev/why-speed-matters/\" target=\"_blank\" rel=\"noopener\">a measurable impact on several metrics you should care about</a>, including conversion rate, SEO, and user experience.</p>\n<p>I ran the three versions of my sample page through Google’s <a href=\"https://pagespeed.web.dev/\" target=\"_blank\" rel=\"noopener\">PageSpeed Insights</a> tool to see what kind of quantitive impact each has performance. The results were what you’d expect.</p>\n<p>The page with no comments scored highly, receiving an overall score of 100 and green metrics across the board. No surprises here.</p>\n<p><img src='/proxy/d61be3ac-11dd-4af3-a035-e46ac9bd0dd7' alt='' loading='lazy' /></p>\n<p>On the page with Disqus installed, the page score dipped to 71, with some disturbing metrics. Pay particular attention to that time-to-interactive (TTI). That’s over 10 seconds of waiting before the page could reliably respond to user input.</p>\n<p><img src='/proxy/a49fe9fc-b0e7-40bb-930e-6ecb984db5f0' alt='' loading='lazy' /></p>\n<p>And finally, adding JamComments kept performance well-within an acceptable range. It scored  100 with everything else green.</p>\n<p><img src='/proxy/97892c5c-33f8-4f4d-96d4-204f3c818db7' alt='' loading='lazy' /></p>\n<p>Again, all we need is a simple comment form that sends some information somewhere and renders it on the page. Disqus tries to get you to download the moon, because that’s apparently what it takes to deliver an effective experience. Or more likely, mine every ounce of information it can collect from you to send it off to third parties.</p>\n<h2>Don’t Fall for the Shininess</h2>\n<p>I totally get the appeal of a tool like Disqus — it offers a host of mature features, and it’s rather easy to set up on a website. But it’s important not to let those shiny tools &#x26; ease of use overshadow what it costs you and your readers. Even if it’s not JamComments, consider searching for a more performant, SEO-friendly, and privacy-mindful options within reach. Blog comments are still a feature worth having, so long as you don’t have to sell your soul to have them.</p>\n",
        "feature_image": "https://images.pexels.com/photos/10874696/pexels-photo-10874696.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2",
        "status": "published",
        "created_at": 1672290000000,
        "published_at": 1672290000000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>I remember when I first started to get a little more serious about blogging. It was with a statically generated Gatsby site, with posts stored in flat Markdown files, and deployed on Netlify. I loved it. But I knew it was still missing something I wanted: a way for readers to post comments.</p>\\n<p>As many did, I reached for Disqus to do the job. Sheltered by naïveté, I thought it was great! But soon enough, I began to notice some of the limitations and annoyances with the platform. I became more aware of how the tool is built and operates as a business. And eventually, I regretted ever setting it up to begin with.</p>\\n<p>If you even slightly care about the effectiveness of your own website and the privacy of your readers’ data, you ought feel this way too. There are plenty of products out there that offer a slick setup experience and an incredible set of features for “free.” But many times (most?), there’s a decent chance some pretty serious trade-offs being made behind your back. Disqus is one of them.</p>\\n<h2>What Trade-Offs?</h2>\\n<p>There are three buckets that deserve the most attention: SEO, privacy, and performance.</p>\\n<h3>Privacy</h3>\\n<p>Disqus has long carried a questionable reputation in how it handles pretty much any information it can get its hands on, including that which is very personal. If you take a few minutes and read through <a href=\\\"https://help.disqus.com/en/articles/1717103-disqus-privacy-policy\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">its privacy policy</a>, you’ll get a better idea of why that is.</p>\\n<p>The list of data types they collect is long, including technical details, biological traits, personal preferences, location, and your contact information:</p>\\n<blockquote>\\n<p>i. Identity Data includes first name, last name, username or similar identifier, date of birth, email address, telephone number, and mailing address.<br>\\nii. Technical Data includes internet protocol (IP) address, unique Cookie ID, Device ID, your login data, browser type and version, time zone setting and location, browser plug-in types and versions, operating system and platform and other technology on the devices you use to access the Service.<br>\\niii. Profile Data includes your username and password, your interests, preferences, feedback and survey responses, marital status, gender, title.<br>\\niv. Usage Data includes information about how you use the Service, and the content of comments that you post.<br>\\nv. Aggregated Data includes statistical or demographic data for any purpose. <br>\\nvi. Sensitive Personal We do not intentionally collect any personal data about your race or ethnicity, religious or philosophical beliefs, sex life, sexual orientation, political opinions, trade union membership, information about your health or genetic or biometric data, or information about criminal convictions and offences. However, if you make comments using the Service that include such data about yourself it will be publicly available and may be processed by Disqus or others.</p>\\n</blockquote>\\n<p>Don’t miss that list bit. If you happen to include any other details about yourself in a comment you submit, it “may be processed by Disqus or others” too. If “processed” sounds ambiguously ominous, it’s because it is. According to that policy, it at least includes selling information directly to third parties. <a href=\\\"https://help.disqus.com/en/articles/1944034-third-party-advertising-partners\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">And there are a lot of them</a> — I counted 21.</p>\\n<p>All of this collection starts the second you load a page with Disqus installed, even if you’re not logged in. Using Brave (which aggressively blocks third-party pixels and trackers), I pulled up a site with it installed and found seven different third-party requests blocked out of the gate. If you’re logged in, by the way, this number increases to 10.</p>\\n<p><img src='/proxy/76462919-7cf9-4618-87ff-119b88d0094a' alt='' loading='lazy' /></p>\\n<p>After discovering the extent to which their poor data stewardship goes, it wasn’t much of a surprise to see they had recently been hit for a hefty fine for <a href=\\\"https://techcrunch.com/2021/05/05/disqus-facing-3m-fine-in-norway-for-tracking-users-without-consent/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">tracking users without their consent</a> in Europe.</p>\\n<p>Especially if you just need a simple comment form on your site, it’s bonkers to me that so many people permit Disqus to wrap their tentacles around &#x26; squeeze your data profile as much as they do.</p>\\n<h3>SEO</h3>\\n<p>The amount of SEO value that comments brings to a website is debatable, but the general consensus is that they’re beneficial it as long as they’re <a href=\\\"https://www.searchenginejournal.com/google-on-the-seo-value-of-user-comments-on-websites/438870/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">moderated for high-quality content.</a> And if that’s true, it’s important for that content to be easy to crawl &#x26; index.</p>\\n<p>Unfortunately, Disqus makes that aim more difficult by rendering comments client-side via JavaScript. Yes, Google <em>is able</em> to index JavaScript-rendered content. But it’s no secret that <a href=\\\"https://developers.google.com/search/docs/crawling-indexing/javascript/javascript-seo-basics\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">indexing single-page applications is slow and inefficient</a>. And some search engines don’t do it at all, meaning that even in the age of the SPA, traditional, server-rendered HTML is the most SEO-friendly way to serve the content you want crawled.</p>\\n<p>Just to verify comments are <em>for sure</em> being indexed, I did a quick search for the exact phrase from a comment on my own site. <a href=\\\"https://www.google.com/search?q=%22Thanks.+Super+clear+and+useful+for+some+issues+I+was+just+experiencing.%22&#x26;oq=%22Thanks.+Super+clear+and+useful+for+some+issues+I+was+just+experiencing.%22\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">One result came up.</a> Mine.</p>\\n<p><img src='/proxy/c918fa30-87b9-440d-8aa4-d95b1458eddb' alt='' loading='lazy' /></p>\\n<p>If there’s a chance a search could pull up one of my posts by matching on a comment, you better believe I want that content to be rendered as a first-class citizen of my site, and not just a client-side-rendered afterthought.</p>\\n<p>By the way, there’s also one more characteristic of Disqus that can negatively impact SEO — <a href=\\\"https://www.cloudflare.com/learning/performance/how-website-speed-boosts-seo/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">site performance</a>.</p>\\n<h3>Performance</h3>\\n<p>Disqus compromises your site’s ability to deliver a performant experience in three ways: page weight, load time, and number of requests. To explore this with some hard numbers, I spun up a basic Eleventy site and deployed it to Netlify. I wanted to play around with three different versions of a simple blog post — one with <strong>no comments</strong>, one with <strong>Disqus</strong>, and one with <a href=\\\"https://jamcomments.com/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\"><strong>JamComments</strong></a><strong>,</strong> a performance-minded service that integrates with a number of Jamstack platforms.</p>\\n<p>A blog post on the first version of this site is pretty plain. In all, it involved three HTTP requests, none of which were for JavaScript assets. Then, I took at look at the version with Disqus. This time, things started getting a little hairy, especially with respect to the amount of JavaScript that was being requested waterfall-style.</p>\\n<p><img src='/proxy/79380d5a-9f2f-4706-b33c-620ab817ce62' alt='' loading='lazy' /></p>\\n<p>That simple addition led to 12 additional network requests. A travesty, especially considering that most of those requests depended on the first being completed, so they weren’t being loaded in parallel. And that’s <em>just JavaScript</em>. When accounting for all of the assets requested — JavaScript and otherwise — it got worse. In all, adding the Disqus snippet led to 51 total requests being fired when that simple blog post was loaded. Again, from 3 to 51.</p>\\n<p>Finally, I deployed a version with JamComments installed. A rendered page with it installed totaled four requests. Just looking at request count, here’s the comparison:</p>\\n<p><img src='/proxy/336e0af6-6fc6-4fc9-984b-e7730873f012' alt='' loading='lazy' /></p>\\n<p><strong>Total Resources</strong></p>\\n<p>Next, let’s look at the total amount of resources that were requested from the three variants. The plain page and that with JamComments were within range of each other. Disqus, on the other hand, blew it out of the water.</p>\\n<p><img src='/proxy/0421f6ce-a857-4e6f-97cd-fe4b91999b41' alt='' loading='lazy' /></p>\\n<p>If you notice above, 1.5 megabytes of (uncompressed) JavaScript were downloaded with Disqus was installed. But when you factor in all of the other assets it downloaded after that JavaScript executed, it bumps up by another 400kb.</p>\\n<p><strong>Request Duration</strong></p>\\n<p>Finally, the amount of time for everything to be downloaded &#x26; made ready to go. As you might expect, Disqus didn’t fare well, and JamComments’ hit to the page was marginal.</p>\\n<p><img src='/proxy/b8c657a5-e82c-446c-a09e-7a71751028c4' alt='' loading='lazy' /></p>\\n<h3>What the Numbers Mean for Performance</h3>\\n<p>Those ridiculous numbers translate into some dismal performance scores, which has been shown to have <a href=\\\"https://web.dev/why-speed-matters/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">a measurable impact on several metrics you should care about</a>, including conversion rate, SEO, and user experience.</p>\\n<p>I ran the three versions of my sample page through Google’s <a href=\\\"https://pagespeed.web.dev/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">PageSpeed Insights</a> tool to see what kind of quantitive impact each has performance. The results were what you’d expect.</p>\\n<p>The page with no comments scored highly, receiving an overall score of 100 and green metrics across the board. No surprises here.</p>\\n<p><img src='/proxy/d61be3ac-11dd-4af3-a035-e46ac9bd0dd7' alt='' loading='lazy' /></p>\\n<p>On the page with Disqus installed, the page score dipped to 71, with some disturbing metrics. Pay particular attention to that time-to-interactive (TTI). That’s over 10 seconds of waiting before the page could reliably respond to user input.</p>\\n<p><img src='/proxy/a49fe9fc-b0e7-40bb-930e-6ecb984db5f0' alt='' loading='lazy' /></p>\\n<p>And finally, adding JamComments kept performance well-within an acceptable range. It scored  100 with everything else green.</p>\\n<p><img src='/proxy/97892c5c-33f8-4f4d-96d4-204f3c818db7' alt='' loading='lazy' /></p>\\n<p>Again, all we need is a simple comment form that sends some information somewhere and renders it on the page. Disqus tries to get you to download the moon, because that’s apparently what it takes to deliver an effective experience. Or more likely, mine every ounce of information it can collect from you to send it off to third parties.</p>\\n<h2>Don’t Fall for the Shininess</h2>\\n<p>I totally get the appeal of a tool like Disqus — it offers a host of mature features, and it’s rather easy to set up on a website. But it’s important not to let those shiny tools &#x26; ease of use overshadow what it costs you and your readers. Even if it’s not JamComments, consider searching for a more performant, SEO-friendly, and privacy-mindful options within reach. Blog comments are still a feature worth having, so long as you don’t have to sell your soul to have them.</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 8,
        "title": "When I Actually Needed useLayoutEffect() in React",
        "slug": "when-i-needed-uselayouteffect-in-react",
        "html": "<p>If you’ve worked with React for any length of time, you’ve probably heard of the infamous <code>useLayoutEffect()</code> hook. You’ve also probably never used it. That’s because for most cases, <code>useEffect()</code> covers the vast majority of use cases with a much lower chance of shooting yourself in the foot. In fact, the the React docs even explicitly encourage you to use the latter whenever possible to avoid performance gotchas.</p>\n<p>The reason for this is because of when each hook fires its callback. The <code>useEffect()</code> hook fires <em>after</em> a component renders and paints changes to the DOM; <code>useLayoutEffect()</code> fires <em>before, and does so synchronously.</em></p>\n<p>This means if you’re not careful, your expensive callback could block the main thread, preventing any UI updates from being rendered for the user.</p>\n<h3>An Illustration</h3>\n<p>Here’s a simple <code>Name</code> component. All it does is render a piece of <code>name</code> state with a default of “Bob.” But there’s also a <code>useEffect()</code> hook that’ll fire whenever that state changes. And as soon as it does, it updates the name to “Alex.” If you were to render this component in the browser, you <em>probably</em> wouldn’t notice any sort of flash. Instead, all you’d see is “Alex” painted to the screen:</p>\n<div class=\"remark-highlight\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Name</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">,</span> setName<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Bob'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Alex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&#x3C;</span>div<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>name<span class=\"token punctuation\">}</span><span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// &#x3C;Name /> seemingly _only_ paints \"Alex\" to the screen.</span>\n</code></pre></div>\n<p>But technically, <code>useEffect()</code> is firing <em>after</em> a full render has taken place, which could also mean after that render has been painted to the screen. We can force this behavior by putting a synchronous pause in place. This <code>Name</code> component will still behave the same way, but this time, the state update will be pushed back by a second (1000ms).</p>\n<div class=\"remark-highlight\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">pause</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>ms<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> time <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> time <span class=\"token operator\">&#x3C;=</span> ms<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Name</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">,</span> setName<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Bob'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\n\t<span class=\"token comment\">// Fires _after_ a render has taken place.</span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">pause</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Alex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&#x3C;</span>div<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>name<span class=\"token punctuation\">}</span><span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>If you <a href=\"https://stackblitz.com/edit/react-vafxw6\" target=\"_blank\" rel=\"noopener\">try it out this time</a>, “Alex” no longer immediately paints to the screen. Instead, “Bob” is first rendered, and then, after a second, “Alex” pops in.</p>\n<p><img src='/proxy/7c1700ed-b4f5-4e81-a615-f5a9b151ce5e' alt='' loading='lazy' /></p>\n<p>Based on how <code>useEffect()</code> is documented, this checks out. It’s only firing after a full render has been committed and prepared to be painted. And so any last-second state changes or DOM modifications are at risk for being “flashed” to the screen before they’re desired.</p>\n<p>Now, let’s make a small modification: instead of using <code>useEffect()</code>, we’ll use <code>useLayoutEffect()</code>. This time around, we’ll change the state <em>before</em> any changes have been allowed to fully render to the DOM. And for that reason, we’ll see some far more predictable results:</p>\n<div class=\"remark-highlight\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Name</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">,</span> setName<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Bob'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\">// Fires _before_ anything's been rendered at all.</span>\n  <span class=\"token function\">useLayoutEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">pause</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Alex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&#x3C;</span>div<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>name<span class=\"token punctuation\">}</span><span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>If you were to try it out now, you’ll see that the “Bob” flash is gone. Instead, nothing renders at all until our synchronous <code>useLayoutEffect()</code> callback has finished:</p>\n<p><img src='/proxy/e9a61e0d-823a-43bd-9c59-e5e4c0e34298' alt='' loading='lazy' /></p>\n<h2>So, When Should I Use It?</h2>\n<p>When choosing between <code>useEffect()</code> and <code>useLayoutEffect()</code>, use the latter when you need to something <em>to</em> or <em>with</em> the DOM <em>before</em> anything has been painted to the screen.</p>\n<h3>My Own Scenario</h3>\n<p>I was building a simple tooltip from scratch. The component allows its positioning to be configured with a <code>position</code> prop — either right, center, or left. However, depending on the layout of the item its mounted to, as well as the dimensions of the viewport, I <em>sometimes</em> might want to override the provided position with an <code>overridePosition</code>. Here’s an ultra-simplified version of this component and how it can be used.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token maybe-class-name\">Tooltip</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> children<span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">,</span> position <span class=\"token operator\">=</span> <span class=\"token string\">'center'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>shouldShow<span class=\"token punctuation\">,</span> setShouldShow<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">toggle</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token function\">setShouldShow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">val</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token operator\">!</span>val<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&#x3C;</span>span <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"tooltip-wrapper\"</span><span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span>shouldShow <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token operator\">&#x3C;</span>div className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">tooltip </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>position<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span>message<span class=\"token punctuation\">}</span><span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span><span class=\"token punctuation\">}</span>\n\n      <span class=\"token punctuation\">{</span><span class=\"token function\">children</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> toggle <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\"><span class=\"token maybe-class-name\">App</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&#x3C;</span><span class=\"token maybe-class-name\">Tooltip</span> position<span class=\"token operator\">=</span><span class=\"token string\">\"left\"</span> message<span class=\"token operator\">=</span><span class=\"token string\">\"My message!\"</span><span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> toggle <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">return</span> <span class=\"token operator\">&#x3C;</span>button onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>toggle<span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token maybe-class-name\">Toggle</span> <span class=\"token maybe-class-name\">Tooltip</span><span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span><span class=\"token maybe-class-name\">Tooltip</span><span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p><a href=\"https://stackblitz.com/edit/react-dan16d\" target=\"_blank\" rel=\"noopener\">This works</a>, but there’s a problem: <strong>we can predict neither the layout of the page nor the size of the user’s viewport.</strong> And so, we might end up with the tooltip rendering like this — outside the view of the user:</p>\n<p><img src='/proxy/fbec16f9-f847-4613-abfb-a45a6de2f5b1' alt='' loading='lazy' /></p>\n<p>In cases like these, there isn’t much React can do for us. Instead, we need to take the DOM into our own hands for a bit before any rendering takes place.</p>\n<h3>Reading the DOM Before Anything’s Rendered</h3>\n<p>In order to get around this, we’re gonna update this component to set an <code>overridePosition</code> only if two conditions are met:</p>\n<ol>\n<li>The tooltip’s DOM node itself is actually mounted.</li>\n<li>That mounted node is hanging off the edge of the viewport.</li>\n</ol>\n<p>Because all of this needs to take place before the user has a chance to see anything, it’s a great use case for <code>useLayoutEffect()</code>.</p>\n<p>First, we’ll set up a <code>useLayoutEffect()</code> hook that checks if a <code>ref.current</code> value is truthy. That <code>ref</code> will be attached to the actual tooltip markup that’s conditionally rendered (via <code>shouldShow</code>):</p>\n<div class=\"remark-highlight\"><pre class=\"language-diff\"><code class=\"language-diff\">const Tooltip = ({ children, message, position = 'center' }) => {\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">\tconst ref = useRef(null);</span>\n<span class=\"token line\"></span></span>\tconst [shouldShow, setShouldShow] = useState(false);\n\tconst toggle = () => setShouldShow((val) => !val);\n\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">\tuseLayoutEffect(() => {</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">\t\tif (!ref.current) return;</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">\t});</span>\n<span class=\"token line\"></span></span>\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> return (</span>\n<span class=\"token line\"></span></span>\t\t&#x3C;span className=\"tooltip-wrapper\">\n\t\t\t{shouldShow &#x26;&#x26; (\n\t\t\t\t&#x3C;div \n\t\t\t\t\tclassName={`tooltip ${position}`}\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">\t\t\t\t\tref={ref}</span>\n<span class=\"token line\"></span></span>\t\t\t\t>\n\t\t\t\t\t{message}\n\t\t\t\t&#x3C;/div>\n\t\t\t)}\n\n\t\t\t{children({ toggle })}\n\t\t&#x3C;/span>\n\t);\n};\n</code></pre></div>\n<p>It’s probably worth noting that we’re not passing any values to the dependency array of our hook. That’s because we <em>want</em> the callback to run whenever any state changes. There could be countless other things going on in the browser between toggles, and so performing a fresh (yet-to-be-written) DOM check keeps us flexible with unpredictable layout changes.</p>\n<p>Next up, we can check if the rendered tooltip is popping outside of the viewport. I’ll leave the implementation of that method (and other supporting methods) out of here, but if you’re interested, you can <a href=\"https://stackblitz.com/edit/react-dan16d\" target=\"_blank\" rel=\"noopener\">check out the demo.</a></p>\n<div class=\"remark-highlight\"><pre class=\"language-diff\"><code class=\"language-diff\">const Tooltip = ({ children, message, position = 'center' }) => {\n\tconst ref = useRef(null);\n\tconst [shouldShow, setShouldShow] = useState(false);\n\tconst toggle = () => setShouldShow((val) => !val);\n\n\tuseLayoutEffect(() => {\n\t\tif (!ref.current) return;\n\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">\t\t// Don't bother unless the tip is clipped by the viewport.</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">\t\tif (!elementIsOutsideViewport(ref.current)) return;</span>\n<span class=\"token line\"></span></span><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\">});</span>\n<span class=\"token line\"></span></span>\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> return (</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   &#x3C;span className=\"tooltip-wrapper\"></span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">     {shouldShow &#x26;&#x26; (</span>\n<span class=\"token line\"></span></span>\t      &#x3C;div \n\t\t\t\t\tclassName={`tooltip ${position}`}\n\t\t\t\t\tref={ref}\n\t\t\t\t>\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\">         {message}</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">       &#x3C;/div></span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">     )}</span>\n<span class=\"token line\"></span></span>\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\">     {children({ toggle })}</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   &#x3C;/span></span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> );</span>\n<span class=\"token line\"></span></span>};\n</code></pre></div>\n<p>And finally, if the element <em>is</em> being clipped by the viewport, we can run through all possible positions (”left,” “center”, and “right”) to find the one that offers the most visibility. If that override is ever set, a small piece of state will be used to update the class instead of the <code>position</code> prop.</p>\n<div class=\"remark-highlight\"><pre class=\"language-diff\"><code class=\"language-diff\">const Tooltip = ({ children, message, position = 'center' }) => {\n\tconst ref = useRef(null);\n\tconst [shouldShow, setShouldShow] = useState(false);\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">\tconst [overridePosition, setOverridePosition] = useState('');</span>\n<span class=\"token line\"></span></span>\tconst toggle = () => setShouldShow((val) => !val);\n\n\tuseLayoutEffect(() => {\n\t\tif (!ref.current) return;\n\t\tif (!elementIsOutsideViewport(ref.current)) return;\n\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">\t\tconst position = findMostVisiblePosition(ref.current);</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">\t\tsetOverridePosition(position);</span>\n<span class=\"token line\"></span></span>\t});\n\n\treturn (\n\t\t&#x3C;span className=\"tooltip-wrapper\">\n\t\t\t{shouldShow &#x26;&#x26; (\n\t\t\t\t&#x3C;div \n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">\t\t\t\t\tclassName={`tooltip ${overridePosition || position}`}</span>\n<span class=\"token line\"></span></span>\t\t\t\t\tref={ref}\n\t\t\t\t>\n\t\t\t\t\t{message}\n\t\t\t\t&#x3C;/div>\n\t\t\t)}\n\n\t\t\t{children({ toggle })}\n\t\t&#x3C;/span>\n\t);\n};\n</code></pre></div>\n<p>After all of that, the tooltip should behave much better, despite being provided a position that would cause it to render outside the viewport. And thanks to <code>useLayoutEffect()</code>, there’s zero risk of the incorrect position ever flashing to the screen.</p>\n<p><img src='/proxy/28c48ef5-bf80-46ce-9010-3f45d46e14a2' alt='' loading='lazy' /></p>\n<h2>What Else Am I Missing Out On?</h2>\n<p>In digging into this, I came across <em>many</em> hooks provided by React that I’ve never even heard of (ex: <code>useSyncExternalStore()</code>???). It’s incredible the seemingly niche use cases some of them cover, and the range in different problems they help to solve.</p>\n<p>So, some homework for you: <a href=\"https://beta.reactjs.org/reference/react\" target=\"_blank\" rel=\"noopener\">skim through some of them</a> the next time you’re waiting for a synchronous timeout to finish. You’ll be better off for it.</p>\n<h3>Links</h3>\n<ul>\n<li><a href=\"https://stackblitz.com/edit/react-vafxw6\" target=\"_blank\" rel=\"noopener\">useLayoutEffect() Demo</a></li>\n<li><a href=\"https://stackblitz.com/edit/react-dan16d\" target=\"_blank\" rel=\"noopener\">Tooltip Demo</a></li>\n</ul>\n",
        "feature_image": "https://images.unsplash.com/photo-1502043150060-b01aa3030556?ixlib=rb-4.0.3&q=80&fm=jpg&crop=entropy&cs=tinysrgb",
        "status": "published",
        "created_at": 1672030800000,
        "published_at": 1672030800000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>If you’ve worked with React for any length of time, you’ve probably heard of the infamous <code>useLayoutEffect()</code> hook. You’ve also probably never used it. That’s because for most cases, <code>useEffect()</code> covers the vast majority of use cases with a much lower chance of shooting yourself in the foot. In fact, the the React docs even explicitly encourage you to use the latter whenever possible to avoid performance gotchas.</p>\\n<p>The reason for this is because of when each hook fires its callback. The <code>useEffect()</code> hook fires <em>after</em> a component renders and paints changes to the DOM; <code>useLayoutEffect()</code> fires <em>before, and does so synchronously.</em></p>\\n<p>This means if you’re not careful, your expensive callback could block the main thread, preventing any UI updates from being rendered for the user.</p>\\n<h3>An Illustration</h3>\\n<p>Here’s a simple <code>Name</code> component. All it does is render a piece of <code>name</code> state with a default of “Bob.” But there’s also a <code>useEffect()</code> hook that’ll fire whenever that state changes. And as soon as it does, it updates the name to “Alex.” If you were to render this component in the browser, you <em>probably</em> wouldn’t notice any sort of flash. Instead, all you’d see is “Alex” painted to the screen:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-typescript\\\"><code class=\\\"language-typescript\\\"><span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">Name</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">[</span>name<span class=\\\"token punctuation\\\">,</span> setName<span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">useState</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'Bob'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token function\\\">useEffect</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token function\\\">setName</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'Alex'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">[</span>name<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">return</span> <span class=\\\"token operator\\\">&#x3C;</span>div<span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">{</span>name<span class=\\\"token punctuation\\\">}</span><span class=\\\"token operator\\\">&#x3C;</span><span class=\\\"token operator\\\">/</span>div<span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// &#x3C;Name /> seemingly _only_ paints \\\"Alex\\\" to the screen.</span>\\n</code></pre></div>\\n<p>But technically, <code>useEffect()</code> is firing <em>after</em> a full render has taken place, which could also mean after that render has been painted to the screen. We can force this behavior by putting a synchronous pause in place. This <code>Name</code> component will still behave the same way, but this time, the state update will be pushed back by a second (1000ms).</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-typescript\\\"><code class=\\\"language-typescript\\\"><span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">pause</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span>ms<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">let</span> time <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Date</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">while</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Date</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">-</span> time <span class=\\\"token operator\\\">&#x3C;=</span> ms<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">Name</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">[</span>name<span class=\\\"token punctuation\\\">,</span> setName<span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">useState</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'Bob'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\t\\n\\t<span class=\\\"token comment\\\">// Fires _after_ a render has taken place.</span>\\n  <span class=\\\"token function\\\">useEffect</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token function\\\">pause</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token number\\\">1000</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token function\\\">setName</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'Alex'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">[</span>name<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">return</span> <span class=\\\"token operator\\\">&#x3C;</span>div<span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">{</span>name<span class=\\\"token punctuation\\\">}</span><span class=\\\"token operator\\\">&#x3C;</span><span class=\\\"token operator\\\">/</span>div<span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>If you <a href=\\\"https://stackblitz.com/edit/react-vafxw6\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">try it out this time</a>, “Alex” no longer immediately paints to the screen. Instead, “Bob” is first rendered, and then, after a second, “Alex” pops in.</p>\\n<p><img src='/proxy/7c1700ed-b4f5-4e81-a615-f5a9b151ce5e' alt='' loading='lazy' /></p>\\n<p>Based on how <code>useEffect()</code> is documented, this checks out. It’s only firing after a full render has been committed and prepared to be painted. And so any last-second state changes or DOM modifications are at risk for being “flashed” to the screen before they’re desired.</p>\\n<p>Now, let’s make a small modification: instead of using <code>useEffect()</code>, we’ll use <code>useLayoutEffect()</code>. This time around, we’ll change the state <em>before</em> any changes have been allowed to fully render to the DOM. And for that reason, we’ll see some far more predictable results:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-typescript\\\"><code class=\\\"language-typescript\\\"><span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">Name</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">[</span>name<span class=\\\"token punctuation\\\">,</span> setName<span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">useState</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'Bob'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n\\t<span class=\\\"token comment\\\">// Fires _before_ anything's been rendered at all.</span>\\n  <span class=\\\"token function\\\">useLayoutEffect</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token function\\\">pause</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token number\\\">1000</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token function\\\">setName</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'Alex'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">[</span>name<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">return</span> <span class=\\\"token operator\\\">&#x3C;</span>div<span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">{</span>name<span class=\\\"token punctuation\\\">}</span><span class=\\\"token operator\\\">&#x3C;</span><span class=\\\"token operator\\\">/</span>div<span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>If you were to try it out now, you’ll see that the “Bob” flash is gone. Instead, nothing renders at all until our synchronous <code>useLayoutEffect()</code> callback has finished:</p>\\n<p><img src='/proxy/e9a61e0d-823a-43bd-9c59-e5e4c0e34298' alt='' loading='lazy' /></p>\\n<h2>So, When Should I Use It?</h2>\\n<p>When choosing between <code>useEffect()</code> and <code>useLayoutEffect()</code>, use the latter when you need to something <em>to</em> or <em>with</em> the DOM <em>before</em> anything has been painted to the screen.</p>\\n<h3>My Own Scenario</h3>\\n<p>I was building a simple tooltip from scratch. The component allows its positioning to be configured with a <code>position</code> prop — either right, center, or left. However, depending on the layout of the item its mounted to, as well as the dimensions of the viewport, I <em>sometimes</em> might want to override the provided position with an <code>overridePosition</code>. Here’s an ultra-simplified version of this component and how it can be used.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> <span class=\\\"token maybe-class-name\\\">Tooltip</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span> children<span class=\\\"token punctuation\\\">,</span> message<span class=\\\"token punctuation\\\">,</span> position <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">'center'</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">[</span>shouldShow<span class=\\\"token punctuation\\\">,</span> setShouldShow<span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">useState</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">toggle</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token function\\\">setShouldShow</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">val</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token operator\\\">!</span>val<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token punctuation\\\">(</span>\\n    <span class=\\\"token operator\\\">&#x3C;</span>span <span class=\\\"token keyword\\\">class</span><span class=\\\"token operator\\\">=</span><span class=\\\"token string\\\">\\\"tooltip-wrapper\\\"</span><span class=\\\"token operator\\\">></span>\\n      <span class=\\\"token punctuation\\\">{</span>shouldShow <span class=\\\"token operator\\\">&#x26;&#x26;</span> <span class=\\\"token operator\\\">&#x3C;</span>div className<span class=\\\"token operator\\\">=</span><span class=\\\"token punctuation\\\">{</span><span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">tooltip </span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>position<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">}</span><span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">{</span>message<span class=\\\"token punctuation\\\">}</span><span class=\\\"token operator\\\">&#x3C;</span><span class=\\\"token operator\\\">/</span>div<span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">}</span>\\n\\n      <span class=\\\"token punctuation\\\">{</span><span class=\\\"token function\\\">children</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span> toggle <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token operator\\\">&#x3C;</span><span class=\\\"token operator\\\">/</span>span<span class=\\\"token operator\\\">></span>\\n  <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword module\\\">export</span> <span class=\\\"token keyword module\\\">default</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\"><span class=\\\"token maybe-class-name\\\">App</span></span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token punctuation\\\">(</span>\\n    <span class=\\\"token operator\\\">&#x3C;</span><span class=\\\"token maybe-class-name\\\">Tooltip</span> position<span class=\\\"token operator\\\">=</span><span class=\\\"token string\\\">\\\"left\\\"</span> message<span class=\\\"token operator\\\">=</span><span class=\\\"token string\\\">\\\"My message!\\\"</span><span class=\\\"token operator\\\">></span>\\n      <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\"><span class=\\\"token punctuation\\\">{</span> toggle <span class=\\\"token punctuation\\\">}</span></span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token operator\\\">&#x3C;</span>button onClick<span class=\\\"token operator\\\">=</span><span class=\\\"token punctuation\\\">{</span>toggle<span class=\\\"token punctuation\\\">}</span><span class=\\\"token operator\\\">></span><span class=\\\"token maybe-class-name\\\">Toggle</span> <span class=\\\"token maybe-class-name\\\">Tooltip</span><span class=\\\"token operator\\\">&#x3C;</span><span class=\\\"token operator\\\">/</span>button<span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token operator\\\">&#x3C;</span><span class=\\\"token operator\\\">/</span><span class=\\\"token maybe-class-name\\\">Tooltip</span><span class=\\\"token operator\\\">></span>\\n  <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p><a href=\\\"https://stackblitz.com/edit/react-dan16d\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">This works</a>, but there’s a problem: <strong>we can predict neither the layout of the page nor the size of the user’s viewport.</strong> And so, we might end up with the tooltip rendering like this — outside the view of the user:</p>\\n<p><img src='/proxy/fbec16f9-f847-4613-abfb-a45a6de2f5b1' alt='' loading='lazy' /></p>\\n<p>In cases like these, there isn’t much React can do for us. Instead, we need to take the DOM into our own hands for a bit before any rendering takes place.</p>\\n<h3>Reading the DOM Before Anything’s Rendered</h3>\\n<p>In order to get around this, we’re gonna update this component to set an <code>overridePosition</code> only if two conditions are met:</p>\\n<ol>\\n<li>The tooltip’s DOM node itself is actually mounted.</li>\\n<li>That mounted node is hanging off the edge of the viewport.</li>\\n</ol>\\n<p>Because all of this needs to take place before the user has a chance to see anything, it’s a great use case for <code>useLayoutEffect()</code>.</p>\\n<p>First, we’ll set up a <code>useLayoutEffect()</code> hook that checks if a <code>ref.current</code> value is truthy. That <code>ref</code> will be attached to the actual tooltip markup that’s conditionally rendered (via <code>shouldShow</code>):</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-diff\\\"><code class=\\\"language-diff\\\">const Tooltip = ({ children, message, position = 'center' }) => {\\n<span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">\\tconst ref = useRef(null);</span>\\n<span class=\\\"token line\\\"></span></span>\\tconst [shouldShow, setShouldShow] = useState(false);\\n\\tconst toggle = () => setShouldShow((val) => !val);\\n\\n<span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">\\tuseLayoutEffect(() => {</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">\\t\\tif (!ref.current) return;</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">\\t});</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> return (</span>\\n<span class=\\\"token line\\\"></span></span>\\t\\t&#x3C;span className=\\\"tooltip-wrapper\\\">\\n\\t\\t\\t{shouldShow &#x26;&#x26; (\\n\\t\\t\\t\\t&#x3C;div \\n\\t\\t\\t\\t\\tclassName={`tooltip ${position}`}\\n<span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">\\t\\t\\t\\t\\tref={ref}</span>\\n<span class=\\\"token line\\\"></span></span>\\t\\t\\t\\t>\\n\\t\\t\\t\\t\\t{message}\\n\\t\\t\\t\\t&#x3C;/div>\\n\\t\\t\\t)}\\n\\n\\t\\t\\t{children({ toggle })}\\n\\t\\t&#x3C;/span>\\n\\t);\\n};\\n</code></pre></div>\\n<p>It’s probably worth noting that we’re not passing any values to the dependency array of our hook. That’s because we <em>want</em> the callback to run whenever any state changes. There could be countless other things going on in the browser between toggles, and so performing a fresh (yet-to-be-written) DOM check keeps us flexible with unpredictable layout changes.</p>\\n<p>Next up, we can check if the rendered tooltip is popping outside of the viewport. I’ll leave the implementation of that method (and other supporting methods) out of here, but if you’re interested, you can <a href=\\\"https://stackblitz.com/edit/react-dan16d\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">check out the demo.</a></p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-diff\\\"><code class=\\\"language-diff\\\">const Tooltip = ({ children, message, position = 'center' }) => {\\n\\tconst ref = useRef(null);\\n\\tconst [shouldShow, setShouldShow] = useState(false);\\n\\tconst toggle = () => setShouldShow((val) => !val);\\n\\n\\tuseLayoutEffect(() => {\\n\\t\\tif (!ref.current) return;\\n\\n<span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">\\t\\t// Don't bother unless the tip is clipped by the viewport.</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">\\t\\tif (!elementIsOutsideViewport(ref.current)) return;</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">});</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> return (</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   &#x3C;span className=\\\"tooltip-wrapper\\\"></span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">     {shouldShow &#x26;&#x26; (</span>\\n<span class=\\\"token line\\\"></span></span>\\t      &#x3C;div \\n\\t\\t\\t\\t\\tclassName={`tooltip ${position}`}\\n\\t\\t\\t\\t\\tref={ref}\\n\\t\\t\\t\\t>\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">         {message}</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">       &#x3C;/div></span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">     )}</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">     {children({ toggle })}</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   &#x3C;/span></span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> );</span>\\n<span class=\\\"token line\\\"></span></span>};\\n</code></pre></div>\\n<p>And finally, if the element <em>is</em> being clipped by the viewport, we can run through all possible positions (”left,” “center”, and “right”) to find the one that offers the most visibility. If that override is ever set, a small piece of state will be used to update the class instead of the <code>position</code> prop.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-diff\\\"><code class=\\\"language-diff\\\">const Tooltip = ({ children, message, position = 'center' }) => {\\n\\tconst ref = useRef(null);\\n\\tconst [shouldShow, setShouldShow] = useState(false);\\n<span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">\\tconst [overridePosition, setOverridePosition] = useState('');</span>\\n<span class=\\\"token line\\\"></span></span>\\tconst toggle = () => setShouldShow((val) => !val);\\n\\n\\tuseLayoutEffect(() => {\\n\\t\\tif (!ref.current) return;\\n\\t\\tif (!elementIsOutsideViewport(ref.current)) return;\\n\\n<span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">\\t\\tconst position = findMostVisiblePosition(ref.current);</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">\\t\\tsetOverridePosition(position);</span>\\n<span class=\\\"token line\\\"></span></span>\\t});\\n\\n\\treturn (\\n\\t\\t&#x3C;span className=\\\"tooltip-wrapper\\\">\\n\\t\\t\\t{shouldShow &#x26;&#x26; (\\n\\t\\t\\t\\t&#x3C;div \\n<span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">\\t\\t\\t\\t\\tclassName={`tooltip ${overridePosition || position}`}</span>\\n<span class=\\\"token line\\\"></span></span>\\t\\t\\t\\t\\tref={ref}\\n\\t\\t\\t\\t>\\n\\t\\t\\t\\t\\t{message}\\n\\t\\t\\t\\t&#x3C;/div>\\n\\t\\t\\t)}\\n\\n\\t\\t\\t{children({ toggle })}\\n\\t\\t&#x3C;/span>\\n\\t);\\n};\\n</code></pre></div>\\n<p>After all of that, the tooltip should behave much better, despite being provided a position that would cause it to render outside the viewport. And thanks to <code>useLayoutEffect()</code>, there’s zero risk of the incorrect position ever flashing to the screen.</p>\\n<p><img src='/proxy/28c48ef5-bf80-46ce-9010-3f45d46e14a2' alt='' loading='lazy' /></p>\\n<h2>What Else Am I Missing Out On?</h2>\\n<p>In digging into this, I came across <em>many</em> hooks provided by React that I’ve never even heard of (ex: <code>useSyncExternalStore()</code>???). It’s incredible the seemingly niche use cases some of them cover, and the range in different problems they help to solve.</p>\\n<p>So, some homework for you: <a href=\\\"https://beta.reactjs.org/reference/react\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">skim through some of them</a> the next time you’re waiting for a synchronous timeout to finish. You’ll be better off for it.</p>\\n<h3>Links</h3>\\n<ul>\\n<li><a href=\\\"https://stackblitz.com/edit/react-vafxw6\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">useLayoutEffect() Demo</a></li>\\n<li><a href=\\\"https://stackblitz.com/edit/react-dan16d\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Tooltip Demo</a></li>\\n</ul>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 9,
        "title": "Serving Notion Presigned Images with Cloudflare Workers",
        "slug": "serving-notion-presigned-images-with-cloudflare",
        "html": "<p>I recently made a pretty big change on my website. For the first time ever, my posts don’t live in Markdown files. Instead, they’re all in Notion, the tool I’ve been using to draft posts for quite some time now. It’s nice being able to have a top-notch writing experience without the need to perform a clunky Markdown export when it’s finally time to publish.</p>\n<p>Most of the migration was pretty boring &#x26; straightforward, but there was a particular piece of it that was interesting to navigate: <strong>serving images</strong>.</p>\n<p>If you look at the underlying URL of any image in Notion, you’ll notice it’s <a href=\"https://docs.aws.amazon.com/AmazonS3/latest/userguide/using-presigned-url.html\" target=\"_blank\" rel=\"noopener\">presigned</a>, and after a fixed number of hours has passed, that URL will expire. This posed a challenge. My site is statically generated with Next.js, and if I directly embedded those raw Notion links, my images would all cease to work after a while.</p>\n<p>I needed a cheap solution that wouldn’t require a painfully complicated process to set up. Thankfully, CloudFlare has some handy tools in its suite for pulling this off.</p>\n<h2>The P<strong>anacea that is Cloudflare</strong></h2>\n<p>There are two distinct problems to solve here, each of which paired nicely with one of Cloudflare’s offerings.</p>\n<p>First, whenever one of my pages containing images is viewed, I needed to intercept each image request in order to serve it from a location that’s <em>not</em> Notion. A Cloudflare Worker is perfect for this job. Workers operate at the edge, so you can run server-side code with a similar level of performance as serving a static file from a CDN. Plus, the free tier is generous and the developer experience is buttery smooth.</p>\n<p>Second, I needed a place to put those images before they’re served on my site. Not long ago, Cloudflare introduced a tempting alternative to Amazon’s S3 product — <a href=\"https://www.cloudflare.com/products/r2/\" target=\"_blank\" rel=\"noopener\">R2 Object Storage</a>. It touts zero egress fees (meaning it’s dirt cheap if you’re largely just reading static assets), and an API that’s fully compatible with S3 (bonkers). I knew this would mesh nicely with what I was aiming to do.</p>\n<h2>The Build</h2>\n<p>With these tools at my disposal, here’s how I set it up:</p>\n<h3>Step #1: Upload images on site build.</h3>\n<p>It’s nice that R2 is compatible with AWS, because all this meant was installing the <code>aws-sdk</code>, configuring it with my Cloudflare access key, and setting up the code to upload images when my Next.js site is built. This process involved two main parts.</p>\n<p><strong>Determining Image Keys</strong></p>\n<p>First, I determined the key by which I’m save each image by hacking apart the URL embedded within my Notion posts. In raw form, they look something like this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-typescript\"><code class=\"language-typescript\">https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>s3<span class=\"token punctuation\">.</span>us<span class=\"token operator\">-</span>west<span class=\"token operator\">-</span><span class=\"token number\">2</span><span class=\"token punctuation\">.</span>amazonaws<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>secure<span class=\"token punctuation\">.</span>notion<span class=\"token operator\">-</span><span class=\"token keyword\">static</span><span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>d527ddf8<span class=\"token operator\">-</span>acdc<span class=\"token operator\">-</span><span class=\"token number\">4284</span><span class=\"token operator\">-</span>914d<span class=\"token operator\">-</span>8d4fefeda507<span class=\"token operator\">/</span>Untitled<span class=\"token punctuation\">.</span>png<span class=\"token operator\">?</span><span class=\"token constant\">X</span><span class=\"token operator\">-</span>Amz<span class=\"token operator\">-</span>Algorithm<span class=\"token operator\">=</span><span class=\"token constant\">AWS4</span><span class=\"token operator\">-</span><span class=\"token constant\">HMAC</span><span class=\"token operator\">-</span><span class=\"token constant\">SHA256</span><span class=\"token operator\">&#x26;</span><span class=\"token constant\">X</span><span class=\"token operator\">-</span>Amz<span class=\"token operator\">-</span>Content<span class=\"token operator\">-</span>Sha256<span class=\"token operator\">=</span><span class=\"token constant\">UNSIGNED</span><span class=\"token operator\">-</span><span class=\"token constant\">PAYLOAD</span><span class=\"token operator\">&#x26;</span><span class=\"token constant\">X</span><span class=\"token operator\">-</span>Amz<span class=\"token operator\">-</span>Credential<span class=\"token operator\">=</span><span class=\"token constant\">AKIAT73L2G45EIPT3X45</span><span class=\"token operator\">%</span>2F20221016<span class=\"token operator\">%</span>2Fus<span class=\"token operator\">-</span>west<span class=\"token operator\">-</span><span class=\"token number\">2</span><span class=\"token operator\">%</span>2Fs3<span class=\"token operator\">%</span>2Faws4_request<span class=\"token operator\">&#x26;</span><span class=\"token constant\">X</span><span class=\"token operator\">-</span>Amz<span class=\"token operator\">-</span>Date<span class=\"token operator\">=</span>20221016T223440Z<span class=\"token operator\">&#x26;</span><span class=\"token constant\">X</span><span class=\"token operator\">-</span>Amz<span class=\"token operator\">-</span>Expires<span class=\"token operator\">=</span><span class=\"token number\">86400</span><span class=\"token operator\">&#x26;</span><span class=\"token constant\">X</span><span class=\"token operator\">-</span>Amz<span class=\"token operator\">-</span>Signature<span class=\"token operator\">=</span>841d76d1a556204dc3d9c5a3d838913e3409224fe6d070a92fc9a9738918479e<span class=\"token operator\">&#x26;</span><span class=\"token constant\">X</span><span class=\"token operator\">-</span>Amz<span class=\"token operator\">-</span>SignedHeaders<span class=\"token operator\">=</span>host<span class=\"token operator\">&#x26;</span>response<span class=\"token operator\">-</span>content<span class=\"token operator\">-</span>disposition<span class=\"token operator\">=</span>filename<span class=\"token operator\">%</span><span class=\"token number\">20</span><span class=\"token operator\">%</span>3D<span class=\"token operator\">%</span>22Untitled<span class=\"token punctuation\">.</span>png<span class=\"token operator\">%</span><span class=\"token number\">22</span><span class=\"token operator\">&#x26;</span>x<span class=\"token operator\">-</span>id<span class=\"token operator\">=</span>GetObject\n</code></pre></div>\n<p>I chose to use the random-looking string of characters immediately following the hostname. This would be the unique identifier by which I upload each image to R2:</p>\n<div class=\"remark-highlight\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">function</span> <span class=\"token function\">extractKey</span><span class=\"token punctuation\">(</span>imageUrl<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token constant\">URL</span></span><span class=\"token punctuation\">(</span>imageUrl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> parts <span class=\"token operator\">=</span> url<span class=\"token punctuation\">.</span>pathname<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> parts<span class=\"token punctuation\">[</span>parts<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> key <span class=\"token operator\">=</span> <span class=\"token function\">extractKey</span><span class=\"token punctuation\">(</span>\n\t<span class=\"token string\">\"https://s3.us-west-2.amazonaws.com/secure.notion-static.com/d527ddf8-acdc-4284-914d-8d4fefeda507/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&#x26;X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&#x26;X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20221016%2Fus-west-2%2Fs3%2Faws4_request&#x26;X-Amz-Date=20221016T223440Z&#x26;X-Amz-Expires=86400&#x26;X-Amz-Signature=841d76d1a556204dc3d9c5a3d838913e3409224fe6d070a92fc9a9738918479e&#x26;X-Amz-SignedHeaders=host&#x26;response-content-disposition=filename%20%3D%22Untitled.png%22&#x26;x-id=GetObject\"</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// key: 802f4ae5-100d-4ce1-9912-82fe84b11733</span>\n</code></pre></div>\n<p><strong>Conditionally Upload Based on Key</strong></p>\n<p>Once the key was determined, it was time for the upload itself, which I bypass if the upload has already occurred. I wrote a <code>StaticAssetService</code> class to perform this work, which uses R2 as a <code>provider</code> responsible for hosting those assets. The interesting part of that code looks like this. Feel free to <a href=\"https://github.com/alexmacarthur/macarthur-me-next/blob/main/lib/StaticAssetService.ts#L14\" target=\"_blank\" rel=\"noopener\">dive in more here</a>.</p>\n<div class=\"remark-highlight\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">async</span> <span class=\"token function\">put</span><span class=\"token punctuation\">(</span>imageUrl<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> key<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&#x3C;</span><span class=\"token builtin\">any</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// I've already uploaded an image with this key! Don't do it again.</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token builtin\">Promise</span><span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Retrieval failed! Key: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>key<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">, url: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>imageUrl<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token comment\">// Upload the image!</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>provider<span class=\"token punctuation\">.</span><span class=\"token function\">uploadImage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      imageUrl<span class=\"token punctuation\">,</span>\n      key<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Upload failed! Key: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>key<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">, url: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>imageUrl<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token builtin\">Promise</span><span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p><strong>Important: Setting the Correct Content-Type</strong></p>\n<p>There’s one gotcha worth calling out regarding this process. By default, <code>binary/octet-stream</code> is set as the content type upon upload (rather than something like <code>image/png</code>), which would prevent the image from rendering when it’s finally served. The solution is to set that type on each upload, based on file you’re attempting to process. Here’s a closer look at that <code>uploadImage</code> method:</p>\n<div class=\"remark-highlight\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">async</span> <span class=\"token function\">uploadImage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> imageUrl<span class=\"token punctuation\">,</span> key <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> imageUrl<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span> key<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>imageUrl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> blob <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">arrayBuffer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> s3\n      <span class=\"token punctuation\">.</span><span class=\"token function\">upload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        Bucket<span class=\"token operator\">:</span> <span class=\"token constant\">BUCKET_NAME</span><span class=\"token punctuation\">,</span>\n        Key<span class=\"token operator\">:</span> key<span class=\"token punctuation\">,</span>\n        Body<span class=\"token operator\">:</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>blob<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n\t\t\t\t<span class=\"token comment\">// Set the correct `ContentType` here!</span>\n        ContentType<span class=\"token operator\">:</span> res<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Content-Type\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>A special shout-out is due to the participants of <a href=\"https://github.com/SoftwareBrothers/adminjs-upload/issues/37\" target=\"_blank\" rel=\"noopener\">this GitHub issue</a> for helping resolve this. With that piece in place, I can see every new upload appear in Cloudflare after I build my site:</p>\n<p><img src='/proxy/04f96ad6-2d26-4c7d-88de-91d78a7038e8' alt='' loading='lazy' /></p>\n<p>The entire process can be represented like so:</p>\n<p><img src='/proxy/510deb5d-e38c-4f46-9c82-bdfb2aa17dc0' alt='Uploading Images on Build' loading='lazy' /></p>\n<h3>Step #2: Rewrite image URLs before generating HTML.</h3>\n<p>You can only use a worker to intercept requests on <em>your own domain</em> set up with Cloudflare. So, if I wanted to handle my images in a certain way when they’re requested (like swap them out with an image from R2), I’d need to make it <em>look</em> like they belong to my domain before I build my HTML. I landed on transforming each presigned URL into a relative path with the following pattern: <code>/proxy/IMAGE_ID</code>. My worker would then be configured to listen for requests to this path and do as I see fit.</p>\n<h3>Writing the Pattern</h3>\n<p>In order to perform this URL transformation, I used a regular expression that would swap out the presigned URL with my <code>/proxy/IMAGE_KEY</code> path, using the image key I extracted earlier.</p>\n<p>The image “block” I’d get from Notion each time is composed of normal Markdown, containing an optional “alt” description and the long, presigned URL.</p>\n<div class=\"remark-highlight\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token operator\">!</span><span class=\"token punctuation\">[</span>alt description<span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span>https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>very<span class=\"token operator\">-</span>very<span class=\"token operator\">-</span>long<span class=\"token operator\">-</span>presigned<span class=\"token operator\">-</span>image<span class=\"token operator\">/</span>url<span class=\"token punctuation\">.</span>jpg<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>In order to preserve that description while I update the path, I used the following pattern:</p>\n<div class=\"remark-highlight\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token operator\">!</span>\\<span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token operator\">*</span><span class=\"token operator\">?</span><span class=\"token punctuation\">)</span>\\<span class=\"token punctuation\">]</span>\\<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>\\<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>Here’s a brief breakdown of that pattern:</p>\n<table>\n<thead>\n<tr>\n<th><strong>Pattern Part</strong></th>\n<th><strong>Description</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>!\\[(.*?)\\]</code></td>\n<td>Captures the “alt description” between square brackets, so I could preserve it in my updated markup.</td>\n</tr>\n<tr>\n<td><code>\\(.*\\)</code></td>\n<td>Matches against the remaining URL between parentheses, in order to replace it with an updated path.</td>\n</tr>\n</tbody>\n</table>\n<p>Finally, I used <code>.replace()</code> to perform the operation:</p>\n<div class=\"remark-highlight\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">let</span> key <span class=\"token operator\">=</span> <span class=\"token function\">keyExtractedEarlierInTheBuild</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> updatedMarkdownImage <span class=\"token operator\">=</span> originalMarkdownImage<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>\n\t<span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">!<span class=\"token special-escape escape\">\\[</span><span class=\"token group punctuation\">(</span><span class=\"token char-set class-name\">.</span><span class=\"token quantifier number\">*?</span><span class=\"token group punctuation\">)</span><span class=\"token special-escape escape\">\\]</span><span class=\"token special-escape escape\">\\(</span><span class=\"token char-set class-name\">.</span><span class=\"token quantifier number\">*</span><span class=\"token special-escape escape\">\\)</span></span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n\t<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">![$1](/proxy/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>key<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">)</span><span class=\"token template-punctuation string\">`</span></span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Now that my images would all attempt to be requested from my own domain, I could finally set up a worker to intercept and pull them from R2.</p>\n<h3>#3. Intercept Image Requests with a Worker</h3>\n<p>One of the reasons this solution works so well is due to Cloudflare Workers’ first-class integration with R2. As such, the flow for my worker isn’t complex and can be visualized by the following sequence diagram:</p>\n<p><img src='/proxy/df80e01f-13f0-4c2d-9b5a-fd77b5a82ed8' alt='Sequence Diagram for Image Requests' loading='lazy' /></p>\n<p>In words, any given request is handled like so:</p>\n<ul>\n<li>For <strong>image requests</strong> (those made to <code>/proxy/IMAGE_ID</code>), intercept and return the the image by the embedded path ID from R2.</li>\n<li>For <strong>all other requests,</strong> allow the request to pass through to my site on Vercel.</li>\n</ul>\n<h3>Setting Up My Worker</h3>\n<p>While you can write it directly in the browser, I chose to <a href=\"https://developers.cloudflare.com/workers/get-started/quickstarts/\" target=\"_blank\" rel=\"noopener\">use Wangler</a> to build &#x26; experiment with my worker locally. There’s a learning curve, but it’s minimal, and eased by the fact that Cloudflare Workers are built on the <a href=\"https://developers.cloudflare.com/workers/runtime-apis/fetch/\" target=\"_blank\" rel=\"noopener\">fetch API</a>. If you’ve spent a decent amount of time with it in the browser, it won’t take long to feel at home with it here too.</p>\n<p>My worker is simple — consisting of only one “route,” set up with <a href=\"https://github.com/kwhitley/itty-router\" target=\"_blank\" rel=\"noopener\">itty-router</a>. Starting from scratch, it first looked something like this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Router <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"itty-router\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> router <span class=\"token operator\">=</span> <span class=\"token function\">Router</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nrouter<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">\"/proxy/:imageId\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>request<span class=\"token operator\">:</span> Request<span class=\"token punctuation\">,</span> env<span class=\"token operator\">:</span> AppEnv<span class=\"token punctuation\">,</span> ctx<span class=\"token operator\">:</span> ExecutionContext<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Response</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>\n    request<span class=\"token operator\">:</span> Request<span class=\"token punctuation\">,</span>\n    env<span class=\"token operator\">:</span> AppEnv<span class=\"token punctuation\">,</span>\n    context<span class=\"token operator\">:</span> ExecutionContext\n  <span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&#x3C;</span>Response<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token comment\">// If an exception is thrown, hit the origin server.</span>\n    context<span class=\"token punctuation\">.</span><span class=\"token function\">passThroughOnException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> router<span class=\"token punctuation\">.</span><span class=\"token function\">handle</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> env<span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>response <span class=\"token operator\">=></span> response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>When any request hits my worker, it’ll try to match against that <code>/proxy/:imageId</code> endpoint. If it doesn’t, the request will be forwarded to the origin server like normal (in this case, Vercel, where my site is hosted). But if it does match, the request will be intercepted and returned with a <code>new Response()</code>:</p>\n<p><img src='/proxy/c74c4615-26ca-4edc-a6b2-93b4201a652f' alt='' loading='lazy' /></p>\n<h3>Retrieving an Image from R2</h3>\n<p>After that, I took it to the next level by integrating with R2. Each request comes in with an <code>imageId</code> that corresponds to an image that was previous uploaded to R2. Cloudflare makes it easy to connect a bucket of your choosing to your worker. That meant creating a binding in my <code>wrangler.toml</code> file, which specifies the buckets I use in production &#x26; development:</p>\n<div class=\"remark-highlight\"><pre class=\"language-toml\"><code class=\"language-toml\"><span class=\"token comment\"># ... the rest of my wrangler.toml</span>\n\n<span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token table class-name\">r2_buckets</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n<span class=\"token key property\">binding</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">'MACARTHUR_ME'</span>\n<span class=\"token key property\">bucket_name</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">'macarthur-me'</span>\n<span class=\"token key property\">preview_bucket_name</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">'macarthur-me-dev'</span>\n</code></pre></div>\n<p>Then I could use that binding to fetch objects in my worker:</p>\n<div class=\"remark-highlight\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Router <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"itty-router\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">AppEnv</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token constant\">MACARTHUR_ME</span><span class=\"token operator\">:</span> R2Bucket<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">IRequest</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Request</span> <span class=\"token punctuation\">{</span>\n  method<span class=\"token operator\">:</span> <span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">;</span>\n  url<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  params<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> imageId<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> router <span class=\"token operator\">=</span> <span class=\"token function\">Router</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nrouter<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">\"/proxy/:imageId\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>request<span class=\"token operator\">:</span> IRequest<span class=\"token punctuation\">,</span> env<span class=\"token operator\">:</span> AppEnv<span class=\"token punctuation\">,</span> ctx<span class=\"token operator\">:</span> ExecutionContext<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> imageId <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span>params<span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token comment\">// Fetch the image by ID:</span>\n    <span class=\"token keyword\">const</span> obj <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> env<span class=\"token punctuation\">.</span><span class=\"token constant\">MACARTHUR_ME</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>imageId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>obj<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Response</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Image not found: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>imageId<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> status<span class=\"token operator\">:</span> <span class=\"token number\">404</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Response</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>After that, the result of my request yielded a different result:</p>\n<p><img src='/proxy/0519b74c-fc68-4b2a-bf28-145bc310b007' alt='' loading='lazy' /></p>\n<h3>Setting up Client Headers</h3>\n<p>After that, I just needed to adjust a couple headers on response sent to the browser. The first was “Content-Type,” which ensures that browsers can correctly serve images, and the second is “Cache-Control,” which tells clients they’re permitted to locally cache the image for up to a year.</p>\n<div class=\"remark-highlight\"><pre class=\"language-diff\"><code class=\"language-diff\">router.get(\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> \"/proxy/:imageId\",</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> async (request: IRequest, env: AppEnv, ctx: ExecutionContext) => {</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   // ...</span>\n<span class=\"token line\"></span></span>\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">   const response = new Response(obj.body);</span>\n<span class=\"token line\"></span></span>\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">   const headers = {</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">     \"Content-Type\": obj.httpMetadata!.contentType as string,</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">     \"Cache-Control\": \"public, max-age=31560000\",</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   };</span>\n<span class=\"token line\"></span></span>\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">   const response = new Response(obj?.body, { headers });</span>\n<span class=\"token line\"></span></span>\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   ctx.waitUntil(caches.default.put(cacheKey, response.clone()));</span>\n<span class=\"token line\"></span></span>\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   return response;</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> }</span>\n<span class=\"token line\"></span></span>);\n</code></pre></div>\n<p>This met minimal needs, but it could be improved with one more small caching optimization…</p>\n<h3>Setting up Object Caching</h3>\n<p>In addition to being able to tell the client how to cache an asset, workers can leverage a proprietary cache provided by Cloudflare. It provides a simple key/value interface, which uses a (cloned) request as the cache key. When a request comes in, if we already have a response matching that request, we can return that. And if not, the image is fetched from R2 and stuck into the same cache for later.</p>\n<div class=\"remark-highlight\"><pre class=\"language-typescript\"><code class=\"language-typescript\">router<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">\"/proxy/:imageId\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>request<span class=\"token operator\">:</span> IRequest<span class=\"token punctuation\">,</span> env<span class=\"token operator\">:</span> AppEnv<span class=\"token punctuation\">,</span> ctx<span class=\"token operator\">:</span> ExecutionContext<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> imageId <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span>params<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Create a cache key from existing request.</span>\n    <span class=\"token keyword\">const</span> cacheKey <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Request</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> cachedImage <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> caches<span class=\"token punctuation\">.</span>default<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span>cacheKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cachedImage<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Cache HIT for </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>imageId<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> cachedImage<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// ... other code for retrieving the image ...</span>\n\n    <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Response</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> headers <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Save the response to cache.</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">waitUntil</span><span class=\"token punctuation\">(</span>caches<span class=\"token punctuation\">.</span>default<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>cacheKey<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">clone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>It’s nothing world-changing, but should reduce the number of requests to my R2 bucket. And I’m all for some free micro-optimization.</p>\n<h2>Just the Beginning</h2>\n<p>This was my first experience dabbling with a Cloudflare Worker. Up until now, the use cases all felt pretty hypothetical. But now that I’ve personally found value in using one to solve a problem, I imagine it won’t be long before I reach for one again — especially with the <a href=\"https://developers.cloudflare.com/workers/examples/\" target=\"_blank\" rel=\"noopener\">wide range of capabilities</a> they empower.</p>\n<p>If you’d like to dig into what’s here a little more, check out these links:</p>\n<ul>\n<li><a href=\"https://github.com/alexmacarthur/macarthur-me-next\" target=\"_blank\" rel=\"noopener\">My Next Site</a></li>\n<li><a href=\"https://github.com/alexmacarthur/cloudflare-image-proxying\" target=\"_blank\" rel=\"noopener\">Image Proxying Worker</a></li>\n</ul>\n<p>Hoping this encourages you to try one out for yourself!</p>\n",
        "feature_image": "https://images.unsplash.com/photo-1534224039826-c7a0eda0e6b3?ixlib=rb-4.0.3&q=80&fm=jpg&crop=entropy&cs=tinysrgb",
        "status": "published",
        "created_at": 1670821200000,
        "published_at": 1670821200000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>I recently made a pretty big change on my website. For the first time ever, my posts don’t live in Markdown files. Instead, they’re all in Notion, the tool I’ve been using to draft posts for quite some time now. It’s nice being able to have a top-notch writing experience without the need to perform a clunky Markdown export when it’s finally time to publish.</p>\\n<p>Most of the migration was pretty boring &#x26; straightforward, but there was a particular piece of it that was interesting to navigate: <strong>serving images</strong>.</p>\\n<p>If you look at the underlying URL of any image in Notion, you’ll notice it’s <a href=\\\"https://docs.aws.amazon.com/AmazonS3/latest/userguide/using-presigned-url.html\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">presigned</a>, and after a fixed number of hours has passed, that URL will expire. This posed a challenge. My site is statically generated with Next.js, and if I directly embedded those raw Notion links, my images would all cease to work after a while.</p>\\n<p>I needed a cheap solution that wouldn’t require a painfully complicated process to set up. Thankfully, CloudFlare has some handy tools in its suite for pulling this off.</p>\\n<h2>The P<strong>anacea that is Cloudflare</strong></h2>\\n<p>There are two distinct problems to solve here, each of which paired nicely with one of Cloudflare’s offerings.</p>\\n<p>First, whenever one of my pages containing images is viewed, I needed to intercept each image request in order to serve it from a location that’s <em>not</em> Notion. A Cloudflare Worker is perfect for this job. Workers operate at the edge, so you can run server-side code with a similar level of performance as serving a static file from a CDN. Plus, the free tier is generous and the developer experience is buttery smooth.</p>\\n<p>Second, I needed a place to put those images before they’re served on my site. Not long ago, Cloudflare introduced a tempting alternative to Amazon’s S3 product — <a href=\\\"https://www.cloudflare.com/products/r2/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">R2 Object Storage</a>. It touts zero egress fees (meaning it’s dirt cheap if you’re largely just reading static assets), and an API that’s fully compatible with S3 (bonkers). I knew this would mesh nicely with what I was aiming to do.</p>\\n<h2>The Build</h2>\\n<p>With these tools at my disposal, here’s how I set it up:</p>\\n<h3>Step #1: Upload images on site build.</h3>\\n<p>It’s nice that R2 is compatible with AWS, because all this meant was installing the <code>aws-sdk</code>, configuring it with my Cloudflare access key, and setting up the code to upload images when my Next.js site is built. This process involved two main parts.</p>\\n<p><strong>Determining Image Keys</strong></p>\\n<p>First, I determined the key by which I’m save each image by hacking apart the URL embedded within my Notion posts. In raw form, they look something like this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-typescript\\\"><code class=\\\"language-typescript\\\">https<span class=\\\"token operator\\\">:</span><span class=\\\"token operator\\\">/</span><span class=\\\"token operator\\\">/</span>s3<span class=\\\"token punctuation\\\">.</span>us<span class=\\\"token operator\\\">-</span>west<span class=\\\"token operator\\\">-</span><span class=\\\"token number\\\">2</span><span class=\\\"token punctuation\\\">.</span>amazonaws<span class=\\\"token punctuation\\\">.</span>com<span class=\\\"token operator\\\">/</span>secure<span class=\\\"token punctuation\\\">.</span>notion<span class=\\\"token operator\\\">-</span><span class=\\\"token keyword\\\">static</span><span class=\\\"token punctuation\\\">.</span>com<span class=\\\"token operator\\\">/</span>d527ddf8<span class=\\\"token operator\\\">-</span>acdc<span class=\\\"token operator\\\">-</span><span class=\\\"token number\\\">4284</span><span class=\\\"token operator\\\">-</span>914d<span class=\\\"token operator\\\">-</span>8d4fefeda507<span class=\\\"token operator\\\">/</span>Untitled<span class=\\\"token punctuation\\\">.</span>png<span class=\\\"token operator\\\">?</span><span class=\\\"token constant\\\">X</span><span class=\\\"token operator\\\">-</span>Amz<span class=\\\"token operator\\\">-</span>Algorithm<span class=\\\"token operator\\\">=</span><span class=\\\"token constant\\\">AWS4</span><span class=\\\"token operator\\\">-</span><span class=\\\"token constant\\\">HMAC</span><span class=\\\"token operator\\\">-</span><span class=\\\"token constant\\\">SHA256</span><span class=\\\"token operator\\\">&#x26;</span><span class=\\\"token constant\\\">X</span><span class=\\\"token operator\\\">-</span>Amz<span class=\\\"token operator\\\">-</span>Content<span class=\\\"token operator\\\">-</span>Sha256<span class=\\\"token operator\\\">=</span><span class=\\\"token constant\\\">UNSIGNED</span><span class=\\\"token operator\\\">-</span><span class=\\\"token constant\\\">PAYLOAD</span><span class=\\\"token operator\\\">&#x26;</span><span class=\\\"token constant\\\">X</span><span class=\\\"token operator\\\">-</span>Amz<span class=\\\"token operator\\\">-</span>Credential<span class=\\\"token operator\\\">=</span><span class=\\\"token constant\\\">AKIAT73L2G45EIPT3X45</span><span class=\\\"token operator\\\">%</span>2F20221016<span class=\\\"token operator\\\">%</span>2Fus<span class=\\\"token operator\\\">-</span>west<span class=\\\"token operator\\\">-</span><span class=\\\"token number\\\">2</span><span class=\\\"token operator\\\">%</span>2Fs3<span class=\\\"token operator\\\">%</span>2Faws4_request<span class=\\\"token operator\\\">&#x26;</span><span class=\\\"token constant\\\">X</span><span class=\\\"token operator\\\">-</span>Amz<span class=\\\"token operator\\\">-</span>Date<span class=\\\"token operator\\\">=</span>20221016T223440Z<span class=\\\"token operator\\\">&#x26;</span><span class=\\\"token constant\\\">X</span><span class=\\\"token operator\\\">-</span>Amz<span class=\\\"token operator\\\">-</span>Expires<span class=\\\"token operator\\\">=</span><span class=\\\"token number\\\">86400</span><span class=\\\"token operator\\\">&#x26;</span><span class=\\\"token constant\\\">X</span><span class=\\\"token operator\\\">-</span>Amz<span class=\\\"token operator\\\">-</span>Signature<span class=\\\"token operator\\\">=</span>841d76d1a556204dc3d9c5a3d838913e3409224fe6d070a92fc9a9738918479e<span class=\\\"token operator\\\">&#x26;</span><span class=\\\"token constant\\\">X</span><span class=\\\"token operator\\\">-</span>Amz<span class=\\\"token operator\\\">-</span>SignedHeaders<span class=\\\"token operator\\\">=</span>host<span class=\\\"token operator\\\">&#x26;</span>response<span class=\\\"token operator\\\">-</span>content<span class=\\\"token operator\\\">-</span>disposition<span class=\\\"token operator\\\">=</span>filename<span class=\\\"token operator\\\">%</span><span class=\\\"token number\\\">20</span><span class=\\\"token operator\\\">%</span>3D<span class=\\\"token operator\\\">%</span>22Untitled<span class=\\\"token punctuation\\\">.</span>png<span class=\\\"token operator\\\">%</span><span class=\\\"token number\\\">22</span><span class=\\\"token operator\\\">&#x26;</span>x<span class=\\\"token operator\\\">-</span>id<span class=\\\"token operator\\\">=</span>GetObject\\n</code></pre></div>\\n<p>I chose to use the random-looking string of characters immediately following the hostname. This would be the unique identifier by which I upload each image to R2:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-typescript\\\"><code class=\\\"language-typescript\\\"><span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\">extractKey</span><span class=\\\"token punctuation\\\">(</span>imageUrl<span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">string</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">string</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">const</span> url <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\"><span class=\\\"token constant\\\">URL</span></span><span class=\\\"token punctuation\\\">(</span>imageUrl<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword\\\">const</span> parts <span class=\\\"token operator\\\">=</span> url<span class=\\\"token punctuation\\\">.</span>pathname<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">split</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"/\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword\\\">return</span> parts<span class=\\\"token punctuation\\\">[</span>parts<span class=\\\"token punctuation\\\">.</span>length <span class=\\\"token operator\\\">-</span> <span class=\\\"token number\\\">2</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token keyword\\\">const</span> key <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">extractKey</span><span class=\\\"token punctuation\\\">(</span>\\n\\t<span class=\\\"token string\\\">\\\"https://s3.us-west-2.amazonaws.com/secure.notion-static.com/d527ddf8-acdc-4284-914d-8d4fefeda507/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&#x26;X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&#x26;X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20221016%2Fus-west-2%2Fs3%2Faws4_request&#x26;X-Amz-Date=20221016T223440Z&#x26;X-Amz-Expires=86400&#x26;X-Amz-Signature=841d76d1a556204dc3d9c5a3d838913e3409224fe6d070a92fc9a9738918479e&#x26;X-Amz-SignedHeaders=host&#x26;response-content-disposition=filename%20%3D%22Untitled.png%22&#x26;x-id=GetObject\\\"</span>\\n<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// key: 802f4ae5-100d-4ce1-9912-82fe84b11733</span>\\n</code></pre></div>\\n<p><strong>Conditionally Upload Based on Key</strong></p>\\n<p>Once the key was determined, it was time for the upload itself, which I bypass if the upload has already occurred. I wrote a <code>StaticAssetService</code> class to perform this work, which uses R2 as a <code>provider</code> responsible for hosting those assets. The interesting part of that code looks like this. Feel free to <a href=\\\"https://github.com/alexmacarthur/macarthur-me-next/blob/main/lib/StaticAssetService.ts#L14\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">dive in more here</a>.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-typescript\\\"><code class=\\\"language-typescript\\\"><span class=\\\"token keyword\\\">async</span> <span class=\\\"token function\\\">put</span><span class=\\\"token punctuation\\\">(</span>imageUrl<span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">string</span><span class=\\\"token punctuation\\\">,</span> key<span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">string</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">Promise</span><span class=\\\"token operator\\\">&#x3C;</span><span class=\\\"token builtin\\\">any</span><span class=\\\"token operator\\\">></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">try</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token comment\\\">// I've already uploaded an image with this key! Don't do it again.</span>\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">await</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">get</span><span class=\\\"token punctuation\\\">(</span>key<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">return</span> <span class=\\\"token builtin\\\">Promise</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">resolve</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">catch</span> <span class=\\\"token punctuation\\\">(</span>e<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token builtin\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">error</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">Retrieval failed! Key: </span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>key<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">, url: </span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>imageUrl<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token keyword\\\">try</span> <span class=\\\"token punctuation\\\">{</span>\\n\\t\\t<span class=\\\"token comment\\\">// Upload the image!</span>\\n    <span class=\\\"token keyword\\\">return</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>provider<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">uploadImage</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n      imageUrl<span class=\\\"token punctuation\\\">,</span>\\n      key<span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">catch</span> <span class=\\\"token punctuation\\\">(</span>e<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token builtin\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">error</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">Upload failed! Key: </span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>key<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">, url: </span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>imageUrl<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword\\\">return</span> <span class=\\\"token builtin\\\">Promise</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">resolve</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p><strong>Important: Setting the Correct Content-Type</strong></p>\\n<p>There’s one gotcha worth calling out regarding this process. By default, <code>binary/octet-stream</code> is set as the content type upon upload (rather than something like <code>image/png</code>), which would prevent the image from rendering when it’s finally served. The solution is to set that type on each upload, based on file you’re attempting to process. Here’s a closer look at that <code>uploadImage</code> method:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-typescript\\\"><code class=\\\"language-typescript\\\"><span class=\\\"token keyword\\\">async</span> <span class=\\\"token function\\\">uploadImage</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span> imageUrl<span class=\\\"token punctuation\\\">,</span> key <span class=\\\"token punctuation\\\">}</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span> imageUrl<span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">string</span><span class=\\\"token punctuation\\\">;</span> key<span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">string</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">const</span> res <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">await</span> <span class=\\\"token function\\\">fetch</span><span class=\\\"token punctuation\\\">(</span>imageUrl<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword\\\">const</span> blob <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">await</span> res<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">arrayBuffer</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword\\\">return</span> s3\\n      <span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">upload</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n        Bucket<span class=\\\"token operator\\\">:</span> <span class=\\\"token constant\\\">BUCKET_NAME</span><span class=\\\"token punctuation\\\">,</span>\\n        Key<span class=\\\"token operator\\\">:</span> key<span class=\\\"token punctuation\\\">,</span>\\n        Body<span class=\\\"token operator\\\">:</span> Buffer<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">from</span><span class=\\\"token punctuation\\\">(</span>blob<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span>\\n\\n\\t\\t\\t\\t<span class=\\\"token comment\\\">// Set the correct `ContentType` here!</span>\\n        ContentType<span class=\\\"token operator\\\">:</span> res<span class=\\\"token punctuation\\\">.</span>headers<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">get</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"Content-Type\\\"</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token keyword\\\">as</span> <span class=\\\"token builtin\\\">string</span><span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">promise</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p>A special shout-out is due to the participants of <a href=\\\"https://github.com/SoftwareBrothers/adminjs-upload/issues/37\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">this GitHub issue</a> for helping resolve this. With that piece in place, I can see every new upload appear in Cloudflare after I build my site:</p>\\n<p><img src='/proxy/04f96ad6-2d26-4c7d-88de-91d78a7038e8' alt='' loading='lazy' /></p>\\n<p>The entire process can be represented like so:</p>\\n<p><img src='/proxy/510deb5d-e38c-4f46-9c82-bdfb2aa17dc0' alt='Uploading Images on Build' loading='lazy' /></p>\\n<h3>Step #2: Rewrite image URLs before generating HTML.</h3>\\n<p>You can only use a worker to intercept requests on <em>your own domain</em> set up with Cloudflare. So, if I wanted to handle my images in a certain way when they’re requested (like swap them out with an image from R2), I’d need to make it <em>look</em> like they belong to my domain before I build my HTML. I landed on transforming each presigned URL into a relative path with the following pattern: <code>/proxy/IMAGE_ID</code>. My worker would then be configured to listen for requests to this path and do as I see fit.</p>\\n<h3>Writing the Pattern</h3>\\n<p>In order to perform this URL transformation, I used a regular expression that would swap out the presigned URL with my <code>/proxy/IMAGE_KEY</code> path, using the image key I extracted earlier.</p>\\n<p>The image “block” I’d get from Notion each time is composed of normal Markdown, containing an optional “alt” description and the long, presigned URL.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-typescript\\\"><code class=\\\"language-typescript\\\"><span class=\\\"token operator\\\">!</span><span class=\\\"token punctuation\\\">[</span>alt description<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">(</span>https<span class=\\\"token operator\\\">:</span><span class=\\\"token operator\\\">/</span><span class=\\\"token operator\\\">/</span>very<span class=\\\"token operator\\\">-</span>very<span class=\\\"token operator\\\">-</span>long<span class=\\\"token operator\\\">-</span>presigned<span class=\\\"token operator\\\">-</span>image<span class=\\\"token operator\\\">/</span>url<span class=\\\"token punctuation\\\">.</span>jpg<span class=\\\"token punctuation\\\">)</span>\\n</code></pre></div>\\n<p>In order to preserve that description while I update the path, I used the following pattern:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-typescript\\\"><code class=\\\"language-typescript\\\"><span class=\\\"token operator\\\">!</span>\\\\<span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token operator\\\">*</span><span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">)</span>\\\\<span class=\\\"token punctuation\\\">]</span>\\\\<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token operator\\\">*</span><span class=\\\"token punctuation\\\">)</span>\\\\<span class=\\\"token punctuation\\\">)</span>\\n</code></pre></div>\\n<p>Here’s a brief breakdown of that pattern:</p>\\n<table>\\n<thead>\\n<tr>\\n<th><strong>Pattern Part</strong></th>\\n<th><strong>Description</strong></th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td><code>!\\\\[(.*?)\\\\]</code></td>\\n<td>Captures the “alt description” between square brackets, so I could preserve it in my updated markup.</td>\\n</tr>\\n<tr>\\n<td><code>\\\\(.*\\\\)</code></td>\\n<td>Matches against the remaining URL between parentheses, in order to replace it with an updated path.</td>\\n</tr>\\n</tbody>\\n</table>\\n<p>Finally, I used <code>.replace()</code> to perform the operation:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-typescript\\\"><code class=\\\"language-typescript\\\"><span class=\\\"token keyword\\\">let</span> key <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">keyExtractedEarlierInTheBuild</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">let</span> updatedMarkdownImage <span class=\\\"token operator\\\">=</span> originalMarkdownImage<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">replace</span><span class=\\\"token punctuation\\\">(</span>\\n\\t<span class=\\\"token regex\\\"><span class=\\\"token regex-delimiter\\\">/</span><span class=\\\"token regex-source language-regex\\\">!<span class=\\\"token special-escape escape\\\">\\\\[</span><span class=\\\"token group punctuation\\\">(</span><span class=\\\"token char-set class-name\\\">.</span><span class=\\\"token quantifier number\\\">*?</span><span class=\\\"token group punctuation\\\">)</span><span class=\\\"token special-escape escape\\\">\\\\]</span><span class=\\\"token special-escape escape\\\">\\\\(</span><span class=\\\"token char-set class-name\\\">.</span><span class=\\\"token quantifier number\\\">*</span><span class=\\\"token special-escape escape\\\">\\\\)</span></span><span class=\\\"token regex-delimiter\\\">/</span></span><span class=\\\"token punctuation\\\">,</span>\\n\\t<span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">![$1](/proxy/</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>key<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">)</span><span class=\\\"token template-punctuation string\\\">`</span></span>\\n<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>Now that my images would all attempt to be requested from my own domain, I could finally set up a worker to intercept and pull them from R2.</p>\\n<h3>#3. Intercept Image Requests with a Worker</h3>\\n<p>One of the reasons this solution works so well is due to Cloudflare Workers’ first-class integration with R2. As such, the flow for my worker isn’t complex and can be visualized by the following sequence diagram:</p>\\n<p><img src='/proxy/df80e01f-13f0-4c2d-9b5a-fd77b5a82ed8' alt='Sequence Diagram for Image Requests' loading='lazy' /></p>\\n<p>In words, any given request is handled like so:</p>\\n<ul>\\n<li>For <strong>image requests</strong> (those made to <code>/proxy/IMAGE_ID</code>), intercept and return the the image by the embedded path ID from R2.</li>\\n<li>For <strong>all other requests,</strong> allow the request to pass through to my site on Vercel.</li>\\n</ul>\\n<h3>Setting Up My Worker</h3>\\n<p>While you can write it directly in the browser, I chose to <a href=\\\"https://developers.cloudflare.com/workers/get-started/quickstarts/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">use Wangler</a> to build &#x26; experiment with my worker locally. There’s a learning curve, but it’s minimal, and eased by the fact that Cloudflare Workers are built on the <a href=\\\"https://developers.cloudflare.com/workers/runtime-apis/fetch/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">fetch API</a>. If you’ve spent a decent amount of time with it in the browser, it won’t take long to feel at home with it here too.</p>\\n<p>My worker is simple — consisting of only one “route,” set up with <a href=\\\"https://github.com/kwhitley/itty-router\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">itty-router</a>. Starting from scratch, it first looked something like this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-typescript\\\"><code class=\\\"language-typescript\\\"><span class=\\\"token keyword\\\">import</span> <span class=\\\"token punctuation\\\">{</span> Router <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">\\\"itty-router\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> router <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">Router</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\nrouter<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">get</span><span class=\\\"token punctuation\\\">(</span>\\n  <span class=\\\"token string\\\">\\\"/proxy/:imageId\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token keyword\\\">async</span> <span class=\\\"token punctuation\\\">(</span>request<span class=\\\"token operator\\\">:</span> Request<span class=\\\"token punctuation\\\">,</span> env<span class=\\\"token operator\\\">:</span> AppEnv<span class=\\\"token punctuation\\\">,</span> ctx<span class=\\\"token operator\\\">:</span> ExecutionContext<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n\\t\\t<span class=\\\"token keyword\\\">return</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Response</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"hello\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">default</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">async</span> <span class=\\\"token function\\\">fetch</span><span class=\\\"token punctuation\\\">(</span>\\n    request<span class=\\\"token operator\\\">:</span> Request<span class=\\\"token punctuation\\\">,</span>\\n    env<span class=\\\"token operator\\\">:</span> AppEnv<span class=\\\"token punctuation\\\">,</span>\\n    context<span class=\\\"token operator\\\">:</span> ExecutionContext\\n  <span class=\\\"token punctuation\\\">)</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">Promise</span><span class=\\\"token operator\\\">&#x3C;</span>Response<span class=\\\"token operator\\\">></span> <span class=\\\"token punctuation\\\">{</span>\\n\\t\\t<span class=\\\"token comment\\\">// If an exception is thrown, hit the origin server.</span>\\n    context<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">passThroughOnException</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword\\\">return</span> router<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">handle</span><span class=\\\"token punctuation\\\">(</span>request<span class=\\\"token punctuation\\\">,</span> env<span class=\\\"token punctuation\\\">,</span> context<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">then</span><span class=\\\"token punctuation\\\">(</span>response <span class=\\\"token operator\\\">=></span> response<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>When any request hits my worker, it’ll try to match against that <code>/proxy/:imageId</code> endpoint. If it doesn’t, the request will be forwarded to the origin server like normal (in this case, Vercel, where my site is hosted). But if it does match, the request will be intercepted and returned with a <code>new Response()</code>:</p>\\n<p><img src='/proxy/c74c4615-26ca-4edc-a6b2-93b4201a652f' alt='' loading='lazy' /></p>\\n<h3>Retrieving an Image from R2</h3>\\n<p>After that, I took it to the next level by integrating with R2. Each request comes in with an <code>imageId</code> that corresponds to an image that was previous uploaded to R2. Cloudflare makes it easy to connect a bucket of your choosing to your worker. That meant creating a binding in my <code>wrangler.toml</code> file, which specifies the buckets I use in production &#x26; development:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-toml\\\"><code class=\\\"language-toml\\\"><span class=\\\"token comment\\\"># ... the rest of my wrangler.toml</span>\\n\\n<span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">[</span> <span class=\\\"token table class-name\\\">r2_buckets</span> <span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">]</span>\\n<span class=\\\"token key property\\\">binding</span> <span class=\\\"token punctuation\\\">=</span> <span class=\\\"token string\\\">'MACARTHUR_ME'</span>\\n<span class=\\\"token key property\\\">bucket_name</span> <span class=\\\"token punctuation\\\">=</span> <span class=\\\"token string\\\">'macarthur-me'</span>\\n<span class=\\\"token key property\\\">preview_bucket_name</span> <span class=\\\"token punctuation\\\">=</span> <span class=\\\"token string\\\">'macarthur-me-dev'</span>\\n</code></pre></div>\\n<p>Then I could use that binding to fetch objects in my worker:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-typescript\\\"><code class=\\\"language-typescript\\\"><span class=\\\"token keyword\\\">import</span> <span class=\\\"token punctuation\\\">{</span> Router <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">\\\"itty-router\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">interface</span> <span class=\\\"token class-name\\\">AppEnv</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token constant\\\">MACARTHUR_ME</span><span class=\\\"token operator\\\">:</span> R2Bucket<span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token keyword\\\">interface</span> <span class=\\\"token class-name\\\">IRequest</span> <span class=\\\"token keyword\\\">extends</span> <span class=\\\"token class-name\\\">Request</span> <span class=\\\"token punctuation\\\">{</span>\\n  method<span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"GET\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n  url<span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">string</span><span class=\\\"token punctuation\\\">;</span>\\n  params<span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span> imageId<span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">string</span> <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token keyword\\\">const</span> router <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">Router</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\nrouter<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">get</span><span class=\\\"token punctuation\\\">(</span>\\n  <span class=\\\"token string\\\">\\\"/proxy/:imageId\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token keyword\\\">async</span> <span class=\\\"token punctuation\\\">(</span>request<span class=\\\"token operator\\\">:</span> IRequest<span class=\\\"token punctuation\\\">,</span> env<span class=\\\"token operator\\\">:</span> AppEnv<span class=\\\"token punctuation\\\">,</span> ctx<span class=\\\"token operator\\\">:</span> ExecutionContext<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n\\t\\t<span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">{</span> imageId <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token operator\\\">=</span> request<span class=\\\"token punctuation\\\">.</span>params<span class=\\\"token punctuation\\\">;</span>\\n\\n\\t\\t<span class=\\\"token comment\\\">// Fetch the image by ID:</span>\\n    <span class=\\\"token keyword\\\">const</span> obj <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">await</span> env<span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">MACARTHUR_ME</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">get</span><span class=\\\"token punctuation\\\">(</span>imageId<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>obj<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">return</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Response</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">Image not found: </span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>imageId<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span> status<span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">404</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n\\n    <span class=\\\"token keyword\\\">return</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Response</span><span class=\\\"token punctuation\\\">(</span>obj<span class=\\\"token punctuation\\\">.</span>body<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>After that, the result of my request yielded a different result:</p>\\n<p><img src='/proxy/0519b74c-fc68-4b2a-bf28-145bc310b007' alt='' loading='lazy' /></p>\\n<h3>Setting up Client Headers</h3>\\n<p>After that, I just needed to adjust a couple headers on response sent to the browser. The first was “Content-Type,” which ensures that browsers can correctly serve images, and the second is “Cache-Control,” which tells clients they’re permitted to locally cache the image for up to a year.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-diff\\\"><code class=\\\"language-diff\\\">router.get(\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> \\\"/proxy/:imageId\\\",</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> async (request: IRequest, env: AppEnv, ctx: ExecutionContext) => {</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   // ...</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   const response = new Response(obj.body);</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   const headers = {</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">     \\\"Content-Type\\\": obj.httpMetadata!.contentType as string,</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">     \\\"Cache-Control\\\": \\\"public, max-age=31560000\\\",</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   };</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   const response = new Response(obj?.body, { headers });</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   ctx.waitUntil(caches.default.put(cacheKey, response.clone()));</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   return response;</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> }</span>\\n<span class=\\\"token line\\\"></span></span>);\\n</code></pre></div>\\n<p>This met minimal needs, but it could be improved with one more small caching optimization…</p>\\n<h3>Setting up Object Caching</h3>\\n<p>In addition to being able to tell the client how to cache an asset, workers can leverage a proprietary cache provided by Cloudflare. It provides a simple key/value interface, which uses a (cloned) request as the cache key. When a request comes in, if we already have a response matching that request, we can return that. And if not, the image is fetched from R2 and stuck into the same cache for later.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-typescript\\\"><code class=\\\"language-typescript\\\">router<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">get</span><span class=\\\"token punctuation\\\">(</span>\\n  <span class=\\\"token string\\\">\\\"/proxy/:imageId\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token keyword\\\">async</span> <span class=\\\"token punctuation\\\">(</span>request<span class=\\\"token operator\\\">:</span> IRequest<span class=\\\"token punctuation\\\">,</span> env<span class=\\\"token operator\\\">:</span> AppEnv<span class=\\\"token punctuation\\\">,</span> ctx<span class=\\\"token operator\\\">:</span> ExecutionContext<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">{</span> imageId <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token operator\\\">=</span> request<span class=\\\"token punctuation\\\">.</span>params<span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token comment\\\">// Create a cache key from existing request.</span>\\n    <span class=\\\"token keyword\\\">const</span> cacheKey <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Request</span><span class=\\\"token punctuation\\\">(</span>request<span class=\\\"token punctuation\\\">.</span>url<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">toString</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> request<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword\\\">const</span> cachedImage <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">await</span> caches<span class=\\\"token punctuation\\\">.</span>default<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">match</span><span class=\\\"token punctuation\\\">(</span>cacheKey<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>cachedImage<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token builtin\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">Cache HIT for </span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>imageId<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token keyword\\\">return</span> cachedImage<span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n\\n    <span class=\\\"token comment\\\">// ... other code for retrieving the image ...</span>\\n\\n    <span class=\\\"token keyword\\\">const</span> response <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Response</span><span class=\\\"token punctuation\\\">(</span>obj<span class=\\\"token punctuation\\\">.</span>body<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span> headers <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token comment\\\">// Save the response to cache.</span>\\n    ctx<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">waitUntil</span><span class=\\\"token punctuation\\\">(</span>caches<span class=\\\"token punctuation\\\">.</span>default<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">put</span><span class=\\\"token punctuation\\\">(</span>cacheKey<span class=\\\"token punctuation\\\">,</span> response<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">clone</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword\\\">return</span> response<span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>It’s nothing world-changing, but should reduce the number of requests to my R2 bucket. And I’m all for some free micro-optimization.</p>\\n<h2>Just the Beginning</h2>\\n<p>This was my first experience dabbling with a Cloudflare Worker. Up until now, the use cases all felt pretty hypothetical. But now that I’ve personally found value in using one to solve a problem, I imagine it won’t be long before I reach for one again — especially with the <a href=\\\"https://developers.cloudflare.com/workers/examples/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">wide range of capabilities</a> they empower.</p>\\n<p>If you’d like to dig into what’s here a little more, check out these links:</p>\\n<ul>\\n<li><a href=\\\"https://github.com/alexmacarthur/macarthur-me-next\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">My Next Site</a></li>\\n<li><a href=\\\"https://github.com/alexmacarthur/cloudflare-image-proxying\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Image Proxying Worker</a></li>\\n</ul>\\n<p>Hoping this encourages you to try one out for yourself!</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 10,
        "title": "I’ve Boarded the SSG Train Again",
        "slug": "boarded-the-ssg-train-again",
        "html": "<p>If you haven’t noticed, we’re in a bit of a server-rendered resurgence right now. It seems like the heyday of the Jamstack, and more specifically, static site generation (SSG) is behind us, and the pendulum is once again swinging toward more traditional paradigms. Namely: HTML that’s generated on demand/request rather than in advance.</p>\n<p>Despite being somewhat of a Jamstack fanatic the past few years, I’m not mad about the shift. When it began picking up steam, SSG was pitched as a panacea for our biggest web development problems. It claimed to be superior in terms of performance, cost, and complexity, when it was really just a different tactic to meet these challenges.</p>\n<h2><strong>Different, Not Superior</strong></h2>\n<p>Consider performance. With a good CDN &#x26; caching strategy, there’s nothing technical preventing a server-rendered site from being just as performant as a statically generated one. Modern caching policies like “<a href=\"https://web.dev/stale-while-revalidate/\" target=\"_blank\" rel=\"noopener\">stale-while-revalidate</a>” can even prevent a user from <em>ever</em> hitting an uncached response, and are being supported by an increasing number of CDN providers. Sure, SSG has the advantage of being statically served <em>by default</em>, but at the end of the day, the <code>&#x3C;div></code>s are still shipped quickly &#x26; close to the user, regardless of when they’re generated.</p>\n<p>Or, take complexity. SSG hype insisted its architecture inherently makes for simpler sites, since there’s no need to maintain a running server, database, and all the other infrastructure required to keep a site from folding under large amounts of traffic. In fact, Gatsby’s documentation <a href=\"https://www.gatsbyjs.com/docs/glossary/static-site-generator/#advantages-of-static-site-generators\" target=\"_blank\" rel=\"noopener\">still makes that claim today.</a> But that complexity hasn’t really gone anywhere — it’s just shifted. None of these components are whisked away when you move to an SSG. You’ll still need a database (or some other data source), infrastructure to build your code, and a web server to deliver it. The only difference is when most of it is used: on build or on request.</p>\n<h2>The Understated Trade-Offs</h2>\n<p>On top of that, this hype has often downplayed the inherent challenges of an SSG approach, with the most obvious one being the inability to serve dynamic content. There are, of course, ways to tackle this too, but they just lead to another layer of trade-offs.</p>\n<p>For example, we could serve a static site and then fetch &#x26; render dynamic content on the client. But that means shipping more JavaScript, impacting metrics like <a href=\"https://web.dev/fid/\" target=\"_blank\" rel=\"noopener\">first input delay</a> and increasing the number of bytes users needs to download, parse, &#x26; execute before they can even access any of your content. At best, the shell of your site will load quickly, but seeing any meaningful content may still be a long way off. Plus, a site depending on JavaScript to render will inevitably run into SEO difficulties.</p>\n<p>Build time is another big one. Depending on the generator, the amount of content on your site, and several other factors, committing to an SSG means being ready to wait for <em>the entire site</em> to build in order to update or publish anything. Platforms like Vercel and Gatsby (probably others now too) have skirted this by introducing incremental generation features, but it isn’t the norm across all platforms, and certainly not a table stakes feature for any given SSG (yet). And for that reason, making such a move requires you to ask, at minimum: “Do I have the sort of site that can afford to wait for a build to complete before my content will be available?”</p>\n<p>There’s much more I could belabor here. The point is that SSGs haven’t become the WD-40 of our problems, and I think most people are starting to more clearly see that (including myself).</p>\n<h2>An Itch to Try Something New</h2>\n<p>My own site’s been built with a few different SSGs over time, including Jekyll, Gatsby, and Next.js. I’ve had neither complex needs nor a ton of content, and so the paradigm’s been a great fit. But a few months ago, when that vibe started to shift and I was more commonly pondering all of the aforementioned thoughts, I began to wonder if I should take a stab at building the next iteration with a server-rendered framework. At the time, Remix was relatively new, open-sourced, and had a ton of Twitter energy around it. I bit and <a href=\"https://twitter.com/amacarthur/status/1519089857829736448\" target=\"_blank\" rel=\"noopener\">committed to using it for my site</a>.</p>\n<h3>My Priorities</h3>\n<p>I went into the rebuild with a few priorities in mind:</p>\n<p><strong>Performance/Caching</strong></p>\n<p>I take pride in how fast a site I’ve built loads when it’s hosted on SSG-friendly platforms like Vercel and Netlify, and so this was a cold, hard requirement for me. If I was gonna switch, I’d <em>need</em> to have SSG-like performance, preferably using <code>stale-while-revalidate</code> on Cloudflare (the number of CDNs that support this policy is still depressingly low, but thankfully, Cloudflare’s incredible and I had already been using them for other things). And this caching couldn’t be flaky. I wanted almost <em>no cache misses</em> after first request, as well as the confidence it was <em>actually</em> happening.</p>\n<p><strong>Content Management</strong></p>\n<p>Ever since I’ve been blogging, I’ve used Markdown files to store my content, all stuck directly in my repository. I’ve appreciated how simple it is, as well as the fact that I don’t need to worry about a dedicated CMS as a dependency. I also really like writing in Markdown.</p>\n<p>But over time, the clunkiness of publishing a new post became a little too annoying. I’d draft my posts in Notion (a really nice writing experience), and when I was ready, I’d perform a full export into a Markdown file. Finally, I’d stick it and any images into my repository. The number of steps it took to launch a new post became a hindrance to me publishing anything at all. If I were to rebuild, I wanted to give a big upgrade to my writing experience along the way.</p>\n<p><strong>Cost</strong></p>\n<p>Platforms like Vercel and Netlify are too good to us. They make it disgustingly easy to stand up a high-performance site with a ton of serverless bells &#x26; whistles <em>for free</em> (they both have very generous free tiers). I didn’t want to introduce another bill into my technological ecosystem if I didn’t have to (subscription fatigue is real), so if I were to move to something else, I wanted to find some reputable platform with a similar model. Cheap, but good.</p>\n<h2>The Rebuild Experience</h2>\n<p>With these priorities in mind, it wasn’t hard to nail down the rest of the stack I’d use for my new Remix site:</p>\n<h3>Hosting: Fly.io</h3>\n<p>I’d been hearing really good things about <a href=\"https://fly.io/\" target=\"_blank\" rel=\"noopener\">Fly</a> from the likes of <a href=\"https://kentcdodds.com/\" target=\"_blank\" rel=\"noopener\">Kent C. Dodds</a> and other big names in the space for quite a while, and so I had a pretty decent bank of trust built up with them, even though I had never used them. Plus, they let you deploy two apps for free, satisfying that “cost” priority.</p>\n<h3>Caching: Cloudflare</h3>\n<p>As mentioned, I had been happily using Cloudflare for quite some time, and it’s one of the few CDN providers I’ve come across that supports <code>staile-while-revalidate</code>. I also wanted to reserve the ability to use their <a href=\"https://workers.cloudflare.com/\" target=\"_blank\" rel=\"noopener\">Workers</a> product if it became helpful for whatever reason (and it did, but that’s a post for another time).</p>\n<h3>CMS: Notion</h3>\n<p>As mentioned, I’d been using Notion to draft my posts for a while. Aside from the nice writing experience, it supports Markdown, including code blocks for several different languages. The timing also felt right being that their official API had recently been opened up, and supported by official SDKs. I didn’t know what to expect from a performance standpoint, but I was hoping my caching strategy would prevent any issues from being experienced by my visitors.</p>\n<h2>Where Things Got Hard</h2>\n<p>Overall, I really enjoyed building out the site. Remix offers a pretty good developer experience, is well-documented, and I enjoyed how it leans into web standards. There were, however, a couple of things that started to make me wonder if it was worth finishing the effort.</p>\n<h3>Deployment</h3>\n<p>Getting my site stood up on <a href=\"http://Fly.io\" target=\"_blank\" rel=\"noopener\">Fly.io</a> wasn’t monumentally difficult, but there was some notable friction. Most of my issues on that front involved tweaking my Docker image after ripping out a ton of stuff provided to me by the <a href=\"https://github.com/remix-run/indie-stack\" target=\"_blank\" rel=\"noopener\">Indie Stack</a> I chose. It’s very possible I could’ve gone another route (maybe no stack at all) and had a smoother experience.</p>\n<p>But the other pain point here was getting it wired up to automatically deploy when I pushed a change to GitHub. The <a href=\"https://github.com/alexmacarthur/macarthur-me-remix/blob/master/.github/workflows/deploy.yml\" target=\"_blank\" rel=\"noopener\">stack I chose</a> came with a workflow, but it didn’t “just work,” which is something I got quite accustomed to when working with Vercel and Netlify. I realize these aren’t apples-to-apples comparisons here. Remix is a very different type of application compared to what I had been using. But still, being spoiled for so long with my SSG sites made it less than fun to wade into something else.</p>\n<h3>Caching</h3>\n<p>I mentioned that caching was my top priority in rebuilding my site. I went into the migration pretty optimistic about meeting that priority. Setting up Cloudflare was easy, as expected, as was configuring the headers on my site, which looked like this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Consider stale after 1 hour, but serve stale &#x26; refresh cache for 6 months.</span>\nresponseHeaders<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">set</span><span class=\"token punctuation\">(</span>\n   <span class=\"token string\">\"Cache-Control\"</span><span class=\"token punctuation\">,</span>\n   <span class=\"token string\">\"public, max-age=3600, s-maxage=3600, stale-while-revalidate=15780000\"</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Based on that header, I expected my content be served straight from the CDN for up to one hour. After that, it would go “stale,” but Cloudflare would still serve that stale cache for up to six months later. And whenever it did serve that stale content, it would refresh the cache behind the scenes. So, as long as people keep visiting a page at least once every six months, <em>no one</em> would ever experience a slow, uncached response.</p>\n<p>But that’s not what happened. I started inspecting the response headers shortly after I deployed these changes. It would return a “HIT,” meaning the page was successfully served from Cloudflare’s cache:</p>\n<p><img src='/proxy/4d59f486-119b-4885-9961-b392a15e9fb7' alt='' loading='lazy' /></p>\n<p>But then, shortly later (if I remember correctly, it was maybe just an hour or so), refreshing that page would result in a “MISS”:</p>\n<p><img src='/proxy/f433efe1-9002-4cac-92fb-2217b507a22c' alt='' loading='lazy' /></p>\n<p>It got pretty frustrating as it continued to occur, but things became a little clearer after Googling around. As it turns out, Cloudflare and other CDNs make no guarantee as to how long they will actually cache a resource. Those time values I used in my headers were really just the maximum amount of time Cloudflare <em>is permitted</em> do it. No promises are made beyond that.</p>\n<p>It’s hard to find any official documentation on all of this, but it appears that Cloudflare will commonly use this distinction to <a href=\"https://community.cloudflare.com/t/getting-cache-miss-after-24-hours-even-though-headers-are-set-to-cache-longer/260526\" target=\"_blank\" rel=\"noopener\">purge infrequently accessed resources</a>, making it a bigger concern for smaller, personal sites like my own.</p>\n<p>Sifting more, it apparently<a href=\"https://community.cloudflare.com/t/cache-everything-is-not-guaranteed/180269/5\" target=\"_blank\" rel=\"noopener\"> isn’t a new thing for Cloudflare</a>, and may very well be tied to how differs itself as a full-on reverse proxy, rather than strictly a static file host. It did cross my mind that it might behave differently for paid plans, but I didn’t do enough digging to figure out if it does.</p>\n<p>As I was piecing this together from various personal experiences and forums on the internet, it slowly became clear I wouldn’t have the level of confidence in caching I wanted. Instead, I’d need to explore other CDN offerings that explicitly support more permanent, longer-term caching, or else risk several requests needing to wait for a full response from Notion before showing any content.</p>\n<p>Of the alternatives I came across, <a href=\"https://bunny.net/cdn/\" target=\"_blank\" rel=\"noopener\">Bunny</a> seemed the most interesting. Not only do they clearly tout permanent caching (“Perma-Cache,” as they call it), they also appear to support an off-brand version of <code>stale-while-revalidate</code> called “<a href=\"https://bunny.net/blog/introducing-stale-cache-more-efficient-cache-handling/\" target=\"_blank\" rel=\"noopener\">Stale Cache Delivery</a>.” The main “downside” here is that there isn’t a free tier, and I’m also not that interested in diving into a totally new CDN right now. Not to mention, I’m sure there are other trade-offs I’d need to spend time considering as well (ex: Cloudflare has over double the number of POPs that Bunny does).</p>\n<h3>In Fairness, SSG Caching Ain’t Perfect</h3>\n<p>It’s really important to note that these caching issues don’t just go away by using Vercel or Netlify. Even for them, cache times are never guaranteed to reach the maximum <code>max-age</code> header you set. For example, Vercel claims assets are cached for <a href=\"https://vercel.com/docs/concepts/edge-network/caching#x-vercel-cache\" target=\"_blank\" rel=\"noopener\">up to 31 days</a>, by default. But also includes this disclaimer:</p>\n<p><img src='/proxy/802f4ae5-100d-4ce1-9912-82fe84b11733' alt='' loading='lazy' /></p>\n<p>The nice thing, though, is that because the site is statically generated, a fresh request doesn’t need to wait for data to be fetched before the HTML can even be built. Instead, the server just goes back to origin to pick up ready-made HTML files, making those “cold” requests pretty lukewarm.</p>\n<h2>Platform FOMO</h2>\n<p>Embarking on this journey really made me appreciate some of the things Jamstack-friendly platforms have turned into features we might take for granted. CI/CD is a breeze, leaving very little friction between getting something off your machine and deployed. CDN caching and SSL certificates <em>just work</em> without you thinking about it. It’s very easy to spin up a branch of your site to a unique, shareable URL. Minimal-config serverless functions provide a means of performing tasks requiring a server (I’ve processed <a href=\"https://typeitjs.com/\" target=\"_blank\" rel=\"noopener\">TypeIt</a> license purchases on a Netlify function for years).</p>\n<p>And then there are newer features that begin to blur the traditional line between static and server-rendered sites. A while back, Vercel rolled out <a href=\"https://vercel.com/docs/concepts/incremental-static-regeneration/overview\" target=\"_blank\" rel=\"noopener\">incremental static regeneration</a>, giving your site a proprietary <code>stale-while-revalidate</code> experience without dealing with a CDN (I’m using this on <a href=\"https://macarthur.me/dashboard\">my personal dashboard</a> and it works great). Another example is edge functions offered by both <a href=\"/bda83e1ecfcd46cebf378579633cc85e\" target=\"_blank\" rel=\"noopener\">Netlify</a> and <a href=\"https://vercel.com/docs/concepts/functions/edge-functions\" target=\"_blank\" rel=\"noopener\">Vercel</a>, making it possible to run dynamic, server-side logic real close to your users, rather than only at your origin.</p>\n<p>These and other players are pushing the limit hard and fast, and it makes me not want to miss out on the next interesting thing they’ll roll out.</p>\n<h2>We’ll See Where this Goes</h2>\n<p>I was a little bummed about the time I invested in that Remix rebuild that will probably never see the light of day, but in hindsight, I’m grateful to have learned a <em>ton</em> in the process, especially with regard to caching and CDNs. I’m also left with a fresh sense of excitement for the Jamstack and some of the innovations its helped shepherd in.</p>\n<p>Even so, it’s only a matter of time before I feel the itch to tear all of this down and rebuild it with the next big thing. I’m giving myself six months.</p>\n",
        "feature_image": "https://images.unsplash.com/photo-1527295110-5145f6b148d0?ixlib=rb-1.2.1&q=80&cs=tinysrgb&fm=jpg&crop=entropy",
        "status": "published",
        "created_at": 1665118800000,
        "published_at": 1665118800000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>If you haven’t noticed, we’re in a bit of a server-rendered resurgence right now. It seems like the heyday of the Jamstack, and more specifically, static site generation (SSG) is behind us, and the pendulum is once again swinging toward more traditional paradigms. Namely: HTML that’s generated on demand/request rather than in advance.</p>\\n<p>Despite being somewhat of a Jamstack fanatic the past few years, I’m not mad about the shift. When it began picking up steam, SSG was pitched as a panacea for our biggest web development problems. It claimed to be superior in terms of performance, cost, and complexity, when it was really just a different tactic to meet these challenges.</p>\\n<h2><strong>Different, Not Superior</strong></h2>\\n<p>Consider performance. With a good CDN &#x26; caching strategy, there’s nothing technical preventing a server-rendered site from being just as performant as a statically generated one. Modern caching policies like “<a href=\\\"https://web.dev/stale-while-revalidate/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">stale-while-revalidate</a>” can even prevent a user from <em>ever</em> hitting an uncached response, and are being supported by an increasing number of CDN providers. Sure, SSG has the advantage of being statically served <em>by default</em>, but at the end of the day, the <code>&#x3C;div></code>s are still shipped quickly &#x26; close to the user, regardless of when they’re generated.</p>\\n<p>Or, take complexity. SSG hype insisted its architecture inherently makes for simpler sites, since there’s no need to maintain a running server, database, and all the other infrastructure required to keep a site from folding under large amounts of traffic. In fact, Gatsby’s documentation <a href=\\\"https://www.gatsbyjs.com/docs/glossary/static-site-generator/#advantages-of-static-site-generators\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">still makes that claim today.</a> But that complexity hasn’t really gone anywhere — it’s just shifted. None of these components are whisked away when you move to an SSG. You’ll still need a database (or some other data source), infrastructure to build your code, and a web server to deliver it. The only difference is when most of it is used: on build or on request.</p>\\n<h2>The Understated Trade-Offs</h2>\\n<p>On top of that, this hype has often downplayed the inherent challenges of an SSG approach, with the most obvious one being the inability to serve dynamic content. There are, of course, ways to tackle this too, but they just lead to another layer of trade-offs.</p>\\n<p>For example, we could serve a static site and then fetch &#x26; render dynamic content on the client. But that means shipping more JavaScript, impacting metrics like <a href=\\\"https://web.dev/fid/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">first input delay</a> and increasing the number of bytes users needs to download, parse, &#x26; execute before they can even access any of your content. At best, the shell of your site will load quickly, but seeing any meaningful content may still be a long way off. Plus, a site depending on JavaScript to render will inevitably run into SEO difficulties.</p>\\n<p>Build time is another big one. Depending on the generator, the amount of content on your site, and several other factors, committing to an SSG means being ready to wait for <em>the entire site</em> to build in order to update or publish anything. Platforms like Vercel and Gatsby (probably others now too) have skirted this by introducing incremental generation features, but it isn’t the norm across all platforms, and certainly not a table stakes feature for any given SSG (yet). And for that reason, making such a move requires you to ask, at minimum: “Do I have the sort of site that can afford to wait for a build to complete before my content will be available?”</p>\\n<p>There’s much more I could belabor here. The point is that SSGs haven’t become the WD-40 of our problems, and I think most people are starting to more clearly see that (including myself).</p>\\n<h2>An Itch to Try Something New</h2>\\n<p>My own site’s been built with a few different SSGs over time, including Jekyll, Gatsby, and Next.js. I’ve had neither complex needs nor a ton of content, and so the paradigm’s been a great fit. But a few months ago, when that vibe started to shift and I was more commonly pondering all of the aforementioned thoughts, I began to wonder if I should take a stab at building the next iteration with a server-rendered framework. At the time, Remix was relatively new, open-sourced, and had a ton of Twitter energy around it. I bit and <a href=\\\"https://twitter.com/amacarthur/status/1519089857829736448\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">committed to using it for my site</a>.</p>\\n<h3>My Priorities</h3>\\n<p>I went into the rebuild with a few priorities in mind:</p>\\n<p><strong>Performance/Caching</strong></p>\\n<p>I take pride in how fast a site I’ve built loads when it’s hosted on SSG-friendly platforms like Vercel and Netlify, and so this was a cold, hard requirement for me. If I was gonna switch, I’d <em>need</em> to have SSG-like performance, preferably using <code>stale-while-revalidate</code> on Cloudflare (the number of CDNs that support this policy is still depressingly low, but thankfully, Cloudflare’s incredible and I had already been using them for other things). And this caching couldn’t be flaky. I wanted almost <em>no cache misses</em> after first request, as well as the confidence it was <em>actually</em> happening.</p>\\n<p><strong>Content Management</strong></p>\\n<p>Ever since I’ve been blogging, I’ve used Markdown files to store my content, all stuck directly in my repository. I’ve appreciated how simple it is, as well as the fact that I don’t need to worry about a dedicated CMS as a dependency. I also really like writing in Markdown.</p>\\n<p>But over time, the clunkiness of publishing a new post became a little too annoying. I’d draft my posts in Notion (a really nice writing experience), and when I was ready, I’d perform a full export into a Markdown file. Finally, I’d stick it and any images into my repository. The number of steps it took to launch a new post became a hindrance to me publishing anything at all. If I were to rebuild, I wanted to give a big upgrade to my writing experience along the way.</p>\\n<p><strong>Cost</strong></p>\\n<p>Platforms like Vercel and Netlify are too good to us. They make it disgustingly easy to stand up a high-performance site with a ton of serverless bells &#x26; whistles <em>for free</em> (they both have very generous free tiers). I didn’t want to introduce another bill into my technological ecosystem if I didn’t have to (subscription fatigue is real), so if I were to move to something else, I wanted to find some reputable platform with a similar model. Cheap, but good.</p>\\n<h2>The Rebuild Experience</h2>\\n<p>With these priorities in mind, it wasn’t hard to nail down the rest of the stack I’d use for my new Remix site:</p>\\n<h3>Hosting: Fly.io</h3>\\n<p>I’d been hearing really good things about <a href=\\\"https://fly.io/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Fly</a> from the likes of <a href=\\\"https://kentcdodds.com/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Kent C. Dodds</a> and other big names in the space for quite a while, and so I had a pretty decent bank of trust built up with them, even though I had never used them. Plus, they let you deploy two apps for free, satisfying that “cost” priority.</p>\\n<h3>Caching: Cloudflare</h3>\\n<p>As mentioned, I had been happily using Cloudflare for quite some time, and it’s one of the few CDN providers I’ve come across that supports <code>staile-while-revalidate</code>. I also wanted to reserve the ability to use their <a href=\\\"https://workers.cloudflare.com/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Workers</a> product if it became helpful for whatever reason (and it did, but that’s a post for another time).</p>\\n<h3>CMS: Notion</h3>\\n<p>As mentioned, I’d been using Notion to draft my posts for a while. Aside from the nice writing experience, it supports Markdown, including code blocks for several different languages. The timing also felt right being that their official API had recently been opened up, and supported by official SDKs. I didn’t know what to expect from a performance standpoint, but I was hoping my caching strategy would prevent any issues from being experienced by my visitors.</p>\\n<h2>Where Things Got Hard</h2>\\n<p>Overall, I really enjoyed building out the site. Remix offers a pretty good developer experience, is well-documented, and I enjoyed how it leans into web standards. There were, however, a couple of things that started to make me wonder if it was worth finishing the effort.</p>\\n<h3>Deployment</h3>\\n<p>Getting my site stood up on <a href=\\\"http://Fly.io\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Fly.io</a> wasn’t monumentally difficult, but there was some notable friction. Most of my issues on that front involved tweaking my Docker image after ripping out a ton of stuff provided to me by the <a href=\\\"https://github.com/remix-run/indie-stack\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Indie Stack</a> I chose. It’s very possible I could’ve gone another route (maybe no stack at all) and had a smoother experience.</p>\\n<p>But the other pain point here was getting it wired up to automatically deploy when I pushed a change to GitHub. The <a href=\\\"https://github.com/alexmacarthur/macarthur-me-remix/blob/master/.github/workflows/deploy.yml\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">stack I chose</a> came with a workflow, but it didn’t “just work,” which is something I got quite accustomed to when working with Vercel and Netlify. I realize these aren’t apples-to-apples comparisons here. Remix is a very different type of application compared to what I had been using. But still, being spoiled for so long with my SSG sites made it less than fun to wade into something else.</p>\\n<h3>Caching</h3>\\n<p>I mentioned that caching was my top priority in rebuilding my site. I went into the migration pretty optimistic about meeting that priority. Setting up Cloudflare was easy, as expected, as was configuring the headers on my site, which looked like this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token comment\\\">// Consider stale after 1 hour, but serve stale &#x26; refresh cache for 6 months.</span>\\nresponseHeaders<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">set</span><span class=\\\"token punctuation\\\">(</span>\\n   <span class=\\\"token string\\\">\\\"Cache-Control\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n   <span class=\\\"token string\\\">\\\"public, max-age=3600, s-maxage=3600, stale-while-revalidate=15780000\\\"</span>\\n<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>Based on that header, I expected my content be served straight from the CDN for up to one hour. After that, it would go “stale,” but Cloudflare would still serve that stale cache for up to six months later. And whenever it did serve that stale content, it would refresh the cache behind the scenes. So, as long as people keep visiting a page at least once every six months, <em>no one</em> would ever experience a slow, uncached response.</p>\\n<p>But that’s not what happened. I started inspecting the response headers shortly after I deployed these changes. It would return a “HIT,” meaning the page was successfully served from Cloudflare’s cache:</p>\\n<p><img src='/proxy/4d59f486-119b-4885-9961-b392a15e9fb7' alt='' loading='lazy' /></p>\\n<p>But then, shortly later (if I remember correctly, it was maybe just an hour or so), refreshing that page would result in a “MISS”:</p>\\n<p><img src='/proxy/f433efe1-9002-4cac-92fb-2217b507a22c' alt='' loading='lazy' /></p>\\n<p>It got pretty frustrating as it continued to occur, but things became a little clearer after Googling around. As it turns out, Cloudflare and other CDNs make no guarantee as to how long they will actually cache a resource. Those time values I used in my headers were really just the maximum amount of time Cloudflare <em>is permitted</em> do it. No promises are made beyond that.</p>\\n<p>It’s hard to find any official documentation on all of this, but it appears that Cloudflare will commonly use this distinction to <a href=\\\"https://community.cloudflare.com/t/getting-cache-miss-after-24-hours-even-though-headers-are-set-to-cache-longer/260526\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">purge infrequently accessed resources</a>, making it a bigger concern for smaller, personal sites like my own.</p>\\n<p>Sifting more, it apparently<a href=\\\"https://community.cloudflare.com/t/cache-everything-is-not-guaranteed/180269/5\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\"> isn’t a new thing for Cloudflare</a>, and may very well be tied to how differs itself as a full-on reverse proxy, rather than strictly a static file host. It did cross my mind that it might behave differently for paid plans, but I didn’t do enough digging to figure out if it does.</p>\\n<p>As I was piecing this together from various personal experiences and forums on the internet, it slowly became clear I wouldn’t have the level of confidence in caching I wanted. Instead, I’d need to explore other CDN offerings that explicitly support more permanent, longer-term caching, or else risk several requests needing to wait for a full response from Notion before showing any content.</p>\\n<p>Of the alternatives I came across, <a href=\\\"https://bunny.net/cdn/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Bunny</a> seemed the most interesting. Not only do they clearly tout permanent caching (“Perma-Cache,” as they call it), they also appear to support an off-brand version of <code>stale-while-revalidate</code> called “<a href=\\\"https://bunny.net/blog/introducing-stale-cache-more-efficient-cache-handling/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Stale Cache Delivery</a>.” The main “downside” here is that there isn’t a free tier, and I’m also not that interested in diving into a totally new CDN right now. Not to mention, I’m sure there are other trade-offs I’d need to spend time considering as well (ex: Cloudflare has over double the number of POPs that Bunny does).</p>\\n<h3>In Fairness, SSG Caching Ain’t Perfect</h3>\\n<p>It’s really important to note that these caching issues don’t just go away by using Vercel or Netlify. Even for them, cache times are never guaranteed to reach the maximum <code>max-age</code> header you set. For example, Vercel claims assets are cached for <a href=\\\"https://vercel.com/docs/concepts/edge-network/caching#x-vercel-cache\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">up to 31 days</a>, by default. But also includes this disclaimer:</p>\\n<p><img src='/proxy/802f4ae5-100d-4ce1-9912-82fe84b11733' alt='' loading='lazy' /></p>\\n<p>The nice thing, though, is that because the site is statically generated, a fresh request doesn’t need to wait for data to be fetched before the HTML can even be built. Instead, the server just goes back to origin to pick up ready-made HTML files, making those “cold” requests pretty lukewarm.</p>\\n<h2>Platform FOMO</h2>\\n<p>Embarking on this journey really made me appreciate some of the things Jamstack-friendly platforms have turned into features we might take for granted. CI/CD is a breeze, leaving very little friction between getting something off your machine and deployed. CDN caching and SSL certificates <em>just work</em> without you thinking about it. It’s very easy to spin up a branch of your site to a unique, shareable URL. Minimal-config serverless functions provide a means of performing tasks requiring a server (I’ve processed <a href=\\\"https://typeitjs.com/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">TypeIt</a> license purchases on a Netlify function for years).</p>\\n<p>And then there are newer features that begin to blur the traditional line between static and server-rendered sites. A while back, Vercel rolled out <a href=\\\"https://vercel.com/docs/concepts/incremental-static-regeneration/overview\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">incremental static regeneration</a>, giving your site a proprietary <code>stale-while-revalidate</code> experience without dealing with a CDN (I’m using this on <a href=\\\"https://macarthur.me/dashboard\\\">my personal dashboard</a> and it works great). Another example is edge functions offered by both <a href=\\\"/bda83e1ecfcd46cebf378579633cc85e\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Netlify</a> and <a href=\\\"https://vercel.com/docs/concepts/functions/edge-functions\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Vercel</a>, making it possible to run dynamic, server-side logic real close to your users, rather than only at your origin.</p>\\n<p>These and other players are pushing the limit hard and fast, and it makes me not want to miss out on the next interesting thing they’ll roll out.</p>\\n<h2>We’ll See Where this Goes</h2>\\n<p>I was a little bummed about the time I invested in that Remix rebuild that will probably never see the light of day, but in hindsight, I’m grateful to have learned a <em>ton</em> in the process, especially with regard to caching and CDNs. I’m also left with a fresh sense of excitement for the Jamstack and some of the innovations its helped shepherd in.</p>\\n<p>Even so, it’s only a matter of time before I feel the itch to tear all of this down and rebuild it with the next big thing. I’m giving myself six months.</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 11,
        "title": "Why Can’t You .forEach() Over Empty Array Items?",
        "slug": "looping-over-empty-array-items",
        "html": "<p>Harken back to a time when you needed to execute some code a specific number of times and had some reason to not use a <code>for</code> loop. You might’ve made a fresh array with a certain number of items, and then attempted to <code>.forEach()</code> over it:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> freshArray <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nfreshArray<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>If you did take that approach, you also might’ve expected to see five individual logs for <code>undefined</code>. <strong>But instead, nothing happened,</strong> as if the array didn’t have any items to begin with.</p>\n<p>That’s because it technically doesn’t. When a number is passed into the <code>Array</code> constructor, no items are actually defined — not even <code>undefined</code> ones. Instead, <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Array#parameters\" target=\"_blank\" rel=\"noopener\">only the </a><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Array#parameters\" target=\"_blank\" rel=\"noopener\"><code>length</code></a><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Array#parameters\" target=\"_blank\" rel=\"noopener\"> property is set</a>, effectively reserving that many seats that may or may not be filled later. You’ve created a <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Indexed_collections#sparse_arrays\" target=\"_blank\" rel=\"noopener\"><em>sparse</em></a><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Indexed_collections#sparse_arrays\" target=\"_blank\" rel=\"noopener\"> array.</a> You can verify that by logging the array itself:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> freshArray <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>freshArray<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// [ &#x3C;5 empty items> ]</span>\n</code></pre></div>\n<p>When a method on the <code>Array</code> prototype (<code>.map()</code>, <code>.forEach()</code>, etc.) encounters such an array, it’s designed to <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach#description\" target=\"_blank\" rel=\"noopener\">skip over any uninitialized or deleted items</a>. The position of those items doesn’t matter. For example, you could designate “empty” items by inserting commas:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> freshArray <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">,</span> <span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Length:\"</span><span class=\"token punctuation\">,</span> freshArray<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nfreshArray<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Length: 5</span>\n<span class=\"token comment\">// 1</span>\n<span class=\"token comment\">// 2</span>\n<span class=\"token comment\">// 5</span>\n</code></pre></div>\n<p>And even by directly setting them via index:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> freshArray <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\nfreshArray<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"fourth item!\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Length:\"</span><span class=\"token punctuation\">,</span> freshArray<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nfreshArray<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item<span class=\"token punctuation\">,</span> index</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Length: 4</span>\n<span class=\"token comment\">// \"fourth item!\" 3</span>\n</code></pre></div>\n<p>If you’re dead-set on using methods like <code>.forEach()</code> or <code>.map()</code> with a sparse array, you can reach for something like <code>.fill()</code> to <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/fill\" target=\"_blank\" rel=\"noopener\">populate each empty item</a> with something first (even <code>undefined</code>).</p>\n<h2>Iterators Are Different, Though</h2>\n<p>That said, even those empty items are accessible using the <code>Symbol.iterator</code> method defined on the <code>Array</code> prototype. It’s implicitly accessed any time you use a <code>for</code> loop.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> freshArray <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> item <span class=\"token keyword\">of</span> freshArray<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// undefined</span>\n<span class=\"token comment\">// undefined</span>\n<span class=\"token comment\">// undefined</span>\n<span class=\"token comment\">// undefined</span>\n<span class=\"token comment\">// undefined</span>\n</code></pre></div>\n<p>It’s also in play under the hood when the spread operator is used, which means you could spread your sparse array, and immediately be able to perform a <code>.forEach()</code> on it:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> freshArray <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// .forEach() will work now!</span>\n<span class=\"token punctuation\">[</span><span class=\"token spread operator\">...</span>freshArray<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item<span class=\"token punctuation\">,</span> index</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// undefined 0</span>\n<span class=\"token comment\">// undefined 1</span>\n<span class=\"token comment\">// undefined 2</span>\n<span class=\"token comment\">// undefined 3</span>\n<span class=\"token comment\">// undefined 4</span>\n</code></pre></div>\n<p>If you wanted, you could use this iteration behavior to make your own variation of <code>.forEach</code> that’ll handle empty items (tack on methods to prototypes at your own risk!):</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token class-name\">Array</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">inclusiveForEach</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">[</span><span class=\"token spread operator\">...</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span>callback<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> freshArray <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nfreshArray<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">inclusiveForEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item<span class=\"token punctuation\">,</span> index</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// undefined 0</span>\n<span class=\"token comment\">// undefined 1</span>\n<span class=\"token comment\">// undefined 2</span>\n<span class=\"token comment\">// undefined 3</span>\n<span class=\"token comment\">// undefined 4</span>\n</code></pre></div>\n<p>All of these decisions are up to you, and highly dependent on your circumstances. At the very least, I hope this helps shed some light on why the code behaves the way it does, and offers some considerations to help you move forward.</p>\n",
        "feature_image": "https://images.unsplash.com/photo-1585420779903-2efb4b39c5bd?ixlib=rb-1.2.1&q=80&cs=tinysrgb&fm=jpg&crop=entropy",
        "status": "published",
        "created_at": 1662613200000,
        "published_at": 1662613200000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>Harken back to a time when you needed to execute some code a specific number of times and had some reason to not use a <code>for</code> loop. You might’ve made a fresh array with a certain number of items, and then attempted to <code>.forEach()</code> over it:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> freshArray <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Array</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token number\\\">5</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\nfreshArray<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">forEach</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">item</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n\\t<span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span>item<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>If you did take that approach, you also might’ve expected to see five individual logs for <code>undefined</code>. <strong>But instead, nothing happened,</strong> as if the array didn’t have any items to begin with.</p>\\n<p>That’s because it technically doesn’t. When a number is passed into the <code>Array</code> constructor, no items are actually defined — not even <code>undefined</code> ones. Instead, <a href=\\\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Array#parameters\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">only the </a><a href=\\\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Array#parameters\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\"><code>length</code></a><a href=\\\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Array#parameters\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\"> property is set</a>, effectively reserving that many seats that may or may not be filled later. You’ve created a <a href=\\\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Indexed_collections#sparse_arrays\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\"><em>sparse</em></a><a href=\\\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Indexed_collections#sparse_arrays\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\"> array.</a> You can verify that by logging the array itself:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> freshArray <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Array</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token number\\\">5</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span>freshArray<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// [ &#x3C;5 empty items> ]</span>\\n</code></pre></div>\\n<p>When a method on the <code>Array</code> prototype (<code>.map()</code>, <code>.forEach()</code>, etc.) encounters such an array, it’s designed to <a href=\\\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach#description\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">skip over any uninitialized or deleted items</a>. The position of those items doesn’t matter. For example, you could designate “empty” items by inserting commas:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> freshArray <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">2</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">5</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"Length:\\\"</span><span class=\\\"token punctuation\\\">,</span> freshArray<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">length</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\nfreshArray<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">forEach</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">item</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span>item<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// Length: 5</span>\\n<span class=\\\"token comment\\\">// 1</span>\\n<span class=\\\"token comment\\\">// 2</span>\\n<span class=\\\"token comment\\\">// 5</span>\\n</code></pre></div>\\n<p>And even by directly setting them via index:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> freshArray <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n\\nfreshArray<span class=\\\"token punctuation\\\">[</span><span class=\\\"token number\\\">3</span><span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"fourth item!\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"Length:\\\"</span><span class=\\\"token punctuation\\\">,</span> freshArray<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">length</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\nfreshArray<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">forEach</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">item<span class=\\\"token punctuation\\\">,</span> index</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span>item<span class=\\\"token punctuation\\\">,</span> index<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// Length: 4</span>\\n<span class=\\\"token comment\\\">// \\\"fourth item!\\\" 3</span>\\n</code></pre></div>\\n<p>If you’re dead-set on using methods like <code>.forEach()</code> or <code>.map()</code> with a sparse array, you can reach for something like <code>.fill()</code> to <a href=\\\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/fill\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">populate each empty item</a> with something first (even <code>undefined</code>).</p>\\n<h2>Iterators Are Different, Though</h2>\\n<p>That said, even those empty items are accessible using the <code>Symbol.iterator</code> method defined on the <code>Array</code> prototype. It’s implicitly accessed any time you use a <code>for</code> loop.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> freshArray <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Array</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token number\\\">5</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword control-flow\\\">for</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">const</span> item <span class=\\\"token keyword\\\">of</span> freshArray<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span>item<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token comment\\\">// undefined</span>\\n<span class=\\\"token comment\\\">// undefined</span>\\n<span class=\\\"token comment\\\">// undefined</span>\\n<span class=\\\"token comment\\\">// undefined</span>\\n<span class=\\\"token comment\\\">// undefined</span>\\n</code></pre></div>\\n<p>It’s also in play under the hood when the spread operator is used, which means you could spread your sparse array, and immediately be able to perform a <code>.forEach()</code> on it:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> freshArray <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Array</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token number\\\">5</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// .forEach() will work now!</span>\\n<span class=\\\"token punctuation\\\">[</span><span class=\\\"token spread operator\\\">...</span>freshArray<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">forEach</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">item<span class=\\\"token punctuation\\\">,</span> index</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span>item<span class=\\\"token punctuation\\\">,</span> index<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// undefined 0</span>\\n<span class=\\\"token comment\\\">// undefined 1</span>\\n<span class=\\\"token comment\\\">// undefined 2</span>\\n<span class=\\\"token comment\\\">// undefined 3</span>\\n<span class=\\\"token comment\\\">// undefined 4</span>\\n</code></pre></div>\\n<p>If you wanted, you could use this iteration behavior to make your own variation of <code>.forEach</code> that’ll handle empty items (tack on methods to prototypes at your own risk!):</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token class-name\\\">Array</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">prototype</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method-variable function-variable method function property-access\\\">inclusiveForEach</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">function</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">callback</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token spread operator\\\">...</span><span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">forEach</span><span class=\\\"token punctuation\\\">(</span>callback<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token keyword\\\">const</span> freshArray <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Array</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token number\\\">5</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\nfreshArray<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">inclusiveForEach</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">item<span class=\\\"token punctuation\\\">,</span> index</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span>item<span class=\\\"token punctuation\\\">,</span> index<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// undefined 0</span>\\n<span class=\\\"token comment\\\">// undefined 1</span>\\n<span class=\\\"token comment\\\">// undefined 2</span>\\n<span class=\\\"token comment\\\">// undefined 3</span>\\n<span class=\\\"token comment\\\">// undefined 4</span>\\n</code></pre></div>\\n<p>All of these decisions are up to you, and highly dependent on your circumstances. At the very least, I hope this helps shed some light on why the code behaves the way it does, and offers some considerations to help you move forward.</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 12,
        "title": "Develop an SPA Against a Remote Page w/ Vite",
        "slug": "project-local-spa-onto-production-page",
        "html": "<p>More and more frequently, I’ve been working with little small single-page applications that are built independently and then mounted into something more complex. Think of things like interactive calculators, multi-step forms, or other tools intended to plug into a “bigger” page, like one hosted by CMS.</p>\n<p><img src='/proxy/824e282f-9b3c-4b3f-b3da-e0ca16b5367d' alt='' loading='lazy' /></p>\n<p>Overall, it’s a helpful approach. Rather than being required to mess with a clunky application in order to work on just a small piece of it, you need to deal only with a little, self-contained application.</p>\n<h2>The Inherent Challenge</h2>\n<p>But there are some noteworthy challenges. The main one: <strong>you’re building a tool intended to be used in a specific context,</strong> <em><strong>totally outside that context</strong></em><strong>.</strong> This inevitably brings about some gotchas &#x26; annoyances, often after you’ve gone through the work of publishing your latest version of the tool and mounting it to the (let’s assume from here on out it’s a) CMS. You’ll ship it and then find things like this:</p>\n<ul>\n<li>Global styles loaded by the CMS are bleeding into your app.</li>\n<li>Third-party analytics scripts aren’t tracking the tool’s activity as expected.</li>\n<li>A sticky header on the page unexpectedly overlaps part of the tool as someone’s using it.</li>\n<li>You didn’t realize a ton of library styles are already being loaded by the CMS, and so you double-shipped a ton of CSS.</li>\n</ul>\n<p>Individually, none of these issues are difficult to solve. The problem is that <strong>the feedback loop to become aware of them is too big</strong>.</p>\n<p>Thankfully, modern tooling can give us some of the best of both worlds — a snappy, lightweight development experience, <em>and a</em> local environment that mimics how the tool will <em>actually exist in production</em>. In particular, Vite makes it real easy.</p>\n<h2>Remote Development with Vite</h2>\n<p>To be fair, Vite isn’t even the first tool I’ve seen used to project a local SPA onto a remote page — my friend <a href=\"https://kroneman.io/\" target=\"_blank\" rel=\"noopener\">Lennart Kroneman</a> showed me how to do it with Webpack a couple of years ago, and I know other tools are capable of proxying requests in a similar fashion as well. But the ease at which it’s possible with Vite is at a whole different level.</p>\n<h3>An Sample Setup</h3>\n<p>To prototype this, I’ve made an example “production” page published with Netlify. It’s got a bit of content and a little SPA mounted to it (”My Production App”). If you’d like to dabble, <a href=\"https://github.com/alexmacarthur/vite-proxy-demo\" target=\"_blank\" rel=\"noopener\">the repository lives here</a>, and the <a href=\"https://vite-proxy-demo.netlify.app/some-page/\" target=\"_blank\" rel=\"noopener\">published page is here</a>. Just pretend it’s a published page hosted by an enterprise CMS.</p>\n<p><img src='/proxy/04a2f25b-a097-43a8-bb5d-cf33c2b37288' alt='' loading='lazy' /></p>\n<p>Rendered between the page’s content is an empty DOM node used to mount the app, and a script tag to load the bundle:</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token comment\">&#x3C;!-- app mounted here --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>app<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>div</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token comment\">&#x3C;!-- app's bundle loaded here --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>module<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/static/production-bundle.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>script</span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<h3>Our Little App’s Vite Configuration</h3>\n<p>The <code>vite.config.js</code> file for our little, independent app is pretty simple at this point, simply defining how the package will be bundled on <code>build</code>.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> resolve <span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">\"path\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> defineConfig <span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">\"vite\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\">preact</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">\"@preact/preset-vite\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token function\">defineConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token function\">preact</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token literal-property property\">build</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token literal-property property\">lib</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token literal-property property\">entry</span><span class=\"token operator\">:</span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">\"app.jsx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"MyApp\"</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token function-variable function\">fileName</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token string\">\"production-bundle.js\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Even though I’m using Preact, the framework of choice is irrelevant. The basic assumption is that it’s something that mounts to <code>#app</code> once the bundle loads. Our application code looks like this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// app.js</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\"><span class=\"token maybe-class-name\">App</span></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword control-flow\">return</span> <span class=\"token operator\">&#x3C;</span>h2<span class=\"token operator\">></span><span class=\"token maybe-class-name\">My</span> <span class=\"token constant\">DEVELOPMENT</span> <span class=\"token maybe-class-name\">App</span><span class=\"token operator\">!</span><span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>h2<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token maybe-class-name\">App</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Which is then locally rendered in a <code>local-dev.jsx</code> file that’s directly referenced by our <code>index.html</code> file. This file is only intended to be used for local development. It’ll never be bundled up with the final product.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// local-dev.jsx</span>\n\n<span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> render <span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">\"preact\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token maybe-class-name\">App</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">\"./app\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&#x3C;</span><span class=\"token maybe-class-name\">App</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"app\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Now, let’s spin things up. To start, it doesn’t look like much. If all goes well, we’ll end with this same application being rendered locally, but as if it’s on that remote, production page.</p>\n<p><img src='/proxy/b23647e6-474c-40da-9085-af261718b601' alt='' loading='lazy' /></p>\n<h2>Manipulating Incoming HTML w/ Vite</h2>\n<p>It’s possible to pull all of this off with Vite’s built-in support for <a href=\"https://vitejs.dev/config/server-options.html#server-proxy\" target=\"_blank\" rel=\"noopener\">proxying requests</a>. In fact, when I first started dabbling, this is the approach I took. But because we’re dealing with multiple request types with various sources, it gets cumbersome real quick, and so I don’t even recommend it anymore.</p>\n<p>Instead, Vite has a simpler, yet equally effective approach we can take: the <code>transformIndexHtml</code> hook from its <a href=\"https://vitejs.dev/guide/api-plugin.html#vite-specific-hooks\" target=\"_blank\" rel=\"noopener\">plugin API</a>. When it’s wired up, we have full control over what’s rendered by the local development server with a relatively small amount of code.</p>\n<p>We’ll start with a small Vite plugin, whose bones look like this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// vite.config.js</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\"><span class=\"token maybe-class-name\">HtmlRewriter</span></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"html-rewriter\"</span><span class=\"token punctuation\">,</span>\n\n\t<span class=\"token keyword\">async</span> <span class=\"token function\">transformIndexHtml</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">html</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token comment\">// Transformation happens here.</span>\n\t\t<span class=\"token keyword control-flow\">return</span> html<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token function\">defineConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">// Plugin registered here:</span>\n\t<span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token function\">preact</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\"><span class=\"token maybe-class-name\">HtmlRewriter</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n\t<span class=\"token comment\">// ... the rest of our config.</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>With this in place, we have full power to do whatever we want with that HTML, like completely swap out all of the HTML for “your mom”:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\"><span class=\"token maybe-class-name\">HtmlRewriter</span></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"html-rewriter\"</span><span class=\"token punctuation\">,</span>\n\n\t<span class=\"token keyword\">async</span> <span class=\"token function\">transformIndexHtml</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">html</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword control-flow\">return</span> <span class=\"token string\">\"your mom\"</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Or, the HTML for a different page altogether:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\"><span class=\"token maybe-class-name\">HtmlRewriter</span></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"html-rewriter\"</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token keyword\">async</span> <span class=\"token function\">transformIndexHtml</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">html</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token comment\">// Request the remote page.</span>\n\t\t<span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>\n\t\t\t<span class=\"token string\">\"https://vite-proxy-demo.netlify.app/some-page/\"</span>\n\t\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token comment\">// Return the HTML.</span>\n\t\t<span class=\"token keyword control-flow\">return</span> response<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>At this point, if you were to reload our local application, it’d look exactly like that remote page we’re targeting, even though we’re serving it on <code>localhost</code>.</p>\n<p><img src='/proxy/04a2f25b-a097-43a8-bb5d-cf33c2b37288' alt='' loading='lazy' /></p>\n<p>The next step is to surgically rewrite the script tag to point to our <em>development</em> version of the application, rather than the one that’s currently rendering.</p>\n<h2>Hijacking the Root Node</h2>\n<p>This’ll highly depend on how your production bundle is being loaded for a page you’re targeting. But for us, the application code is being loaded from a CloudFront URL. All we’ll do is target that remote script and swap it out for our local <code>local-dev.jsx</code>. Notice that since we’ll be serving it locally, we can even stick to using a relative path.</p>\n<div class=\"remark-highlight\"><pre class=\"language-diff\"><code class=\"language-diff\">const HtmlRewriter = () => ({\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> name: \"html-rewriter\",</span>\n<span class=\"token line\"></span></span>\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> async transformIndexHtml(html) {</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   const response = await fetch(</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">     \"https://vite-proxy-demo.netlify.app/some-page/\"</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   );</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   const remoteHtml = await response.text();</span>\n<span class=\"token line\"></span></span>\n<span class=\"token deleted-sign deleted\"><span class=\"token prefix deleted\">-</span><span class=\"token line\">   return remoteHtml;</span>\n<span class=\"token line\"></span></span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">   return remoteHtml.replace(</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">     /(https:\\/\\/(.*?)cloudfront\\.net(.*?)production-bundle\\.js)/,</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">     `./local-dev.jsx`</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   );</span>\n<span class=\"token line\"></span></span><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> },</span>\n<span class=\"token line\"></span></span>});\n</code></pre></div>\n<p>If you refresh the page, you’ll see <em>nearly</em> the same result as before. All code is coming in from a production page <em>except</em> the script we targeted. And because of this, it’s our <em>local version</em> of the application running on the page — no longer the remote one.</p>\n<p><img src='/proxy/211f9c5e-d403-4dd2-ad02-36808b9293ea' alt='' loading='lazy' /></p>\n<p>With that, we’re largely set. We can iterate on our application with a far less chance of interference from unexpected code running on the page, without running any other application locally.</p>\n<h2>Avoiding a Couple of Gotchas</h2>\n<p>Before we’re wrapped up, there are a couple more things to keep in mind as you implement any of this:</p>\n<p><strong>#1: Guarantee hot module reloading fires consistently.</strong></p>\n<p>I initially ran into some issues with changes not being propagated through Vite to the browser consistently. In order to guarantee that they do, include <a href=\"http://import.meta.hot\" target=\"_blank\" rel=\"noopener\"><code>import.meta.hot</code></a> in your entry point file:</p>\n<div class=\"remark-highlight\"><pre class=\"language-diff\"><code class=\"language-diff\">// local-dev.jsx\n\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\"> import.meta.hot;</span>\n<span class=\"token line\"></span></span>\nimport { render } from \"preact\";\nimport App from \"./app\";\n\nrender(&#x3C;App />, document.getElementById(\"app\"));\n</code></pre></div>\n<p>That single line will force Vite to fully propagate an update, trigging a module reload, and keeping your development experience snappy:</p>\n<p><img src='/proxy/dc22d28b-99d7-4faf-9c0e-c3a6e6fc92f9' alt='' loading='lazy' /></p>\n<p><strong>#2: Your</strong> <strong><code>script</code></strong> <strong>tag</strong> <em><strong>must</strong></em> <strong>have a</strong> <strong><code>type=\"module\"</code></strong> <strong>attribute on it.</strong></p>\n<p>Without it, Vite won’t be able to load and execute your local entry point. It’s a small thing that may also be easily remedied by HTML rewriting again. Nevertheless, it can trip you up.</p>\n<h2>All this in a Plugin</h2>\n<p>I’ve quickly found myself implementing this setup in multiple projects, so I wrapped it up in a plugin: <a href=\"https://github.com/alexmacarthur/vite-plugin-proxy-page\" target=\"_blank\" rel=\"noopener\">vite-plugin-proxy-page</a>. It’s been tested in a variety of different projects, and you’re welcome to leverage it too. As an added benefit, there are a few other nice-to-haves handled by it too. Things like:</p>\n<ul>\n<li>Locally caching the remote HTML so you’re not refetching it on every page load.</li>\n<li>Being able to <em>create</em> a root node in the remote page’s HTML if it doesn’t already exist (and mount it in the correct spot).</li>\n</ul>\n<h2>Tightening the Feedback Loop</h2>\n<p>Embracing these tactics has done some wonders for shrinking the formerly gigantic feedback loop we’d otherwise need to navigate when building in this sort of architecture. Hoping it does the same for you!</p>\n",
        "feature_image": "https://images.unsplash.com/photo-1453728013993-6d66e9c9123a?ixlib=rb-1.2.1&q=80&cs=tinysrgb&fm=jpg&crop=entropy",
        "status": "published",
        "created_at": 1662440400000,
        "published_at": 1662440400000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "meta_description": "There are serious benefits to building small applications in the context of a complex, remote page. Vite makes it pretty simple to pull it off.",
        "updated_at": 1677646800000,
        "updated_by": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>More and more frequently, I’ve been working with little small single-page applications that are built independently and then mounted into something more complex. Think of things like interactive calculators, multi-step forms, or other tools intended to plug into a “bigger” page, like one hosted by CMS.</p>\\n<p><img src='/proxy/824e282f-9b3c-4b3f-b3da-e0ca16b5367d' alt='' loading='lazy' /></p>\\n<p>Overall, it’s a helpful approach. Rather than being required to mess with a clunky application in order to work on just a small piece of it, you need to deal only with a little, self-contained application.</p>\\n<h2>The Inherent Challenge</h2>\\n<p>But there are some noteworthy challenges. The main one: <strong>you’re building a tool intended to be used in a specific context,</strong> <em><strong>totally outside that context</strong></em><strong>.</strong> This inevitably brings about some gotchas &#x26; annoyances, often after you’ve gone through the work of publishing your latest version of the tool and mounting it to the (let’s assume from here on out it’s a) CMS. You’ll ship it and then find things like this:</p>\\n<ul>\\n<li>Global styles loaded by the CMS are bleeding into your app.</li>\\n<li>Third-party analytics scripts aren’t tracking the tool’s activity as expected.</li>\\n<li>A sticky header on the page unexpectedly overlaps part of the tool as someone’s using it.</li>\\n<li>You didn’t realize a ton of library styles are already being loaded by the CMS, and so you double-shipped a ton of CSS.</li>\\n</ul>\\n<p>Individually, none of these issues are difficult to solve. The problem is that <strong>the feedback loop to become aware of them is too big</strong>.</p>\\n<p>Thankfully, modern tooling can give us some of the best of both worlds — a snappy, lightweight development experience, <em>and a</em> local environment that mimics how the tool will <em>actually exist in production</em>. In particular, Vite makes it real easy.</p>\\n<h2>Remote Development with Vite</h2>\\n<p>To be fair, Vite isn’t even the first tool I’ve seen used to project a local SPA onto a remote page — my friend <a href=\\\"https://kroneman.io/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Lennart Kroneman</a> showed me how to do it with Webpack a couple of years ago, and I know other tools are capable of proxying requests in a similar fashion as well. But the ease at which it’s possible with Vite is at a whole different level.</p>\\n<h3>An Sample Setup</h3>\\n<p>To prototype this, I’ve made an example “production” page published with Netlify. It’s got a bit of content and a little SPA mounted to it (”My Production App”). If you’d like to dabble, <a href=\\\"https://github.com/alexmacarthur/vite-proxy-demo\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">the repository lives here</a>, and the <a href=\\\"https://vite-proxy-demo.netlify.app/some-page/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">published page is here</a>. Just pretend it’s a published page hosted by an enterprise CMS.</p>\\n<p><img src='/proxy/04a2f25b-a097-43a8-bb5d-cf33c2b37288' alt='' loading='lazy' /></p>\\n<p>Rendered between the page’s content is an empty DOM node used to mount the app, and a script tag to load the bundle:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token comment\\\">&#x3C;!-- app mounted here --></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>div</span> <span class=\\\"token attr-name\\\">id</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>app<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>div</span><span class=\\\"token punctuation\\\">></span></span>\\n\\n<span class=\\\"token comment\\\">&#x3C;!-- app's bundle loaded here --></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>script</span> <span class=\\\"token attr-name\\\">type</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>module<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token attr-name\\\">src</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>/static/production-bundle.js<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token script\\\"></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>script</span><span class=\\\"token punctuation\\\">></span></span>\\n</code></pre></div>\\n<h3>Our Little App’s Vite Configuration</h3>\\n<p>The <code>vite.config.js</code> file for our little, independent app is pretty simple at this point, simply defining how the package will be bundled on <code>build</code>.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword module\\\">import</span> <span class=\\\"token imports\\\"><span class=\\\"token punctuation\\\">{</span> resolve <span class=\\\"token punctuation\\\">}</span></span> <span class=\\\"token keyword module\\\">from</span> <span class=\\\"token string\\\">\\\"path\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword module\\\">import</span> <span class=\\\"token imports\\\"><span class=\\\"token punctuation\\\">{</span> defineConfig <span class=\\\"token punctuation\\\">}</span></span> <span class=\\\"token keyword module\\\">from</span> <span class=\\\"token string\\\">\\\"vite\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword module\\\">import</span> <span class=\\\"token imports\\\">preact</span> <span class=\\\"token keyword module\\\">from</span> <span class=\\\"token string\\\">\\\"@preact/preset-vite\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword module\\\">export</span> <span class=\\\"token keyword module\\\">default</span> <span class=\\\"token function\\\">defineConfig</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n\\t<span class=\\\"token literal-property property\\\">plugins</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token function\\\">preact</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span>\\n\\t<span class=\\\"token literal-property property\\\">build</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n\\t\\t<span class=\\\"token literal-property property\\\">lib</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n\\t\\t\\t<span class=\\\"token literal-property property\\\">entry</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token function\\\">resolve</span><span class=\\\"token punctuation\\\">(</span>__dirname<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">\\\"app.jsx\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span>\\n\\t\\t\\t<span class=\\\"token literal-property property\\\">name</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"MyApp\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n\\t\\t\\t<span class=\\\"token function-variable function\\\">fileName</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token string\\\">\\\"production-bundle.js\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n\\t\\t<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n\\t<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>Even though I’m using Preact, the framework of choice is irrelevant. The basic assumption is that it’s something that mounts to <code>#app</code> once the bundle loads. Our application code looks like this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token comment\\\">// app.js</span>\\n\\n<span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\"><span class=\\\"token maybe-class-name\\\">App</span></span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n\\t<span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token operator\\\">&#x3C;</span>h2<span class=\\\"token operator\\\">></span><span class=\\\"token maybe-class-name\\\">My</span> <span class=\\\"token constant\\\">DEVELOPMENT</span> <span class=\\\"token maybe-class-name\\\">App</span><span class=\\\"token operator\\\">!</span><span class=\\\"token operator\\\">&#x3C;</span><span class=\\\"token operator\\\">/</span>h2<span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword module\\\">export</span> <span class=\\\"token keyword module\\\">default</span> <span class=\\\"token maybe-class-name\\\">App</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>Which is then locally rendered in a <code>local-dev.jsx</code> file that’s directly referenced by our <code>index.html</code> file. This file is only intended to be used for local development. It’ll never be bundled up with the final product.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token comment\\\">// local-dev.jsx</span>\\n\\n<span class=\\\"token keyword module\\\">import</span> <span class=\\\"token imports\\\"><span class=\\\"token punctuation\\\">{</span> render <span class=\\\"token punctuation\\\">}</span></span> <span class=\\\"token keyword module\\\">from</span> <span class=\\\"token string\\\">\\\"preact\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword module\\\">import</span> <span class=\\\"token imports\\\"><span class=\\\"token maybe-class-name\\\">App</span></span> <span class=\\\"token keyword module\\\">from</span> <span class=\\\"token string\\\">\\\"./app\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token function\\\">render</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">&#x3C;</span><span class=\\\"token maybe-class-name\\\">App</span> <span class=\\\"token operator\\\">/</span><span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getElementById</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"app\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>Now, let’s spin things up. To start, it doesn’t look like much. If all goes well, we’ll end with this same application being rendered locally, but as if it’s on that remote, production page.</p>\\n<p><img src='/proxy/b23647e6-474c-40da-9085-af261718b601' alt='' loading='lazy' /></p>\\n<h2>Manipulating Incoming HTML w/ Vite</h2>\\n<p>It’s possible to pull all of this off with Vite’s built-in support for <a href=\\\"https://vitejs.dev/config/server-options.html#server-proxy\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">proxying requests</a>. In fact, when I first started dabbling, this is the approach I took. But because we’re dealing with multiple request types with various sources, it gets cumbersome real quick, and so I don’t even recommend it anymore.</p>\\n<p>Instead, Vite has a simpler, yet equally effective approach we can take: the <code>transformIndexHtml</code> hook from its <a href=\\\"https://vitejs.dev/guide/api-plugin.html#vite-specific-hooks\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">plugin API</a>. When it’s wired up, we have full control over what’s rendered by the local development server with a relatively small amount of code.</p>\\n<p>We’ll start with a small Vite plugin, whose bones look like this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token comment\\\">// vite.config.js</span>\\n\\n<span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\"><span class=\\\"token maybe-class-name\\\">HtmlRewriter</span></span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n\\t<span class=\\\"token literal-property property\\\">name</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"html-rewriter\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n\\n\\t<span class=\\\"token keyword\\\">async</span> <span class=\\\"token function\\\">transformIndexHtml</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">html</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n\\t\\t<span class=\\\"token comment\\\">// Transformation happens here.</span>\\n\\t\\t<span class=\\\"token keyword control-flow\\\">return</span> html<span class=\\\"token punctuation\\\">;</span>\\n\\t<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword module\\\">export</span> <span class=\\\"token keyword module\\\">default</span> <span class=\\\"token function\\\">defineConfig</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n\\t<span class=\\\"token comment\\\">// Plugin registered here:</span>\\n\\t<span class=\\\"token literal-property property\\\">plugins</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token function\\\">preact</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token function\\\"><span class=\\\"token maybe-class-name\\\">HtmlRewriter</span></span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span>\\n\\n\\t<span class=\\\"token comment\\\">// ... the rest of our config.</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>With this in place, we have full power to do whatever we want with that HTML, like completely swap out all of the HTML for “your mom”:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\"><span class=\\\"token maybe-class-name\\\">HtmlRewriter</span></span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token literal-property property\\\">name</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"html-rewriter\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n\\n\\t<span class=\\\"token keyword\\\">async</span> <span class=\\\"token function\\\">transformIndexHtml</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">html</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n\\t\\t<span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token string\\\">\\\"your mom\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n\\t<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>Or, the HTML for a different page altogether:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\"><span class=\\\"token maybe-class-name\\\">HtmlRewriter</span></span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token literal-property property\\\">name</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"html-rewriter\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n\\n  <span class=\\\"token keyword\\\">async</span> <span class=\\\"token function\\\">transformIndexHtml</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">html</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n\\t\\t<span class=\\\"token comment\\\">// Request the remote page.</span>\\n\\t\\t<span class=\\\"token keyword\\\">const</span> response <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword control-flow\\\">await</span> <span class=\\\"token function\\\">fetch</span><span class=\\\"token punctuation\\\">(</span>\\n\\t\\t\\t<span class=\\\"token string\\\">\\\"https://vite-proxy-demo.netlify.app/some-page/\\\"</span>\\n\\t\\t<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n\\t\\t<span class=\\\"token comment\\\">// Return the HTML.</span>\\n\\t\\t<span class=\\\"token keyword control-flow\\\">return</span> response<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">text</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>At this point, if you were to reload our local application, it’d look exactly like that remote page we’re targeting, even though we’re serving it on <code>localhost</code>.</p>\\n<p><img src='/proxy/04a2f25b-a097-43a8-bb5d-cf33c2b37288' alt='' loading='lazy' /></p>\\n<p>The next step is to surgically rewrite the script tag to point to our <em>development</em> version of the application, rather than the one that’s currently rendering.</p>\\n<h2>Hijacking the Root Node</h2>\\n<p>This’ll highly depend on how your production bundle is being loaded for a page you’re targeting. But for us, the application code is being loaded from a CloudFront URL. All we’ll do is target that remote script and swap it out for our local <code>local-dev.jsx</code>. Notice that since we’ll be serving it locally, we can even stick to using a relative path.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-diff\\\"><code class=\\\"language-diff\\\">const HtmlRewriter = () => ({\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> name: \\\"html-rewriter\\\",</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> async transformIndexHtml(html) {</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   const response = await fetch(</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">     \\\"https://vite-proxy-demo.netlify.app/some-page/\\\"</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   );</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   const remoteHtml = await response.text();</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token deleted-sign deleted\\\"><span class=\\\"token prefix deleted\\\">-</span><span class=\\\"token line\\\">   return remoteHtml;</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   return remoteHtml.replace(</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">     /(https:\\\\/\\\\/(.*?)cloudfront\\\\.net(.*?)production-bundle\\\\.js)/,</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">     `./local-dev.jsx`</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   );</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> },</span>\\n<span class=\\\"token line\\\"></span></span>});\\n</code></pre></div>\\n<p>If you refresh the page, you’ll see <em>nearly</em> the same result as before. All code is coming in from a production page <em>except</em> the script we targeted. And because of this, it’s our <em>local version</em> of the application running on the page — no longer the remote one.</p>\\n<p><img src='/proxy/211f9c5e-d403-4dd2-ad02-36808b9293ea' alt='' loading='lazy' /></p>\\n<p>With that, we’re largely set. We can iterate on our application with a far less chance of interference from unexpected code running on the page, without running any other application locally.</p>\\n<h2>Avoiding a Couple of Gotchas</h2>\\n<p>Before we’re wrapped up, there are a couple more things to keep in mind as you implement any of this:</p>\\n<p><strong>#1: Guarantee hot module reloading fires consistently.</strong></p>\\n<p>I initially ran into some issues with changes not being propagated through Vite to the browser consistently. In order to guarantee that they do, include <a href=\\\"http://import.meta.hot\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\"><code>import.meta.hot</code></a> in your entry point file:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-diff\\\"><code class=\\\"language-diff\\\">// local-dev.jsx\\n\\n<span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"> import.meta.hot;</span>\\n<span class=\\\"token line\\\"></span></span>\\nimport { render } from \\\"preact\\\";\\nimport App from \\\"./app\\\";\\n\\nrender(&#x3C;App />, document.getElementById(\\\"app\\\"));\\n</code></pre></div>\\n<p>That single line will force Vite to fully propagate an update, trigging a module reload, and keeping your development experience snappy:</p>\\n<p><img src='/proxy/dc22d28b-99d7-4faf-9c0e-c3a6e6fc92f9' alt='' loading='lazy' /></p>\\n<p><strong>#2: Your</strong> <strong><code>script</code></strong> <strong>tag</strong> <em><strong>must</strong></em> <strong>have a</strong> <strong><code>type=\\\"module\\\"</code></strong> <strong>attribute on it.</strong></p>\\n<p>Without it, Vite won’t be able to load and execute your local entry point. It’s a small thing that may also be easily remedied by HTML rewriting again. Nevertheless, it can trip you up.</p>\\n<h2>All this in a Plugin</h2>\\n<p>I’ve quickly found myself implementing this setup in multiple projects, so I wrapped it up in a plugin: <a href=\\\"https://github.com/alexmacarthur/vite-plugin-proxy-page\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">vite-plugin-proxy-page</a>. It’s been tested in a variety of different projects, and you’re welcome to leverage it too. As an added benefit, there are a few other nice-to-haves handled by it too. Things like:</p>\\n<ul>\\n<li>Locally caching the remote HTML so you’re not refetching it on every page load.</li>\\n<li>Being able to <em>create</em> a root node in the remote page’s HTML if it doesn’t already exist (and mount it in the correct spot).</li>\\n</ul>\\n<h2>Tightening the Feedback Loop</h2>\\n<p>Embracing these tactics has done some wonders for shrinking the formerly gigantic feedback loop we’d otherwise need to navigate when building in this sort of architecture. Hoping it does the same for you!</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 13,
        "title": "Evading Goodhart’s Law in My Personal Life",
        "slug": "evading-goodharts-law",
        "html": "<p>A few months ago, I stumbled across <a href=\"https://en.wikipedia.org/wiki/Goodhart%27s_law\" target=\"_blank\" rel=\"noopener\">Goodhart’s Law</a>:</p>\n<p><em>When a measure becomes a target, it ceases to be a good measure.</em></p>\n<p>An example: The owner of a business wants his company to become a reputable brand on Twitter. To get there, he begins rewarding his social team for the number of followers the account accumulates. Over time, that number goes through the roof. There’s celebration!</p>\n<p>But then the owner skims through the tweets. He’s frustrated to see a high ratio of click bait with an overabundance of spammy hashtags. And on top of that, most of the new followers are bots or totally outside the company’s target market. Improving the <strong>measurement</strong> was a success, but the reaching the <strong>objective</strong> — growth as a <em>reputable</em> brand on Twitter — was a failure.</p>\n<p>Jonathan Smart <a href=\"https://www.linkedin.com/posts/jonathansmart_bvssh-activity-6938086576065265664-bmTO\" target=\"_blank\" rel=\"noopener\">shared this illustration</a> on LinkedIn a while back. It captures the spirit of the idea perfectly.</p>\n<p><img src='/proxy/18658446-e9bf-42e6-ab99-bda7923304c7' alt='' loading='lazy' /></p>\n<p>This phenomenon reveals some noteworthy things about us:</p>\n<p><strong>First, we’re good at optimizing for specific outcomes.</strong></p>\n<p>Usually, that’s a good thing. But if we’re not careful, it risks yielding some unintended consequences.</p>\n<p>Consider high-stakes testing in schools. When standardized test scores are used to judge the performance of students and the effectiveness of teachers, classroom energy pivots from thoroughly teaching the material to <a href=\"https://www.usnews.com/news/national-news/articles/2017-11-13/better-tests-dont-lead-to-better-teaching-study-finds\" target=\"_blank\" rel=\"noopener\">preparing students to test well</a>. Two very different things. Schools are given the definition of success, and anything that doesn’t help achieve that end falls out of focus. No one intends for it to happen, but it does.</p>\n<p>The story of the SEO industry also bears witness to this. Years ago, web content creators figured out that filling a site with (at least partially) relevant keywords and building a network of backlinks can boost its page rank. Knowing this, energies yet again shifted — this time from creating high-quality, engaging content to optimizing for these metrics. Keyword stuffing became a thing. Link farms were born. And eventually, Google and other search engines responded to these “<a href=\"https://blog.hubspot.com/marketing/black-hat-seo\" target=\"_blank\" rel=\"noopener\">black hat SEO</a>” tactics by either dampening the benefit, or straight-up penalizing sites for practicing them.</p>\n<p>The takeaway is that when we are so dead-focused on a particular metric (or small set of them), the underlying <em>purpose</em> of that metric (a good education, strong content, etc.) can fade into our peripheral, perhaps disappearing altogether. If you’ve heard of the <a href=\"https://en.wikipedia.org/wiki/Troxler%27s_fading\" target=\"_blank\" rel=\"noopener\">Troxler effect</a>, it should feel similar:</p>\n<blockquote>\n<p>When one fixates on a particular point for even a short period of time, an unchanging stimulus away from the fixation point will fade away and disappear.</p>\n</blockquote>\n<p>TL;DR: Stare at something long enough and you’ll become blind to everything around it.</p>\n<p>Try it out by focusing on the black cross in the image below. After staring for a while, if you’re a normal human, the pink, fuzzy dots will vanish:</p>\n<p><img src='/proxy/a4e17035-f2ec-479d-a2c3-cc4b9102ce6d' alt='' loading='lazy' /></p>\n<p>You probably did a really good job ensuring the black cross didn’t sneak away. Nice work! But you likely also lost sight of what made the image interesting.</p>\n<p><strong>Second, we’re picky (and lazy) about what we choose to measure,</strong> gravitating toward the things are simple and quantifiable (counting is easy). This shouldn’t be surprising. Many aims are difficult to reason about without hard numbers. Take “brand influence.” We know that winning in this area goes beyond revenue, follower count, or market share. But metrics like these are all we have when trying to get our heads around such a concept.</p>\n<p>As a consequence, though, it’s easy to fall into some sort of analytical <a href=\"https://en.wikipedia.org/wiki/Streetlight_effect\" target=\"_blank\" rel=\"noopener\">streetlight effect</a>, using certain measurements to track progress for no other reason than them being the ones within reach. It’s a common challenge with any objective worth pursuing. We measure what we can monitor, at the risk of leaving out other elusive, unquantifiable, but meaningful indicators.</p>\n<p><strong>Third, we’re quick to assume there’s two-way causality between events.</strong></p>\n<p>We tend to believe that…</p>\n<p>“If we meet an <strong>objective</strong>, our <strong>measurement</strong> moves up.”</p>\n<p>… will also make for the inverse:</p>\n<p>“If we make our <strong>measurement</strong> move up, we will have met our <strong>objective</strong>.”</p>\n<p>But the <a href=\"https://en.wikipedia.org/wiki/Questionable_cause\" target=\"_blank\" rel=\"noopener\">Questionable Cause fallacy</a> and <a href=\"https://www.indy100.com/viral/bizarre-correlations-that-will-leave-you-wishing-nicolas-cage-would-retire-7240456\" target=\"_blank\" rel=\"noopener\">probably Nicolas Cage</a> say this isn’t always the case. <em>A</em> may cause <em>B</em>, but <em>B</em> will not necessarily cause <em>A</em>. And sometimes, they aren’t causally related in either direction, but simply share some other correlation that tricks us into thinking they’re really tied to the same lever. It’s a hard tendency to break when we’re so eager to grasp for something we can be confident will lead to an outcome.</p>\n<h2>Goodhart Gets Personal</h2>\n<p>All of this is usually discussed in the context of public policy, business strategy, and other boring grown-up topics. But as the it rolled around in my head, I began catching this law rear its head in several areas of my life (like, all of them), and I was very much taken aback. I started to notice how often I think things like this:</p>\n<ul>\n<li><em><strong>If I run more miles, I know I’ll be healthier.</strong></em> But then I start religiously obsessing over getting my runs in, compromising other areas of my well-being. Rather than eat lunch, I go on a run. I sacrifice sleep to squeeze in a few more miles. My <a href=\"https://www.strava.com/athletes/27922666\" target=\"_blank\" rel=\"noopener\">Strava account looks great</a>, but it’s questionable whether I’m actually healthier.</li>\n<li><em><strong>If I read more books, I know I’ll be smarter.</strong></em> But then I find myself gravitating toward shorter books with shallow content, instead of substantive ones that challenge me to think. I start skimming pages rather than wrestling with them. None of the concepts stick because I’m always looking forward to crossing off another book from my list. I’m reading more, but only marginally better off for it.</li>\n<li><em><strong>If I spend more time with my kids, I’ll strengthen my relationship with them.</strong></em> But then the time I do spend with them becomes hollow. There’s physical proximity, but not much more. We’ll spend an entire day together, but my focus will be on various projects in the garage while they bike on their own in the driveway. I’m “with” them, but not in a way that actually means anything. Again, the numbers are good, but the objective fails.</li>\n</ul>\n<p>None of the aims in this non-exhaustive list are inherently bad. In fact, I think they’re all <em>good</em>. <strong>But if they become the end goal themselves, my efforts become little more than an exercise in vanity.</strong> And even if these things do help to propel me toward some deeper purpose, my mind can become so fixated on moving a needle that it’s impossible for me to notice the real impact anyway. I’m blinded by the satisfaction of pulling something off. My life becomes one big demonstration of the Troxler effect.</p>\n<h2>Spiritual Parallels</h2>\n<p>I can’t help but see similarities in how the Bible speaks of faith and works. Rather than being the ultimate sole objective in the life of a Christian, works should overflow <em>out of</em> our faith as a byproduct. They’re a necessary side effect of the best objective having already been achieved by Christ:</p>\n<blockquote>\n<p>So also faith by itself, if it does not have works, is dead. But someone will say, ‘You have faith and I have works.’ Show me your faith apart from your works, and I will show you my faith by my works.</p>\n</blockquote>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">James 2:17-18 (ESV)</code></pre></div>\n<p>And there’s no two-way causality here. Flipping the order will get you nowhere. Jesus is pretty direct:</p>\n<blockquote>\n<p>Not everyone who says to me, ‘Lord, Lord,’ will enter the kingdom of heaven, but the one who does the will of my Father who is in heaven. On that day many will say to me, ‘Lord, Lord, did we not prophesy in your name, and cast out demons in your name and do many mighty works in your name’ And then will I declare to them, ‘I never knew you; depart from me, you workers of lawlessness.’</p>\n</blockquote>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">Matthew 7:21–23 (ESV)</code></pre></div>\n<p>You can show up with the results, but unless they’re aligned with and driven by something (someone) greater, they’re <em>worthless</em>.</p>\n<h2>Skirting the Law</h2>\n<p>Given how natural it is, I don’t think you can just “decide” not to succumb to these forces. But there do seem to be some good approaches to warding them off. Here are the favorites I’ve come across.</p>\n<p><strong>Diversify how you measure for success.</strong></p>\n<p>There’s a simple way to the short-circuit the Troxler effect: continually shift your focus, just a little bit, every so often. Test it yourself by going back up to that image and staring again. But this time, make little shifts in focus around the cross, always maintaining it within your direct view. The diversification of focus will prevent anything from fading away, no matter how long you’re staring. You get to keep an eye on the cross without losing site of the peripheral details.</p>\n<p>Similarly, <a href=\"https://builtin.com/data-science/goodharts-law\" target=\"_blank\" rel=\"noopener\">diversifying your measurements</a> can provide a more comprehensive picture of whether you’re hitting the mark without losing sight of the objective. For that business owner looking to build his brand’s influence on Twitter, those might include:</p>\n<ul>\n<li>The engagement rate of Twitter followers (likes, replies, retweets).</li>\n<li>The ratio of followers who are likely to be bots.</li>\n<li>The fraction of tweets engaging with other users vs. just one-off posts.</li>\n</ul>\n<p>Or, for me looking to strengthen my relationship with my kids:</p>\n<ul>\n<li>The frequency at which they ask me to play a game with them.</li>\n<li>The number of times they immediately go to me when they’re hurt, scared, or worried.</li>\n<li>How often they want to show me the artwork they’ve made or the new trick they learned on the climbing dome.</li>\n</ul>\n<p>Shake up your measurements, and you’ll end up with a more whole, accurate view of how well you’re actually pulling things off.</p>\n<p><strong>Second, track the untrackable.</strong></p>\n<p>We’re missing something if we to bind the success of every objective to something we can count; the nature of some aims make it impossible to do so. This is the entire essence of the <a href=\"https://en.wikipedia.org/wiki/McNamara_fallacy\" target=\"_blank\" rel=\"noopener\">McNamara Fallacy</a>, named for the former U.S. Secretary of Defense, who was known to judge the success of the Vietnam War exclusively by measurements like body counts. He would adamantly dismiss any metric that couldn’t be quantified.</p>\n<p>But in reality, some of the most valuable metrics you can chase are completely subjective but just as telling.</p>\n<p>For the company’s brand influence, maybe it’s hearing how helpful a follower found its content to be in a certain area of life. Or maybe it’s noticing the depth of the questions you get from others in the industry, clearly hungry to learn from your efforts.</p>\n<p>For my kids and me, that might mean watching the way they greet me when I come home from work. Or maybe it’s paying attention to the inflection of their voice when they come to me after they’ve screwed up. Unquantifiable, but immensely valuable.</p>\n<p><strong>Finally, maybe just don’t measure.</strong></p>\n<p>Running has always been somewhat of a pressure release valve for me. A means physically resetting and shaking off stress. For these reasons among others, I enjoy it.</p>\n<p>But there was a season when the numbers got in the way. While training for races, the enjoyment I got out of it was displaced by the pressure to hit a certain mile count or pace. Rather than looking forward to getting on the road, I was eager for it to be over. I started to question whether contemptuously squeezing the stats out of a run was worth the feedback I’d get when I’d eventually post a picture of a race medal to Instagram.</p>\n<p>Depending on the circumstances, maybe measuring an output at all does a disgrace to the real objective. Maybe the thing you’re measuring are just gifts, and aren’t meant to be monitored, but simply enjoyed.</p>\n<p>I wonder if Paul’s getting at something like this in Galatians 5. It’s in the context of the freedom Christ has achieved <em>for</em> us, allowing us to no longer live in submission to “a yoke of slavery” (v1). Being free, we are called not to live by the flesh, but by the Spirit. It’s here where Paul lists the “works” of the former:</p>\n<blockquote>\n<p>Now the works of the flesh are evident: sexual immorality, impurity, sensuality, idolatry, sorcery, enmity, strife, jealousy, fits of anger, rivalries, dissensions, divisions, envy, drunkenness, orgies, and things like these. I warn you, as I warned you before, that those who do, such things will not inherit the kingdom of God.</p>\n</blockquote>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">Galations 5:19-21</code></pre></div>\n<p>But later on when describing life by the Spirit, he provides another list. This time, they’re notably described as “fruit.”</p>\n<blockquote>\n<p>But the fruit of the Spirit is love, joy, peace, patience, kindness, goodness, faithfulness, gentleness, self-control; against such things there is no law.</p>\n</blockquote>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">Galations 5:22-23</code></pre></div>\n<p>“Works” is a something I do. “Fruit” is something I harvest. It’s an output indicative of choosing to live by something holy rather than ungodly, sure. But more than anything else, that verse reads to me like those things are <em>gifts</em>. The work is done, and I’m simply invited to enjoy them in gratitude.</p>\n<p>I’ve seen (and done so myself) people use this passage as some sort of litmus test for authentic Christianity — a “measurement” in the Goodhart sense. I don’t want to dismiss that altogether, but if that’s all we see in this passage, I think we’re missing the point. That list of things isn’t just evidence of our sanctification. They’re good things that result from choosing to live under a certain Authority. Knowing this makes me breathe more easily, both on the road &#x26; off.</p>\n<h2>Be Not Deceived</h2>\n<p>There’s a hint of irony in writing this very post, because I’ll probably fall prey to Goodhart’s law by doing so. I’ll walk away from publishing this with a boost of achievement. My total post count will go up. I’ll get some site hits. Maybe some comments. And I’ll yet again deceive myself into believing that all those metrics are indicative of something greater I’ve achieved as a result. What’s extra rich is that I don’t even know what that “something” is. I’ve just become so conditioned to focus on the numbers that it really doesn’t matter anymore.</p>\n<p>It should go without saying: the habit isn’t going anywhere. But at the very least, I’m hoping that reflecting on all of this will help crack the blinds of awareness and lead me to catch it more frequently in my daily life. And maybe with enough practice, more and more fuzzy, pink dots will come back into view.</p>\n",
        "feature_image": "https://images.pexels.com/photos/171195/pexels-photo-171195.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=1260&amp;h=750&amp;dpr=2",
        "status": "published",
        "created_at": 1659416400000,
        "published_at": 1659416400000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>A few months ago, I stumbled across <a href=\\\"https://en.wikipedia.org/wiki/Goodhart%27s_law\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Goodhart’s Law</a>:</p>\\n<p><em>When a measure becomes a target, it ceases to be a good measure.</em></p>\\n<p>An example: The owner of a business wants his company to become a reputable brand on Twitter. To get there, he begins rewarding his social team for the number of followers the account accumulates. Over time, that number goes through the roof. There’s celebration!</p>\\n<p>But then the owner skims through the tweets. He’s frustrated to see a high ratio of click bait with an overabundance of spammy hashtags. And on top of that, most of the new followers are bots or totally outside the company’s target market. Improving the <strong>measurement</strong> was a success, but the reaching the <strong>objective</strong> — growth as a <em>reputable</em> brand on Twitter — was a failure.</p>\\n<p>Jonathan Smart <a href=\\\"https://www.linkedin.com/posts/jonathansmart_bvssh-activity-6938086576065265664-bmTO\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">shared this illustration</a> on LinkedIn a while back. It captures the spirit of the idea perfectly.</p>\\n<p><img src='/proxy/18658446-e9bf-42e6-ab99-bda7923304c7' alt='' loading='lazy' /></p>\\n<p>This phenomenon reveals some noteworthy things about us:</p>\\n<p><strong>First, we’re good at optimizing for specific outcomes.</strong></p>\\n<p>Usually, that’s a good thing. But if we’re not careful, it risks yielding some unintended consequences.</p>\\n<p>Consider high-stakes testing in schools. When standardized test scores are used to judge the performance of students and the effectiveness of teachers, classroom energy pivots from thoroughly teaching the material to <a href=\\\"https://www.usnews.com/news/national-news/articles/2017-11-13/better-tests-dont-lead-to-better-teaching-study-finds\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">preparing students to test well</a>. Two very different things. Schools are given the definition of success, and anything that doesn’t help achieve that end falls out of focus. No one intends for it to happen, but it does.</p>\\n<p>The story of the SEO industry also bears witness to this. Years ago, web content creators figured out that filling a site with (at least partially) relevant keywords and building a network of backlinks can boost its page rank. Knowing this, energies yet again shifted — this time from creating high-quality, engaging content to optimizing for these metrics. Keyword stuffing became a thing. Link farms were born. And eventually, Google and other search engines responded to these “<a href=\\\"https://blog.hubspot.com/marketing/black-hat-seo\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">black hat SEO</a>” tactics by either dampening the benefit, or straight-up penalizing sites for practicing them.</p>\\n<p>The takeaway is that when we are so dead-focused on a particular metric (or small set of them), the underlying <em>purpose</em> of that metric (a good education, strong content, etc.) can fade into our peripheral, perhaps disappearing altogether. If you’ve heard of the <a href=\\\"https://en.wikipedia.org/wiki/Troxler%27s_fading\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Troxler effect</a>, it should feel similar:</p>\\n<blockquote>\\n<p>When one fixates on a particular point for even a short period of time, an unchanging stimulus away from the fixation point will fade away and disappear.</p>\\n</blockquote>\\n<p>TL;DR: Stare at something long enough and you’ll become blind to everything around it.</p>\\n<p>Try it out by focusing on the black cross in the image below. After staring for a while, if you’re a normal human, the pink, fuzzy dots will vanish:</p>\\n<p><img src='/proxy/a4e17035-f2ec-479d-a2c3-cc4b9102ce6d' alt='' loading='lazy' /></p>\\n<p>You probably did a really good job ensuring the black cross didn’t sneak away. Nice work! But you likely also lost sight of what made the image interesting.</p>\\n<p><strong>Second, we’re picky (and lazy) about what we choose to measure,</strong> gravitating toward the things are simple and quantifiable (counting is easy). This shouldn’t be surprising. Many aims are difficult to reason about without hard numbers. Take “brand influence.” We know that winning in this area goes beyond revenue, follower count, or market share. But metrics like these are all we have when trying to get our heads around such a concept.</p>\\n<p>As a consequence, though, it’s easy to fall into some sort of analytical <a href=\\\"https://en.wikipedia.org/wiki/Streetlight_effect\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">streetlight effect</a>, using certain measurements to track progress for no other reason than them being the ones within reach. It’s a common challenge with any objective worth pursuing. We measure what we can monitor, at the risk of leaving out other elusive, unquantifiable, but meaningful indicators.</p>\\n<p><strong>Third, we’re quick to assume there’s two-way causality between events.</strong></p>\\n<p>We tend to believe that…</p>\\n<p>“If we meet an <strong>objective</strong>, our <strong>measurement</strong> moves up.”</p>\\n<p>… will also make for the inverse:</p>\\n<p>“If we make our <strong>measurement</strong> move up, we will have met our <strong>objective</strong>.”</p>\\n<p>But the <a href=\\\"https://en.wikipedia.org/wiki/Questionable_cause\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Questionable Cause fallacy</a> and <a href=\\\"https://www.indy100.com/viral/bizarre-correlations-that-will-leave-you-wishing-nicolas-cage-would-retire-7240456\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">probably Nicolas Cage</a> say this isn’t always the case. <em>A</em> may cause <em>B</em>, but <em>B</em> will not necessarily cause <em>A</em>. And sometimes, they aren’t causally related in either direction, but simply share some other correlation that tricks us into thinking they’re really tied to the same lever. It’s a hard tendency to break when we’re so eager to grasp for something we can be confident will lead to an outcome.</p>\\n<h2>Goodhart Gets Personal</h2>\\n<p>All of this is usually discussed in the context of public policy, business strategy, and other boring grown-up topics. But as the it rolled around in my head, I began catching this law rear its head in several areas of my life (like, all of them), and I was very much taken aback. I started to notice how often I think things like this:</p>\\n<ul>\\n<li><em><strong>If I run more miles, I know I’ll be healthier.</strong></em> But then I start religiously obsessing over getting my runs in, compromising other areas of my well-being. Rather than eat lunch, I go on a run. I sacrifice sleep to squeeze in a few more miles. My <a href=\\\"https://www.strava.com/athletes/27922666\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Strava account looks great</a>, but it’s questionable whether I’m actually healthier.</li>\\n<li><em><strong>If I read more books, I know I’ll be smarter.</strong></em> But then I find myself gravitating toward shorter books with shallow content, instead of substantive ones that challenge me to think. I start skimming pages rather than wrestling with them. None of the concepts stick because I’m always looking forward to crossing off another book from my list. I’m reading more, but only marginally better off for it.</li>\\n<li><em><strong>If I spend more time with my kids, I’ll strengthen my relationship with them.</strong></em> But then the time I do spend with them becomes hollow. There’s physical proximity, but not much more. We’ll spend an entire day together, but my focus will be on various projects in the garage while they bike on their own in the driveway. I’m “with” them, but not in a way that actually means anything. Again, the numbers are good, but the objective fails.</li>\\n</ul>\\n<p>None of the aims in this non-exhaustive list are inherently bad. In fact, I think they’re all <em>good</em>. <strong>But if they become the end goal themselves, my efforts become little more than an exercise in vanity.</strong> And even if these things do help to propel me toward some deeper purpose, my mind can become so fixated on moving a needle that it’s impossible for me to notice the real impact anyway. I’m blinded by the satisfaction of pulling something off. My life becomes one big demonstration of the Troxler effect.</p>\\n<h2>Spiritual Parallels</h2>\\n<p>I can’t help but see similarities in how the Bible speaks of faith and works. Rather than being the ultimate sole objective in the life of a Christian, works should overflow <em>out of</em> our faith as a byproduct. They’re a necessary side effect of the best objective having already been achieved by Christ:</p>\\n<blockquote>\\n<p>So also faith by itself, if it does not have works, is dead. But someone will say, ‘You have faith and I have works.’ Show me your faith apart from your works, and I will show you my faith by my works.</p>\\n</blockquote>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-unknown\\\"><code class=\\\"language-unknown\\\">James 2:17-18 (ESV)</code></pre></div>\\n<p>And there’s no two-way causality here. Flipping the order will get you nowhere. Jesus is pretty direct:</p>\\n<blockquote>\\n<p>Not everyone who says to me, ‘Lord, Lord,’ will enter the kingdom of heaven, but the one who does the will of my Father who is in heaven. On that day many will say to me, ‘Lord, Lord, did we not prophesy in your name, and cast out demons in your name and do many mighty works in your name’ And then will I declare to them, ‘I never knew you; depart from me, you workers of lawlessness.’</p>\\n</blockquote>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-unknown\\\"><code class=\\\"language-unknown\\\">Matthew 7:21–23 (ESV)</code></pre></div>\\n<p>You can show up with the results, but unless they’re aligned with and driven by something (someone) greater, they’re <em>worthless</em>.</p>\\n<h2>Skirting the Law</h2>\\n<p>Given how natural it is, I don’t think you can just “decide” not to succumb to these forces. But there do seem to be some good approaches to warding them off. Here are the favorites I’ve come across.</p>\\n<p><strong>Diversify how you measure for success.</strong></p>\\n<p>There’s a simple way to the short-circuit the Troxler effect: continually shift your focus, just a little bit, every so often. Test it yourself by going back up to that image and staring again. But this time, make little shifts in focus around the cross, always maintaining it within your direct view. The diversification of focus will prevent anything from fading away, no matter how long you’re staring. You get to keep an eye on the cross without losing site of the peripheral details.</p>\\n<p>Similarly, <a href=\\\"https://builtin.com/data-science/goodharts-law\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">diversifying your measurements</a> can provide a more comprehensive picture of whether you’re hitting the mark without losing sight of the objective. For that business owner looking to build his brand’s influence on Twitter, those might include:</p>\\n<ul>\\n<li>The engagement rate of Twitter followers (likes, replies, retweets).</li>\\n<li>The ratio of followers who are likely to be bots.</li>\\n<li>The fraction of tweets engaging with other users vs. just one-off posts.</li>\\n</ul>\\n<p>Or, for me looking to strengthen my relationship with my kids:</p>\\n<ul>\\n<li>The frequency at which they ask me to play a game with them.</li>\\n<li>The number of times they immediately go to me when they’re hurt, scared, or worried.</li>\\n<li>How often they want to show me the artwork they’ve made or the new trick they learned on the climbing dome.</li>\\n</ul>\\n<p>Shake up your measurements, and you’ll end up with a more whole, accurate view of how well you’re actually pulling things off.</p>\\n<p><strong>Second, track the untrackable.</strong></p>\\n<p>We’re missing something if we to bind the success of every objective to something we can count; the nature of some aims make it impossible to do so. This is the entire essence of the <a href=\\\"https://en.wikipedia.org/wiki/McNamara_fallacy\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">McNamara Fallacy</a>, named for the former U.S. Secretary of Defense, who was known to judge the success of the Vietnam War exclusively by measurements like body counts. He would adamantly dismiss any metric that couldn’t be quantified.</p>\\n<p>But in reality, some of the most valuable metrics you can chase are completely subjective but just as telling.</p>\\n<p>For the company’s brand influence, maybe it’s hearing how helpful a follower found its content to be in a certain area of life. Or maybe it’s noticing the depth of the questions you get from others in the industry, clearly hungry to learn from your efforts.</p>\\n<p>For my kids and me, that might mean watching the way they greet me when I come home from work. Or maybe it’s paying attention to the inflection of their voice when they come to me after they’ve screwed up. Unquantifiable, but immensely valuable.</p>\\n<p><strong>Finally, maybe just don’t measure.</strong></p>\\n<p>Running has always been somewhat of a pressure release valve for me. A means physically resetting and shaking off stress. For these reasons among others, I enjoy it.</p>\\n<p>But there was a season when the numbers got in the way. While training for races, the enjoyment I got out of it was displaced by the pressure to hit a certain mile count or pace. Rather than looking forward to getting on the road, I was eager for it to be over. I started to question whether contemptuously squeezing the stats out of a run was worth the feedback I’d get when I’d eventually post a picture of a race medal to Instagram.</p>\\n<p>Depending on the circumstances, maybe measuring an output at all does a disgrace to the real objective. Maybe the thing you’re measuring are just gifts, and aren’t meant to be monitored, but simply enjoyed.</p>\\n<p>I wonder if Paul’s getting at something like this in Galatians 5. It’s in the context of the freedom Christ has achieved <em>for</em> us, allowing us to no longer live in submission to “a yoke of slavery” (v1). Being free, we are called not to live by the flesh, but by the Spirit. It’s here where Paul lists the “works” of the former:</p>\\n<blockquote>\\n<p>Now the works of the flesh are evident: sexual immorality, impurity, sensuality, idolatry, sorcery, enmity, strife, jealousy, fits of anger, rivalries, dissensions, divisions, envy, drunkenness, orgies, and things like these. I warn you, as I warned you before, that those who do, such things will not inherit the kingdom of God.</p>\\n</blockquote>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-unknown\\\"><code class=\\\"language-unknown\\\">Galations 5:19-21</code></pre></div>\\n<p>But later on when describing life by the Spirit, he provides another list. This time, they’re notably described as “fruit.”</p>\\n<blockquote>\\n<p>But the fruit of the Spirit is love, joy, peace, patience, kindness, goodness, faithfulness, gentleness, self-control; against such things there is no law.</p>\\n</blockquote>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-unknown\\\"><code class=\\\"language-unknown\\\">Galations 5:22-23</code></pre></div>\\n<p>“Works” is a something I do. “Fruit” is something I harvest. It’s an output indicative of choosing to live by something holy rather than ungodly, sure. But more than anything else, that verse reads to me like those things are <em>gifts</em>. The work is done, and I’m simply invited to enjoy them in gratitude.</p>\\n<p>I’ve seen (and done so myself) people use this passage as some sort of litmus test for authentic Christianity — a “measurement” in the Goodhart sense. I don’t want to dismiss that altogether, but if that’s all we see in this passage, I think we’re missing the point. That list of things isn’t just evidence of our sanctification. They’re good things that result from choosing to live under a certain Authority. Knowing this makes me breathe more easily, both on the road &#x26; off.</p>\\n<h2>Be Not Deceived</h2>\\n<p>There’s a hint of irony in writing this very post, because I’ll probably fall prey to Goodhart’s law by doing so. I’ll walk away from publishing this with a boost of achievement. My total post count will go up. I’ll get some site hits. Maybe some comments. And I’ll yet again deceive myself into believing that all those metrics are indicative of something greater I’ve achieved as a result. What’s extra rich is that I don’t even know what that “something” is. I’ve just become so conditioned to focus on the numbers that it really doesn’t matter anymore.</p>\\n<p>It should go without saying: the habit isn’t going anywhere. But at the very least, I’m hoping that reflecting on all of this will help crack the blinds of awareness and lead me to catch it more frequently in my daily life. And maybe with enough practice, more and more fuzzy, pink dots will come back into view.</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 14,
        "title": "Reminding Myself that Maps Store Objects by Reference Too",
        "slug": "maps-store-objects-by-reference",
        "html": "<p>No matter how many times I revisit it, I have pretty consistent track record of being tripped up by how JavaScript assigns values to variables.</p>\n<h2>Primitives: Assigned by Value</h2>\n<p>Primitive values (numbers, strings, etc.) are assigned by <em>value,</em> meaning that assigning one variable to another variable assigned to a primitive value will result in <em>two, distinct values</em> being stored in memory. The entire <em>value</em> is copied.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> number1 <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span> \n<span class=\"token keyword\">const</span> number2 <span class=\"token operator\">=</span> number1<span class=\"token punctuation\">;</span> \n\n<span class=\"token comment\">// Variable / Memory Value: </span>\n<span class=\"token comment\">// number1 -> 100</span>\n<span class=\"token comment\">// number2 -> 100</span>\n</code></pre></div>\n<h2>Objects: Assigned by Reference</h2>\n<p>Everything else (objects, including functions, arrays, etc.) are assigned by <em>reference</em>. Assigning a newly created object to a variable is actually creating a <em>reference</em> to that object’s location in memory. Any further variable assignments will also point to that exact same location.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> object1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">someProperty</span><span class=\"token operator\">:</span> <span class=\"token string\">'some value'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> object2 <span class=\"token operator\">=</span> object1<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Variable / Memory Value: </span>\n<span class=\"token comment\">// object1 -> { someProperty: 'some value' }</span>\n<span class=\"token comment\">// object2 -> object1</span>\n</code></pre></div>\n<p>And that’s why things like this work. If you mess with the properties of an object — no matter which variable is referencing it — that central value in memory will be changed, impacting every variable pointing to it.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> object1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">someProperty</span><span class=\"token operator\">:</span> <span class=\"token string\">'some value'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> object2 <span class=\"token operator\">=</span> object1<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> object3 <span class=\"token operator\">=</span> object2<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> object4 <span class=\"token operator\">=</span> object3<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> object5 <span class=\"token operator\">=</span> object4<span class=\"token punctuation\">;</span>\n\nobject5<span class=\"token punctuation\">.</span><span class=\"token property-access\">someProperty</span> <span class=\"token operator\">=</span> <span class=\"token string\">'some OTHER value!'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>object1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// { someProperty: 'some OTHER value!' }</span>\n</code></pre></div>\n<h2>A Map() Follows the Same Rules</h2>\n<p>This is a pretty fundamental concept in JavaScript, but that didn’t stop me from forgetting about it while dealing with a <code>Map()</code>. Just like a regular, old variable, a value inside a Map() is stored differently depending on the value’s type — primitive or otherwise. From <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map/get\" target=\"_blank\" rel=\"noopener\">MDN</a>:</p>\n<blockquote>\n<p>If the value that is associated to the provided key is an object, then you will get a reference to that object and any change made to that object will effectively modify it inside the Map object.</p>\n</blockquote>\n<p>In my case, I was working with somthing like this (highly contrived):</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> aMap <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> anObj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'Alex'</span>\n<span class=\"token punctuation\">}</span>\n\naMap<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">,</span> anObj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\naMap<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'b'</span><span class=\"token punctuation\">,</span> anObj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\naMap<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'c'</span><span class=\"token punctuation\">,</span> anObj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\naMap<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'c'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">name</span> <span class=\"token operator\">=</span> <span class=\"token string\">'Bob'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">table</span><span class=\"token punctuation\">(</span><span class=\"token known-class-name class-name\">Array</span><span class=\"token punctuation\">.</span><span class=\"token keyword module\">from</span><span class=\"token punctuation\">(</span>aMap<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">entries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>While I was intending to modify the <code>name</code> only by on the <code>a</code> key, the results prints as follows:</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\">| (index) |  0  |        1        |\n-----------------------------------\n|    0    | 'a' | { name: 'Bob' } |\n|    1    | 'b' | { name: 'Bob' } |\n|    2    | 'c' | { name: 'Bob' } |\n</code></pre></div>\n<p>Bob is everywhere. In hindsight, this is no surprise. <em>Primitives by value, objects by reference.</em> If I want these values to be updated independently, the answer is to duplicate the object, reserving it a new, distinct place in memory:</p>\n<div class=\"remark-highlight\"><pre class=\"language-diff\"><code class=\"language-diff\">const aMap = new Map();\nconst anObj = {\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> name: 'Alex'</span>\n<span class=\"token line\"></span></span>}\n\n<span class=\"token deleted-sign deleted\"><span class=\"token prefix deleted\">-</span><span class=\"token line\"> aMap.set('a', anObj);</span>\n<span class=\"token line\"></span></span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\"> aMap.set('a', {...anObj});</span>\n<span class=\"token line\"></span></span><span class=\"token deleted-sign deleted\"><span class=\"token prefix deleted\">-</span><span class=\"token line\"> aMap.set('b', anObj);</span>\n<span class=\"token line\"></span></span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\"> aMap.set('b', {...anObj});</span>\n<span class=\"token line\"></span></span><span class=\"token deleted-sign deleted\"><span class=\"token prefix deleted\">-</span><span class=\"token line\"> aMap.set('c', anObj);</span>\n<span class=\"token line\"></span></span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\"> aMap.set('c', {...anObj});</span>\n<span class=\"token line\"></span></span>\naMap.get('c').name = 'Bob';\n\nconsole.table(Array.from(aMap.entries()));\n</code></pre></div>\n<p>And with that, you’re released to update properties freely:</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\">| (index) |  0  |        1         |\n------------------------------------\n|    0    | 'a' | { name: 'Alex' }  |\n|    1    | 'b' | { name: 'Alex' } |\n|    2    | 'c' | { name: 'Bob' } |\n</code></pre></div>\n<p>Just one “Bob,” as desired.</p>\n<h2>Only a Matter of Time</h2>\n<p>Stay tuned for another post basically covering the same concept within another context after it inevitably trips me up again.</p>\n",
        "feature_image": "https://images.pexels.com/photos/163726/belgium-antwerp-shipping-container-163726.jpeg?auto=compress&amp;cs=tinysrgb&amp;w=1260&amp;h=750&amp;dpr=2",
        "status": "published",
        "created_at": 1655269200000,
        "published_at": 1655269200000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>No matter how many times I revisit it, I have pretty consistent track record of being tripped up by how JavaScript assigns values to variables.</p>\\n<h2>Primitives: Assigned by Value</h2>\\n<p>Primitive values (numbers, strings, etc.) are assigned by <em>value,</em> meaning that assigning one variable to another variable assigned to a primitive value will result in <em>two, distinct values</em> being stored in memory. The entire <em>value</em> is copied.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> number1 <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">100</span><span class=\\\"token punctuation\\\">;</span> \\n<span class=\\\"token keyword\\\">const</span> number2 <span class=\\\"token operator\\\">=</span> number1<span class=\\\"token punctuation\\\">;</span> \\n\\n<span class=\\\"token comment\\\">// Variable / Memory Value: </span>\\n<span class=\\\"token comment\\\">// number1 -> 100</span>\\n<span class=\\\"token comment\\\">// number2 -> 100</span>\\n</code></pre></div>\\n<h2>Objects: Assigned by Reference</h2>\\n<p>Everything else (objects, including functions, arrays, etc.) are assigned by <em>reference</em>. Assigning a newly created object to a variable is actually creating a <em>reference</em> to that object’s location in memory. Any further variable assignments will also point to that exact same location.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> object1 <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token literal-property property\\\">someProperty</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">'some value'</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">const</span> object2 <span class=\\\"token operator\\\">=</span> object1<span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// Variable / Memory Value: </span>\\n<span class=\\\"token comment\\\">// object1 -> { someProperty: 'some value' }</span>\\n<span class=\\\"token comment\\\">// object2 -> object1</span>\\n</code></pre></div>\\n<p>And that’s why things like this work. If you mess with the properties of an object — no matter which variable is referencing it — that central value in memory will be changed, impacting every variable pointing to it.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">let</span> object1 <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token literal-property property\\\">someProperty</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">'some value'</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">let</span> object2 <span class=\\\"token operator\\\">=</span> object1<span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">let</span> object3 <span class=\\\"token operator\\\">=</span> object2<span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">let</span> object4 <span class=\\\"token operator\\\">=</span> object3<span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">let</span> object5 <span class=\\\"token operator\\\">=</span> object4<span class=\\\"token punctuation\\\">;</span>\\n\\nobject5<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">someProperty</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">'some OTHER value!'</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span>object1<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token comment\\\">// { someProperty: 'some OTHER value!' }</span>\\n</code></pre></div>\\n<h2>A Map() Follows the Same Rules</h2>\\n<p>This is a pretty fundamental concept in JavaScript, but that didn’t stop me from forgetting about it while dealing with a <code>Map()</code>. Just like a regular, old variable, a value inside a Map() is stored differently depending on the value’s type — primitive or otherwise. From <a href=\\\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map/get\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">MDN</a>:</p>\\n<blockquote>\\n<p>If the value that is associated to the provided key is an object, then you will get a reference to that object and any change made to that object will effectively modify it inside the Map object.</p>\\n</blockquote>\\n<p>In my case, I was working with somthing like this (highly contrived):</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> aMap <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Map</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">const</span> anObj <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token literal-property property\\\">name</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">'Alex'</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\naMap<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">set</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'a'</span><span class=\\\"token punctuation\\\">,</span> anObj<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\naMap<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">set</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'b'</span><span class=\\\"token punctuation\\\">,</span> anObj<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\naMap<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">set</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'c'</span><span class=\\\"token punctuation\\\">,</span> anObj<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\naMap<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">get</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'c'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">name</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">'Bob'</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">table</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token known-class-name class-name\\\">Array</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword module\\\">from</span><span class=\\\"token punctuation\\\">(</span>aMap<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">entries</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>While I was intending to modify the <code>name</code> only by on the <code>a</code> key, the results prints as follows:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-html\\\"><code class=\\\"language-html\\\">| (index) |  0  |        1        |\\n-----------------------------------\\n|    0    | 'a' | { name: 'Bob' } |\\n|    1    | 'b' | { name: 'Bob' } |\\n|    2    | 'c' | { name: 'Bob' } |\\n</code></pre></div>\\n<p>Bob is everywhere. In hindsight, this is no surprise. <em>Primitives by value, objects by reference.</em> If I want these values to be updated independently, the answer is to duplicate the object, reserving it a new, distinct place in memory:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-diff\\\"><code class=\\\"language-diff\\\">const aMap = new Map();\\nconst anObj = {\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> name: 'Alex'</span>\\n<span class=\\\"token line\\\"></span></span>}\\n\\n<span class=\\\"token deleted-sign deleted\\\"><span class=\\\"token prefix deleted\\\">-</span><span class=\\\"token line\\\"> aMap.set('a', anObj);</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"> aMap.set('a', {...anObj});</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token deleted-sign deleted\\\"><span class=\\\"token prefix deleted\\\">-</span><span class=\\\"token line\\\"> aMap.set('b', anObj);</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"> aMap.set('b', {...anObj});</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token deleted-sign deleted\\\"><span class=\\\"token prefix deleted\\\">-</span><span class=\\\"token line\\\"> aMap.set('c', anObj);</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"> aMap.set('c', {...anObj});</span>\\n<span class=\\\"token line\\\"></span></span>\\naMap.get('c').name = 'Bob';\\n\\nconsole.table(Array.from(aMap.entries()));\\n</code></pre></div>\\n<p>And with that, you’re released to update properties freely:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-html\\\"><code class=\\\"language-html\\\">| (index) |  0  |        1         |\\n------------------------------------\\n|    0    | 'a' | { name: 'Alex' }  |\\n|    1    | 'b' | { name: 'Alex' } |\\n|    2    | 'c' | { name: 'Bob' } |\\n</code></pre></div>\\n<p>Just one “Bob,” as desired.</p>\\n<h2>Only a Matter of Time</h2>\\n<p>Stay tuned for another post basically covering the same concept within another context after it inevitably trips me up again.</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 15,
        "title": "Why I've Had No Regrets Moving from Google Analytics to Plausible",
        "slug": "moving-from-google-analytics-to-plausible",
        "html": "<p>A while ago, I was hanging out with some guys at my buddy Buddy’s (this is actually his first name) house. We were chatting about typical nerd stuff, when Samuel brought up a self-hostable, privacy-minded analytics service he’s been using: <a href=\"https://plausible.io/\" target=\"_blank\" rel=\"noopener\">Plausible</a>. I had never heard of it, but he gave a solid pitch, so I said I’d look into it.</p>\n<p>I didn’t say that just to be polite — I had been on the hunt for an alternative to Google Analytics for some time. I’ve used it for years, but as time has gone on, there’s been increasing pressure to “de-Google” in this way for a few reasons:</p>\n<ul>\n<li>I’ve always felt overwhelmed by the UI and feature set. Way too much for my needs.</li>\n<li>The recommended installation approach has caused it to consistently show up in Lighthouse performance reports as problematic.</li>\n<li>It’s a “free” product that owns all of the data I send through it, and you know what that means.</li>\n</ul>\n<p>I decided to try out the self-hosted version of Plausible, which I put up via Docker Compose on a $5 DigitalOcean droplet. The whole process took ~20 minutes. I don’t think I was ready for how easy and satisfying it was getting it stood up and seeing it in action.</p>\n<p>Looking back, here are the key things I’ve loved about the experience:</p>\n<h3>1. It has thorough documentation.</h3>\n<p>For being as “small” as it is in the analytics space, I was very pleased by how thorough and SEO-friendly Plausible’s documentation is. For the most part, when I needed something, I did a quick Google search with a few keywords, and the first result was <em>exactly</em> what I needed, right in their documentation.</p>\n<p>They appear to do a great job at anticipating the questions and concerns of their users, and solid documentation is the result of that. But some of the credit for this might also be due to the fact that the all of <a href=\"https://github.com/plausible/docs\" target=\"_blank\" rel=\"noopener\">the documentation is available on GitHub</a>, open to pull requests, and updated regularly.</p>\n<p>This all was a refreshing change from using Google Analytics. When searching for somethig for that tool, I’d often find several different sources that roughly relate to what I’m searching for, often scattered throughout Google’s own resources. I’m sure there are reasons for that (wider feature scope, multiple implementation approaches, maturity &#x26; complexity of the product, etc.), but it became a pretty significant point of friction for me, especially when all I wanted to do was get something up &#x26; tracking.</p>\n<h3>2. Its custom event handling is intuitive.</h3>\n<p>For my purposes, I don’t need any sort of complex event or user action analytics. I have (and probably will for quite some time) pretty simple things I’d like to keep track of:</p>\n<ul>\n<li>License purchases for <a href=\"https://typeitjs.com/\" target=\"_blank\" rel=\"noopener\">TypeIt</a></li>\n<li>Signups for <a href=\"https://jamcomments.com/\" target=\"_blank\" rel=\"noopener\">JamComments</a></li>\n<li><a href=\"http://typeitjs.com/docs\" target=\"_blank\" rel=\"noopener\">TypeIt documentation</a> search queries</li>\n<li>Usage of TypeIt’s <a href=\"https://www.typeitjs.com/build-your-own/\" target=\"_blank\" rel=\"noopener\">interactive demo</a></li>\n<li>Something else I’m probably forgetting</li>\n</ul>\n<p>And some of those events have custom data I’d like to attach to each event (ex: the license type someone purchased, or a search query).</p>\n<p>In GA, it <em>seems</em> relatively straightforward to send an event, which varies based on the implementation you’re using (<a href=\"https://developers.google.com/analytics/devguides/collection/gtagjs/events\" target=\"_blank\" rel=\"noopener\">Global Site Tag</a> vs. <a href=\"https://developers.google.com/analytics/devguides/collection/analyticsjs/events\" target=\"_blank\" rel=\"noopener\">“standard”</a>) — I just need to specify an event action, category, label, and value. But in reality, it was a little more complicated to implement. Among my issues:</p>\n<ul>\n<li>With so much documentation for each implementation, it’s easy to get peeved and feel somewhat lost.</li>\n<li>If I wanted to send custom data that’s not numeric, I couldn’t use the <code>value</code> field. Instead, I’d need to set up <a href=\"https://developers.google.com/analytics/devguides/collection/analyticsjs/custom-dims-mets\" target=\"_blank\" rel=\"noopener\">custom dimensions</a>, which, paired with “metrics,” is an entirely different concept to wrap my head around.</li>\n<li>Finding custom event data within the GA admin is a pain. In fact, I never did figure out how to find data I had started to send w/ custom dimensions &#x26; metrics. I quickly grew impatient and confused, largely because it was so difficult to verify that I had even configured everything correctly.</li>\n</ul>\n<p>Primed with this less-than-pleasant experience, Plausible’s custom event API was a godsend. After installing the core Plausible script, it was as simple as setting up the global <code>window.plausible</code> variable:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token operator\">&#x3C;</span>script<span class=\"token operator\">></span><span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">plausible</span> <span class=\"token operator\">=</span> <span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">plausible</span> <span class=\"token operator\">||</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">(</span><span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">plausible</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">q</span> <span class=\"token operator\">=</span> <span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">plausible</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">q</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">push</span><span class=\"token punctuation\">(</span>arguments<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n</code></pre></div>\n<p>… and then sending an event:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">plausible</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Sign Up'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Or, with custom data that pertains certain events.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">plausible</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Purchase'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Optional custom data.</span>\n  <span class=\"token literal-property property\">props</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">product_slug</span><span class=\"token operator\">:</span> <span class=\"token string\">'my-product-slug'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">total</span><span class=\"token operator\">:</span> <span class=\"token number\">44</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token comment\">// Optional callback method fired after event is sent.</span>\n  <span class=\"token function-variable function\">callback</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'it sent!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>After setting up a goal in the Plausible admin, all that data appears in highly-digestible way. Here’s an example of how my “Purchase” event looked at one point:</p>\n<p><img src='/proxy/f4c9a8da-7a77-4f98-a127-6027293108d7' alt='' loading='lazy' /></p>\n<p>Good enough for me. And if I need to created some more complex reports with that data, it’s a matter of <a href=\"https://plausible.io/docs/self-hosting-configuration#database\" target=\"_blank\" rel=\"noopener\">accessing the database</a> and running with it.</p>\n<h3>3. It’s more performant.</h3>\n<p>When I moved from Google Analytics to Plausible on <a href=\"https://typeitjs.com/\" target=\"_blank\" rel=\"noopener\">TypeIt’s site</a>, <a href=\"https://twitter.com/amacarthur/status/1464833420593438725\" target=\"_blank\" rel=\"noopener\">I tweeted</a> about my Lighthouse score improving by eight points. It’s a Gatsby site with a lot of JavaScript in play, and Lighthouse doesn’t report on the actual user experience, but even so, it was a little jarring.</p>\n<p>Some of the reason for this boost was pretty apparent. According Plausible, <a href=\"https://plausible.io/vs-google-analytics#increasing-the-page-weight-and-the-loading-time\" target=\"_blank\" rel=\"noopener\">its script is many times smaller than Google’s</a>, and that means less time downloading &#x26; parsing code. But according to Lighthouse and WebPageTest reports, other factors were due credit as well.</p>\n<p>One of those other factors was the amount of work Google Analytics performs on the main thread, choking out any other processes that may actually support the user’s experience. Here’s a shot of the problem scripts on <a href=\"http://typeitjs.com/\" target=\"_blank\" rel=\"noopener\">typeitjs.com</a>. GA comes in at the third most thread-obnoxious script (divert your eyes from the top two… remember, this is a Gatsby site).</p>\n<p><img src='/proxy/8f230f7b-4365-4196-b616-c1ad1f84efad' alt='' loading='lazy' /></p>\n<p>The other notable factor was the caching policy used by Google to serve its scripts. WebPageTest wasn’t happy about it:</p>\n<p><img src='/proxy/bbab8a1a-e152-45cc-a19b-79b68790696d' alt='' loading='lazy' /></p>\n<p>These concerns don’t magically go away by moving from GA to another provider, but the lightweight and self-hosted nature of Plausible sure makes it easier to mitigate them. Addressing the first concern is automatic, and the second is solved by setting the appropriate caching headers when the script is served from my DigitalOcean droplet.</p>\n<h3>4. SPA page tracking is easier.</h3>\n<p>This is a small perk I didn’t at all expect to see by moving to Plausible, but it’s an appreciated one. By default, Google Analytics collects its data only by executing after a page is loaded. As such, observing a user’s flow through several different pieces is achieved by stitching together the data from subsequent full page loads.</p>\n<p>It’s a fine way to go about it, but also makes it a bit of a hassle to track views in single page applications. In SPAs, there’s often a <em>single</em> page load, after which navigation is handled entirely client-side. They do a good job equipping people to accurately track page views in SPAs by providing <a href=\"https://developers.google.com/analytics/devguides/collection/analyticsjs/single-page-applications\" target=\"_blank\" rel=\"noopener\">good documentation</a> on it. The short of it is that you need to manually send a <code>pageview</code> event whenever client-side navigation occurs.</p>\n<p>For my own NextJS site using the recommended <a href=\"https://support.google.com/analytics/answer/9355662?hl=en\" target=\"_blank\" rel=\"noopener\">Global Site Tag</a> approach, I had to pull that off by listening for a <code>routeChangeComplete</code> event, which looked something like this (stripped down and a little contrived for simplicity):</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">pageView</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">url</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">gtag</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"config\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">GA_TRACKING_ID</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">page_path</span><span class=\"token operator\">:</span> url<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\"><span class=\"token maybe-class-name\">App</span></span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">Component</span><span class=\"token punctuation\">,</span> pageProps <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> router <span class=\"token operator\">=</span> <span class=\"token function\">useRouter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\">// Track each client-side page navigation.</span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleRouteChange</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">url</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token function\">pageView</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    router<span class=\"token punctuation\">.</span><span class=\"token property-access\">events</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"routeChangeComplete\"</span><span class=\"token punctuation\">,</span> handleRouteChange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n      router<span class=\"token punctuation\">.</span><span class=\"token property-access\">events</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">off</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"routeChangeComplete\"</span><span class=\"token punctuation\">,</span> handleRouteChange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>router<span class=\"token punctuation\">.</span><span class=\"token property-access\">events</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\">// Track the initial page load.</span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">pageView</span><span class=\"token punctuation\">(</span><span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">location</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">pathname</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token operator\">&#x3C;</span><span class=\"token maybe-class-name\">Component</span> <span class=\"token punctuation\">{</span><span class=\"token spread operator\">...</span>pageProps<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>It’s nothing terribly complicated, but it’s also something I’d rather not have to worry about myself.</p>\n<p>Thankfully, Plausible takes care of this automatically by piggy-backing on client-side routers’ usage of the History API. In order to simulate page views performed in the context of an SPA, libraries like <a href=\"https://reactrouter.com/\" target=\"_blank\" rel=\"noopener\">react-router</a> will use <code>history.pushState()</code> to place these views into a user’s browser history. Plausible leverages that integration, meaning <a href=\"https://plausible.io/docs/spa-support\" target=\"_blank\" rel=\"noopener\">I don’t have to do </a><a href=\"https://plausible.io/docs/spa-support\" target=\"_blank\" rel=\"noopener\"><em>anything</em></a> to correctly track SPA page views after installing the script (<a href=\"https://plausible.io/docs/script-extensions#plausiblemanualjs\" target=\"_blank\" rel=\"noopener\">unless I want to</a>). It just works!</p>\n<h3>5. My data belongs to me.</h3>\n<p>Google Analytics is mature and feature-rich service, but there’s a reason it’s free — all that data it collects <a href=\"https://policies.google.com/technologies/partner-sites?hl=en-US\" target=\"_blank\" rel=\"noopener\">is used in a wide variety of ways</a> to benefit the business. I don’t have any particular issue with that model in and of itself, but the scope of its implications also doesn’t sit great with me.</p>\n<p>Among Plausible’s selling points, however, are its intentional focuses on privacy and data ownership. <a href=\"https://plausible.io/privacy-focused-web-analytics\" target=\"_blank\" rel=\"noopener\">Its website</a> lists a wealth of ways they lean into that — things like no cookies, no cross-site tracking, no sharing data with any third party, and being able to self-host the entire thing.</p>\n<p>And that also means it’s easy to get my data <em>out</em> of Plausible too, like with its <a href=\"https://plausible.io/docs/stats-api\" target=\"_blank\" rel=\"noopener\">Stats API</a>, which I use to display analytics data on my <a href=\"https://macarthur.me/dashboard\">personal dashboard</a>. One nice thing about self-hosting the tool is that there are virtually no limits to how much of my own data I can request on demand from my droplet. There’s an hourly limit, but even that can be manually increased by accessing the container, logging into the database, and updating a value:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token operator\">--</span> <span class=\"token maybe-class-name\">Log</span> into the database<span class=\"token punctuation\">.</span>\n<span class=\"token property-access\">psql</span> <span class=\"token operator\">-</span><span class=\"token constant\">U</span> postgres <span class=\"token operator\">-</span>d plausible_db\n\n<span class=\"token operator\">--</span> <span class=\"token maybe-class-name\">Update</span> every limit to <span class=\"token number\">10000.</span>\n<span class=\"token constant\">UPDATE</span> api_keys <span class=\"token constant\">SET</span> hourly_request_limit <span class=\"token operator\">=</span> <span class=\"token number\">10000</span>\n</code></pre></div>\n<p>That leaves me feeling like my data really is easily accessible, safe, and <em>mine</em>.</p>\n<h2>6. The data’s more reliable.</h2>\n<p>Ad blockers and privacy-focused browsers (like Brave) are a growing problem for the client-side analytics space. When using either, it’s increasingly common for Google Analytics requests to be blocked by default, impacting the accuracy of your data.</p>\n<p>One approach to address this is proxying analytics requests through your domain, which convinces privacy tools to consider the requests to be trustworthy.</p>\n<p>Wiring this up with Google Analytics is possible, but is neither simple nor maintainable in the long term. It requires serving the analytics script locally (by either proxying it from Google or maintaining a modified copy yourself), and then passing every event request through your domain as well. Modern tooling like serverless functions make it less of a hassle, but even so, it’s tedious and potentially unreliable if/when Google ever pushes updates to the script.</p>\n<p>It’d be remiss of me not to mention the strides Google Analytics is taking to help tackle some of these issues, such as the introduction of <a href=\"https://developers.google.com/tag-platform/tag-manager/server-side\" target=\"_blank\" rel=\"noopener\">server-side tagging</a>. But the amount of time and technical overhead required to take advantage of it is still more than I’m willing to take on for my side projects.</p>\n<p>Plausible, on the other hand, has <a href=\"https://plausible.io/docs/proxy/introduction\" target=\"_blank\" rel=\"noopener\">dedicated documentation</a> on how to proxy its script through your own domain, covering a host of platforms, including two I use a lot — Netlify and Vercel. For the <a href=\"https://github.com/alexmacarthur/macarthur-me-next\" target=\"_blank\" rel=\"noopener\">current iteration of my blog</a> — on Next.js — that’s as simple as setting up a couple of rewrites:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// next.config.js </span>\n\nmodule<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">rewrites</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">source</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/js/numbers.js\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">destination</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://analytics.macarthur.me/js/plausible.js\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">source</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/api/event\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">destination</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://analytics.macarthur.me/api/event\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>And then installing the script using my proxied destination:</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token comment\">&#x3C;!-- The `&#x3C;head>` of each page --></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>script</span> <span class=\"token attr-name\">defer</span> <span class=\"token attr-name\">data-domain</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>macarthur.me<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/js/numbers.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>script</span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<p>With those pieces in place, I’m able to successfully reach my analytics server without issue — even using privacy-focused browsers like Brave.</p>\n<h2>Boring is Better</h2>\n<p>Plausible is a great example of how attractive and valuable products <em>without</em> a lot of features can be. I’m giving up a large set of tricks and functionality by dumping Google Analytics. But between the simplicity, performance, privacy gains, and everything else in between, the tradeoff has been more than worth it for me. And it’s helped get me one step closer to weaning myself off big tech as much as I reasonably can.</p>\n<p>We’ll see how things play out in the long term, but for the time being, I have no regrets.</p>\n",
        "feature_image": "https://images.pexels.com/photos/1615327/pexels-photo-1615327.jpeg",
        "status": "published",
        "created_at": 1650085200000,
        "published_at": 1650085200000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>A while ago, I was hanging out with some guys at my buddy Buddy’s (this is actually his first name) house. We were chatting about typical nerd stuff, when Samuel brought up a self-hostable, privacy-minded analytics service he’s been using: <a href=\\\"https://plausible.io/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Plausible</a>. I had never heard of it, but he gave a solid pitch, so I said I’d look into it.</p>\\n<p>I didn’t say that just to be polite — I had been on the hunt for an alternative to Google Analytics for some time. I’ve used it for years, but as time has gone on, there’s been increasing pressure to “de-Google” in this way for a few reasons:</p>\\n<ul>\\n<li>I’ve always felt overwhelmed by the UI and feature set. Way too much for my needs.</li>\\n<li>The recommended installation approach has caused it to consistently show up in Lighthouse performance reports as problematic.</li>\\n<li>It’s a “free” product that owns all of the data I send through it, and you know what that means.</li>\\n</ul>\\n<p>I decided to try out the self-hosted version of Plausible, which I put up via Docker Compose on a $5 DigitalOcean droplet. The whole process took ~20 minutes. I don’t think I was ready for how easy and satisfying it was getting it stood up and seeing it in action.</p>\\n<p>Looking back, here are the key things I’ve loved about the experience:</p>\\n<h3>1. It has thorough documentation.</h3>\\n<p>For being as “small” as it is in the analytics space, I was very pleased by how thorough and SEO-friendly Plausible’s documentation is. For the most part, when I needed something, I did a quick Google search with a few keywords, and the first result was <em>exactly</em> what I needed, right in their documentation.</p>\\n<p>They appear to do a great job at anticipating the questions and concerns of their users, and solid documentation is the result of that. But some of the credit for this might also be due to the fact that the all of <a href=\\\"https://github.com/plausible/docs\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">the documentation is available on GitHub</a>, open to pull requests, and updated regularly.</p>\\n<p>This all was a refreshing change from using Google Analytics. When searching for somethig for that tool, I’d often find several different sources that roughly relate to what I’m searching for, often scattered throughout Google’s own resources. I’m sure there are reasons for that (wider feature scope, multiple implementation approaches, maturity &#x26; complexity of the product, etc.), but it became a pretty significant point of friction for me, especially when all I wanted to do was get something up &#x26; tracking.</p>\\n<h3>2. Its custom event handling is intuitive.</h3>\\n<p>For my purposes, I don’t need any sort of complex event or user action analytics. I have (and probably will for quite some time) pretty simple things I’d like to keep track of:</p>\\n<ul>\\n<li>License purchases for <a href=\\\"https://typeitjs.com/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">TypeIt</a></li>\\n<li>Signups for <a href=\\\"https://jamcomments.com/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">JamComments</a></li>\\n<li><a href=\\\"http://typeitjs.com/docs\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">TypeIt documentation</a> search queries</li>\\n<li>Usage of TypeIt’s <a href=\\\"https://www.typeitjs.com/build-your-own/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">interactive demo</a></li>\\n<li>Something else I’m probably forgetting</li>\\n</ul>\\n<p>And some of those events have custom data I’d like to attach to each event (ex: the license type someone purchased, or a search query).</p>\\n<p>In GA, it <em>seems</em> relatively straightforward to send an event, which varies based on the implementation you’re using (<a href=\\\"https://developers.google.com/analytics/devguides/collection/gtagjs/events\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Global Site Tag</a> vs. <a href=\\\"https://developers.google.com/analytics/devguides/collection/analyticsjs/events\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">“standard”</a>) — I just need to specify an event action, category, label, and value. But in reality, it was a little more complicated to implement. Among my issues:</p>\\n<ul>\\n<li>With so much documentation for each implementation, it’s easy to get peeved and feel somewhat lost.</li>\\n<li>If I wanted to send custom data that’s not numeric, I couldn’t use the <code>value</code> field. Instead, I’d need to set up <a href=\\\"https://developers.google.com/analytics/devguides/collection/analyticsjs/custom-dims-mets\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">custom dimensions</a>, which, paired with “metrics,” is an entirely different concept to wrap my head around.</li>\\n<li>Finding custom event data within the GA admin is a pain. In fact, I never did figure out how to find data I had started to send w/ custom dimensions &#x26; metrics. I quickly grew impatient and confused, largely because it was so difficult to verify that I had even configured everything correctly.</li>\\n</ul>\\n<p>Primed with this less-than-pleasant experience, Plausible’s custom event API was a godsend. After installing the core Plausible script, it was as simple as setting up the global <code>window.plausible</code> variable:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token operator\\\">&#x3C;</span>script<span class=\\\"token operator\\\">></span><span class=\\\"token dom variable\\\">window</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">plausible</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token dom variable\\\">window</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">plausible</span> <span class=\\\"token operator\\\">||</span> <span class=\\\"token keyword\\\">function</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token dom variable\\\">window</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">plausible</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">q</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token dom variable\\\">window</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">plausible</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">q</span> <span class=\\\"token operator\\\">||</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">push</span><span class=\\\"token punctuation\\\">(</span>arguments<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token operator\\\">&#x3C;</span><span class=\\\"token operator\\\">/</span>script<span class=\\\"token operator\\\">></span>\\n</code></pre></div>\\n<p>… and then sending an event:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token dom variable\\\">window</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">plausible</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'Sign Up'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>Or, with custom data that pertains certain events.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token dom variable\\\">window</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">plausible</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'Purchase'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token comment\\\">// Optional custom data.</span>\\n  <span class=\\\"token literal-property property\\\">props</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token literal-property property\\\">product_slug</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">'my-product-slug'</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token literal-property property\\\">total</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">44</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n\\n  <span class=\\\"token comment\\\">// Optional callback method fired after event is sent.</span>\\n  <span class=\\\"token function-variable function\\\">callback</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'it sent!'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>After setting up a goal in the Plausible admin, all that data appears in highly-digestible way. Here’s an example of how my “Purchase” event looked at one point:</p>\\n<p><img src='/proxy/f4c9a8da-7a77-4f98-a127-6027293108d7' alt='' loading='lazy' /></p>\\n<p>Good enough for me. And if I need to created some more complex reports with that data, it’s a matter of <a href=\\\"https://plausible.io/docs/self-hosting-configuration#database\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">accessing the database</a> and running with it.</p>\\n<h3>3. It’s more performant.</h3>\\n<p>When I moved from Google Analytics to Plausible on <a href=\\\"https://typeitjs.com/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">TypeIt’s site</a>, <a href=\\\"https://twitter.com/amacarthur/status/1464833420593438725\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">I tweeted</a> about my Lighthouse score improving by eight points. It’s a Gatsby site with a lot of JavaScript in play, and Lighthouse doesn’t report on the actual user experience, but even so, it was a little jarring.</p>\\n<p>Some of the reason for this boost was pretty apparent. According Plausible, <a href=\\\"https://plausible.io/vs-google-analytics#increasing-the-page-weight-and-the-loading-time\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">its script is many times smaller than Google’s</a>, and that means less time downloading &#x26; parsing code. But according to Lighthouse and WebPageTest reports, other factors were due credit as well.</p>\\n<p>One of those other factors was the amount of work Google Analytics performs on the main thread, choking out any other processes that may actually support the user’s experience. Here’s a shot of the problem scripts on <a href=\\\"http://typeitjs.com/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">typeitjs.com</a>. GA comes in at the third most thread-obnoxious script (divert your eyes from the top two… remember, this is a Gatsby site).</p>\\n<p><img src='/proxy/8f230f7b-4365-4196-b616-c1ad1f84efad' alt='' loading='lazy' /></p>\\n<p>The other notable factor was the caching policy used by Google to serve its scripts. WebPageTest wasn’t happy about it:</p>\\n<p><img src='/proxy/bbab8a1a-e152-45cc-a19b-79b68790696d' alt='' loading='lazy' /></p>\\n<p>These concerns don’t magically go away by moving from GA to another provider, but the lightweight and self-hosted nature of Plausible sure makes it easier to mitigate them. Addressing the first concern is automatic, and the second is solved by setting the appropriate caching headers when the script is served from my DigitalOcean droplet.</p>\\n<h3>4. SPA page tracking is easier.</h3>\\n<p>This is a small perk I didn’t at all expect to see by moving to Plausible, but it’s an appreciated one. By default, Google Analytics collects its data only by executing after a page is loaded. As such, observing a user’s flow through several different pieces is achieved by stitching together the data from subsequent full page loads.</p>\\n<p>It’s a fine way to go about it, but also makes it a bit of a hassle to track views in single page applications. In SPAs, there’s often a <em>single</em> page load, after which navigation is handled entirely client-side. They do a good job equipping people to accurately track page views in SPAs by providing <a href=\\\"https://developers.google.com/analytics/devguides/collection/analyticsjs/single-page-applications\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">good documentation</a> on it. The short of it is that you need to manually send a <code>pageview</code> event whenever client-side navigation occurs.</p>\\n<p>For my own NextJS site using the recommended <a href=\\\"https://support.google.com/analytics/answer/9355662?hl=en\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Global Site Tag</a> approach, I had to pull that off by listening for a <code>routeChangeComplete</code> event, which looked something like this (stripped down and a little contrived for simplicity):</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">pageView</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">url</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token function\\\">gtag</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"config\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constant\\\">GA_TRACKING_ID</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token literal-property property\\\">page_path</span><span class=\\\"token operator\\\">:</span> url<span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword module\\\">export</span> <span class=\\\"token keyword module\\\">default</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\"><span class=\\\"token maybe-class-name\\\">App</span></span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\"><span class=\\\"token punctuation\\\">{</span> <span class=\\\"token maybe-class-name\\\">Component</span><span class=\\\"token punctuation\\\">,</span> pageProps <span class=\\\"token punctuation\\\">}</span></span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> router <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">useRouter</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n\\t<span class=\\\"token comment\\\">// Track each client-side page navigation.</span>\\n  <span class=\\\"token function\\\">useEffect</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">handleRouteChange</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">url</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token function\\\">pageView</span><span class=\\\"token punctuation\\\">(</span>url<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    router<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">events</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">on</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"routeChangeComplete\\\"</span><span class=\\\"token punctuation\\\">,</span> handleRouteChange<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n      router<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">events</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">off</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"routeChangeComplete\\\"</span><span class=\\\"token punctuation\\\">,</span> handleRouteChange<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">[</span>router<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">events</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n\\t<span class=\\\"token comment\\\">// Track the initial page load.</span>\\n  <span class=\\\"token function\\\">useEffect</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token function\\\">pageView</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token dom variable\\\">window</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">location</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">pathname</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token operator\\\">&#x3C;</span><span class=\\\"token maybe-class-name\\\">Component</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token spread operator\\\">...</span>pageProps<span class=\\\"token punctuation\\\">}</span> <span class=\\\"token operator\\\">/</span><span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p>It’s nothing terribly complicated, but it’s also something I’d rather not have to worry about myself.</p>\\n<p>Thankfully, Plausible takes care of this automatically by piggy-backing on client-side routers’ usage of the History API. In order to simulate page views performed in the context of an SPA, libraries like <a href=\\\"https://reactrouter.com/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">react-router</a> will use <code>history.pushState()</code> to place these views into a user’s browser history. Plausible leverages that integration, meaning <a href=\\\"https://plausible.io/docs/spa-support\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">I don’t have to do </a><a href=\\\"https://plausible.io/docs/spa-support\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\"><em>anything</em></a> to correctly track SPA page views after installing the script (<a href=\\\"https://plausible.io/docs/script-extensions#plausiblemanualjs\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">unless I want to</a>). It just works!</p>\\n<h3>5. My data belongs to me.</h3>\\n<p>Google Analytics is mature and feature-rich service, but there’s a reason it’s free — all that data it collects <a href=\\\"https://policies.google.com/technologies/partner-sites?hl=en-US\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">is used in a wide variety of ways</a> to benefit the business. I don’t have any particular issue with that model in and of itself, but the scope of its implications also doesn’t sit great with me.</p>\\n<p>Among Plausible’s selling points, however, are its intentional focuses on privacy and data ownership. <a href=\\\"https://plausible.io/privacy-focused-web-analytics\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Its website</a> lists a wealth of ways they lean into that — things like no cookies, no cross-site tracking, no sharing data with any third party, and being able to self-host the entire thing.</p>\\n<p>And that also means it’s easy to get my data <em>out</em> of Plausible too, like with its <a href=\\\"https://plausible.io/docs/stats-api\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Stats API</a>, which I use to display analytics data on my <a href=\\\"https://macarthur.me/dashboard\\\">personal dashboard</a>. One nice thing about self-hosting the tool is that there are virtually no limits to how much of my own data I can request on demand from my droplet. There’s an hourly limit, but even that can be manually increased by accessing the container, logging into the database, and updating a value:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token operator\\\">--</span> <span class=\\\"token maybe-class-name\\\">Log</span> into the database<span class=\\\"token punctuation\\\">.</span>\\n<span class=\\\"token property-access\\\">psql</span> <span class=\\\"token operator\\\">-</span><span class=\\\"token constant\\\">U</span> postgres <span class=\\\"token operator\\\">-</span>d plausible_db\\n\\n<span class=\\\"token operator\\\">--</span> <span class=\\\"token maybe-class-name\\\">Update</span> every limit to <span class=\\\"token number\\\">10000.</span>\\n<span class=\\\"token constant\\\">UPDATE</span> api_keys <span class=\\\"token constant\\\">SET</span> hourly_request_limit <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">10000</span>\\n</code></pre></div>\\n<p>That leaves me feeling like my data really is easily accessible, safe, and <em>mine</em>.</p>\\n<h2>6. The data’s more reliable.</h2>\\n<p>Ad blockers and privacy-focused browsers (like Brave) are a growing problem for the client-side analytics space. When using either, it’s increasingly common for Google Analytics requests to be blocked by default, impacting the accuracy of your data.</p>\\n<p>One approach to address this is proxying analytics requests through your domain, which convinces privacy tools to consider the requests to be trustworthy.</p>\\n<p>Wiring this up with Google Analytics is possible, but is neither simple nor maintainable in the long term. It requires serving the analytics script locally (by either proxying it from Google or maintaining a modified copy yourself), and then passing every event request through your domain as well. Modern tooling like serverless functions make it less of a hassle, but even so, it’s tedious and potentially unreliable if/when Google ever pushes updates to the script.</p>\\n<p>It’d be remiss of me not to mention the strides Google Analytics is taking to help tackle some of these issues, such as the introduction of <a href=\\\"https://developers.google.com/tag-platform/tag-manager/server-side\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">server-side tagging</a>. But the amount of time and technical overhead required to take advantage of it is still more than I’m willing to take on for my side projects.</p>\\n<p>Plausible, on the other hand, has <a href=\\\"https://plausible.io/docs/proxy/introduction\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">dedicated documentation</a> on how to proxy its script through your own domain, covering a host of platforms, including two I use a lot — Netlify and Vercel. For the <a href=\\\"https://github.com/alexmacarthur/macarthur-me-next\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">current iteration of my blog</a> — on Next.js — that’s as simple as setting up a couple of rewrites:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token comment\\\">// next.config.js </span>\\n\\nmodule<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">exports</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">async</span> <span class=\\\"token function\\\">rewrites</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token punctuation\\\">[</span>\\n      <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token literal-property property\\\">source</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"/js/numbers.js\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n        <span class=\\\"token literal-property property\\\">destination</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"https://analytics.macarthur.me/js/plausible.js\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token literal-property property\\\">source</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"/api/event\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n        <span class=\\\"token literal-property property\\\">destination</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"https://analytics.macarthur.me/api/event\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>And then installing the script using my proxied destination:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token comment\\\">&#x3C;!-- The `&#x3C;head>` of each page --></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>script</span> <span class=\\\"token attr-name\\\">defer</span> <span class=\\\"token attr-name\\\">data-domain</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>macarthur.me<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token attr-name\\\">src</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>/js/numbers.js<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token script\\\"></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>script</span><span class=\\\"token punctuation\\\">></span></span>\\n</code></pre></div>\\n<p>With those pieces in place, I’m able to successfully reach my analytics server without issue — even using privacy-focused browsers like Brave.</p>\\n<h2>Boring is Better</h2>\\n<p>Plausible is a great example of how attractive and valuable products <em>without</em> a lot of features can be. I’m giving up a large set of tricks and functionality by dumping Google Analytics. But between the simplicity, performance, privacy gains, and everything else in between, the tradeoff has been more than worth it for me. And it’s helped get me one step closer to weaning myself off big tech as much as I reasonably can.</p>\\n<p>We’ll see how things play out in the long term, but for the time being, I have no regrets.</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 16,
        "title": "Reliably Send an HTTP Request as a User Leaves a Page",
        "slug": "send-an-http-request-on-page-exit",
        "html": "<p>A post on CSS Tricks exploring why HTTP requests sent during page navigation are at risk of abandonment, as well as options available to prevent it from happening.</p>\n",
        "feature_image": "",
        "status": "published",
        "created_at": 1645506000000,
        "published_at": 1645506000000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>A post on CSS Tricks exploring why HTTP requests sent during page navigation are at risk of abandonment, as well as options available to prevent it from happening.</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 17,
        "title": "Programmatically Create a Static Page in WordPress",
        "slug": "creating-static-page-in-wordpress",
        "html": "<p>It’s surprisingly a big pain to create a route and render a static template in WordPress <em>without</em> messing with the database. For example, let’s say you’d like to create a static “/error” page, and there’s no desire to have any of the content editable. You just want a particular template to render at that route every time.</p>\n<p>If you give this sort of thing a Google search, you’ll find a lot of results on setting up a <a href=\"https://wordpress.org/support/article/creating-a-static-front-page/\" target=\"_blank\" rel=\"noopener\">“static” front page</a> (requiring a setting to be toggled in the WP admin), or using <code>page-*.php</code> <a href=\"https://developer.wordpress.org/themes/template-files-section/page-template-files/\" target=\"_blank\" rel=\"noopener\">templates for specific pages</a>, which also require the pages to first exist in the database.</p>\n<p><strong>But what if you want to create and render content for a route entirely in PHP — 100% programmatically?</strong> It’s not straightforward (WordPress simply doesn’t lend itself best to registering routes in this way), but it’s not as complicated as you might think.</p>\n<h2>Programmatically Registering a Route</h2>\n<p>For this breakdown, we’re going to register a route at <code>/a-static-page</code> , and have it render <code>YOUR_THEME_DIRECTORY/static-templates/a-static-template.php</code>. If I navigate to that page on my local “sandbox” instance of WordPress (I’m using the <a href=\"https://wordpress.org/themes/twentynineteen/\" target=\"_blank\" rel=\"noopener\">twentynineteen</a> theme, by the way), I’ll expectedly get a 404:</p>\n<p><img src='/proxy/7c734db2-4659-4060-8fcb-e77a6fa871fc' alt='' loading='lazy' /></p>\n<p>In order to pull this off, we’ll rely on three distinct WordPress hooks. At the most basic level, these can all be placed in a theme’s <code>functions.php</code> file.</p>\n<h3>Create a Rewrite Rule</h3>\n<p>First, let’s create a rewrite rule that’ll attempt to match against a particular request path, and then <em>rewrite</em> that path into one that WordPress will use to parse and render a page. Let’s start with this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token function\">add_action</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'init'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">add_rewrite_rule</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'a-static-page/?$'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'index.php?static_template=a-static-template'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'top'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\">// Not required. Just here for easier local development.</span>\n\t<span class=\"token function\">flush_rewrite_rules</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>When a request comes in with a path that resembles “/a-static-page,” we’re rewriting the path to include a <code>static_template</code> query variable, whose value is the particular page template we want to render — <code>a-static-template.php</code>. Right now, however, <strong>that new query variable is useless</strong>. It’ll get filtered out as the request is parsed later on, unless we deliberate whitelist it.</p>\n<h3>Whitelist the Custom Query Var</h3>\n<p>To do that, we’ll use <a href=\"https://developer.wordpress.org/reference/hooks/query_vars/\" target=\"_blank\" rel=\"noopener\">the </a><a href=\"https://developer.wordpress.org/reference/hooks/query_vars/\" target=\"_blank\" rel=\"noopener\"><code>query_var</code></a><a href=\"https://developer.wordpress.org/reference/hooks/query_vars/\" target=\"_blank\" rel=\"noopener\"> filter</a>, which will permit our <code>static_template</code> variable to be accessible when we choose to render a custom template (or not).</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token function\">add_filter</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'query_vars'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$queryVars</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$queryVars</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'static_template'</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token variable\">$queryVars</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>There isn’t much to this piece. The <code>query_vars</code> filter provides us the permitted query variables. We’re just tacking a custom one on the end. With that in place, we’re able to use the variable to maybe render a particular template.</p>\n<h3>Conditionally Render a Template</h3>\n<p>From here on out, it’s just a matter of setting up some logic. We’ll check for our query variable. If it’s set, return the respective page template. If it’s not, return whatever template would’ve been rendered to begin with.</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token function\">add_action</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'template_include'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$template</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$staticQueryVarValue</span> <span class=\"token operator\">=</span> <span class=\"token function\">get_query_var</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'static_template'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">empty</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$staticQueryVarValue</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">get_stylesheet_directory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token string double-quoted-string\">\"/static-templates/<span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token variable\">$staticQueryVarValue</span><span class=\"token punctuation\">}</span></span>.php\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token variable\">$template</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>If you refresh that page now, you’ll should see the content within <code>a-static-template.php</code> :</p>\n<p><img src='/proxy/6b6bc7b5-3c02-4a86-aae2-d659f1013416' alt='' loading='lazy' /></p>\n<h2>Not So Bad, Right?</h2>\n<p>Obviously, this is a pretty contrived example. In a real-life case, there may be a bit more complicated logic to wade through, and you could also clean this up a bit, like always naming the custom templates after the static paths you’re registering. Whatever the case, this should provide enough of a foundation to get you moving in the right direction a little faster.</p>\n",
        "feature_image": "https://images.pexels.com/photos/681335/pexels-photo-681335.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;w=1200",
        "status": "published",
        "created_at": 1643605200000,
        "published_at": 1643605200000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>It’s surprisingly a big pain to create a route and render a static template in WordPress <em>without</em> messing with the database. For example, let’s say you’d like to create a static “/error” page, and there’s no desire to have any of the content editable. You just want a particular template to render at that route every time.</p>\\n<p>If you give this sort of thing a Google search, you’ll find a lot of results on setting up a <a href=\\\"https://wordpress.org/support/article/creating-a-static-front-page/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">“static” front page</a> (requiring a setting to be toggled in the WP admin), or using <code>page-*.php</code> <a href=\\\"https://developer.wordpress.org/themes/template-files-section/page-template-files/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">templates for specific pages</a>, which also require the pages to first exist in the database.</p>\\n<p><strong>But what if you want to create and render content for a route entirely in PHP — 100% programmatically?</strong> It’s not straightforward (WordPress simply doesn’t lend itself best to registering routes in this way), but it’s not as complicated as you might think.</p>\\n<h2>Programmatically Registering a Route</h2>\\n<p>For this breakdown, we’re going to register a route at <code>/a-static-page</code> , and have it render <code>YOUR_THEME_DIRECTORY/static-templates/a-static-template.php</code>. If I navigate to that page on my local “sandbox” instance of WordPress (I’m using the <a href=\\\"https://wordpress.org/themes/twentynineteen/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">twentynineteen</a> theme, by the way), I’ll expectedly get a 404:</p>\\n<p><img src='/proxy/7c734db2-4659-4060-8fcb-e77a6fa871fc' alt='' loading='lazy' /></p>\\n<p>In order to pull this off, we’ll rely on three distinct WordPress hooks. At the most basic level, these can all be placed in a theme’s <code>functions.php</code> file.</p>\\n<h3>Create a Rewrite Rule</h3>\\n<p>First, let’s create a rewrite rule that’ll attempt to match against a particular request path, and then <em>rewrite</em> that path into one that WordPress will use to parse and render a page. Let’s start with this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token function\\\">add_action</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string single-quoted-string\\\">'init'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token function\\\">add_rewrite_rule</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string single-quoted-string\\\">'a-static-page/?$'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string single-quoted-string\\\">'index.php?static_template=a-static-template'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string single-quoted-string\\\">'top'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n\\t<span class=\\\"token comment\\\">// Not required. Just here for easier local development.</span>\\n\\t<span class=\\\"token function\\\">flush_rewrite_rules</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>When a request comes in with a path that resembles “/a-static-page,” we’re rewriting the path to include a <code>static_template</code> query variable, whose value is the particular page template we want to render — <code>a-static-template.php</code>. Right now, however, <strong>that new query variable is useless</strong>. It’ll get filtered out as the request is parsed later on, unless we deliberate whitelist it.</p>\\n<h3>Whitelist the Custom Query Var</h3>\\n<p>To do that, we’ll use <a href=\\\"https://developer.wordpress.org/reference/hooks/query_vars/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">the </a><a href=\\\"https://developer.wordpress.org/reference/hooks/query_vars/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\"><code>query_var</code></a><a href=\\\"https://developer.wordpress.org/reference/hooks/query_vars/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\"> filter</a>, which will permit our <code>static_template</code> variable to be accessible when we choose to render a custom template (or not).</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token function\\\">add_filter</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string single-quoted-string\\\">'query_vars'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">function</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">$queryVars</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token variable\\\">$queryVars</span><span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token string single-quoted-string\\\">'static_template'</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword\\\">return</span> <span class=\\\"token variable\\\">$queryVars</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>There isn’t much to this piece. The <code>query_vars</code> filter provides us the permitted query variables. We’re just tacking a custom one on the end. With that in place, we’re able to use the variable to maybe render a particular template.</p>\\n<h3>Conditionally Render a Template</h3>\\n<p>From here on out, it’s just a matter of setting up some logic. We’ll check for our query variable. If it’s set, return the respective page template. If it’s not, return whatever template would’ve been rendered to begin with.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token function\\\">add_action</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string single-quoted-string\\\">'template_include'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">function</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">$template</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token variable\\\">$staticQueryVarValue</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">get_query_var</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string single-quoted-string\\\">'static_template'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword\\\">if</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span><span class=\\\"token keyword\\\">empty</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">$staticQueryVarValue</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token keyword\\\">return</span> <span class=\\\"token function\\\">get_stylesheet_directory</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">.</span> <span class=\\\"token string double-quoted-string\\\">\\\"/static-templates/<span class=\\\"token interpolation\\\"><span class=\\\"token punctuation\\\">{</span><span class=\\\"token variable\\\">$staticQueryVarValue</span><span class=\\\"token punctuation\\\">}</span></span>.php\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n\\n    <span class=\\\"token keyword\\\">return</span> <span class=\\\"token variable\\\">$template</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>If you refresh that page now, you’ll should see the content within <code>a-static-template.php</code> :</p>\\n<p><img src='/proxy/6b6bc7b5-3c02-4a86-aae2-d659f1013416' alt='' loading='lazy' /></p>\\n<h2>Not So Bad, Right?</h2>\\n<p>Obviously, this is a pretty contrived example. In a real-life case, there may be a bit more complicated logic to wade through, and you could also clean this up a bit, like always naming the custom templates after the static paths you’re registering. Whatever the case, this should provide enough of a foundation to get you moving in the right direction a little faster.</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 18,
        "title": "My Three Favorite Reasons to Get a Credit Card and Why They’re All Inadequate",
        "slug": "favorite-reasons-to-get-a-credit-card",
        "html": "<p>I’ve lived without a credit card for nearly a decade now. Life hasn’t been hard without one. With a debit card (backed by my own, real money) readily available and accepted anywhere a credit card is, I wouldn’t even say it’s been inconvenient.</p>\n<p>Even so, more than a few times, I’ve been roped into (or instigated, lol) hearty discussions with people who insist that there are indisputable reasons why I and everyone else should have a credit card. Despite some of those reasons being total garbage (”get a 20% discount on these American Eagle pants!”), I’ve found a few to be fairly compelling on more than one occasion — enough to make me think about whether my plastic abstinence is more rooted in dogma than reason. But time after time, thinking through even the best of these reasons only lands me right back where I’ve stood for several years now.</p>\n<p>I’ve thought about it enough times now to warrant getting something written down; if anything, for the purpose of being able to point people to resource when I don’t have the patience to try to regurgitate thoughts from scratch in the moment.</p>\n<p>So, here they are: my three favorite reasons to get a credit card, and why they’re still not good enough for me.</p>\n<h2>1. “Credit cards are safer than debit cards.”</h2>\n<p>This one gets me because it strikes right at my security gland. And it also comes off as pretty agreeable, because credit cards <em>do</em> offer solid protection in the event that either your number or physical card is used fraudulently. In fact, it’s the law. The <a href=\"https://www.experian.com/blogs/ask-experian/what-is-the-fair-credit-billing-act/\" target=\"_blank\" rel=\"noopener\">Fair Credit Billing Act</a> shields you from any responsibility for charges that occur after you report a stolen card. And even if the bad guys did rack up any charges before then, the maximum amount you’re responsible for is $50.</p>\n<p>But even paying <em>that</em> is pretty rare. Most major credit cards have <a href=\"https://www.investopedia.com/terms/z/zero-liability-policy.asp\" target=\"_blank\" rel=\"noopener\">zero-liability policies</a>, meaning you won’t owe a cent on anything purchased by anyone but yourself — no matter how or when the purchase was made. It’s little surprise that people tout the peace of mind credit cards offer in this way, especially in an age when online commerce dominates. You’d be hard-pressed to find yourself out of any sum of money due to someone getting a hold of your card, either physically or digitally.</p>\n<p><strong>But! It’s also true that debit cards enjoy virtually the same level of security.</strong> And in an increasing number of cases, those protections are <em>exactly</em> the same. This type of plastic isn’t covered by the same legislation as credit cards. Rather, they fall within the scope of the <a href=\"https://www.ftc.gov/enforcement/statutes/electronic-fund-transfer-act\" target=\"_blank\" rel=\"noopener\">Electronic Fund Transfer Act</a>. Under that law, the following protections are in force when your debit card becomes compromised, depending on how it happened:</p>\n<h3>Physical Card is Lost/Stolen</h3>\n<table>\n<thead>\n<tr>\n<th>Reported Within</th>\n<th>Maximum Liability</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>within two days</td>\n<td>$50</td>\n</tr>\n<tr>\n<td>within 60 days</td>\n<td>$500</td>\n</tr>\n<tr>\n<td>greater than 60 days</td>\n<td>unlimited</td>\n</tr>\n</tbody>\n</table>\n<h3>Card Number is Lost/Stolen</h3>\n<table>\n<thead>\n<tr>\n<th>Reported Within</th>\n<th>Maximum Liability</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>within 60 days</td>\n<td>$0</td>\n</tr>\n<tr>\n<td>greater than 60 days</td>\n<td>unlimited</td>\n</tr>\n</tbody>\n</table>\n<p>Just taking these restrictions at face value, the only chance you’re going to be liable for an extraordinary amount of money is if you fail to report your card within 60 days. And if takes you that long to realize something’s going on, I’d question whether you’re even adult enough to have a card to begin with.</p>\n<h3>Zero-Liability for Everyone</h3>\n<p>But still, there’s good news on top of that — <strong>more and more providers are choosing to offer the same zero-liability policies on their</strong> <em><strong>debit</strong></em> <strong>cards too</strong>. The top two players dominating this space are <a href=\"https://www.fool.com/the-ascent/research/credit-debit-card-market-share-network-issuer/\" target=\"_blank\" rel=\"noopener\">Visa and Mastercard</a>. And <em>both</em> have zero-liability policies in place — regardless of whether your card is physically lost/stolen. (For more reading, here are details on <a href=\"https://www.mastercard.us/en-us/personal/find-a-card/standard-mastercard-debit.html\" target=\"_blank\" rel=\"noopener\">Mastercard’s policy</a>, and <a href=\"https://usa.visa.com/pay-with-visa/visa-chip-technology-consumers/zero-liability-policy.html\" target=\"_blank\" rel=\"noopener\">here’s Visa’s</a>.)</p>\n<p>I called my own bank to verify this, and sure enough, here’s a snippet of the document I was emailed. The language is pretty clear, and the bank’s representative confirmed it verbally for me as well. No matter what the type of transaction, if it was unauthorized and I wasn’t being an idiot in exposing my card information, my butt’s covered:</p>\n<p><img src='/proxy/2a39de6d-bd7e-42a7-bef1-14411bbdbc2a' alt='' loading='lazy' /></p>\n<p>And that means, void of any hair-splitting intricacies I’m missing, <strong>a credit card doesn’t have a discernable security advantage over a debit card.</strong></p>\n<h3>“But it takes TIME for fraud to be resolved!”</h3>\n<p>On the surface, this concern sounds legitimate. If you have relatively straightforward financial needs, you might have a single account where most of your available spending money lives. And if that’s gone, even momentarily, it could wreak havoc on your day-to-day life. But most (read: practically all) debit cards come with daily purchase limits out of the box. They vary by bank &#x26; account, but with one of any sort in place, I have a hard time imagining one of these nightmare scenarios actually occurring.</p>\n<p>But let’s say it happens. Maybe you temporarily increase the limit on your card, and someone takes advantage of that opportunity to clean you out. The felt consequences of that event are largely avoidable by <strong>maintaining a healthy emergency fund in a</strong> <em><strong>separate</strong></em> <strong>account</strong> – something every responsible adult should do anyway. If things get any weirder than that (e.g.: you raise the limit on BOTH accounts, both get fraudulently accessed, and every cent of both manages to get stolen at the same time), I think it’s time to change your identity altogether and commit to using straight cash for the rest of your life.</p>\n<p>So, in light of the law, increasingly common zero-liability policies, built-in card protections, and the safeguards good money habits inherently bring with them, the appeal of this reason starts to become pretty weak.</p>\n<h2>2. “I use the rewards to cover expenses I would’ve had anyway.”</h2>\n<p>Out of the claims we’re looking at, this one’s advantage is its appeal to cold, hard reason. Everyone has boring, predictable expenses they need to make each month. Why <em>wouldn’t</em> you soften their blow by leveraging credit card perks, especially if those perks can be funneled right back into the category of “things I would’ve had to buy anyway” (think: cash back for groceries, airline points for an upcoming trip to visit family, etc.).</p>\n<p>If I believed most people to be self-disciplined machines, I wouldn’t have an objection here, especially if you have a perfect, maybe even automated track record of paying off your card’s balance each month.</p>\n<p>And to be fair, there are <em>real</em> stories of people raking in legitimate perks through their use of credit cards, <a href=\"https://web.archive.org/web/20210422211556/https://www.creditcards.com/credit-card-news/how-much-money-make-with-cash-back-cards/\" target=\"_blank\" rel=\"noopener\">like Katie DeCicco</a>, who brings in ~$6,000/year with business expenses. Or <a href=\"https://www.pointswithacrew.com/about/\" target=\"_blank\" rel=\"noopener\">this “travel hacker”</a> who prides himself on accumulating “free” airline miles for his family of eight.</p>\n<p>But to be <em>even more</em> fair, we need to consider some contextual details. Katie had to spend <em>$650,000 dollars</em> to reap that $6k, and that travel hacker’s perks require far more effort than just regular, predictable spending, like routinely <a href=\"https://www.pointswithacrew.com/how-i-got-a-million-points-and-you-can-too/\" target=\"_blank\" rel=\"noopener\">signing up for new cards</a> just for the sign-up bonuses. And at work underneath all of this is the human psyche, which isn’t highly regarded as being immune to subconscious influence. Unsurprisingly, there’s a wide body of research that thoroughly backs that up.</p>\n<h3>Cards Make You Spend More</h3>\n<p>The connection between your payment method of choice and your spending tendencies is pretty undeniable. When your options are reduced to either a card linked to someone else’s money and physical cash that belongs to <em>you</em>, you spend (probably unknowingly) far more with card than you do cash. Just a few examples:</p>\n<ul>\n<li>An <a href=\"https://link.springer.com/article/10.1023/A:1008196717017\" target=\"_blank\" rel=\"noopener\">MIT study found</a> that people are willing to spend up to <em>100% more</em> using credit cards.</li>\n<li>Toll rates tended to <a href=\"https://www.nber.org/papers/w12924\" target=\"_blank\" rel=\"noopener\">increase by 20-40%</a> once electronic/automatic payment mechanisms were installed.</li>\n<li>People were found to tip <a href=\"https://fortunly.com/statistics/cash-versus-credit-card-spending-statistics#according-to-an-mit-study-credit-cards-make-people-spend-more-money-sometimes-up-to-83-more\" target=\"_blank\" rel=\"noopener\">13% more when paying with a credit card</a>.</li>\n</ul>\n<p>If you dig into some of these and other sources, there’s a common thread as to why people behave this way. <strong>It</strong> <em><strong>feels</strong></em> <strong>different giving your physical cash away than it does a quick swipe of a card.</strong> And there’s more at play than just a different “feeling.” <a href=\"https://www.cmu.edu/homepage/practical/2007/winter/spending-til-it-hurts.shtml\" target=\"_blank\" rel=\"noopener\">As George Loewenstein noted</a> after studying the relationship between making purchases and the brain’s registration of pain:</p>\n<blockquote>\n<p>Credit cards effectively anesthetize the pain of paying. You swipe the card and it doesn’t feel like you’re giving anything up to make the purchase, unlike paying cash where you have to hand over bills.</p>\n</blockquote>\n<p>Summarized: when it hurts less, it costs more.</p>\n<h3>“Ok, but debit cards are <em>cards</em> too, right?”</h3>\n<p>Yes — the fact that a debit card is still a <em>card</em> means that its users are subject to many of the same psychological forces as a credit card. But there are a couple of distinctions between the two that make the credit card worse:</p>\n<p><strong>First, they mess with our tendency to make decisions based on the amount of resources we</strong> <em><strong>think</strong></em> <strong>we have available</strong>. <a href=\"https://www.inverse.com/culture/59670-credit-card-psychology\" target=\"_blank\" rel=\"noopener\">Dr. Carey Morewedge</a> refers to this perception as “cognitive availability.” If we think a purchase would take up a decent chunk of our available money, it hurts more, decreasing our chance of doing it.</p>\n<p>For example, if I’m carrying $100 in cash and I’m considering a $50 purchase, that decision would mean parting with <em>50%</em> of my available money. Ouch. But that same $50 purchase would be a lot less painful if I were to use a debit card linked to a checking account with $10,000 in it.</p>\n<p>Credit cards take this to an entirely new level, kicking the bottom out of the amount of money you have “cognitively available.” When you use a credit card, there’s virtually <em>no limit</em> at all, aside from whatever daily transaction limit exists. And that means there’s far, <em>far</em> less “payment pain” using a credit card over any other payment methods.</p>\n<p><strong>Second, it screws with our already poor habit of valuing the present over the future.</strong> When we use a debit card, the consequence of that decision is felt immediately (the money is taken right out of your account), putting the satisfaction of whatever we just purchased in a dimmer light. But with a credit card, that pain is pushed off into the future, taking a back seat to the immediate gratification of whatever how belongs to us. Morewedge explains it better:</p>\n<blockquote>\n<p>I don’t value my future money as much as I value my present money, and so with a credit card, by moving the payment into the future, it’s less psychologically painful than if I paid right now.</p>\n</blockquote>\n<p>And based on the limited amount of research I was able to find directly comparing credit cards and debit cards, all of this seems to hold up, with credit cards taking the #1 spot in terms of <a href=\"https://irrationallabs.com/content/uploads/2020/04/Irrationally-Healthy.pdf\" target=\"_blank\" rel=\"noopener\">most money spent at a grocery store.</a></p>\n<p>Of course, at the end of the day, all the research in the world won’t sway a person who believes they’re the exception to it. Still, it’s worth asking: do you really think that using a card with a built-in reward mechanism and that’s attached to someone else’s money <em>doesn’t</em> have a subconscious impact on your spending? If you answer “yes,” you might be right and you’re in the minority who’s risen above these psychological forces.</p>\n<p>But you’re probably not.</p>\n<h2>3. “I need a credit card to build a healthy credit score.”</h2>\n<p>Ok, it’s a straight-up fact that you don’t <em>need</em> a credit score to live life in the modern world. Despite that truth, many still think it’s necessary to do things like get into an apartment, rent a car, or get a mortgage. <strong>But you can pretty much always do these things via alternative methods</strong>. Google it. Listen to <a href=\"https://www.youtube.com/watch?v=1alhWkWyijs\" target=\"_blank\" rel=\"noopener\">this episode</a> of <em>The Fine Print</em> podcast. Or call around yourself.</p>\n<p>That aside, the hassle required to do some of these things make it a little more complicated. For some things, having a poor or non-existent score racks up to a minor inconvenience (you might need to put up a larger rental deposit or submit some more extensive proof that you have an income and pay your bills on time, etc.). But for others, it can be a serious pain in the cheeks — like getting a mortgage manually underwritten. It’d be remiss of me to not acknowledge some of the horror stories in navigating this process, like <a href=\"https://danwatt.org/2020/10/actually-getting-a-mortgage-with-no-credit-score\" target=\"_blank\" rel=\"noopener\">this one from a friend</a>.</p>\n<p>Just hearing stories like that stresses me out. And imagining going through it myself helps me understand why having a card for this reason is so appealing. At the same time, it enrages me that we live within a system designed to depend on such a backwards method of “qualifying” someone to do something. I could have zero debt, a perfect housing/utilities payment history, have been awarded the Medal of Honor, and STILL have a harder time getting a decent mortgage than someone who’s played the FICO game well.</p>\n<p>In fact, virtually none of how that score is calculated has anything to do with healthy money habits (saving, budgeting, investing, paying your bills on time, etc.). Instead, there’s a heckuva large focus on <a href=\"https://www.equifax.com/personal/education/credit/score/how-is-credit-score-calculated\" target=\"_blank\" rel=\"noopener\">how well you “manage” debt</a>, rewarding those who play according to the rules with the <a href=\"https://www.experian.com/blogs/ask-experian/why-would-you-want-a-good-credit-score/\" target=\"_blank\" rel=\"noopener\">primary privilege of taking on more debt</a>. It’s almost as if it was designed to be cyclically manipulative.</p>\n<h3>Make Your Past Mistakes Work for You</h3>\n<p>The slimy, senseless nature of the credit score is enough to make me opt out of chasing it altogether (even if it will cost me a slice of my sanity).</p>\n<p>But if you choose to do the same, it still doesn’t necessarily mean you’re signing up for a world of hurt. If you already have outstanding debt you’re paying off, you can use it to maintain a decent score for the time being. It’s untrue that regularly swiping plastic is the only or most impactful thing you can do for your score. In reality, staying on top of <em>any</em> debt will factor into it — <a href=\"https://www.nerdwallet.com/article/loans/student-loans/do-student-loans-affect-your-credit\" target=\"_blank\" rel=\"noopener\">like student loans</a>.</p>\n<p>I’m an example of this. Over the course of ~4 years, we paid off ~$50k in student loans. Our credit score held up just fine, and after we were done, we had no problems going through the traditional mortgage process, despite not having used a card in several years. We certainly weren’t relieved to have debt for this purpose, but it was helpful being able to make useful what was otherwise a regretful burden.</p>\n<p>No matter which way you slice it, saying someone “needs” a card to build a score should raise some eyebrows on multiple levels. And I only buy into things that cause my eyebrows to stand firm and level.</p>\n<h2>No, I’m not Amish.</h2>\n<p>I guess no one’s actually asked me that, but it’s the vibe I get sometimes when someone finds out I haven’t used a credit card in a decade. I don’t mind — I’m an Enneagram #3, so I actually kind of like the attention (perhaps that’s factored into why I’ve chosen this path, lol).</p>\n<p>But just for thoroughness, I should note that I happily use tools like Venmo &#x26; Google Pay (don’t h8), and of course, my debit card. Like I said before, life isn’t really inconvenient as a result of living this way. It’s just one that’s tied to money that actually exists, with a built-in safety mechanism to deter me from making stupid financial decisions. I won’t say you <em>must</em> follow suit, but I will issue a challenge:</p>\n<p>Do it, and you won’t regret it as much as you think you will. Cut ‘em up! 🙂</p>\n",
        "feature_image": "https://images.pexels.com/photos/259200/pexels-photo-259200.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=3&amp;h=750&amp;w=1260",
        "status": "published",
        "created_at": 1641704400000,
        "published_at": 1641704400000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>I’ve lived without a credit card for nearly a decade now. Life hasn’t been hard without one. With a debit card (backed by my own, real money) readily available and accepted anywhere a credit card is, I wouldn’t even say it’s been inconvenient.</p>\\n<p>Even so, more than a few times, I’ve been roped into (or instigated, lol) hearty discussions with people who insist that there are indisputable reasons why I and everyone else should have a credit card. Despite some of those reasons being total garbage (”get a 20% discount on these American Eagle pants!”), I’ve found a few to be fairly compelling on more than one occasion — enough to make me think about whether my plastic abstinence is more rooted in dogma than reason. But time after time, thinking through even the best of these reasons only lands me right back where I’ve stood for several years now.</p>\\n<p>I’ve thought about it enough times now to warrant getting something written down; if anything, for the purpose of being able to point people to resource when I don’t have the patience to try to regurgitate thoughts from scratch in the moment.</p>\\n<p>So, here they are: my three favorite reasons to get a credit card, and why they’re still not good enough for me.</p>\\n<h2>1. “Credit cards are safer than debit cards.”</h2>\\n<p>This one gets me because it strikes right at my security gland. And it also comes off as pretty agreeable, because credit cards <em>do</em> offer solid protection in the event that either your number or physical card is used fraudulently. In fact, it’s the law. The <a href=\\\"https://www.experian.com/blogs/ask-experian/what-is-the-fair-credit-billing-act/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Fair Credit Billing Act</a> shields you from any responsibility for charges that occur after you report a stolen card. And even if the bad guys did rack up any charges before then, the maximum amount you’re responsible for is $50.</p>\\n<p>But even paying <em>that</em> is pretty rare. Most major credit cards have <a href=\\\"https://www.investopedia.com/terms/z/zero-liability-policy.asp\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">zero-liability policies</a>, meaning you won’t owe a cent on anything purchased by anyone but yourself — no matter how or when the purchase was made. It’s little surprise that people tout the peace of mind credit cards offer in this way, especially in an age when online commerce dominates. You’d be hard-pressed to find yourself out of any sum of money due to someone getting a hold of your card, either physically or digitally.</p>\\n<p><strong>But! It’s also true that debit cards enjoy virtually the same level of security.</strong> And in an increasing number of cases, those protections are <em>exactly</em> the same. This type of plastic isn’t covered by the same legislation as credit cards. Rather, they fall within the scope of the <a href=\\\"https://www.ftc.gov/enforcement/statutes/electronic-fund-transfer-act\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Electronic Fund Transfer Act</a>. Under that law, the following protections are in force when your debit card becomes compromised, depending on how it happened:</p>\\n<h3>Physical Card is Lost/Stolen</h3>\\n<table>\\n<thead>\\n<tr>\\n<th>Reported Within</th>\\n<th>Maximum Liability</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td>within two days</td>\\n<td>$50</td>\\n</tr>\\n<tr>\\n<td>within 60 days</td>\\n<td>$500</td>\\n</tr>\\n<tr>\\n<td>greater than 60 days</td>\\n<td>unlimited</td>\\n</tr>\\n</tbody>\\n</table>\\n<h3>Card Number is Lost/Stolen</h3>\\n<table>\\n<thead>\\n<tr>\\n<th>Reported Within</th>\\n<th>Maximum Liability</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td>within 60 days</td>\\n<td>$0</td>\\n</tr>\\n<tr>\\n<td>greater than 60 days</td>\\n<td>unlimited</td>\\n</tr>\\n</tbody>\\n</table>\\n<p>Just taking these restrictions at face value, the only chance you’re going to be liable for an extraordinary amount of money is if you fail to report your card within 60 days. And if takes you that long to realize something’s going on, I’d question whether you’re even adult enough to have a card to begin with.</p>\\n<h3>Zero-Liability for Everyone</h3>\\n<p>But still, there’s good news on top of that — <strong>more and more providers are choosing to offer the same zero-liability policies on their</strong> <em><strong>debit</strong></em> <strong>cards too</strong>. The top two players dominating this space are <a href=\\\"https://www.fool.com/the-ascent/research/credit-debit-card-market-share-network-issuer/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Visa and Mastercard</a>. And <em>both</em> have zero-liability policies in place — regardless of whether your card is physically lost/stolen. (For more reading, here are details on <a href=\\\"https://www.mastercard.us/en-us/personal/find-a-card/standard-mastercard-debit.html\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Mastercard’s policy</a>, and <a href=\\\"https://usa.visa.com/pay-with-visa/visa-chip-technology-consumers/zero-liability-policy.html\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">here’s Visa’s</a>.)</p>\\n<p>I called my own bank to verify this, and sure enough, here’s a snippet of the document I was emailed. The language is pretty clear, and the bank’s representative confirmed it verbally for me as well. No matter what the type of transaction, if it was unauthorized and I wasn’t being an idiot in exposing my card information, my butt’s covered:</p>\\n<p><img src='/proxy/2a39de6d-bd7e-42a7-bef1-14411bbdbc2a' alt='' loading='lazy' /></p>\\n<p>And that means, void of any hair-splitting intricacies I’m missing, <strong>a credit card doesn’t have a discernable security advantage over a debit card.</strong></p>\\n<h3>“But it takes TIME for fraud to be resolved!”</h3>\\n<p>On the surface, this concern sounds legitimate. If you have relatively straightforward financial needs, you might have a single account where most of your available spending money lives. And if that’s gone, even momentarily, it could wreak havoc on your day-to-day life. But most (read: practically all) debit cards come with daily purchase limits out of the box. They vary by bank &#x26; account, but with one of any sort in place, I have a hard time imagining one of these nightmare scenarios actually occurring.</p>\\n<p>But let’s say it happens. Maybe you temporarily increase the limit on your card, and someone takes advantage of that opportunity to clean you out. The felt consequences of that event are largely avoidable by <strong>maintaining a healthy emergency fund in a</strong> <em><strong>separate</strong></em> <strong>account</strong> – something every responsible adult should do anyway. If things get any weirder than that (e.g.: you raise the limit on BOTH accounts, both get fraudulently accessed, and every cent of both manages to get stolen at the same time), I think it’s time to change your identity altogether and commit to using straight cash for the rest of your life.</p>\\n<p>So, in light of the law, increasingly common zero-liability policies, built-in card protections, and the safeguards good money habits inherently bring with them, the appeal of this reason starts to become pretty weak.</p>\\n<h2>2. “I use the rewards to cover expenses I would’ve had anyway.”</h2>\\n<p>Out of the claims we’re looking at, this one’s advantage is its appeal to cold, hard reason. Everyone has boring, predictable expenses they need to make each month. Why <em>wouldn’t</em> you soften their blow by leveraging credit card perks, especially if those perks can be funneled right back into the category of “things I would’ve had to buy anyway” (think: cash back for groceries, airline points for an upcoming trip to visit family, etc.).</p>\\n<p>If I believed most people to be self-disciplined machines, I wouldn’t have an objection here, especially if you have a perfect, maybe even automated track record of paying off your card’s balance each month.</p>\\n<p>And to be fair, there are <em>real</em> stories of people raking in legitimate perks through their use of credit cards, <a href=\\\"https://web.archive.org/web/20210422211556/https://www.creditcards.com/credit-card-news/how-much-money-make-with-cash-back-cards/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">like Katie DeCicco</a>, who brings in ~$6,000/year with business expenses. Or <a href=\\\"https://www.pointswithacrew.com/about/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">this “travel hacker”</a> who prides himself on accumulating “free” airline miles for his family of eight.</p>\\n<p>But to be <em>even more</em> fair, we need to consider some contextual details. Katie had to spend <em>$650,000 dollars</em> to reap that $6k, and that travel hacker’s perks require far more effort than just regular, predictable spending, like routinely <a href=\\\"https://www.pointswithacrew.com/how-i-got-a-million-points-and-you-can-too/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">signing up for new cards</a> just for the sign-up bonuses. And at work underneath all of this is the human psyche, which isn’t highly regarded as being immune to subconscious influence. Unsurprisingly, there’s a wide body of research that thoroughly backs that up.</p>\\n<h3>Cards Make You Spend More</h3>\\n<p>The connection between your payment method of choice and your spending tendencies is pretty undeniable. When your options are reduced to either a card linked to someone else’s money and physical cash that belongs to <em>you</em>, you spend (probably unknowingly) far more with card than you do cash. Just a few examples:</p>\\n<ul>\\n<li>An <a href=\\\"https://link.springer.com/article/10.1023/A:1008196717017\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">MIT study found</a> that people are willing to spend up to <em>100% more</em> using credit cards.</li>\\n<li>Toll rates tended to <a href=\\\"https://www.nber.org/papers/w12924\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">increase by 20-40%</a> once electronic/automatic payment mechanisms were installed.</li>\\n<li>People were found to tip <a href=\\\"https://fortunly.com/statistics/cash-versus-credit-card-spending-statistics#according-to-an-mit-study-credit-cards-make-people-spend-more-money-sometimes-up-to-83-more\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">13% more when paying with a credit card</a>.</li>\\n</ul>\\n<p>If you dig into some of these and other sources, there’s a common thread as to why people behave this way. <strong>It</strong> <em><strong>feels</strong></em> <strong>different giving your physical cash away than it does a quick swipe of a card.</strong> And there’s more at play than just a different “feeling.” <a href=\\\"https://www.cmu.edu/homepage/practical/2007/winter/spending-til-it-hurts.shtml\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">As George Loewenstein noted</a> after studying the relationship between making purchases and the brain’s registration of pain:</p>\\n<blockquote>\\n<p>Credit cards effectively anesthetize the pain of paying. You swipe the card and it doesn’t feel like you’re giving anything up to make the purchase, unlike paying cash where you have to hand over bills.</p>\\n</blockquote>\\n<p>Summarized: when it hurts less, it costs more.</p>\\n<h3>“Ok, but debit cards are <em>cards</em> too, right?”</h3>\\n<p>Yes — the fact that a debit card is still a <em>card</em> means that its users are subject to many of the same psychological forces as a credit card. But there are a couple of distinctions between the two that make the credit card worse:</p>\\n<p><strong>First, they mess with our tendency to make decisions based on the amount of resources we</strong> <em><strong>think</strong></em> <strong>we have available</strong>. <a href=\\\"https://www.inverse.com/culture/59670-credit-card-psychology\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Dr. Carey Morewedge</a> refers to this perception as “cognitive availability.” If we think a purchase would take up a decent chunk of our available money, it hurts more, decreasing our chance of doing it.</p>\\n<p>For example, if I’m carrying $100 in cash and I’m considering a $50 purchase, that decision would mean parting with <em>50%</em> of my available money. Ouch. But that same $50 purchase would be a lot less painful if I were to use a debit card linked to a checking account with $10,000 in it.</p>\\n<p>Credit cards take this to an entirely new level, kicking the bottom out of the amount of money you have “cognitively available.” When you use a credit card, there’s virtually <em>no limit</em> at all, aside from whatever daily transaction limit exists. And that means there’s far, <em>far</em> less “payment pain” using a credit card over any other payment methods.</p>\\n<p><strong>Second, it screws with our already poor habit of valuing the present over the future.</strong> When we use a debit card, the consequence of that decision is felt immediately (the money is taken right out of your account), putting the satisfaction of whatever we just purchased in a dimmer light. But with a credit card, that pain is pushed off into the future, taking a back seat to the immediate gratification of whatever how belongs to us. Morewedge explains it better:</p>\\n<blockquote>\\n<p>I don’t value my future money as much as I value my present money, and so with a credit card, by moving the payment into the future, it’s less psychologically painful than if I paid right now.</p>\\n</blockquote>\\n<p>And based on the limited amount of research I was able to find directly comparing credit cards and debit cards, all of this seems to hold up, with credit cards taking the #1 spot in terms of <a href=\\\"https://irrationallabs.com/content/uploads/2020/04/Irrationally-Healthy.pdf\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">most money spent at a grocery store.</a></p>\\n<p>Of course, at the end of the day, all the research in the world won’t sway a person who believes they’re the exception to it. Still, it’s worth asking: do you really think that using a card with a built-in reward mechanism and that’s attached to someone else’s money <em>doesn’t</em> have a subconscious impact on your spending? If you answer “yes,” you might be right and you’re in the minority who’s risen above these psychological forces.</p>\\n<p>But you’re probably not.</p>\\n<h2>3. “I need a credit card to build a healthy credit score.”</h2>\\n<p>Ok, it’s a straight-up fact that you don’t <em>need</em> a credit score to live life in the modern world. Despite that truth, many still think it’s necessary to do things like get into an apartment, rent a car, or get a mortgage. <strong>But you can pretty much always do these things via alternative methods</strong>. Google it. Listen to <a href=\\\"https://www.youtube.com/watch?v=1alhWkWyijs\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">this episode</a> of <em>The Fine Print</em> podcast. Or call around yourself.</p>\\n<p>That aside, the hassle required to do some of these things make it a little more complicated. For some things, having a poor or non-existent score racks up to a minor inconvenience (you might need to put up a larger rental deposit or submit some more extensive proof that you have an income and pay your bills on time, etc.). But for others, it can be a serious pain in the cheeks — like getting a mortgage manually underwritten. It’d be remiss of me to not acknowledge some of the horror stories in navigating this process, like <a href=\\\"https://danwatt.org/2020/10/actually-getting-a-mortgage-with-no-credit-score\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">this one from a friend</a>.</p>\\n<p>Just hearing stories like that stresses me out. And imagining going through it myself helps me understand why having a card for this reason is so appealing. At the same time, it enrages me that we live within a system designed to depend on such a backwards method of “qualifying” someone to do something. I could have zero debt, a perfect housing/utilities payment history, have been awarded the Medal of Honor, and STILL have a harder time getting a decent mortgage than someone who’s played the FICO game well.</p>\\n<p>In fact, virtually none of how that score is calculated has anything to do with healthy money habits (saving, budgeting, investing, paying your bills on time, etc.). Instead, there’s a heckuva large focus on <a href=\\\"https://www.equifax.com/personal/education/credit/score/how-is-credit-score-calculated\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">how well you “manage” debt</a>, rewarding those who play according to the rules with the <a href=\\\"https://www.experian.com/blogs/ask-experian/why-would-you-want-a-good-credit-score/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">primary privilege of taking on more debt</a>. It’s almost as if it was designed to be cyclically manipulative.</p>\\n<h3>Make Your Past Mistakes Work for You</h3>\\n<p>The slimy, senseless nature of the credit score is enough to make me opt out of chasing it altogether (even if it will cost me a slice of my sanity).</p>\\n<p>But if you choose to do the same, it still doesn’t necessarily mean you’re signing up for a world of hurt. If you already have outstanding debt you’re paying off, you can use it to maintain a decent score for the time being. It’s untrue that regularly swiping plastic is the only or most impactful thing you can do for your score. In reality, staying on top of <em>any</em> debt will factor into it — <a href=\\\"https://www.nerdwallet.com/article/loans/student-loans/do-student-loans-affect-your-credit\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">like student loans</a>.</p>\\n<p>I’m an example of this. Over the course of ~4 years, we paid off ~$50k in student loans. Our credit score held up just fine, and after we were done, we had no problems going through the traditional mortgage process, despite not having used a card in several years. We certainly weren’t relieved to have debt for this purpose, but it was helpful being able to make useful what was otherwise a regretful burden.</p>\\n<p>No matter which way you slice it, saying someone “needs” a card to build a score should raise some eyebrows on multiple levels. And I only buy into things that cause my eyebrows to stand firm and level.</p>\\n<h2>No, I’m not Amish.</h2>\\n<p>I guess no one’s actually asked me that, but it’s the vibe I get sometimes when someone finds out I haven’t used a credit card in a decade. I don’t mind — I’m an Enneagram #3, so I actually kind of like the attention (perhaps that’s factored into why I’ve chosen this path, lol).</p>\\n<p>But just for thoroughness, I should note that I happily use tools like Venmo &#x26; Google Pay (don’t h8), and of course, my debit card. Like I said before, life isn’t really inconvenient as a result of living this way. It’s just one that’s tied to money that actually exists, with a built-in safety mechanism to deter me from making stupid financial decisions. I won’t say you <em>must</em> follow suit, but I will issue a challenge:</p>\\n<p>Do it, and you won’t regret it as much as you think you will. Cut ‘em up! 🙂</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 19,
        "title": "Passing Variables to Markdown Files in Gatsby",
        "slug": "passing-variables-to-markdown",
        "html": "<p>All of the documentation and a few miscellaneous text blobs you see on <a href=\"http://typeitjs.com/\" target=\"_blank\" rel=\"noopener\">typeitjs.com</a> are sourced from Markdown files built using Gatsby’s <a href=\"https://www.gatsbyjs.com/plugins/gatsby-transformer-remark/\" target=\"_blank\" rel=\"noopener\">gatsby-transformer-remark</a> plugin. Sprinkled throughout the content are several references to the current published version of the library (ex: <code>v8.0.7</code>).</p>\n<p>When a new version is published, it’d be an error-prone pain to change each of these references manually. Instead, I’ve set up a programmatic solution, allowing me to drop in fixed variable directly into a Markdown file as needed, and then swap that out for the actual value. So, something like this…</p>\n<div class=\"remark-highlight\"><pre class=\"language-markdown\"><code class=\"language-markdown\"><span class=\"token title important\"><span class=\"token punctuation\">#</span> Stuff About TypeIt</span>\n\nThe version of TypeIt is @{TYPEIT_VERSION}.\n</code></pre></div>\n<p>…would end up as HTML, but in place of <code>@{TYPEIT_VERSION}</code>, there’d remain “v8.0.7” (or whatever the value might be).</p>\n<p>The setup for this relatively straightforward, and should be easy enough to replicate on any other similar platform. Let’s walk through how that process looked for me:</p>\n<h2>Make a Function to Replace Variable Names</h2>\n<p>The root of the solutions is creating a means of accepting a piece of content, parsing that content for a variable name, and then swapping the names we find with the correct values. We can use a single JavaScript function to make that happen:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> variables <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token constant\">TYPEIT_VERSION</span><span class=\"token operator\">:</span> <span class=\"token string\">'v8.0.7'</span><span class=\"token punctuation\">,</span> \n    <span class=\"token constant\">TYPEIT_BUNDLE_SIZE</span><span class=\"token operator\">:</span> <span class=\"token string\">'3.6kb'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">processVariables</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">content</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> content<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">@{<span class=\"token group punctuation\">(</span><span class=\"token char-set class-name\">\\S</span><span class=\"token quantifier number\">+</span><span class=\"token group punctuation\">)</span>}</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">match<span class=\"token punctuation\">,</span> variableName</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">if</span><span class=\"token punctuation\">(</span>variables<span class=\"token punctuation\">[</span>variableName<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token keyword control-flow\">return</span> variables<span class=\"token punctuation\">[</span>variableName<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token keyword control-flow\">throw</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Variable does not have value: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>variableName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>As that function accepts content, we run a regular expression against it, which will match any set of characters that contained by <code>@{</code> and <code>}</code> that does <em>not</em> have whitespace in it. Then, for each match we find, we check for the respective value in <code>variables</code>. If it’s there, return the value. If it’s not throw an error, since we probably don’t want to ship content that contains ugly, invalid variable names.</p>\n<p>Applying it to a few example strings yields the following results:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">processVariables</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"The version is: @{TYPEIT_VERSION}\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 'The version is: v8.0.7'</span>\n\n<span class=\"token function\">processVariables</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"This string @{does not match the pattern!}\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 'This string @{does not match the pattern!}'</span>\n\n<span class=\"token function\">processVariables</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"This string @{MISSING_VALUE}\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Uncaught: Variable does not have value: MISSING_VALUE</span>\n</code></pre></div>\n<p>With that piece in place, we’re ready to integrate it into the Markdown handling process.</p>\n<h2>The Quick &#x26; Dirty Implementation</h2>\n<p>If you’ve gotta cut some corners and just need to get some content on the screen, the (arguably) quickest way to implement our new function is by filtering the processed HTML from your Markdown files before rendering it with React:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> processVariables <span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> '<span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>some<span class=\"token operator\">/</span>file<span class=\"token punctuation\">.</span><span class=\"token property-access\">js</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\"><span class=\"token maybe-class-name\">MyPage</span></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> typeItVersion <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> props<span class=\"token punctuation\">.</span><span class=\"token property-access\">data</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">site</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">siteMetadata</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> html <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> props<span class=\"token punctuation\">.</span><span class=\"token property-access\">data</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">markdownRemark</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">(</span>\n        <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">></span>\n            <span class=\"token operator\">&#x3C;</span>h1<span class=\"token operator\">></span><span class=\"token maybe-class-name\">My</span> <span class=\"token maybe-class-name\">Page</span><span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n            \n            <span class=\"token operator\">&#x3C;</span>div dangerouslySetInnerHTML<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\n                <span class=\"token literal-property property\">__html</span><span class=\"token operator\">:</span> <span class=\"token function\">processVariables</span><span class=\"token punctuation\">(</span>html<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> typeItVersion <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n            <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>However, there’s a slight cost with this approach. Gatsby will server-render the HTML with the processed variables, and will then hydrate the page with the same JS that was initially used the process the content. As a result, you’re technically sending more code to the client than needed (negligible impact, but still). Ideally, the variable replacement would exclusively happen on build, and strictly pass the processed content to the client.</p>\n<p>Thankfully, there’s a better and not-that-much-more-time-consuming way.</p>\n<h2>Create a Tiny Remark <strong>Transformer Plugin</strong></h2>\n<p>Gatsby has a blessed means of building plugins to safely integrate with <code>gatsby-transformer-remark</code>, and they provide some solid documentation on <a href=\"https://www.gatsbyjs.com/tutorial/remark-plugin-tutorial/\" target=\"_blank\" rel=\"noopener\">getting started</a>. For our case, we don’t need much.</p>\n<p>First, create a new <code>plugins/gatsby-remark-process-variables</code> directory where the plugin will live, and initialize an npm project with an <code>index.js</code> file.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\">mkdir <span class=\"token operator\">-</span>p plugins<span class=\"token operator\">/</span>gatsby<span class=\"token operator\">-</span>remark<span class=\"token operator\">-</span>process<span class=\"token operator\">-</span>variables\ncd plugins<span class=\"token operator\">/</span>gatsby<span class=\"token operator\">-</span>remark<span class=\"token operator\">-</span>process<span class=\"token operator\">-</span>variables\nnpm init <span class=\"token operator\">--</span>yes\ntouch index<span class=\"token punctuation\">.</span><span class=\"token property-access\">js</span>\n</code></pre></div>\n<p>Then, load our newly created plugin in the <code>gatsby-config.js</code> file:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// ... other stuff</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">resolve</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">gatsby-transformer-remark</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">options</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                    require<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">./plugins/gatsby-remark-process-variables</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>And paste in some simple boilerplate for the plugin:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// plugins/gatsby-remark-process-variables/index.js</span>\n\nmodule<span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> markdownAST <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> markdownAST<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>That <code>markdownAST</code> refers to the <a href=\"https://github.com/syntax-tree/mdast\" target=\"_blank\" rel=\"noopener\">Markdown Abstract Syntax Tree</a> that we’ll be processing. If you’re unfamiliar, it’s a data specification used to represent content (in this case, Markdown) via JavaScript object. The AST can contain several nested layers of nodes, so instead of writing our own recursive code to crawl through that three, let’s use one that handles that for us.</p>\n<p>Install it with <code>npm install unist-util-map@^2</code>. That version constraint important, since the latest version of the package is ESM-only, and we’re bound to end up with errors during the Gatsby build. This won’t be a problem forever, but it’s a hassle now.</p>\n<p>After doing so, we’re ready to apply our <code>processVariables</code> function to each node in the tree.</p>\n<div class=\"remark-highlight\"><pre class=\"language-diff\"><code class=\"language-diff\">// plugins/gatsby-remark-process-variables/index.js\n\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\"> const map = require('unist-util-map');</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\"> const processVariables = require('./some/file.js') </span>\n<span class=\"token line\"></span></span>\nmodule.exports = ({ markdownAST }) => {\n<span class=\"token deleted-sign deleted\"><span class=\"token prefix deleted\">-</span><span class=\"token line\">\treturn markdownAST;</span>\n<span class=\"token line\"></span></span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">\treturn map(markdownAST, function (node) {</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">    if (node.value) {</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">        node.value = processVariables(node.value);</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">    }</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\"></span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">     return node;</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   });</span>\n<span class=\"token line\"></span></span>}\n</code></pre></div>\n<p>With that in place, running and/or building our Gatsby site will result in each Markdown-embedded variable being replaced with the correct value. No more error-prone search &#x26; replace, and not a lick of extra client-side code.</p>\n<h2>See It Live</h2>\n<p>If you’d like to see the actual code I used on TypeIt’s site to pull this all of, <a href=\"https://github.com/alexmacarthur/typeit-site-gatsby/blob/cf2f72ec02a27921f30b93d12aba7703f9ac396b/plugins/gatsby-remark-process-variables/index.js\" target=\"_blank\" rel=\"noopener\">have at it!</a></p>\n",
        "feature_image": "https://images.pexels.com/photos/952594/pexels-photo-952594.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;h=750&amp;w=1200",
        "status": "published",
        "created_at": 1638162000000,
        "published_at": 1638162000000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>All of the documentation and a few miscellaneous text blobs you see on <a href=\\\"http://typeitjs.com/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">typeitjs.com</a> are sourced from Markdown files built using Gatsby’s <a href=\\\"https://www.gatsbyjs.com/plugins/gatsby-transformer-remark/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">gatsby-transformer-remark</a> plugin. Sprinkled throughout the content are several references to the current published version of the library (ex: <code>v8.0.7</code>).</p>\\n<p>When a new version is published, it’d be an error-prone pain to change each of these references manually. Instead, I’ve set up a programmatic solution, allowing me to drop in fixed variable directly into a Markdown file as needed, and then swap that out for the actual value. So, something like this…</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-markdown\\\"><code class=\\\"language-markdown\\\"><span class=\\\"token title important\\\"><span class=\\\"token punctuation\\\">#</span> Stuff About TypeIt</span>\\n\\nThe version of TypeIt is @{TYPEIT_VERSION}.\\n</code></pre></div>\\n<p>…would end up as HTML, but in place of <code>@{TYPEIT_VERSION}</code>, there’d remain “v8.0.7” (or whatever the value might be).</p>\\n<p>The setup for this relatively straightforward, and should be easy enough to replicate on any other similar platform. Let’s walk through how that process looked for me:</p>\\n<h2>Make a Function to Replace Variable Names</h2>\\n<p>The root of the solutions is creating a means of accepting a piece of content, parsing that content for a variable name, and then swapping the names we find with the correct values. We can use a single JavaScript function to make that happen:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> variables <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token constant\\\">TYPEIT_VERSION</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">'v8.0.7'</span><span class=\\\"token punctuation\\\">,</span> \\n    <span class=\\\"token constant\\\">TYPEIT_BUNDLE_SIZE</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">'3.6kb'</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">processVariables</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">content</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> content<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">replace</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token regex\\\"><span class=\\\"token regex-delimiter\\\">/</span><span class=\\\"token regex-source language-regex\\\">@{<span class=\\\"token group punctuation\\\">(</span><span class=\\\"token char-set class-name\\\">\\\\S</span><span class=\\\"token quantifier number\\\">+</span><span class=\\\"token group punctuation\\\">)</span>}</span><span class=\\\"token regex-delimiter\\\">/</span><span class=\\\"token regex-flags\\\">g</span></span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">match<span class=\\\"token punctuation\\\">,</span> variableName</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword control-flow\\\">if</span><span class=\\\"token punctuation\\\">(</span>variables<span class=\\\"token punctuation\\\">[</span>variableName<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token keyword control-flow\\\">return</span> variables<span class=\\\"token punctuation\\\">[</span>variableName<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n    \\n    <span class=\\\"token keyword control-flow\\\">throw</span> <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">Variable does not have value: </span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>variableName<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>As that function accepts content, we run a regular expression against it, which will match any set of characters that contained by <code>@{</code> and <code>}</code> that does <em>not</em> have whitespace in it. Then, for each match we find, we check for the respective value in <code>variables</code>. If it’s there, return the value. If it’s not throw an error, since we probably don’t want to ship content that contains ugly, invalid variable names.</p>\\n<p>Applying it to a few example strings yields the following results:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token function\\\">processVariables</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"The version is: @{TYPEIT_VERSION}\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token comment\\\">// 'The version is: v8.0.7'</span>\\n\\n<span class=\\\"token function\\\">processVariables</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"This string @{does not match the pattern!}\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token comment\\\">// 'This string @{does not match the pattern!}'</span>\\n\\n<span class=\\\"token function\\\">processVariables</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"This string @{MISSING_VALUE}\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token comment\\\">// Uncaught: Variable does not have value: MISSING_VALUE</span>\\n</code></pre></div>\\n<p>With that piece in place, we’re ready to integrate it into the Markdown handling process.</p>\\n<h2>The Quick &#x26; Dirty Implementation</h2>\\n<p>If you’ve gotta cut some corners and just need to get some content on the screen, the (arguably) quickest way to implement our new function is by filtering the processed HTML from your Markdown files before rendering it with React:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword module\\\">import</span> <span class=\\\"token imports\\\"><span class=\\\"token punctuation\\\">{</span> processVariables <span class=\\\"token punctuation\\\">}</span></span> <span class=\\\"token keyword module\\\">from</span> '<span class=\\\"token punctuation\\\">.</span><span class=\\\"token operator\\\">/</span>some<span class=\\\"token operator\\\">/</span>file<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">js</span>\\n\\n<span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\"><span class=\\\"token maybe-class-name\\\">MyPage</span></span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">props</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">{</span> typeItVersion <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token operator\\\">=</span> props<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">data</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">site</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">siteMetadata</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">{</span> html <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token operator\\\">=</span> props<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">data</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">markdownRemark</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token punctuation\\\">(</span>\\n        <span class=\\\"token operator\\\">&#x3C;</span><span class=\\\"token operator\\\">></span>\\n            <span class=\\\"token operator\\\">&#x3C;</span>h1<span class=\\\"token operator\\\">></span><span class=\\\"token maybe-class-name\\\">My</span> <span class=\\\"token maybe-class-name\\\">Page</span><span class=\\\"token operator\\\">&#x3C;</span><span class=\\\"token operator\\\">/</span>h1<span class=\\\"token operator\\\">></span>\\n            \\n            <span class=\\\"token operator\\\">&#x3C;</span>div dangerouslySetInnerHTML<span class=\\\"token operator\\\">=</span><span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">{</span>\\n                <span class=\\\"token literal-property property\\\">__html</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token function\\\">processVariables</span><span class=\\\"token punctuation\\\">(</span>html<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span> typeItVersion <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span>\\n            <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">}</span>\\n            <span class=\\\"token operator\\\">/</span><span class=\\\"token operator\\\">></span>\\n        <span class=\\\"token operator\\\">&#x3C;</span><span class=\\\"token operator\\\">/</span><span class=\\\"token operator\\\">></span>\\n    <span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>However, there’s a slight cost with this approach. Gatsby will server-render the HTML with the processed variables, and will then hydrate the page with the same JS that was initially used the process the content. As a result, you’re technically sending more code to the client than needed (negligible impact, but still). Ideally, the variable replacement would exclusively happen on build, and strictly pass the processed content to the client.</p>\\n<p>Thankfully, there’s a better and not-that-much-more-time-consuming way.</p>\\n<h2>Create a Tiny Remark <strong>Transformer Plugin</strong></h2>\\n<p>Gatsby has a blessed means of building plugins to safely integrate with <code>gatsby-transformer-remark</code>, and they provide some solid documentation on <a href=\\\"https://www.gatsbyjs.com/tutorial/remark-plugin-tutorial/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">getting started</a>. For our case, we don’t need much.</p>\\n<p>First, create a new <code>plugins/gatsby-remark-process-variables</code> directory where the plugin will live, and initialize an npm project with an <code>index.js</code> file.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\">mkdir <span class=\\\"token operator\\\">-</span>p plugins<span class=\\\"token operator\\\">/</span>gatsby<span class=\\\"token operator\\\">-</span>remark<span class=\\\"token operator\\\">-</span>process<span class=\\\"token operator\\\">-</span>variables\\ncd plugins<span class=\\\"token operator\\\">/</span>gatsby<span class=\\\"token operator\\\">-</span>remark<span class=\\\"token operator\\\">-</span>process<span class=\\\"token operator\\\">-</span>variables\\nnpm init <span class=\\\"token operator\\\">--</span>yes\\ntouch index<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">js</span>\\n</code></pre></div>\\n<p>Then, load our newly created plugin in the <code>gatsby-config.js</code> file:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token comment\\\">// ... other stuff</span>\\n<span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token literal-property property\\\">plugins</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">[</span>\\n        <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token literal-property property\\\">resolve</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">gatsby-transformer-remark</span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">,</span>\\n            <span class=\\\"token literal-property property\\\">options</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n                <span class=\\\"token literal-property property\\\">plugins</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">[</span>\\n                    require<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">resolve</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">./plugins/gatsby-remark-process-variables</span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span>\\n                <span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span>\\n            <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n        <span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token punctuation\\\">]</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p>And paste in some simple boilerplate for the plugin:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token comment\\\">// plugins/gatsby-remark-process-variables/index.js</span>\\n\\nmodule<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method-variable function-variable method function property-access\\\">exports</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\"><span class=\\\"token punctuation\\\">{</span> markdownAST <span class=\\\"token punctuation\\\">}</span></span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword control-flow\\\">return</span> markdownAST<span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p>That <code>markdownAST</code> refers to the <a href=\\\"https://github.com/syntax-tree/mdast\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Markdown Abstract Syntax Tree</a> that we’ll be processing. If you’re unfamiliar, it’s a data specification used to represent content (in this case, Markdown) via JavaScript object. The AST can contain several nested layers of nodes, so instead of writing our own recursive code to crawl through that three, let’s use one that handles that for us.</p>\\n<p>Install it with <code>npm install unist-util-map@^2</code>. That version constraint important, since the latest version of the package is ESM-only, and we’re bound to end up with errors during the Gatsby build. This won’t be a problem forever, but it’s a hassle now.</p>\\n<p>After doing so, we’re ready to apply our <code>processVariables</code> function to each node in the tree.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-diff\\\"><code class=\\\"language-diff\\\">// plugins/gatsby-remark-process-variables/index.js\\n\\n<span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"> const map = require('unist-util-map');</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"> const processVariables = require('./some/file.js') </span>\\n<span class=\\\"token line\\\"></span></span>\\nmodule.exports = ({ markdownAST }) => {\\n<span class=\\\"token deleted-sign deleted\\\"><span class=\\\"token prefix deleted\\\">-</span><span class=\\\"token line\\\">\\treturn markdownAST;</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">\\treturn map(markdownAST, function (node) {</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">    if (node.value) {</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">        node.value = processVariables(node.value);</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">    }</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"></span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">     return node;</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   });</span>\\n<span class=\\\"token line\\\"></span></span>}\\n</code></pre></div>\\n<p>With that in place, running and/or building our Gatsby site will result in each Markdown-embedded variable being replaced with the correct value. No more error-prone search &#x26; replace, and not a lick of extra client-side code.</p>\\n<h2>See It Live</h2>\\n<p>If you’d like to see the actual code I used on TypeIt’s site to pull this all of, <a href=\\\"https://github.com/alexmacarthur/typeit-site-gatsby/blob/cf2f72ec02a27921f30b93d12aba7703f9ac396b/plugins/gatsby-remark-process-variables/index.js\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">have at it!</a></p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 20,
        "title": "Conditionally Rendering ERB Templates from Different Directories with Ruby on Rails",
        "slug": "conditionally-rendering-templates-in-rails",
        "html": "<p>A while back, I was working in a Ruby on Rails project in which we wanted to test out different versions of features within our application, most of which were housed in separate ERB partials.</p>\n<p>For each feature, there’d be a default “experience”, but when a certain condition was met, we’d render an alternative, which might’ve contained slightly different markup, styles, or something else. To pull it off, we needed a way to maintain these different variants, as well as a means of reliably serving them whenever a particular experience was activated.</p>\n<p>This scenario led me down the path of exploring conditional template rendering with the two most popular approaches to handling ERB templates Rails — the <a href=\"https://doc.bccnsoft.com/docs/rails-guides-4.2.1-en/action_view_overview.html\" target=\"_blank\" rel=\"noopener\">Action View module</a>, and the <a href=\"https://viewcomponent.org/\" target=\"_blank\" rel=\"noopener\">View Component gem</a>. Under more typical circumstances, we’d be able to leverage the “variants” feature offered by both solutions. But this was complicated by the fact that we wanted our variant templates to live in a different directory from our defaults (they wouldn’t be siblings). This post is mostly just a recap of how I prototyped this somewhat unusual need with both of these tools.</p>\n<h2>Conditional Rendering w/ Action View</h2>\n<p>Out of the two approaches I explored, Action View definitely requires the least amount of lift, being that I could largely rely on out-of-the-box functional`ity provided by Rails.</p>\n<h3>Template File Structure</h3>\n<p>First, a quick overview of the template organization scheme with which I started. The default feature template would live in the standard <code>views</code> directory), and then for each variant, a template by the same name would reside in a directory housed under <code>views/experiences</code>. For example, consider an application with a <code>ProductController</code> and a single <code>index</code> action:</p>\n<div class=\"remark-highlight\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">ProductController</span> <span class=\"token operator\">&#x3C;</span> ApplicationController    \n\t<span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">index</span></span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n</code></pre></div>\n<p>And within the associated <code>app/views/product/index.html.erb</code> file, a <code>_comparison-table.erb</code> template is rendered:</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>h1</span><span class=\"token punctuation\">></span></span>Default Products Page<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>h1</span><span class=\"token punctuation\">></span></span>\n\n&#x3C;%= render \"comparison-table\" %>\n</code></pre></div>\n<p>When navigating to that route in the browser, some sort of “default” experience would be rendered:</p>\n<p><img src='/proxy/65b2498e-b799-4c18-bc5f-7a4860acb8ba' alt='' loading='lazy' /></p>\n<p>Now, imagine that “minimalist” and “maximalist” experiences were introduced for the application. Each of these experiences would have a dedicated directory (named according to that experience) that housed the alternative templates <strong>using the same folder structure</strong> (in this case, under the <code>product</code> namespace).</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token operator\">|</span>-- app/\n    <span class=\"token operator\">|</span>-- views/\n        <span class=\"token operator\">|</span>-- experiences/\n            <span class=\"token operator\">|</span>-- minimalist/\n                <span class=\"token operator\">|</span>-- product\n                    <span class=\"token operator\">|</span>-- _comparison-table.html.erb\t\n                    <span class=\"token operator\">|</span>-- index.html.erb\n            <span class=\"token operator\">|</span>-- maximalist/\n                <span class=\"token operator\">|</span>-- product\n                    <span class=\"token operator\">|</span>-- _comparison-table.html.erb\n                    <span class=\"token operator\">|</span>-- index.html.erb\n        <span class=\"token operator\">|</span>-- product\n\t        <span class=\"token operator\">|</span>-- _comparison-table.html.erb\n\t\t\t\t<span class=\"token operator\">|</span>-- index.html.erb\n</code></pre></div>\n<p>While arguably a little more complicated than dealing strictly with sibling template variants, this still feel pretty maintinable. When a new experience is introduced, I’d simply duplicate the relevant template files and tweak away.</p>\n<h3>Overriding Where Templates Are Searched</h3>\n<p>At the start of this, I assumed we’d now need to build out some sort of abstraction on top of Rails’ standard <code>render</code> method in order determine which template to show. But shortly after digging in, I ran into the <code>prepend_view_path</code> method within the <code>ActionView</code> module.</p>\n<p>This method is responsible for <a href=\"https://api.rubyonrails.org/classes/ActionView/ViewPaths/ClassMethods.html#method-i-prepend_view_path\" target=\"_blank\" rel=\"noopener\">prepending paths in which Rails searches for templates to render</a>. By default, that list of paths only contains <code>app/views</code>, but if you’d like Rails to look in another location first, you can configure that in a <code>before_action</code> hook. The following, for example, would tell any controller in an application to <em>first</em> look in the <code>app/views/experiences/minimalist</code> directory.</p>\n<div class=\"remark-highlight\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">ApplicationController</span> <span class=\"token operator\">&#x3C;</span> ActionController<span class=\"token double-colon punctuation\">::</span>Base\n\tbefore_action <span class=\"token symbol\">:prepend_experience_path</span>\n    \n\t<span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">prepend_experience_path</span></span>\n\t\tprepend_view_path <span class=\"token string-literal\"><span class=\"token string\">\"app/views/experiences/minimalist\"</span></span>\n\t<span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n</code></pre></div>\n<p>Then, whenever the <code>render</code> method is used in an ERB template, the “minimalist” template would be pulled — no other special implementation or custom code necessary:</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token comment\">&#x3C;!-- </span>\n<span class=\"token comment\">\tFirst searches for:</span>\n<span class=\"token comment\">    `app/views/experiences/minimalist/product/_comparison-table.html.erb` </span>\n<span class=\"token comment\">--></span>\n&#x3C;%= render \"comparison-table\" %>\n</code></pre></div>\n<p>Plus, this feature includes the <em>implicit</em> use of <code>render</code> directly within a controller action:</p>\n<div class=\"remark-highlight\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">ProductController</span> <span class=\"token operator\">&#x3C;</span> ApplicationController\n\t<span class=\"token comment\"># First searches for:</span>\n\t<span class=\"token comment\"># `app/views/experiences/minimalist/product/index.html.erb`</span>\n    <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">index</span></span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n</code></pre></div>\n<p>The nice part about this is that it falls back gracefully. If no template is found in that path, Rails will move onto the remaining list of paths to check. Using that most previous example, if <code>index.html.erb</code> didn’t exist within the <code>minimalist</code> experience path, it’d fall back to <code>app/views/product/index.html.erb</code> — the default experience.</p>\n<h3>Setting a Particular Experience</h3>\n<p>At this point, I needed a means of determining which experience is active for a given user, and then use that experience to choose the directory that’s first searched for templates. There’s a gazillion ways this might be handled (the database, a third-party feature flag tool, etc.), but for simplicity of demonstration, I’ll use a <code>?experience=experience_name</code> query string parameter in the URL. Here’s how that’d look in the inherited <code>ApplicationController</code>:</p>\n<div class=\"remark-highlight\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">ApplicationController</span> <span class=\"token operator\">&#x3C;</span> ActionController<span class=\"token double-colon punctuation\">::</span>Base\n    before_action <span class=\"token symbol\">:prepend_experience_path</span>\n\n    <span class=\"token comment\"># Only search in an \"experience\" directory if a query param is set in the URL.</span>\n    <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">prepend_experience_path</span></span>\n        prepend_view_path <span class=\"token string-literal\"><span class=\"token string\">\"app/views/experiences/</span><span class=\"token interpolation\"><span class=\"token delimiter punctuation\">#{</span><span class=\"token content\">experience</span><span class=\"token delimiter punctuation\">}</span></span><span class=\"token string\">\"</span></span> <span class=\"token keyword\">if</span> experience<span class=\"token punctuation\">.</span>present<span class=\"token operator\">?</span>\n    <span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">private</span>\n\n\t<span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">experience</span></span>\n\t\tparams<span class=\"token punctuation\">[</span><span class=\"token symbol\">:experience</span><span class=\"token punctuation\">]</span>\n\t<span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n</code></pre></div>\n<p>On each request, the specified experience is pulled from the <code>params</code> object with our <code>experience</code> method. Then, I’m prepending that particular experience’s path. Following the earlier example, if I were to navigate to the same page with the experience set in the URL, the page would now render something like this:</p>\n<p><img src='/proxy/f0485e05-eb4c-4998-93e6-6201748398e5' alt='' loading='lazy' /></p>\n<p>Easy conditional template rendering… by just leveraging what Rails gives us anyway!</p>\n<h2>Conditional Rendering w/ ViewComponents</h2>\n<p>If you’re not that familiar with GitHub’s <a href=\"https://github.com/github/view_component\" target=\"_blank\" rel=\"noopener\">view_component</a> gem, check it out. It toutes some pretty sick advantages — performance, testability, and encapsulation, to mention a few.</p>\n<p>Unfortunately, conditionally rendering different templates with ViewComponents is a little more complicated than with Action View. As far as my digging through the code &#x26; documentation went, there’s neither (yet) a public API for controlling where <code>.erb</code> templates are searched, nor a blessed means of dictating which template should be rendered for a given component. Regardless, it’s possible to pull off for my specific use case. Here’s the approach I took:</p>\n<h3>An Example Component</h3>\n<p>I used a simple “ProductCard” component for trying this out, which comes with a <code>ProducCardComponent</code> class that accepts <code>title</code>, <code>price</code>, and <code>experience</code> (which we’ll use to determine the rendered template) parameters:</p>\n<div class=\"remark-highlight\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># /app/components/product_card_component.rb</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ProductCardComponent</span> <span class=\"token operator\">&#x3C;</span> ViewComponent<span class=\"token double-colon punctuation\">::</span>Base\n    <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">initialize</span></span><span class=\"token punctuation\">(</span><span class=\"token symbol\">title</span><span class=\"token operator\">:</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">price</span><span class=\"token operator\">:</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">experience</span><span class=\"token operator\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"\"</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token variable\">@experience</span> <span class=\"token operator\">=</span> experience\n        <span class=\"token variable\">@title</span> <span class=\"token operator\">=</span> title\n        <span class=\"token variable\">@price</span> <span class=\"token operator\">=</span> price\n    <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n</code></pre></div>\n<p>And then there’s the ERB template itself:</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token comment\">&#x3C;!-- /app/components/product_card_component.html.erb --></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>h4</span><span class=\"token punctuation\">></span></span>Default Card<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>h4</span><span class=\"token punctuation\">></span></span>\n    Title: &#x3C;%= @title %>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>br</span> <span class=\"token punctuation\">/></span></span>\n    Price: $&#x3C;%= @price %>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>div</span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<p>Inside an ERB template, that’s instantiated like so:</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token comment\">&#x3C;!-- app/views/index.html.erb --></span>\n\n&#x3C;%= render(ProductCardComponent.new(title: \"A Product\", price: 49, experience: experience)) %>\n</code></pre></div>\n<p>Which ends up looking like this:</p>\n<p><img src='/proxy/add7f9c6-3e27-48eb-9b53-062acc690328' alt='' loading='lazy' /></p>\n<h3>Taking Over Template Rendering</h3>\n<p>By default, ViewComponent looks for a sibling ERB file within the <code>app/components</code> directory. But, as <a href=\"https://viewcomponent.org/guide/templates.html#inline\" target=\"_blank\" rel=\"noopener\">an alternative</a>, it’s possible to render content returned from a <code>call</code> method attached to the component class. And that can be used (or slightly hacked) to take full control over what’s rendered under certain conditions. Here’s how I started to wire that up:</p>\n<div class=\"remark-highlight\"><pre class=\"language-diff\"><code class=\"language-diff\">class ProductCardComponent &#x3C; ViewComponent::Base\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   def initialize(title:, price:, experience: \"\")</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">       @experience = experience</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">       @title = title</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">       @price = price</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   end</span>\n<span class=\"token line\"></span></span>\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">   # Grab a template's contents and turn it into HTML.</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   def call</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   \ttemplate_contents = File.read(template_path)</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">          </span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">       ERB.new(template_contents).result(binding).html_safe</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   end</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   </span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">private</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   </span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   # Use the same template path ViewComponet uses by default.</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   def template_path</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">       @template_path ||= \"#{Rails.root}/app/components/#{self.class.name.underscore}.html.erb\"</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   end</span>\n<span class=\"token line\"></span></span>end\n</code></pre></div>\n<p>With this change, I’m manually compiling our own ERB templates using the included <code>ERB</code> renderer (note: that <code>.result(binding)</code> piece is important — it’ll allow access to instance variables from within the template). That template is being targeted by transforming the name of the current class into the same format expected by ViewComponent.</p>\n<p>If you’re following along on your own and refresh the page at this point, you’d get an error. That’s because, out of the box, ViewComponent <a href=\"https://github.com/github/view_component/blob/main/lib/view_component/compiler.rb#L121\" target=\"_blank\" rel=\"noopener\">does not permit you to have both</a> a template in your <code>app/components</code> directory, <em>and</em> a <code>call</code> method on your class. To get around this hurdle and allow the component’s templates to remain in the standard <code>app/components</code> directory, I did a little meta-programming (and no, I did not feel spectacular about it):</p>\n<div class=\"remark-highlight\"><pre class=\"language-diff\"><code class=\"language-diff\">class ProductCardComponent &#x3C; ViewComponent::Base\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   def initialize(title:, price:, experience: \"\")</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">       @experience = experience</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">       @title = title</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">       @price = price</span>\n<span class=\"token line\"></span></span>\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">       wipe_out_templates</span>\n<span class=\"token line\"></span></span><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   end</span>\n<span class=\"token line\"></span></span>\n\tdef call\n\t\ttemplate_contents = File.read(template_path)\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\">       </span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">       ERB.new(template_contents).result(binding).html_safe</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   end</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\"></span>\n<span class=\"token line\"></span></span>private\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"></span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   def template_path</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">       @template_path ||= \"#{Rails.root}/app/components/#{self.class.name.underscore}.html.erb\"</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   end</span>\n<span class=\"token line\"></span></span>\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">   # Fake ViewComonent into thinking there are no templates in `app/components`.</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   def wipe_out_templates</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">       self.class.class_eval do</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">           def self._sidecar_files(_extensions)</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">               []</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">           end</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">       end</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   end</span>\n<span class=\"token line\"></span></span>end\n</code></pre></div>\n<p>With this in place, each time the component is instantiated, the static <code>_sidecar_files</code> method is overridden (a class method that literally has the word “EXPERIMENTAL” above it <a href=\"https://github.com/github/view_component/blob/main/lib/view_component/base.rb#L309\" target=\"_blank\" rel=\"noopener\">in the source</a>, lol). That override stomps out its original implementation, making the library believe that there are actually no ERB templates living in the directory. A little dirty-feeling, but still. Onward!</p>\n<h3>Conditionally Rendering Templates</h3>\n<p>Next up, I needed to introduce the logic for choosing a different template when a certain experience is active. To do that, I modified the <code>template_path</code> method and include two more:</p>\n<div class=\"remark-highlight\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">template_path</span></span> \n    <span class=\"token variable\">@template_path</span> <span class=\"token operator\">||=</span> <span class=\"token builtin\">File</span><span class=\"token punctuation\">.</span>exist<span class=\"token operator\">?</span><span class=\"token punctuation\">(</span>experience_template_path<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> experience_template_path <span class=\"token operator\">:</span> standard_template_path\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">experience_template_path</span></span>\n    <span class=\"token variable\">@experience_template_path</span> <span class=\"token operator\">||=</span> <span class=\"token string-literal\"><span class=\"token string\">\"</span><span class=\"token interpolation\"><span class=\"token delimiter punctuation\">#{</span><span class=\"token content\">Rails<span class=\"token punctuation\">.</span>root</span><span class=\"token delimiter punctuation\">}</span></span><span class=\"token string\">/app/components/experiences/</span><span class=\"token interpolation\"><span class=\"token delimiter punctuation\">#{</span><span class=\"token content\"><span class=\"token variable\">@experience</span></span><span class=\"token delimiter punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token delimiter punctuation\">#{</span><span class=\"token content\"><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span>underscore</span><span class=\"token delimiter punctuation\">}</span></span><span class=\"token string\">.html.erb\"</span></span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">standard_template_path</span></span>\n    <span class=\"token variable\">@standard_template_path</span> <span class=\"token operator\">||=</span> <span class=\"token string-literal\"><span class=\"token string\">\"</span><span class=\"token interpolation\"><span class=\"token delimiter punctuation\">#{</span><span class=\"token content\">Rails<span class=\"token punctuation\">.</span>root</span><span class=\"token delimiter punctuation\">}</span></span><span class=\"token string\">/app/components/</span><span class=\"token interpolation\"><span class=\"token delimiter punctuation\">#{</span><span class=\"token content\"><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span>underscore</span><span class=\"token delimiter punctuation\">}</span></span><span class=\"token string\">.html.erb\"</span></span>\n<span class=\"token keyword\">end</span>\n</code></pre></div>\n<p>Now, the component will first always check to see if it can render a template based on whatever experience is set (which might be none). If it can’t, the “standard” template will be used.</p>\n<h3>A Bit of Clean-Up</h3>\n<p>For housekeeping purposes, this can be arranged differently for better reuse among all components that might be introduced. To do that, I created a new <code>ExperienceableComponent</code> class from which all of my components extend, which will be responsible for containing all of this custom rendering logic. Altogether, it looked like this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">ExperienceableComponent</span> <span class=\"token operator\">&#x3C;</span> ViewComponent<span class=\"token double-colon punctuation\">::</span>Base\n    <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">initialize</span></span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>\n        wipe_out_templates\n    <span class=\"token keyword\">end</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">call</span></span>\n        template_contents <span class=\"token operator\">=</span> <span class=\"token builtin\">File</span><span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span>template_path<span class=\"token punctuation\">)</span>\n        \n        <span class=\"token class-name\">ERB</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span>template_contents<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>result<span class=\"token punctuation\">(</span>binding<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>html_safe\n    <span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">private</span> \n\n    <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">template_path</span></span> \n        <span class=\"token variable\">@template_path</span> <span class=\"token operator\">||=</span> <span class=\"token builtin\">File</span><span class=\"token punctuation\">.</span>exist<span class=\"token operator\">?</span><span class=\"token punctuation\">(</span>experience_template_path<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> experience_template_path <span class=\"token operator\">:</span> standard_template_path\n    <span class=\"token keyword\">end</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">experience_template_path</span></span>\n        <span class=\"token variable\">@experience_template_path</span> <span class=\"token operator\">||=</span> <span class=\"token string-literal\"><span class=\"token string\">\"</span><span class=\"token interpolation\"><span class=\"token delimiter punctuation\">#{</span><span class=\"token content\">Rails<span class=\"token punctuation\">.</span>root</span><span class=\"token delimiter punctuation\">}</span></span><span class=\"token string\">/app/components/experiences/</span><span class=\"token interpolation\"><span class=\"token delimiter punctuation\">#{</span><span class=\"token content\"><span class=\"token variable\">@experience</span></span><span class=\"token delimiter punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token delimiter punctuation\">#{</span><span class=\"token content\"><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span>underscore</span><span class=\"token delimiter punctuation\">}</span></span><span class=\"token string\">.html.erb\"</span></span>\n    <span class=\"token keyword\">end</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">standard_template_path</span></span>\n        <span class=\"token variable\">@standard_template_path</span> <span class=\"token operator\">||=</span> <span class=\"token string-literal\"><span class=\"token string\">\"</span><span class=\"token interpolation\"><span class=\"token delimiter punctuation\">#{</span><span class=\"token content\">Rails<span class=\"token punctuation\">.</span>root</span><span class=\"token delimiter punctuation\">}</span></span><span class=\"token string\">/app/components/</span><span class=\"token interpolation\"><span class=\"token delimiter punctuation\">#{</span><span class=\"token content\"><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span>underscore</span><span class=\"token delimiter punctuation\">}</span></span><span class=\"token string\">.html.erb\"</span></span>\n    <span class=\"token keyword\">end</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">wipe_out_templates</span></span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span>class_eval <span class=\"token keyword\">do</span>\n            <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token function\">_sidecar_files</span></span><span class=\"token punctuation\">(</span>_extensions<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n            <span class=\"token keyword\">end</span>\n        <span class=\"token keyword\">end</span>\n    <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n</code></pre></div>\n<p>After that abstraction, the actual component class can look a lot simpler:</p>\n<div class=\"remark-highlight\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">ProductCardComponent</span> <span class=\"token operator\">&#x3C;</span> ExperienceableComponent\n    <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">initialize</span></span><span class=\"token punctuation\">(</span><span class=\"token symbol\">title</span><span class=\"token operator\">:</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">price</span><span class=\"token operator\">:</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">experience</span><span class=\"token operator\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"\"</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token variable\">@experience</span> <span class=\"token operator\">=</span> experience\n        <span class=\"token variable\">@title</span> <span class=\"token operator\">=</span> title\n        <span class=\"token variable\">@price</span> <span class=\"token operator\">=</span> price\n\n        <span class=\"token keyword\">super</span>\n    <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n</code></pre></div>\n<p>With things feeling a little tidier, navigating to the same page with <code>?experience=minimalist</code> in the URL renders exactly what I wanted:</p>\n<p><img src='/proxy/2c8a3607-cb9b-4131-8fae-ae0448b05d41' alt='' loading='lazy' /></p>\n<p>And there you go. Despite the slight hackiness, we got it running!</p>\n<h2>Rails Developers are Smart</h2>\n<p>If there’s anything I really came to realize during all of this exploration, it’s that there’s a <em>ton</em> of considerations the Action View &#x26; ViewComponent contributors have balanced with excellence as they built (and continue to build) out these UI-rendering solutions. I can’t imagine building out a package of such scale that satisfies so many different use cases, including my own. But they did it. So, a brief message to those contributors: You’re a lot smarter than I am. But I’mma catch you.</p>\n<p>Thanks for tagging along!</p>\n",
        "feature_image": "https://images.pexels.com/photos/1831113/pexels-photo-1831113.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=3&amp;h=750&amp;w=1200",
        "status": "published",
        "created_at": 1637557200000,
        "published_at": 1637557200000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>A while back, I was working in a Ruby on Rails project in which we wanted to test out different versions of features within our application, most of which were housed in separate ERB partials.</p>\\n<p>For each feature, there’d be a default “experience”, but when a certain condition was met, we’d render an alternative, which might’ve contained slightly different markup, styles, or something else. To pull it off, we needed a way to maintain these different variants, as well as a means of reliably serving them whenever a particular experience was activated.</p>\\n<p>This scenario led me down the path of exploring conditional template rendering with the two most popular approaches to handling ERB templates Rails — the <a href=\\\"https://doc.bccnsoft.com/docs/rails-guides-4.2.1-en/action_view_overview.html\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Action View module</a>, and the <a href=\\\"https://viewcomponent.org/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">View Component gem</a>. Under more typical circumstances, we’d be able to leverage the “variants” feature offered by both solutions. But this was complicated by the fact that we wanted our variant templates to live in a different directory from our defaults (they wouldn’t be siblings). This post is mostly just a recap of how I prototyped this somewhat unusual need with both of these tools.</p>\\n<h2>Conditional Rendering w/ Action View</h2>\\n<p>Out of the two approaches I explored, Action View definitely requires the least amount of lift, being that I could largely rely on out-of-the-box functional`ity provided by Rails.</p>\\n<h3>Template File Structure</h3>\\n<p>First, a quick overview of the template organization scheme with which I started. The default feature template would live in the standard <code>views</code> directory), and then for each variant, a template by the same name would reside in a directory housed under <code>views/experiences</code>. For example, consider an application with a <code>ProductController</code> and a single <code>index</code> action:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">ProductController</span> <span class=\\\"token operator\\\">&#x3C;</span> ApplicationController    \\n\\t<span class=\\\"token keyword\\\">def</span> <span class=\\\"token method-definition\\\"><span class=\\\"token function\\\">index</span></span><span class=\\\"token punctuation\\\">;</span> <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre></div>\\n<p>And within the associated <code>app/views/product/index.html.erb</code> file, a <code>_comparison-table.erb</code> template is rendered:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>h1</span><span class=\\\"token punctuation\\\">></span></span>Default Products Page<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>h1</span><span class=\\\"token punctuation\\\">></span></span>\\n\\n&#x3C;%= render \\\"comparison-table\\\" %>\\n</code></pre></div>\\n<p>When navigating to that route in the browser, some sort of “default” experience would be rendered:</p>\\n<p><img src='/proxy/65b2498e-b799-4c18-bc5f-7a4860acb8ba' alt='' loading='lazy' /></p>\\n<p>Now, imagine that “minimalist” and “maximalist” experiences were introduced for the application. Each of these experiences would have a dedicated directory (named according to that experience) that housed the alternative templates <strong>using the same folder structure</strong> (in this case, under the <code>product</code> namespace).</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\"><span class=\\\"token operator\\\">|</span>-- app/\\n    <span class=\\\"token operator\\\">|</span>-- views/\\n        <span class=\\\"token operator\\\">|</span>-- experiences/\\n            <span class=\\\"token operator\\\">|</span>-- minimalist/\\n                <span class=\\\"token operator\\\">|</span>-- product\\n                    <span class=\\\"token operator\\\">|</span>-- _comparison-table.html.erb\\t\\n                    <span class=\\\"token operator\\\">|</span>-- index.html.erb\\n            <span class=\\\"token operator\\\">|</span>-- maximalist/\\n                <span class=\\\"token operator\\\">|</span>-- product\\n                    <span class=\\\"token operator\\\">|</span>-- _comparison-table.html.erb\\n                    <span class=\\\"token operator\\\">|</span>-- index.html.erb\\n        <span class=\\\"token operator\\\">|</span>-- product\\n\\t        <span class=\\\"token operator\\\">|</span>-- _comparison-table.html.erb\\n\\t\\t\\t\\t<span class=\\\"token operator\\\">|</span>-- index.html.erb\\n</code></pre></div>\\n<p>While arguably a little more complicated than dealing strictly with sibling template variants, this still feel pretty maintinable. When a new experience is introduced, I’d simply duplicate the relevant template files and tweak away.</p>\\n<h3>Overriding Where Templates Are Searched</h3>\\n<p>At the start of this, I assumed we’d now need to build out some sort of abstraction on top of Rails’ standard <code>render</code> method in order determine which template to show. But shortly after digging in, I ran into the <code>prepend_view_path</code> method within the <code>ActionView</code> module.</p>\\n<p>This method is responsible for <a href=\\\"https://api.rubyonrails.org/classes/ActionView/ViewPaths/ClassMethods.html#method-i-prepend_view_path\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">prepending paths in which Rails searches for templates to render</a>. By default, that list of paths only contains <code>app/views</code>, but if you’d like Rails to look in another location first, you can configure that in a <code>before_action</code> hook. The following, for example, would tell any controller in an application to <em>first</em> look in the <code>app/views/experiences/minimalist</code> directory.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">ApplicationController</span> <span class=\\\"token operator\\\">&#x3C;</span> ActionController<span class=\\\"token double-colon punctuation\\\">::</span>Base\\n\\tbefore_action <span class=\\\"token symbol\\\">:prepend_experience_path</span>\\n    \\n\\t<span class=\\\"token keyword\\\">def</span> <span class=\\\"token method-definition\\\"><span class=\\\"token function\\\">prepend_experience_path</span></span>\\n\\t\\tprepend_view_path <span class=\\\"token string-literal\\\"><span class=\\\"token string\\\">\\\"app/views/experiences/minimalist\\\"</span></span>\\n\\t<span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre></div>\\n<p>Then, whenever the <code>render</code> method is used in an ERB template, the “minimalist” template would be pulled — no other special implementation or custom code necessary:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token comment\\\">&#x3C;!-- </span>\\n<span class=\\\"token comment\\\">\\tFirst searches for:</span>\\n<span class=\\\"token comment\\\">    `app/views/experiences/minimalist/product/_comparison-table.html.erb` </span>\\n<span class=\\\"token comment\\\">--></span>\\n&#x3C;%= render \\\"comparison-table\\\" %>\\n</code></pre></div>\\n<p>Plus, this feature includes the <em>implicit</em> use of <code>render</code> directly within a controller action:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">ProductController</span> <span class=\\\"token operator\\\">&#x3C;</span> ApplicationController\\n\\t<span class=\\\"token comment\\\"># First searches for:</span>\\n\\t<span class=\\\"token comment\\\"># `app/views/experiences/minimalist/product/index.html.erb`</span>\\n    <span class=\\\"token keyword\\\">def</span> <span class=\\\"token method-definition\\\"><span class=\\\"token function\\\">index</span></span><span class=\\\"token punctuation\\\">;</span> <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre></div>\\n<p>The nice part about this is that it falls back gracefully. If no template is found in that path, Rails will move onto the remaining list of paths to check. Using that most previous example, if <code>index.html.erb</code> didn’t exist within the <code>minimalist</code> experience path, it’d fall back to <code>app/views/product/index.html.erb</code> — the default experience.</p>\\n<h3>Setting a Particular Experience</h3>\\n<p>At this point, I needed a means of determining which experience is active for a given user, and then use that experience to choose the directory that’s first searched for templates. There’s a gazillion ways this might be handled (the database, a third-party feature flag tool, etc.), but for simplicity of demonstration, I’ll use a <code>?experience=experience_name</code> query string parameter in the URL. Here’s how that’d look in the inherited <code>ApplicationController</code>:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">ApplicationController</span> <span class=\\\"token operator\\\">&#x3C;</span> ActionController<span class=\\\"token double-colon punctuation\\\">::</span>Base\\n    before_action <span class=\\\"token symbol\\\">:prepend_experience_path</span>\\n\\n    <span class=\\\"token comment\\\"># Only search in an \\\"experience\\\" directory if a query param is set in the URL.</span>\\n    <span class=\\\"token keyword\\\">def</span> <span class=\\\"token method-definition\\\"><span class=\\\"token function\\\">prepend_experience_path</span></span>\\n        prepend_view_path <span class=\\\"token string-literal\\\"><span class=\\\"token string\\\">\\\"app/views/experiences/</span><span class=\\\"token interpolation\\\"><span class=\\\"token delimiter punctuation\\\">#{</span><span class=\\\"token content\\\">experience</span><span class=\\\"token delimiter punctuation\\\">}</span></span><span class=\\\"token string\\\">\\\"</span></span> <span class=\\\"token keyword\\\">if</span> experience<span class=\\\"token punctuation\\\">.</span>present<span class=\\\"token operator\\\">?</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">private</span>\\n\\n\\t<span class=\\\"token keyword\\\">def</span> <span class=\\\"token method-definition\\\"><span class=\\\"token function\\\">experience</span></span>\\n\\t\\tparams<span class=\\\"token punctuation\\\">[</span><span class=\\\"token symbol\\\">:experience</span><span class=\\\"token punctuation\\\">]</span>\\n\\t<span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre></div>\\n<p>On each request, the specified experience is pulled from the <code>params</code> object with our <code>experience</code> method. Then, I’m prepending that particular experience’s path. Following the earlier example, if I were to navigate to the same page with the experience set in the URL, the page would now render something like this:</p>\\n<p><img src='/proxy/f0485e05-eb4c-4998-93e6-6201748398e5' alt='' loading='lazy' /></p>\\n<p>Easy conditional template rendering… by just leveraging what Rails gives us anyway!</p>\\n<h2>Conditional Rendering w/ ViewComponents</h2>\\n<p>If you’re not that familiar with GitHub’s <a href=\\\"https://github.com/github/view_component\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">view_component</a> gem, check it out. It toutes some pretty sick advantages — performance, testability, and encapsulation, to mention a few.</p>\\n<p>Unfortunately, conditionally rendering different templates with ViewComponents is a little more complicated than with Action View. As far as my digging through the code &#x26; documentation went, there’s neither (yet) a public API for controlling where <code>.erb</code> templates are searched, nor a blessed means of dictating which template should be rendered for a given component. Regardless, it’s possible to pull off for my specific use case. Here’s the approach I took:</p>\\n<h3>An Example Component</h3>\\n<p>I used a simple “ProductCard” component for trying this out, which comes with a <code>ProducCardComponent</code> class that accepts <code>title</code>, <code>price</code>, and <code>experience</code> (which we’ll use to determine the rendered template) parameters:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token comment\\\"># /app/components/product_card_component.rb</span>\\n\\n<span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">ProductCardComponent</span> <span class=\\\"token operator\\\">&#x3C;</span> ViewComponent<span class=\\\"token double-colon punctuation\\\">::</span>Base\\n    <span class=\\\"token keyword\\\">def</span> <span class=\\\"token method-definition\\\"><span class=\\\"token function\\\">initialize</span></span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token symbol\\\">title</span><span class=\\\"token operator\\\">:</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token symbol\\\">price</span><span class=\\\"token operator\\\">:</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token symbol\\\">experience</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string-literal\\\"><span class=\\\"token string\\\">\\\"\\\"</span></span><span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token variable\\\">@experience</span> <span class=\\\"token operator\\\">=</span> experience\\n        <span class=\\\"token variable\\\">@title</span> <span class=\\\"token operator\\\">=</span> title\\n        <span class=\\\"token variable\\\">@price</span> <span class=\\\"token operator\\\">=</span> price\\n    <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre></div>\\n<p>And then there’s the ERB template itself:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token comment\\\">&#x3C;!-- /app/components/product_card_component.html.erb --></span>\\n\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>div</span><span class=\\\"token punctuation\\\">></span></span>\\n    <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>h4</span><span class=\\\"token punctuation\\\">></span></span>Default Card<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>h4</span><span class=\\\"token punctuation\\\">></span></span>\\n    Title: &#x3C;%= @title %>\\n    <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>br</span> <span class=\\\"token punctuation\\\">/></span></span>\\n    Price: $&#x3C;%= @price %>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>div</span><span class=\\\"token punctuation\\\">></span></span>\\n</code></pre></div>\\n<p>Inside an ERB template, that’s instantiated like so:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token comment\\\">&#x3C;!-- app/views/index.html.erb --></span>\\n\\n&#x3C;%= render(ProductCardComponent.new(title: \\\"A Product\\\", price: 49, experience: experience)) %>\\n</code></pre></div>\\n<p>Which ends up looking like this:</p>\\n<p><img src='/proxy/add7f9c6-3e27-48eb-9b53-062acc690328' alt='' loading='lazy' /></p>\\n<h3>Taking Over Template Rendering</h3>\\n<p>By default, ViewComponent looks for a sibling ERB file within the <code>app/components</code> directory. But, as <a href=\\\"https://viewcomponent.org/guide/templates.html#inline\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">an alternative</a>, it’s possible to render content returned from a <code>call</code> method attached to the component class. And that can be used (or slightly hacked) to take full control over what’s rendered under certain conditions. Here’s how I started to wire that up:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-diff\\\"><code class=\\\"language-diff\\\">class ProductCardComponent &#x3C; ViewComponent::Base\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   def initialize(title:, price:, experience: \\\"\\\")</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">       @experience = experience</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">       @title = title</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">       @price = price</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   end</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   # Grab a template's contents and turn it into HTML.</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   def call</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   \\ttemplate_contents = File.read(template_path)</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">          </span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">       ERB.new(template_contents).result(binding).html_safe</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   end</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   </span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">private</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   </span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   # Use the same template path ViewComponet uses by default.</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   def template_path</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">       @template_path ||= \\\"#{Rails.root}/app/components/#{self.class.name.underscore}.html.erb\\\"</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   end</span>\\n<span class=\\\"token line\\\"></span></span>end\\n</code></pre></div>\\n<p>With this change, I’m manually compiling our own ERB templates using the included <code>ERB</code> renderer (note: that <code>.result(binding)</code> piece is important — it’ll allow access to instance variables from within the template). That template is being targeted by transforming the name of the current class into the same format expected by ViewComponent.</p>\\n<p>If you’re following along on your own and refresh the page at this point, you’d get an error. That’s because, out of the box, ViewComponent <a href=\\\"https://github.com/github/view_component/blob/main/lib/view_component/compiler.rb#L121\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">does not permit you to have both</a> a template in your <code>app/components</code> directory, <em>and</em> a <code>call</code> method on your class. To get around this hurdle and allow the component’s templates to remain in the standard <code>app/components</code> directory, I did a little meta-programming (and no, I did not feel spectacular about it):</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-diff\\\"><code class=\\\"language-diff\\\">class ProductCardComponent &#x3C; ViewComponent::Base\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   def initialize(title:, price:, experience: \\\"\\\")</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">       @experience = experience</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">       @title = title</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">       @price = price</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">       wipe_out_templates</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   end</span>\\n<span class=\\\"token line\\\"></span></span>\\n\\tdef call\\n\\t\\ttemplate_contents = File.read(template_path)\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">       </span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">       ERB.new(template_contents).result(binding).html_safe</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   end</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"></span>\\n<span class=\\\"token line\\\"></span></span>private\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"></span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   def template_path</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">       @template_path ||= \\\"#{Rails.root}/app/components/#{self.class.name.underscore}.html.erb\\\"</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   end</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   # Fake ViewComonent into thinking there are no templates in `app/components`.</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   def wipe_out_templates</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">       self.class.class_eval do</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">           def self._sidecar_files(_extensions)</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">               []</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">           end</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">       end</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   end</span>\\n<span class=\\\"token line\\\"></span></span>end\\n</code></pre></div>\\n<p>With this in place, each time the component is instantiated, the static <code>_sidecar_files</code> method is overridden (a class method that literally has the word “EXPERIMENTAL” above it <a href=\\\"https://github.com/github/view_component/blob/main/lib/view_component/base.rb#L309\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">in the source</a>, lol). That override stomps out its original implementation, making the library believe that there are actually no ERB templates living in the directory. A little dirty-feeling, but still. Onward!</p>\\n<h3>Conditionally Rendering Templates</h3>\\n<p>Next up, I needed to introduce the logic for choosing a different template when a certain experience is active. To do that, I modified the <code>template_path</code> method and include two more:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token keyword\\\">def</span> <span class=\\\"token method-definition\\\"><span class=\\\"token function\\\">template_path</span></span> \\n    <span class=\\\"token variable\\\">@template_path</span> <span class=\\\"token operator\\\">||=</span> <span class=\\\"token builtin\\\">File</span><span class=\\\"token punctuation\\\">.</span>exist<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">(</span>experience_template_path<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">?</span> experience_template_path <span class=\\\"token operator\\\">:</span> standard_template_path\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> <span class=\\\"token method-definition\\\"><span class=\\\"token function\\\">experience_template_path</span></span>\\n    <span class=\\\"token variable\\\">@experience_template_path</span> <span class=\\\"token operator\\\">||=</span> <span class=\\\"token string-literal\\\"><span class=\\\"token string\\\">\\\"</span><span class=\\\"token interpolation\\\"><span class=\\\"token delimiter punctuation\\\">#{</span><span class=\\\"token content\\\">Rails<span class=\\\"token punctuation\\\">.</span>root</span><span class=\\\"token delimiter punctuation\\\">}</span></span><span class=\\\"token string\\\">/app/components/experiences/</span><span class=\\\"token interpolation\\\"><span class=\\\"token delimiter punctuation\\\">#{</span><span class=\\\"token content\\\"><span class=\\\"token variable\\\">@experience</span></span><span class=\\\"token delimiter punctuation\\\">}</span></span><span class=\\\"token string\\\">/</span><span class=\\\"token interpolation\\\"><span class=\\\"token delimiter punctuation\\\">#{</span><span class=\\\"token content\\\"><span class=\\\"token keyword\\\">self</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">class</span><span class=\\\"token punctuation\\\">.</span>name<span class=\\\"token punctuation\\\">.</span>underscore</span><span class=\\\"token delimiter punctuation\\\">}</span></span><span class=\\\"token string\\\">.html.erb\\\"</span></span>\\n<span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">def</span> <span class=\\\"token method-definition\\\"><span class=\\\"token function\\\">standard_template_path</span></span>\\n    <span class=\\\"token variable\\\">@standard_template_path</span> <span class=\\\"token operator\\\">||=</span> <span class=\\\"token string-literal\\\"><span class=\\\"token string\\\">\\\"</span><span class=\\\"token interpolation\\\"><span class=\\\"token delimiter punctuation\\\">#{</span><span class=\\\"token content\\\">Rails<span class=\\\"token punctuation\\\">.</span>root</span><span class=\\\"token delimiter punctuation\\\">}</span></span><span class=\\\"token string\\\">/app/components/</span><span class=\\\"token interpolation\\\"><span class=\\\"token delimiter punctuation\\\">#{</span><span class=\\\"token content\\\"><span class=\\\"token keyword\\\">self</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">class</span><span class=\\\"token punctuation\\\">.</span>name<span class=\\\"token punctuation\\\">.</span>underscore</span><span class=\\\"token delimiter punctuation\\\">}</span></span><span class=\\\"token string\\\">.html.erb\\\"</span></span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre></div>\\n<p>Now, the component will first always check to see if it can render a template based on whatever experience is set (which might be none). If it can’t, the “standard” template will be used.</p>\\n<h3>A Bit of Clean-Up</h3>\\n<p>For housekeeping purposes, this can be arranged differently for better reuse among all components that might be introduced. To do that, I created a new <code>ExperienceableComponent</code> class from which all of my components extend, which will be responsible for containing all of this custom rendering logic. Altogether, it looked like this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">ExperienceableComponent</span> <span class=\\\"token operator\\\">&#x3C;</span> ViewComponent<span class=\\\"token double-colon punctuation\\\">::</span>Base\\n    <span class=\\\"token keyword\\\">def</span> <span class=\\\"token method-definition\\\"><span class=\\\"token function\\\">initialize</span></span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">*</span><span class=\\\"token punctuation\\\">)</span>\\n        wipe_out_templates\\n    <span class=\\\"token keyword\\\">end</span>\\n\\n    <span class=\\\"token keyword\\\">def</span> <span class=\\\"token method-definition\\\"><span class=\\\"token function\\\">call</span></span>\\n        template_contents <span class=\\\"token operator\\\">=</span> <span class=\\\"token builtin\\\">File</span><span class=\\\"token punctuation\\\">.</span>read<span class=\\\"token punctuation\\\">(</span>template_path<span class=\\\"token punctuation\\\">)</span>\\n        \\n        <span class=\\\"token class-name\\\">ERB</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">new</span><span class=\\\"token punctuation\\\">(</span>template_contents<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>result<span class=\\\"token punctuation\\\">(</span>binding<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>html_safe\\n    <span class=\\\"token keyword\\\">end</span>\\n\\n<span class=\\\"token keyword\\\">private</span> \\n\\n    <span class=\\\"token keyword\\\">def</span> <span class=\\\"token method-definition\\\"><span class=\\\"token function\\\">template_path</span></span> \\n        <span class=\\\"token variable\\\">@template_path</span> <span class=\\\"token operator\\\">||=</span> <span class=\\\"token builtin\\\">File</span><span class=\\\"token punctuation\\\">.</span>exist<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">(</span>experience_template_path<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">?</span> experience_template_path <span class=\\\"token operator\\\">:</span> standard_template_path\\n    <span class=\\\"token keyword\\\">end</span>\\n\\n    <span class=\\\"token keyword\\\">def</span> <span class=\\\"token method-definition\\\"><span class=\\\"token function\\\">experience_template_path</span></span>\\n        <span class=\\\"token variable\\\">@experience_template_path</span> <span class=\\\"token operator\\\">||=</span> <span class=\\\"token string-literal\\\"><span class=\\\"token string\\\">\\\"</span><span class=\\\"token interpolation\\\"><span class=\\\"token delimiter punctuation\\\">#{</span><span class=\\\"token content\\\">Rails<span class=\\\"token punctuation\\\">.</span>root</span><span class=\\\"token delimiter punctuation\\\">}</span></span><span class=\\\"token string\\\">/app/components/experiences/</span><span class=\\\"token interpolation\\\"><span class=\\\"token delimiter punctuation\\\">#{</span><span class=\\\"token content\\\"><span class=\\\"token variable\\\">@experience</span></span><span class=\\\"token delimiter punctuation\\\">}</span></span><span class=\\\"token string\\\">/</span><span class=\\\"token interpolation\\\"><span class=\\\"token delimiter punctuation\\\">#{</span><span class=\\\"token content\\\"><span class=\\\"token keyword\\\">self</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">class</span><span class=\\\"token punctuation\\\">.</span>name<span class=\\\"token punctuation\\\">.</span>underscore</span><span class=\\\"token delimiter punctuation\\\">}</span></span><span class=\\\"token string\\\">.html.erb\\\"</span></span>\\n    <span class=\\\"token keyword\\\">end</span>\\n\\n    <span class=\\\"token keyword\\\">def</span> <span class=\\\"token method-definition\\\"><span class=\\\"token function\\\">standard_template_path</span></span>\\n        <span class=\\\"token variable\\\">@standard_template_path</span> <span class=\\\"token operator\\\">||=</span> <span class=\\\"token string-literal\\\"><span class=\\\"token string\\\">\\\"</span><span class=\\\"token interpolation\\\"><span class=\\\"token delimiter punctuation\\\">#{</span><span class=\\\"token content\\\">Rails<span class=\\\"token punctuation\\\">.</span>root</span><span class=\\\"token delimiter punctuation\\\">}</span></span><span class=\\\"token string\\\">/app/components/</span><span class=\\\"token interpolation\\\"><span class=\\\"token delimiter punctuation\\\">#{</span><span class=\\\"token content\\\"><span class=\\\"token keyword\\\">self</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">class</span><span class=\\\"token punctuation\\\">.</span>name<span class=\\\"token punctuation\\\">.</span>underscore</span><span class=\\\"token delimiter punctuation\\\">}</span></span><span class=\\\"token string\\\">.html.erb\\\"</span></span>\\n    <span class=\\\"token keyword\\\">end</span>\\n\\n    <span class=\\\"token keyword\\\">def</span> <span class=\\\"token method-definition\\\"><span class=\\\"token function\\\">wipe_out_templates</span></span>\\n        <span class=\\\"token keyword\\\">self</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">class</span><span class=\\\"token punctuation\\\">.</span>class_eval <span class=\\\"token keyword\\\">do</span>\\n            <span class=\\\"token keyword\\\">def</span> <span class=\\\"token method-definition\\\"><span class=\\\"token keyword\\\">self</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">_sidecar_files</span></span><span class=\\\"token punctuation\\\">(</span>_extensions<span class=\\\"token punctuation\\\">)</span>\\n                <span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">]</span>\\n            <span class=\\\"token keyword\\\">end</span>\\n        <span class=\\\"token keyword\\\">end</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre></div>\\n<p>After that abstraction, the actual component class can look a lot simpler:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-ruby\\\"><code class=\\\"language-ruby\\\"><span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">ProductCardComponent</span> <span class=\\\"token operator\\\">&#x3C;</span> ExperienceableComponent\\n    <span class=\\\"token keyword\\\">def</span> <span class=\\\"token method-definition\\\"><span class=\\\"token function\\\">initialize</span></span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token symbol\\\">title</span><span class=\\\"token operator\\\">:</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token symbol\\\">price</span><span class=\\\"token operator\\\">:</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token symbol\\\">experience</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string-literal\\\"><span class=\\\"token string\\\">\\\"\\\"</span></span><span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token variable\\\">@experience</span> <span class=\\\"token operator\\\">=</span> experience\\n        <span class=\\\"token variable\\\">@title</span> <span class=\\\"token operator\\\">=</span> title\\n        <span class=\\\"token variable\\\">@price</span> <span class=\\\"token operator\\\">=</span> price\\n\\n        <span class=\\\"token keyword\\\">super</span>\\n    <span class=\\\"token keyword\\\">end</span>\\n<span class=\\\"token keyword\\\">end</span>\\n</code></pre></div>\\n<p>With things feeling a little tidier, navigating to the same page with <code>?experience=minimalist</code> in the URL renders exactly what I wanted:</p>\\n<p><img src='/proxy/2c8a3607-cb9b-4131-8fae-ae0448b05d41' alt='' loading='lazy' /></p>\\n<p>And there you go. Despite the slight hackiness, we got it running!</p>\\n<h2>Rails Developers are Smart</h2>\\n<p>If there’s anything I really came to realize during all of this exploration, it’s that there’s a <em>ton</em> of considerations the Action View &#x26; ViewComponent contributors have balanced with excellence as they built (and continue to build) out these UI-rendering solutions. I can’t imagine building out a package of such scale that satisfies so many different use cases, including my own. But they did it. So, a brief message to those contributors: You’re a lot smarter than I am. But I’mma catch you.</p>\\n<p>Thanks for tagging along!</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 21,
        "title": "When a JavaScript WeakMap() Actually Came in Handy",
        "slug": "when-a-weakmap-came-in-handy",
        "html": "<p>Back when I was working on <a href=\"https://github.com/alexmacarthur/slide-element\" target=\"_blank\" rel=\"noopener\">slide-element</a>, I noticed an issue that would occur when I rapidly toggled an element open &#x26; closed. If the previous animation wasn’t allowed to finish, the new one would eventually get outta whack, clipping the content on subsequent animations.</p>\n<p><img src='/proxy/4846d61a-612e-48b9-a978-2b69ee046803' alt='' loading='lazy' /></p>\n<h2>The Cause of the Weirdness</h2>\n<p>This was happening because each time an animation was triggered, I was grabbing the current “raw” height of the opened element, regardless of whether it was in the middle of an active animation. The library uses the Web Animations API, so the frame construction looked like this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// For each trigger, animate between zero and the `clientHeight` of the element.</span>\n<span class=\"token keyword\">let</span> frames <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"0px\"</span><span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>element<span class=\"token punctuation\">.</span><span class=\"token property-access\">clientHeight</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">height</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span> height<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">overflow</span><span class=\"token operator\">:</span> <span class=\"token string\">\"hidden\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>To fix it, I needed to calculate and cache the expanded height once when <code>slide-element</code> is first used, and then refer back to that cached value every time an animation is triggered. That way, for each page load, there’d be one, fixed expanded height value to animate to and from, and no more weirdness caused by rapid clicking.</p>\n<h2>Weighing My Options</h2>\n<p>A couple of potential solutions quickly came to mind.</p>\n<p><strong>First, storing that value in a</strong> <strong><code>data</code></strong> <strong>attribute on the target element.</strong> This would’ve done the job, but I have this admittedly weird thing with limiting the amount of data I persist this way. When I inspect the page, I don’t want to see a cluster of different attributes cluttering up the markup, particularly if other libraries require their own attributes to exist as well. I’ve worked with various other tools that, when used in parallel, led to some pretty convoluted markup, and I’ve been scarred a bit by those experiences. That history and the fact that I was curious if there’d be a more “interesting” way to pull this off, I opted out of this option.</p>\n<p><strong>Second, I thought of sticking a “cache” on the</strong> <strong><code>window</code></strong> <strong>object</strong> (deal with it). But there could be <em>several</em> sliding elements on a page at once. So, a single <code>window.seCache</code> (or something like it) variable wouldn’t cut it. That value would need to be some sort of key:value pair (like a simple object) in which I could store a reference to each element and the respective expanded height value.</p>\n<p>I was open to this general idea, but it had a <code>key</code> (lol) limitation: plain old objects don’t permit you to use HTML nodes as properties, so I’d need to require that a unique identifier exist on each element in order to store their expanded heights reliably. That’s a change I wasn’t eager to make.</p>\n<h3>Using DOM Nodes As Keys</h3>\n<p>I was momentarily taken aback after first publishing this post, however, when <a href=\"https://www.quickwinswithcode.com/\" target=\"_blank\" rel=\"noopener\">a friend</a> reached out about about the fact that using nodes as property names <em>sorta</em> work within ES2015’s <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Object_initializer#computed_property_names\" target=\"_blank\" rel=\"noopener\">“computed property names”</a> specification. He shared the following sort of example, which kinda blew my mind.</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>span</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>el1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>first element<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>span</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>span</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>el2<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>second element<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>span</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n  <span class=\"token keyword\">const</span> someObj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">[</span><span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'el1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token string\">'some value'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>someObj<span class=\"token punctuation\">[</span><span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'el1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// 'some value'</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>script</span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<p>Yep, accessing that value via a DOM <em>does</em> return the desired value. But, after digging in a little more, I realized that it wasn’t performing a lookup based on the reference to that object. Instead, it was transforming it to a string representation of that object, and then using <em>that</em> as the key:</p>\n<div class=\"remark-highlight\"><pre class=\"language-text\"><code class=\"language-text\">console.log(Object.keys(someObj));\n// [&#x26;#39;object HTMLSpanElement&#x26;#39;]</code></pre></div>\n<p>And that means any of the following would access the same value as well:</p>\n<div class=\"remark-highlight\"><pre class=\"language-text\"><code class=\"language-text\">console.log(someObj[document.getElementById(&#x26;#39;el2&#x26;#39;)]);\n// &#x26;#39;some value&#x26;#39;\n\nconsole.log(someObj[document.createElement(&#x26;#39;span&#x26;#39;)]);\n// &#x26;#39;some value&#x26;#39;</code></pre></div>\n<p>While that didn’t flesh out, there was another option: <strong>a set of new-ish native JavaScript objects that allow you to use objects for keys – including references to DOM nodes themselves</strong>. Those are the <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map\" target=\"_blank\" rel=\"noopener\">Map</a> and <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap\" target=\"_blank\" rel=\"noopener\">WeakMap</a> objects. For example:</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>span</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>thing<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>thing<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>a thing.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>span</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n<span class=\"token keyword\">const</span> myWeakMap <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WeakMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Set a value to a specific node reference.</span>\nmyWeakMap<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">set</span><span class=\"token punctuation\">(</span><span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'thing'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'some value'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Access that value by passing the same reference.</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>myWeakMap<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">get</span><span class=\"token punctuation\">(</span><span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.thing'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 'some value'</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>script</span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<p>My use of a WeakMap is intentional here. A standard Map would do the trick, but a WeakMap as a marginal advantage in my case: <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Keyed_collections#weakmap_object\" target=\"_blank\" rel=\"noopener\">the keys are not protected from the garbage collection process</a> (thanks to <a href=\"https://www.reddit.com/user/CreativeTechGuyGames/\" target=\"_blank\" rel=\"noopener\">CreativeTechGuyGames</a> on Reddit for this tip!). As soon as all other references to an object cease to exist, that item in a WeakMap becomes a candiate for garabage collection, preventing a potential (albeit small) memory leak.</p>\n<p>With this tool at my disposal, rigging up an expanded height cache for each target element became relatively straightforward:</p>\n<ol>\n<li>Create a dedicated WeakMap for storing expanded element heights.</li>\n<li>When <code>slide-element</code> is called on an element, create a key in that WeakMap and store the full, pre-animated height.</li>\n<li>Whenever it’s needed, first check that WeakMap for the height for the respective node.</li>\n</ol>\n<p>In rather contrived &#x26; simplified code, the logic came to look something like this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">seCache</span> <span class=\"token operator\">=</span> <span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">seCache</span> <span class=\"token operator\">||</span> <span class=\"token known-class-name class-name\">WeakMap</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">getExpandedHeight</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// We already have the calculated height.</span>\n  <span class=\"token keyword control-flow\">if</span><span class=\"token punctuation\">(</span><span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">seCache</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">get</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">seCache</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">get</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// This is the first run. Calculate &#x26; cache the full height.</span>\n  element<span class=\"token punctuation\">.</span><span class=\"token property-access\">style</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">display</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"block\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">seCache</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">set</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">,</span> element<span class=\"token punctuation\">.</span><span class=\"token property-access\">clientHeight</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  element<span class=\"token punctuation\">.</span><span class=\"token property-access\">style</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">display</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"none\"</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">seCache</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">get</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// For each trigger, animate between zero and the `clientHeight` of the element.</span>\n<span class=\"token keyword\">let</span> frames <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"0px\"</span><span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">getExpandedHeight</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">height</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span> height<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">overflow</span><span class=\"token operator\">:</span> <span class=\"token string\">\"hidden\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>And there we have it. A far more interesting solution than 2010’s data attributes. 😜</p>\n<h2>Way More Useful Than I Thought</h2>\n<p>For whatever reason, I didn’t think there’d be much utility to a brand new JavaScript object that enables you to use objects as keys, as well as anything other feature it offered (why wouldn’t a basic object cover my every need?). So, when I finally came across a use case for it, I got pretty pumped. Hopefully, this all nudges your mind to think of the tool when the appropriate need arises.</p>\n<p>Apologies to whomever proposed this thing.</p>\n",
        "feature_image": "https://images.pexels.com/photos/2859169/pexels-photo-2859169.jpeg?auto=compress&cs=tinysrgb&dpr=3&h=750&w=1200",
        "status": "published",
        "created_at": 1633237200000,
        "published_at": 1633237200000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>Back when I was working on <a href=\\\"https://github.com/alexmacarthur/slide-element\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">slide-element</a>, I noticed an issue that would occur when I rapidly toggled an element open &#x26; closed. If the previous animation wasn’t allowed to finish, the new one would eventually get outta whack, clipping the content on subsequent animations.</p>\\n<p><img src='/proxy/4846d61a-612e-48b9-a978-2b69ee046803' alt='' loading='lazy' /></p>\\n<h2>The Cause of the Weirdness</h2>\\n<p>This was happening because each time an animation was triggered, I was grabbing the current “raw” height of the opened element, regardless of whether it was in the middle of an active animation. The library uses the Web Animations API, so the frame construction looked like this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token comment\\\">// For each trigger, animate between zero and the `clientHeight` of the element.</span>\\n<span class=\\\"token keyword\\\">let</span> frames <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token string\\\">\\\"0px\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>element<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">clientHeight</span><span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">px</span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">map</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">height</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token punctuation\\\">{</span> height<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token literal-property property\\\">overflow</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"hidden\\\"</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>To fix it, I needed to calculate and cache the expanded height once when <code>slide-element</code> is first used, and then refer back to that cached value every time an animation is triggered. That way, for each page load, there’d be one, fixed expanded height value to animate to and from, and no more weirdness caused by rapid clicking.</p>\\n<h2>Weighing My Options</h2>\\n<p>A couple of potential solutions quickly came to mind.</p>\\n<p><strong>First, storing that value in a</strong> <strong><code>data</code></strong> <strong>attribute on the target element.</strong> This would’ve done the job, but I have this admittedly weird thing with limiting the amount of data I persist this way. When I inspect the page, I don’t want to see a cluster of different attributes cluttering up the markup, particularly if other libraries require their own attributes to exist as well. I’ve worked with various other tools that, when used in parallel, led to some pretty convoluted markup, and I’ve been scarred a bit by those experiences. That history and the fact that I was curious if there’d be a more “interesting” way to pull this off, I opted out of this option.</p>\\n<p><strong>Second, I thought of sticking a “cache” on the</strong> <strong><code>window</code></strong> <strong>object</strong> (deal with it). But there could be <em>several</em> sliding elements on a page at once. So, a single <code>window.seCache</code> (or something like it) variable wouldn’t cut it. That value would need to be some sort of key:value pair (like a simple object) in which I could store a reference to each element and the respective expanded height value.</p>\\n<p>I was open to this general idea, but it had a <code>key</code> (lol) limitation: plain old objects don’t permit you to use HTML nodes as properties, so I’d need to require that a unique identifier exist on each element in order to store their expanded heights reliably. That’s a change I wasn’t eager to make.</p>\\n<h3>Using DOM Nodes As Keys</h3>\\n<p>I was momentarily taken aback after first publishing this post, however, when <a href=\\\"https://www.quickwinswithcode.com/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">a friend</a> reached out about about the fact that using nodes as property names <em>sorta</em> work within ES2015’s <a href=\\\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Object_initializer#computed_property_names\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">“computed property names”</a> specification. He shared the following sort of example, which kinda blew my mind.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>span</span> <span class=\\\"token attr-name\\\">id</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>el1<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>first element<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>span</span><span class=\\\"token punctuation\\\">></span></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>span</span> <span class=\\\"token attr-name\\\">id</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>el2<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>second element<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>span</span><span class=\\\"token punctuation\\\">></span></span>\\n\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>script</span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token script\\\"><span class=\\\"token language-javascript\\\">\\n  <span class=\\\"token keyword\\\">const</span> someObj <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token punctuation\\\">[</span><span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getElementById</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'el1'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">'some value'</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span>someObj<span class=\\\"token punctuation\\\">[</span><span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getElementById</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'el1'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token comment\\\">// 'some value'</span>\\n</span></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>script</span><span class=\\\"token punctuation\\\">></span></span>\\n</code></pre></div>\\n<p>Yep, accessing that value via a DOM <em>does</em> return the desired value. But, after digging in a little more, I realized that it wasn’t performing a lookup based on the reference to that object. Instead, it was transforming it to a string representation of that object, and then using <em>that</em> as the key:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">console.log(Object.keys(someObj));\\n// [&#x26;#39;object HTMLSpanElement&#x26;#39;]</code></pre></div>\\n<p>And that means any of the following would access the same value as well:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">console.log(someObj[document.getElementById(&#x26;#39;el2&#x26;#39;)]);\\n// &#x26;#39;some value&#x26;#39;\\n\\nconsole.log(someObj[document.createElement(&#x26;#39;span&#x26;#39;)]);\\n// &#x26;#39;some value&#x26;#39;</code></pre></div>\\n<p>While that didn’t flesh out, there was another option: <strong>a set of new-ish native JavaScript objects that allow you to use objects for keys – including references to DOM nodes themselves</strong>. Those are the <a href=\\\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Map</a> and <a href=\\\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">WeakMap</a> objects. For example:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>span</span> <span class=\\\"token attr-name\\\">id</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>thing<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token attr-name\\\">class</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>thing<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>a thing.<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>span</span><span class=\\\"token punctuation\\\">></span></span>\\n\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>script</span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token script\\\"><span class=\\\"token language-javascript\\\">\\n<span class=\\\"token keyword\\\">const</span> myWeakMap <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">WeakMap</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// Set a value to a specific node reference.</span>\\nmyWeakMap<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">set</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getElementById</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'thing'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">'some value'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// Access that value by passing the same reference.</span>\\n<span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span>myWeakMap<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">get</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">querySelector</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'.thing'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span> <span class=\\\"token comment\\\">// 'some value'</span>\\n</span></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>script</span><span class=\\\"token punctuation\\\">></span></span>\\n</code></pre></div>\\n<p>My use of a WeakMap is intentional here. A standard Map would do the trick, but a WeakMap as a marginal advantage in my case: <a href=\\\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Keyed_collections#weakmap_object\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">the keys are not protected from the garbage collection process</a> (thanks to <a href=\\\"https://www.reddit.com/user/CreativeTechGuyGames/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">CreativeTechGuyGames</a> on Reddit for this tip!). As soon as all other references to an object cease to exist, that item in a WeakMap becomes a candiate for garabage collection, preventing a potential (albeit small) memory leak.</p>\\n<p>With this tool at my disposal, rigging up an expanded height cache for each target element became relatively straightforward:</p>\\n<ol>\\n<li>Create a dedicated WeakMap for storing expanded element heights.</li>\\n<li>When <code>slide-element</code> is called on an element, create a key in that WeakMap and store the full, pre-animated height.</li>\\n<li>Whenever it’s needed, first check that WeakMap for the height for the respective node.</li>\\n</ol>\\n<p>In rather contrived &#x26; simplified code, the logic came to look something like this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token dom variable\\\">window</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">seCache</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token dom variable\\\">window</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">seCache</span> <span class=\\\"token operator\\\">||</span> <span class=\\\"token known-class-name class-name\\\">WeakMap</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">new</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\">getExpandedHeight</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token comment\\\">// We already have the calculated height.</span>\\n  <span class=\\\"token keyword control-flow\\\">if</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token dom variable\\\">window</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">seCache</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">get</span><span class=\\\"token punctuation\\\">(</span>element<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token dom variable\\\">window</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">seCache</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">get</span><span class=\\\"token punctuation\\\">(</span>element<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token comment\\\">// This is the first run. Calculate &#x26; cache the full height.</span>\\n  element<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">style</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">display</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"block\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token dom variable\\\">window</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">seCache</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">set</span><span class=\\\"token punctuation\\\">(</span>element<span class=\\\"token punctuation\\\">,</span> element<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">clientHeight</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  element<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">style</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">display</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"none\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token dom variable\\\">window</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">seCache</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">get</span><span class=\\\"token punctuation\\\">(</span>element<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token comment\\\">// For each trigger, animate between zero and the `clientHeight` of the element.</span>\\n<span class=\\\"token keyword\\\">let</span> frames <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token string\\\">\\\"0px\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span><span class=\\\"token function\\\">getExpandedHeight</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">px</span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">map</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">height</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token punctuation\\\">{</span> height<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token literal-property property\\\">overflow</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"hidden\\\"</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>And there we have it. A far more interesting solution than 2010’s data attributes. 😜</p>\\n<h2>Way More Useful Than I Thought</h2>\\n<p>For whatever reason, I didn’t think there’d be much utility to a brand new JavaScript object that enables you to use objects as keys, as well as anything other feature it offered (why wouldn’t a basic object cover my every need?). So, when I finally came across a use case for it, I got pretty pumped. Hopefully, this all nudges your mind to think of the tool when the appropriate need arises.</p>\\n<p>Apologies to whomever proposed this thing.</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 22,
        "title": "Build Your Own WordPress Plugin Update Server with a Serverless Function",
        "slug": "serverless-wordpress-plugin-update-server",
        "html": "<p>A while ago, I wrote a premium WordPress plugin for creating typewriter effects with <a href=\"https://typeitjs.com/\" target=\"_blank\" rel=\"noopener\">TypeIt</a> via shortcode or Gutenblock. I was ill-prepared for the trickiness of managing plugin updates for such a plugin. Since a premium plugin is monetized, it can’t live inside the WordPress Plugin Repository like free options can, and asking paying customers to manually upload the a ZIP file for each new release is a clunky, less-than-ideal option.</p>\n<h2>Serverless to the Rescue</h2>\n<p>The go-to solution for this problem is to set up a custom update server. With this approach, your plugin checks for updates the same way any other plugin does, but instead of asking the Plugin Repository for those updates, it’s configured to ask your server.</p>\n<p>Just a short while ago, setting this up was quite a chore, since it required you to create and maintain a separate application just to allow your users to easily get updates. But with the serverless/lambda function landscape now so accessible, it’s pretty simple to roll one of these on your own with neither much hassle nor cost.</p>\n<p>Let’s explore just how simple that is by setting up own serverless plugin update function that can be used to manage an unlimited number of your premium plugin updates, as well as what it takes to configure a plugin to actually use this function.</p>\n<h2>Choose a Platform &#x26; Get Set Up</h2>\n<p>The number of companies offering serverless function platforms with minimal configuration are plenty, with the top two contenders arguably being <a href=\"https://www.netlify.com/\" target=\"_blank\" rel=\"noopener\">Netlify</a> and <a href=\"http://vercel.com/\" target=\"_blank\" rel=\"noopener\">Vercel</a>. For this setup, we’ll be using the latter, although the fundamentals are largely similar, with the primary differences being the proprietary tools and configuration patterns required by each.</p>\n<h3>Set Up a Vercel Project</h3>\n<p>On your machine, create a directory and initialize it as a Git repository.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\">mkdir wp<span class=\"token operator\">-</span>plugin<span class=\"token operator\">-</span>update<span class=\"token operator\">-</span><span class=\"token keyword\">function</span><span class=\"token operator\">-</span>example\ncd wp<span class=\"token operator\">-</span>plugin<span class=\"token operator\">-</span>update<span class=\"token operator\">-</span><span class=\"token keyword\">function</span><span class=\"token operator\">-</span>example\ngit init\n</code></pre></div>\n<p>After <a href=\"https://vercel.com/docs/cli\" target=\"_blank\" rel=\"noopener\">installing and authenticating</a> with the Vercel CLI, initialize your project by running <code>vercel</code> and following the prompts. See Vercel’s solid documentation on then <a href=\"https://vercel.com/docs/git\" target=\"_blank\" rel=\"noopener\">linking this new project with a remote Git repository.</a> Once you’re finished, a <code>.vercel</code> directory containing some project configuration should have been generated in the project on your machine.</p>\n<h3>Run the Project</h3>\n<p>After the project is initialized, spin up a local development server by running <code>vercel dev</code>. You should see a message indicating that the server is available at <code>http://localhost:3000</code> (assuming nothing else is running there already).</p>\n<h2>Create a Basic Function Triggered by a GET Request</h2>\n<p>Create an <code>api</code> directory and a file named <code>[plugin].js</code>. This’ll serve as a <a href=\"https://vercel.com/docs/serverless-functions/introduction#path-segments\" target=\"_blank\" rel=\"noopener\">path segment</a> that we’ll use to pass plugin slugs through to the function. You could also go with the URL query parameter approach. That decision is up to you.</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">mkdir</span> api <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token function\">touch</span> <span class=\"token string\">\"api/[plugin].js\"</span>\n</code></pre></div>\n<p>Inside that newly created <code>[plugin].js</code> file, let’s start with something simple just to verify things are working. Using this, we’ll pull the <code>plugin</code> parameter from the URL path – dictated by the name of our file – and immediately spit back a bit of JSON.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">query</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> plugin <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> req<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword control-flow\">return</span> res<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">version</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0.0.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">package</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">http://localhost:3000/plugins/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>plugin<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/0.0.0.zip</span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Now, navigate to <code>http://localhost:3000/api/our-plugin</code>, and you should see some JSON output on the screen. The structure of that blob is important; it’s what we’ll later use to communicate to a WordPress site wondering if a plugin should be updated. More on that as we go.</p>\n<h3>Retrieve the Latest Plugin Version Information</h3>\n<p>Next, let’s make a means of surfacing information about a particular plugin whenever a <code>GET</code> request is made to our endpoint.</p>\n<p>First off, we’ll create a directory to store the ZIP files for our different plugin versions. Go ahead and create a <code>plugins/our-plugin</code> directory, and place a zipped version of our plugin within that.</p>\n<p>We’re building this function in a way that only requires to you to upload newer ZIP files to the function’s repo as new plugin releases come out, leaving the older versions in place. It’s simpler to use, and it’s also handy in case customers request a download link for an older version of a plugin. If you don’t need this level of complexity, feel free to rip stuff out as desired.</p>\n<p>The naming convention for that file is important, since we’ll use that for determining what the latest available version is. It should named by the version represented by the zipped contents. For example, <code>1.0.2.zip</code>. With that ZIP added to the mix, our directory tree should look something like this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-text\"><code class=\"language-text\">.\n├── api\n│   └── plugin\n│       └── [plugin].js\n└── plugins\n    └── our-plugin\n        └── 1.0.2.zip</code></pre></div>\n<h3>Parse Latest Version Information</h3>\n<p>At this point, we’re ready to surface latest version data when a request is made. To do that, we’re gonna go through a series of steps:</p>\n<ul>\n<li>Access every available version in the <code>plugins</code> directory.</li>\n<li>Filter out any non-<code>.zip</code> files (particularly while developing locally; some hidden “dot” files can sneak in).</li>\n<li>Sort the file names by version, descending (go ahead and run <code>npm install compare-versions</code> for this step.</li>\n<li>Grab the first file name in the list. This will be our newest version available.</li>\n</ul>\n<p>In code, that’ll look like this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-diff\"><code class=\"language-diff\"><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\"> const compareVersions = require('compare-versions');</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\"> const { readdirSync } = require('fs');</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\"> const { join } = require('path');</span>\n<span class=\"token line\"></span></span>\nexport default (req, res) => {\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> const {</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">     query: { plugin },</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> } = req;</span>\n<span class=\"token line\"></span></span>\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\"> // Read all files in directory.</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\"> const zips = readdirSync(join(process.cwd(), 'plugins', plugin))</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">     // Remove any non-ZIP files.</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">     .filter(fileName => fileName.endsWith('.zip'))</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\"></span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">     // Collect only the file names, without file extension.</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">     .map(fileName => fileName.match(/(.+)\\.zip$/)[1])</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\"></span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">     // Sort those file names (which are the version numbers).</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">     .sort(compareVersions).reverse();</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\"></span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\"> const latestVersion = zips[0];</span>\n<span class=\"token line\"></span></span>\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> return res.json({</span>\n<span class=\"token line\"></span></span><span class=\"token deleted-sign deleted\"><span class=\"token prefix deleted\">-</span><span class=\"token line\">   version: \"0.0.0\",</span>\n<span class=\"token line\"></span></span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">   version: latestVersion,</span>\n<span class=\"token line\"></span></span><span class=\"token deleted-sign deleted\"><span class=\"token prefix deleted\">-</span><span class=\"token line\">   package: `http://localhost:3000/plugins/${plugin}/0.0.0.zip`</span>\n<span class=\"token line\"></span></span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">   package: `http://localhost:3000/plugins/${plugin}/${latestVersion}.zip`</span>\n<span class=\"token line\"></span></span><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> })</span>\n<span class=\"token line\"></span></span>};\n</code></pre></div>\n<p>If you refresh your browser, you should see that same JSON blob we got earlier, but filled in with the correct version information:</p>\n<div class=\"remark-highlight\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0.2\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"package\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://localhost:3000/plugins/our-plugin/1.0.2.zip\"</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>There’s one more tweak we should make in case someone requests information for a plugin we don’t manage:</p>\n<div class=\"remark-highlight\"><pre class=\"language-diff\"><code class=\"language-diff\">const compareVersions = require('compare-versions');\nconst { readdirSync } = require('fs');\nconst { join } = require('path');\n\nexport default (req, res) => {\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> const {</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   query: { plugin },</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> } = req;</span>\n<span class=\"token line\"></span></span>\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\"> try {</span>\n<span class=\"token line\"></span></span><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   const zips = readdirSync(join(process.cwd(), 'plugins', plugin))</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">     .filter(fileName => fileName.endsWith('.zip'))</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">     .map(fileName => fileName.match(/(.+)\\.zip$/)[1])</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">     .sort(compareVersions)</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">     .reverse();</span>\n<span class=\"token line\"></span></span>\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   const latestVersion = zips[0];</span>\n<span class=\"token line\"></span></span>\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   return res.json({</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">     version: latestVersion,</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">     package: `http://localhost:3000/plugins/${plugin}/${latestVersion}.zip`</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   })</span>\n<span class=\"token line\"></span></span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\"> } catch (e) {</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">    return res.status(404).json({</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">      message: `Sorry, couldn't find data for '${plugin}'.`,</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">    });</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\"> }</span>\n<span class=\"token line\"></span></span>};\n</code></pre></div>\n<p>Now, if you make a request to our function using a non-existent plugin slug, you should get a <code>404</code> status code, which is a bit more appropriate for the type of error that occurred.</p>\n<p>And just like that, we have our own custom plugin update server ready in place. The next piece is configuring our plugin to check for updates &#x26; pull from that endpoint, rather than the WordPress Plugin Repository.</p>\n<h2>Configure a WordPress Plugin to Use Update Server</h2>\n<p>WordPress uses an <code>update_plugins</code> transient to keep track of which plugins have been checked for updates recently, and which are due for another check. We can hook into &#x26; filter the value of that transient using the <a href=\"https://github.com/WordPress/wordpress-develop/blob/97790af164b20a72640b3497af4c5a3986d8cf32/src/wp-includes/option.php#L1957\" target=\"_blank\" rel=\"noopener\"><code>site_transient_update_plugins</code></a><a href=\"https://github.com/WordPress/wordpress-develop/blob/97790af164b20a72640b3497af4c5a3986d8cf32/src/wp-includes/option.php#L1957\" target=\"_blank\" rel=\"noopener\"> filter</a>. By doing this, we’ll be able seize control of where WordPress looks to see if an update is ready.</p>\n<p>But <em>before</em> we start to stub out that filter, let’s write a simple function for fetching fresh plugin data via <code>GET</code> request to our endpoint. With the following, we’re making that request, accounting for a possible error, and returning the raw JSON.</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token function\">define</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"PLUGIN_CHECK_ENDPOINT\"</span><span class=\"token punctuation\">,</span> <span class=\"token string double-quoted-string\">\"http://localhost:3000/api/our-plugin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function-definition function\">fetch_remote_data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token variable\">$remoteData</span> <span class=\"token operator\">=</span> <span class=\"token function\">wp_remote_get</span><span class=\"token punctuation\">(</span>\n    <span class=\"token constant\">PLUGIN_CHECK_ENDPOINT</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>\n      <span class=\"token string single-quoted-string\">'headers'</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string single-quoted-string\">'Accept'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'application/json'</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Something went wrong!</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token function\">is_wp_error</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$remoteData</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span>\n    <span class=\"token class-name\">wp_remote_retrieve_response_code</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$remoteData</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!==</span> <span class=\"token number\">200</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token constant\">null</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// {</span>\n  <span class=\"token comment\">//    \"version\":\"1.0.2\",</span>\n  <span class=\"token comment\">//    \"package\":\"http://localhost:3000/plugins/our-plugin/1.0.2.zip\"</span>\n  <span class=\"token comment\">// }</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token function\">json_decode</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$remoteData</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'body'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Now, let’s tweak that to return an object with an interface expected by WordPress’s plugin update system, populating the <code>new_version</code> and <code>package</code> properties with the data from our endpoint. (If you wanna dig into that more, <a href=\"https://make.wordpress.org/core/2020/07/30/recommended-usage-of-the-updates-api-to-support-the-auto-updates-ui-for-plugins-and-themes-in-wordpress-5-5/\" target=\"_blank\" rel=\"noopener\">see here</a>.) As for the rest, feel free to fill things in as needed.</p>\n<div class=\"remark-highlight\"><pre class=\"language-diff\"><code class=\"language-diff\">define(\"PLUGIN_CHECK_ENDPOINT\", \"http://localhost:3000/api/our-plugin\");\n\nfunction fetch_remote_data() {\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> $remoteData = wp_remote_get(</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   PLUGIN_CHECK_ENDPOINT,</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   [</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">     'headers' => [</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">       'Accept' => 'application/json'</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">     ]</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   ]</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> );</span>\n<span class=\"token line\"></span></span>\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> // Something went wrong!</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> if (</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">     is_wp_error($remoteData) ||</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">     wp_remote_retrieve_response_code($remoteData) !== 200</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> ) {</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">     return null;</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> }</span>\n<span class=\"token line\"></span></span>\n<span class=\"token deleted-sign deleted\"><span class=\"token prefix deleted\">-</span><span class=\"token line\"> return json_decode($remoteData['body']);</span>\n<span class=\"token line\"></span></span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\"> $remoteData = json_decode($remoteData['body']);</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\"></span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\"> return (object) [</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">     'id'            => 'our-plugin/our-plugin.php',</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">     'slug'          => 'our-plugin',</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">     'plugin'        => 'our-plugin/our-plugin.php',</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">     'new_version'   => $remoteData->version,  // &#x3C;-- Important!</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">     'url'           => 'https://macarthur.me',</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">     'package'       => $remoteData->package,  // &#x3C;-- Important!</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">     'icons'         => [],</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">     'banners'       => [],</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">     'banners_rtl'   => [],</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">     'tested'        => '',</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">     'requires_php'  => '',</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">     'compatibility' => new \\stdClass(),</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\"> ];</span>\n<span class=\"token line\"></span></span>}\n</code></pre></div>\n<p>Now, we’re ready to start filtering the <code>update_plugins</code> transient. To start, let’s stub out our filter and fetch the fresh data using the function we just wrote above. We’ll also pull in a means of grabbing the current installed version of our plugin, since we’ll later need to that to compare against our remote version.</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token function\">add_filter</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'site_transient_update_plugins'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$transient</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token variable\">$pluginData</span> <span class=\"token operator\">=</span> <span class=\"token function\">fetch_remote_data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token variable\">$transient</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>And now, it’s as simple as doing a version comparison, which PHP makes relatively easy with it’s <code>version_compare</code> function:</p>\n<div class=\"remark-highlight\"><pre class=\"language-diff\"><code class=\"language-diff\"><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\"> require_once(ABSPATH . 'wp-admin/includes/plugin.php');</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\"></span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\"> $currentPluginData = get_plugin_data(__FILE__);</span>\n<span class=\"token line\"></span></span>\nadd_filter('site_transient_update_plugins', function ($transient) {\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> $pluginData = fetch_remote_data();</span>\n<span class=\"token line\"></span></span>\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\"> if (version_compare($pluginData->new_version, $currentPluginData[\"Version\"], \">\")) {</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   $transient->response['our-plugin/our-plugin.php'] = $pluginData;</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\"> } else {</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   $transient->no_update['our-plugin/our-plugin.php'] = $pluginData;</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\"> }</span>\n<span class=\"token line\"></span></span>\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> return $transient;</span>\n<span class=\"token line\"></span></span>});\n</code></pre></div>\n<p>The magic here is in that <code>$transient->PROPERTY</code> stuff. If our remote version is <em>larger</em> than the version we have installed, we’ll tell WordPress to prompt for an update by sticking it on the <code>response</code> property, which is an array whose keys are a WordPress site’s plugins’ root files. But if the plugin is not eligible for an update, we’re sticking it onto the <code>no_update</code> property, and no update will be prompted.</p>\n<h3>Testing It Locally</h3>\n<p>With things as they are, we’re <em>technically</em> sorta done. If you artificially set your local plugin’s version to something lower than what the remote endpoint is providing, you’ll see an update prompt:</p>\n<p><img src='/proxy/8adea494-ec53-428f-b3ea-60b14de3665f' alt='' loading='lazy' /></p>\n<p>But! Unfortunately, since our update endpoint is on <code>localhost</code>, WordPress will, by default, not allow a ZIP file to be pulled from it. So, for local testing, let’s turn that feature off using the filter below. <strong>Ideally, don’t put this in your plugin’s code.</strong> You don’t want to accidentally ship it.</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token function\">add_filter</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'http_request_args'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$args</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token variable\">$args</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'reject_unsafe_urls'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token variable\">$args</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>After that’s in place, there’s another key step: <strong>commit &#x26; push up your plugin’s code</strong>, since it’s about to get wiped out with a “new” version, and you’ll need a way to revert it. Then, go ahead and attempt to run the update from the WordPress admin. It should work.</p>\n<p>But! There’s still work to be done. In its current state, our code requires that our endpoint be hit every time it’s run. That’s an unnecessarily burdensome process (you’ll likely notice it every time you refresh the WordPress admin), especially when we have transients at our disposal.</p>\n<h3>Make Things More Efficient</h3>\n<p>Using a simple <a href=\"https://developer.wordpress.org/apis/handbook/transients/\" target=\"_blank\" rel=\"noopener\">transient</a>, we can cache the payload from our endpoint until a certain amount of time passes. Let’s set one to expire after 12 hours, and set up some simple logic to first check for a transient value before hitting our serverless function.</p>\n<div class=\"remark-highlight\"><pre class=\"language-diff\"><code class=\"language-diff\">require_once(ABSPATH . 'wp-admin/includes/plugin.php');\n\ndefine(\"PLUGIN_CHECK_TRANSIENT_EXPIRATION\", 43200); // 12 hours\ndefine(\"PLUGIN_CHECK_TRANSIENT_NAME\", \"wp_update_check_our_plugin\");\n\n$currentPluginData = get_plugin_data(__FILE__);\n\nadd_filter('site_transient_update_plugins', function ($transient) {\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\"> $checkPluginTransient = get_transient(PLUGIN_CHECK_TRANSIENT_NAME);</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\"></span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\"> $pluginData = $checkPluginTransient ?: fetch_remote_data();</span>\n<span class=\"token line\"></span></span><span class=\"token deleted-sign deleted\"><span class=\"token prefix deleted\">-</span><span class=\"token line\"> $pluginData = fetch_remote_data();</span>\n<span class=\"token line\"></span></span>\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> if (version_compare($pluginData->new_version, $currentPluginData[\"Version\"], \">\")) {</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   $transient->response['our-plugin/our-plugin.php'] = $pluginData;</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> } else {</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   $transient->no_update['our-plugin/our-plugin.php'] = $pluginData;</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> }</span>\n<span class=\"token line\"></span></span>\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> return $transient;</span>\n<span class=\"token line\"></span></span>});\n</code></pre></div>\n<p>And finally, if that transient is due for a refresh, set it with what we receive from our endpoint.</p>\n<div class=\"remark-highlight\"><pre class=\"language-diff\"><code class=\"language-diff\">require_once(ABSPATH . 'wp-admin/includes/plugin.php');\n\ndefine(\"PLUGIN_CHECK_TRANSIENT_EXPIRATION\", 43200); // 12 hours\ndefine(\"PLUGIN_CHECK_TRANSIENT_NAME\", \"wp_update_check_our_plugin\");\n\n$currentPluginData = get_plugin_data(__FILE__);\n\nadd_filter('site_transient_update_plugins', function ($transient) {\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> $checkPluginTransient = get_transient(PLUGIN_CHECK_TRANSIENT_NAME);</span>\n<span class=\"token line\"></span></span>\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> $pluginData = $checkPluginTransient ?: fetch_remote_data();</span>\n<span class=\"token line\"></span></span>\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">  if (!$checkPluginTransient) {</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   set_transient(</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">     PLUGIN_CHECK_TRANSIENT_NAME,</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">     $pluginData,</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">     PLUGIN_CHECK_TRANSIENT_EXPIRATION</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   );</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\"> }</span>\n<span class=\"token line\"></span></span>\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> if (version_compare($pluginData->new_version, $currentPluginData[\"Version\"], \">\")) {</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   $transient->response['our-plugin/our-plugin.php'] = $pluginData;</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> } else {</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   $transient->no_update['our-plugin/our-plugin.php'] = $pluginData;</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> }</span>\n<span class=\"token line\"></span></span>\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> return $transient;</span>\n<span class=\"token line\"></span></span>});\n</code></pre></div>\n<p>Now, if you were to refresh your WP admin a few times, you’ll notice that things are performing much more smoothly, since our serverless function will only need to be hit every 12 hours at the most.</p>\n<h2>See a Live Example</h2>\n<p>Everything you’re reading here was put into practice with one of my own plugins. If you’d like to take a glace at that code (with some various adjustments to suite my specific needs), check out the repositories below:</p>\n<ul>\n<li><a href=\"https://github.com/alexmacarthur/wp-typeit\" target=\"_blank\" rel=\"noopener\">TypeIt WordPress plugin</a></li>\n<li><a href=\"https://github.com/alexmacarthur/wp-plugin-update-lambda\" target=\"_blank\" rel=\"noopener\">serverless function</a></li>\n</ul>\n<h2>Any Gotchas?</h2>\n<p>One of the primary motivators I had for writing this was the fact that I couldn’t find any ultra-clear documentation for the process myself. That said, I welcome any feedback or unexpected gotchas you hit along the way.</p>\n<p>Thanks for reading!</p>\n",
        "feature_image": "https://images.pexels.com/photos/5332291/pexels-photo-5332291.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;h=750&amp;w=1260",
        "status": "published",
        "created_at": 1632027600000,
        "published_at": 1632027600000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>A while ago, I wrote a premium WordPress plugin for creating typewriter effects with <a href=\\\"https://typeitjs.com/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">TypeIt</a> via shortcode or Gutenblock. I was ill-prepared for the trickiness of managing plugin updates for such a plugin. Since a premium plugin is monetized, it can’t live inside the WordPress Plugin Repository like free options can, and asking paying customers to manually upload the a ZIP file for each new release is a clunky, less-than-ideal option.</p>\\n<h2>Serverless to the Rescue</h2>\\n<p>The go-to solution for this problem is to set up a custom update server. With this approach, your plugin checks for updates the same way any other plugin does, but instead of asking the Plugin Repository for those updates, it’s configured to ask your server.</p>\\n<p>Just a short while ago, setting this up was quite a chore, since it required you to create and maintain a separate application just to allow your users to easily get updates. But with the serverless/lambda function landscape now so accessible, it’s pretty simple to roll one of these on your own with neither much hassle nor cost.</p>\\n<p>Let’s explore just how simple that is by setting up own serverless plugin update function that can be used to manage an unlimited number of your premium plugin updates, as well as what it takes to configure a plugin to actually use this function.</p>\\n<h2>Choose a Platform &#x26; Get Set Up</h2>\\n<p>The number of companies offering serverless function platforms with minimal configuration are plenty, with the top two contenders arguably being <a href=\\\"https://www.netlify.com/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Netlify</a> and <a href=\\\"http://vercel.com/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Vercel</a>. For this setup, we’ll be using the latter, although the fundamentals are largely similar, with the primary differences being the proprietary tools and configuration patterns required by each.</p>\\n<h3>Set Up a Vercel Project</h3>\\n<p>On your machine, create a directory and initialize it as a Git repository.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\">mkdir wp<span class=\\\"token operator\\\">-</span>plugin<span class=\\\"token operator\\\">-</span>update<span class=\\\"token operator\\\">-</span><span class=\\\"token keyword\\\">function</span><span class=\\\"token operator\\\">-</span>example\\ncd wp<span class=\\\"token operator\\\">-</span>plugin<span class=\\\"token operator\\\">-</span>update<span class=\\\"token operator\\\">-</span><span class=\\\"token keyword\\\">function</span><span class=\\\"token operator\\\">-</span>example\\ngit init\\n</code></pre></div>\\n<p>After <a href=\\\"https://vercel.com/docs/cli\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">installing and authenticating</a> with the Vercel CLI, initialize your project by running <code>vercel</code> and following the prompts. See Vercel’s solid documentation on then <a href=\\\"https://vercel.com/docs/git\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">linking this new project with a remote Git repository.</a> Once you’re finished, a <code>.vercel</code> directory containing some project configuration should have been generated in the project on your machine.</p>\\n<h3>Run the Project</h3>\\n<p>After the project is initialized, spin up a local development server by running <code>vercel dev</code>. You should see a message indicating that the server is available at <code>http://localhost:3000</code> (assuming nothing else is running there already).</p>\\n<h2>Create a Basic Function Triggered by a GET Request</h2>\\n<p>Create an <code>api</code> directory and a file named <code>[plugin].js</code>. This’ll serve as a <a href=\\\"https://vercel.com/docs/serverless-functions/introduction#path-segments\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">path segment</a> that we’ll use to pass plugin slugs through to the function. You could also go with the URL query parameter approach. That decision is up to you.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\"><span class=\\\"token function\\\">mkdir</span> api <span class=\\\"token operator\\\">&#x26;&#x26;</span> <span class=\\\"token function\\\">touch</span> <span class=\\\"token string\\\">\\\"api/[plugin].js\\\"</span>\\n</code></pre></div>\\n<p>Inside that newly created <code>[plugin].js</code> file, let’s start with something simple just to verify things are working. Using this, we’ll pull the <code>plugin</code> parameter from the URL path – dictated by the name of our file – and immediately spit back a bit of JSON.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword module\\\">export</span> <span class=\\\"token keyword module\\\">default</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">req<span class=\\\"token punctuation\\\">,</span> res</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token literal-property property\\\">query</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span> plugin <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token operator\\\">=</span> req<span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword control-flow\\\">return</span> res<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">json</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token literal-property property\\\">version</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"0.0.0\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token keyword\\\">package</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">http://localhost:3000/plugins/</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>plugin<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">/0.0.0.zip</span><span class=\\\"token template-punctuation string\\\">`</span></span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>Now, navigate to <code>http://localhost:3000/api/our-plugin</code>, and you should see some JSON output on the screen. The structure of that blob is important; it’s what we’ll later use to communicate to a WordPress site wondering if a plugin should be updated. More on that as we go.</p>\\n<h3>Retrieve the Latest Plugin Version Information</h3>\\n<p>Next, let’s make a means of surfacing information about a particular plugin whenever a <code>GET</code> request is made to our endpoint.</p>\\n<p>First off, we’ll create a directory to store the ZIP files for our different plugin versions. Go ahead and create a <code>plugins/our-plugin</code> directory, and place a zipped version of our plugin within that.</p>\\n<p>We’re building this function in a way that only requires to you to upload newer ZIP files to the function’s repo as new plugin releases come out, leaving the older versions in place. It’s simpler to use, and it’s also handy in case customers request a download link for an older version of a plugin. If you don’t need this level of complexity, feel free to rip stuff out as desired.</p>\\n<p>The naming convention for that file is important, since we’ll use that for determining what the latest available version is. It should named by the version represented by the zipped contents. For example, <code>1.0.2.zip</code>. With that ZIP added to the mix, our directory tree should look something like this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">.\\n├── api\\n│   └── plugin\\n│       └── [plugin].js\\n└── plugins\\n    └── our-plugin\\n        └── 1.0.2.zip</code></pre></div>\\n<h3>Parse Latest Version Information</h3>\\n<p>At this point, we’re ready to surface latest version data when a request is made. To do that, we’re gonna go through a series of steps:</p>\\n<ul>\\n<li>Access every available version in the <code>plugins</code> directory.</li>\\n<li>Filter out any non-<code>.zip</code> files (particularly while developing locally; some hidden “dot” files can sneak in).</li>\\n<li>Sort the file names by version, descending (go ahead and run <code>npm install compare-versions</code> for this step.</li>\\n<li>Grab the first file name in the list. This will be our newest version available.</li>\\n</ul>\\n<p>In code, that’ll look like this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-diff\\\"><code class=\\\"language-diff\\\"><span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"> const compareVersions = require('compare-versions');</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"> const { readdirSync } = require('fs');</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"> const { join } = require('path');</span>\\n<span class=\\\"token line\\\"></span></span>\\nexport default (req, res) => {\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> const {</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">     query: { plugin },</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> } = req;</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"> // Read all files in directory.</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"> const zips = readdirSync(join(process.cwd(), 'plugins', plugin))</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">     // Remove any non-ZIP files.</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">     .filter(fileName => fileName.endsWith('.zip'))</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"></span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">     // Collect only the file names, without file extension.</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">     .map(fileName => fileName.match(/(.+)\\\\.zip$/)[1])</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"></span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">     // Sort those file names (which are the version numbers).</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">     .sort(compareVersions).reverse();</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"></span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"> const latestVersion = zips[0];</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> return res.json({</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token deleted-sign deleted\\\"><span class=\\\"token prefix deleted\\\">-</span><span class=\\\"token line\\\">   version: \\\"0.0.0\\\",</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   version: latestVersion,</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token deleted-sign deleted\\\"><span class=\\\"token prefix deleted\\\">-</span><span class=\\\"token line\\\">   package: `http://localhost:3000/plugins/${plugin}/0.0.0.zip`</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   package: `http://localhost:3000/plugins/${plugin}/${latestVersion}.zip`</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> })</span>\\n<span class=\\\"token line\\\"></span></span>};\\n</code></pre></div>\\n<p>If you refresh your browser, you should see that same JSON blob we got earlier, but filled in with the correct version information:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-json\\\"><code class=\\\"language-json\\\"><span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token property\\\">\\\"version\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"1.0.2\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token property\\\">\\\"package\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"http://localhost:3000/plugins/our-plugin/1.0.2.zip\\\"</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p>There’s one more tweak we should make in case someone requests information for a plugin we don’t manage:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-diff\\\"><code class=\\\"language-diff\\\">const compareVersions = require('compare-versions');\\nconst { readdirSync } = require('fs');\\nconst { join } = require('path');\\n\\nexport default (req, res) => {\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> const {</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   query: { plugin },</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> } = req;</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"> try {</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   const zips = readdirSync(join(process.cwd(), 'plugins', plugin))</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">     .filter(fileName => fileName.endsWith('.zip'))</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">     .map(fileName => fileName.match(/(.+)\\\\.zip$/)[1])</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">     .sort(compareVersions)</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">     .reverse();</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   const latestVersion = zips[0];</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   return res.json({</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">     version: latestVersion,</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">     package: `http://localhost:3000/plugins/${plugin}/${latestVersion}.zip`</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   })</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"> } catch (e) {</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">    return res.status(404).json({</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">      message: `Sorry, couldn't find data for '${plugin}'.`,</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">    });</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"> }</span>\\n<span class=\\\"token line\\\"></span></span>};\\n</code></pre></div>\\n<p>Now, if you make a request to our function using a non-existent plugin slug, you should get a <code>404</code> status code, which is a bit more appropriate for the type of error that occurred.</p>\\n<p>And just like that, we have our own custom plugin update server ready in place. The next piece is configuring our plugin to check for updates &#x26; pull from that endpoint, rather than the WordPress Plugin Repository.</p>\\n<h2>Configure a WordPress Plugin to Use Update Server</h2>\\n<p>WordPress uses an <code>update_plugins</code> transient to keep track of which plugins have been checked for updates recently, and which are due for another check. We can hook into &#x26; filter the value of that transient using the <a href=\\\"https://github.com/WordPress/wordpress-develop/blob/97790af164b20a72640b3497af4c5a3986d8cf32/src/wp-includes/option.php#L1957\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\"><code>site_transient_update_plugins</code></a><a href=\\\"https://github.com/WordPress/wordpress-develop/blob/97790af164b20a72640b3497af4c5a3986d8cf32/src/wp-includes/option.php#L1957\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\"> filter</a>. By doing this, we’ll be able seize control of where WordPress looks to see if an update is ready.</p>\\n<p>But <em>before</em> we start to stub out that filter, let’s write a simple function for fetching fresh plugin data via <code>GET</code> request to our endpoint. With the following, we’re making that request, accounting for a possible error, and returning the raw JSON.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token function\\\">define</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string double-quoted-string\\\">\\\"PLUGIN_CHECK_ENDPOINT\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string double-quoted-string\\\">\\\"http://localhost:3000/api/our-plugin\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">function</span> <span class=\\\"token function-definition function\\\">fetch_remote_data</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token variable\\\">$remoteData</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">wp_remote_get</span><span class=\\\"token punctuation\\\">(</span>\\n    <span class=\\\"token constant\\\">PLUGIN_CHECK_ENDPOINT</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">[</span>\\n      <span class=\\\"token string single-quoted-string\\\">'headers'</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">[</span>\\n        <span class=\\\"token string single-quoted-string\\\">'Accept'</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token string single-quoted-string\\\">'application/json'</span>\\n      <span class=\\\"token punctuation\\\">]</span>\\n    <span class=\\\"token punctuation\\\">]</span>\\n  <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token comment\\\">// Something went wrong!</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>\\n    <span class=\\\"token function\\\">is_wp_error</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">$remoteData</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">||</span>\\n    <span class=\\\"token class-name\\\">wp_remote_retrieve_response_code</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">$remoteData</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">!==</span> <span class=\\\"token number\\\">200</span>\\n  <span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">return</span> <span class=\\\"token constant\\\">null</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token comment\\\">// {</span>\\n  <span class=\\\"token comment\\\">//    \\\"version\\\":\\\"1.0.2\\\",</span>\\n  <span class=\\\"token comment\\\">//    \\\"package\\\":\\\"http://localhost:3000/plugins/our-plugin/1.0.2.zip\\\"</span>\\n  <span class=\\\"token comment\\\">// }</span>\\n\\n  <span class=\\\"token keyword\\\">return</span> <span class=\\\"token function\\\">json_decode</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">$remoteData</span><span class=\\\"token punctuation\\\">[</span><span class=\\\"token string single-quoted-string\\\">'body'</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p>Now, let’s tweak that to return an object with an interface expected by WordPress’s plugin update system, populating the <code>new_version</code> and <code>package</code> properties with the data from our endpoint. (If you wanna dig into that more, <a href=\\\"https://make.wordpress.org/core/2020/07/30/recommended-usage-of-the-updates-api-to-support-the-auto-updates-ui-for-plugins-and-themes-in-wordpress-5-5/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">see here</a>.) As for the rest, feel free to fill things in as needed.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-diff\\\"><code class=\\\"language-diff\\\">define(\\\"PLUGIN_CHECK_ENDPOINT\\\", \\\"http://localhost:3000/api/our-plugin\\\");\\n\\nfunction fetch_remote_data() {\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> $remoteData = wp_remote_get(</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   PLUGIN_CHECK_ENDPOINT,</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   [</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">     'headers' => [</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">       'Accept' => 'application/json'</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">     ]</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   ]</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> );</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> // Something went wrong!</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> if (</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">     is_wp_error($remoteData) ||</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">     wp_remote_retrieve_response_code($remoteData) !== 200</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> ) {</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">     return null;</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> }</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token deleted-sign deleted\\\"><span class=\\\"token prefix deleted\\\">-</span><span class=\\\"token line\\\"> return json_decode($remoteData['body']);</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"> $remoteData = json_decode($remoteData['body']);</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"></span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"> return (object) [</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">     'id'            => 'our-plugin/our-plugin.php',</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">     'slug'          => 'our-plugin',</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">     'plugin'        => 'our-plugin/our-plugin.php',</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">     'new_version'   => $remoteData->version,  // &#x3C;-- Important!</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">     'url'           => 'https://macarthur.me',</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">     'package'       => $remoteData->package,  // &#x3C;-- Important!</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">     'icons'         => [],</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">     'banners'       => [],</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">     'banners_rtl'   => [],</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">     'tested'        => '',</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">     'requires_php'  => '',</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">     'compatibility' => new \\\\stdClass(),</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"> ];</span>\\n<span class=\\\"token line\\\"></span></span>}\\n</code></pre></div>\\n<p>Now, we’re ready to start filtering the <code>update_plugins</code> transient. To start, let’s stub out our filter and fetch the fresh data using the function we just wrote above. We’ll also pull in a means of grabbing the current installed version of our plugin, since we’ll later need to that to compare against our remote version.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token function\\\">add_filter</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string single-quoted-string\\\">'site_transient_update_plugins'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">$transient</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token variable\\\">$pluginData</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">fetch_remote_data</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">return</span> <span class=\\\"token variable\\\">$transient</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>And now, it’s as simple as doing a version comparison, which PHP makes relatively easy with it’s <code>version_compare</code> function:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-diff\\\"><code class=\\\"language-diff\\\"><span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"> require_once(ABSPATH . 'wp-admin/includes/plugin.php');</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"></span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"> $currentPluginData = get_plugin_data(__FILE__);</span>\\n<span class=\\\"token line\\\"></span></span>\\nadd_filter('site_transient_update_plugins', function ($transient) {\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> $pluginData = fetch_remote_data();</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"> if (version_compare($pluginData->new_version, $currentPluginData[\\\"Version\\\"], \\\">\\\")) {</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   $transient->response['our-plugin/our-plugin.php'] = $pluginData;</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"> } else {</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   $transient->no_update['our-plugin/our-plugin.php'] = $pluginData;</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"> }</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> return $transient;</span>\\n<span class=\\\"token line\\\"></span></span>});\\n</code></pre></div>\\n<p>The magic here is in that <code>$transient->PROPERTY</code> stuff. If our remote version is <em>larger</em> than the version we have installed, we’ll tell WordPress to prompt for an update by sticking it on the <code>response</code> property, which is an array whose keys are a WordPress site’s plugins’ root files. But if the plugin is not eligible for an update, we’re sticking it onto the <code>no_update</code> property, and no update will be prompted.</p>\\n<h3>Testing It Locally</h3>\\n<p>With things as they are, we’re <em>technically</em> sorta done. If you artificially set your local plugin’s version to something lower than what the remote endpoint is providing, you’ll see an update prompt:</p>\\n<p><img src='/proxy/8adea494-ec53-428f-b3ea-60b14de3665f' alt='' loading='lazy' /></p>\\n<p>But! Unfortunately, since our update endpoint is on <code>localhost</code>, WordPress will, by default, not allow a ZIP file to be pulled from it. So, for local testing, let’s turn that feature off using the filter below. <strong>Ideally, don’t put this in your plugin’s code.</strong> You don’t want to accidentally ship it.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token function\\\">add_filter</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string single-quoted-string\\\">'http_request_args'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">$args</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token variable\\\">$args</span><span class=\\\"token punctuation\\\">[</span><span class=\\\"token string single-quoted-string\\\">'reject_unsafe_urls'</span><span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant boolean\\\">false</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">return</span> <span class=\\\"token variable\\\">$args</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>After that’s in place, there’s another key step: <strong>commit &#x26; push up your plugin’s code</strong>, since it’s about to get wiped out with a “new” version, and you’ll need a way to revert it. Then, go ahead and attempt to run the update from the WordPress admin. It should work.</p>\\n<p>But! There’s still work to be done. In its current state, our code requires that our endpoint be hit every time it’s run. That’s an unnecessarily burdensome process (you’ll likely notice it every time you refresh the WordPress admin), especially when we have transients at our disposal.</p>\\n<h3>Make Things More Efficient</h3>\\n<p>Using a simple <a href=\\\"https://developer.wordpress.org/apis/handbook/transients/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">transient</a>, we can cache the payload from our endpoint until a certain amount of time passes. Let’s set one to expire after 12 hours, and set up some simple logic to first check for a transient value before hitting our serverless function.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-diff\\\"><code class=\\\"language-diff\\\">require_once(ABSPATH . 'wp-admin/includes/plugin.php');\\n\\ndefine(\\\"PLUGIN_CHECK_TRANSIENT_EXPIRATION\\\", 43200); // 12 hours\\ndefine(\\\"PLUGIN_CHECK_TRANSIENT_NAME\\\", \\\"wp_update_check_our_plugin\\\");\\n\\n$currentPluginData = get_plugin_data(__FILE__);\\n\\nadd_filter('site_transient_update_plugins', function ($transient) {\\n<span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"> $checkPluginTransient = get_transient(PLUGIN_CHECK_TRANSIENT_NAME);</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"></span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"> $pluginData = $checkPluginTransient ?: fetch_remote_data();</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token deleted-sign deleted\\\"><span class=\\\"token prefix deleted\\\">-</span><span class=\\\"token line\\\"> $pluginData = fetch_remote_data();</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> if (version_compare($pluginData->new_version, $currentPluginData[\\\"Version\\\"], \\\">\\\")) {</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   $transient->response['our-plugin/our-plugin.php'] = $pluginData;</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> } else {</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   $transient->no_update['our-plugin/our-plugin.php'] = $pluginData;</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> }</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> return $transient;</span>\\n<span class=\\\"token line\\\"></span></span>});\\n</code></pre></div>\\n<p>And finally, if that transient is due for a refresh, set it with what we receive from our endpoint.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-diff\\\"><code class=\\\"language-diff\\\">require_once(ABSPATH . 'wp-admin/includes/plugin.php');\\n\\ndefine(\\\"PLUGIN_CHECK_TRANSIENT_EXPIRATION\\\", 43200); // 12 hours\\ndefine(\\\"PLUGIN_CHECK_TRANSIENT_NAME\\\", \\\"wp_update_check_our_plugin\\\");\\n\\n$currentPluginData = get_plugin_data(__FILE__);\\n\\nadd_filter('site_transient_update_plugins', function ($transient) {\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> $checkPluginTransient = get_transient(PLUGIN_CHECK_TRANSIENT_NAME);</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> $pluginData = $checkPluginTransient ?: fetch_remote_data();</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">  if (!$checkPluginTransient) {</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   set_transient(</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">     PLUGIN_CHECK_TRANSIENT_NAME,</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">     $pluginData,</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">     PLUGIN_CHECK_TRANSIENT_EXPIRATION</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   );</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"> }</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> if (version_compare($pluginData->new_version, $currentPluginData[\\\"Version\\\"], \\\">\\\")) {</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   $transient->response['our-plugin/our-plugin.php'] = $pluginData;</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> } else {</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   $transient->no_update['our-plugin/our-plugin.php'] = $pluginData;</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> }</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> return $transient;</span>\\n<span class=\\\"token line\\\"></span></span>});\\n</code></pre></div>\\n<p>Now, if you were to refresh your WP admin a few times, you’ll notice that things are performing much more smoothly, since our serverless function will only need to be hit every 12 hours at the most.</p>\\n<h2>See a Live Example</h2>\\n<p>Everything you’re reading here was put into practice with one of my own plugins. If you’d like to take a glace at that code (with some various adjustments to suite my specific needs), check out the repositories below:</p>\\n<ul>\\n<li><a href=\\\"https://github.com/alexmacarthur/wp-typeit\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">TypeIt WordPress plugin</a></li>\\n<li><a href=\\\"https://github.com/alexmacarthur/wp-plugin-update-lambda\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">serverless function</a></li>\\n</ul>\\n<h2>Any Gotchas?</h2>\\n<p>One of the primary motivators I had for writing this was the fact that I couldn’t find any ultra-clear documentation for the process myself. That said, I welcome any feedback or unexpected gotchas you hit along the way.</p>\\n<p>Thanks for reading!</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 23,
        "title": "The Time I (Sorta) Had a Real Use Case for a Bitwise Operator in Client-Side JavaScript",
        "slug": "use-case-for-bitwise-operator-in-javascript",
        "html": "<p>There’s a certain number of JavaScript features that I’ve never really used and find highly intimidating. Bitwise operators are among them.</p>\n<p>These operators exist for manipulating binary representations of data, and for the type of work I usually do, I’ve never met a scenario when I’ve needed to dive into nitty-gritty bit handling. As far as I imagined, they’d only be useful to NASA engineers writing their newest rover’s operating system, or something else super cerebral.</p>\n<p>But then I found myself working on <a href=\"https://github.com/alexmacarthur/slide-element\" target=\"_blank\" rel=\"noopener\">a project</a> with an explicit priority to shave off as many bytes as possible. As it turns out, a bitwise operator could be shoehorned into supporting that objective. And at this point, I’d take any shot at justifying me spending time understanding what they do and how they work. So, I went for it.</p>\n<h2>Quick Overview of Bitwise</h2>\n<p>There’s a ton of great documentation out there that’ll do a better job of explaining the what, why, and how of JavaScript’s bitwise operators, but for some quick context (as well as some practice explaining this stuff myself), here’s a brief overview.</p>\n<p>The data used in the applications we build are represented by multiple bits – 1s and 0s – that are pieced together to make up bytes of information. For example, the numbers <code>10</code>, <code>20</code>, and <code>30</code> are represented by the following bit sequences:</p>\n<div class=\"remark-highlight\"><pre class=\"language-text\"><code class=\"language-text\">01010 // 10\n10100 // 20\n11110 // 30</code></pre></div>\n<p>JavaScript’s bitwise operators allow us to perform operations on the individual, corresponding bits of two values, which results in a new binary sequence. Several operators exist – AND, OR, XOR, and more – all of which compare bits in a different way.</p>\n<p>Let’s use the bitwise AND (&#x26;) operator to illustrate. This operator will spit out a <code>1</code> when the bits in a certain positioned are both <code>1</code>. So, if we wanted to know the result of a bitwise AND operation between <code>20</code> and <code>30</code> in JavaScript, we might write something like this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span> <span class=\"token operator\">&#x26;</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 20</span>\n</code></pre></div>\n<p>To “show our work” in that operation, we can stack the binary representations of each number on top of each other, and then compare the values in each position. If they’re both <code>1</code>, the output for that position is <code>1</code>:</p>\n<div class=\"remark-highlight\"><pre class=\"language-text\"><code class=\"language-text\">// Moving vertically, compare each bit.\n// If both are `1`, the resulting bit is `1`.\n\n10100 // 20\n11110 // 30\n-----\n10100 // 20</code></pre></div>\n<p>Similarly, the OR (|) operator returns a <code>1</code> if either of the corresponding bits are <code>1</code>:</p>\n<div class=\"remark-highlight\"><pre class=\"language-text\"><code class=\"language-text\">// bitwise OR\n\n10100 // 20\n11110 // 30\n-----\n11110 // 30</code></pre></div>\n<p>You get the idea.</p>\n<h2>My Situation</h2>\n<p>In my particular case, this sort of operator’s usefulness didn’t have much to do with the binary values themselves. Rather, it had more to do with allowing me to select a certain array item using the least amount of characters possible. Here’s the stage (pared-down quite a bit):</p>\n<p>In <a href=\"https://github.com/alexmacarthur/slide-element\" target=\"_blank\" rel=\"noopener\">slide-element</a>, I return a Promise after a sliding animation is complete for an element. That animation is powered by a CSS transition, so knowing when to <code>resolve()</code> that Promise requires listening for both the <code>transitionend</code> and <code>transitioncancel</code> events. The former fires whenever an animation is allowed to fully complete (or “end”), and the latter fires whenever it’s stopped before completion (or “cancelled”). To attach those listeners, I store them in an array and loop over <code>addEventListener</code>, resolving my Promise when an animation is finished.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> events <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"transitionend\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"transitioncancel\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n  events<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event<span class=\"token punctuation\">,</span> index</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    box<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Animation is done... whether it's completed or cancelled.</span>\n      <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">once</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h2>Cleaning Up Unneeded Event Listeners</h2>\n<p>Attaching the listeners and resolving the Promise is straightforward enough. Where things get a little more complicated is the cleanup. After an animation is finished, I don’t want to let old listeners hang around to potentially cause unexpected behavior or performance bottlenecks.</p>\n<p>One thing that helps is setting <code>{ once: true }</code> on each event listener I set up. This causes the listener to detach itself after firing, removing the need for me to do it. But the <em>other</em> event listener is left to fend for itself. I went through a couple of approaches to handle this.</p>\n<h3>Cleanup Approach #1: Loop &#x26; Remove Event Listeners</h3>\n<p>This option entailed storing my callback as a variable, and then looping over the events whenever one of them is triggered to fire <code>removeEventListener</code>, referencing that same callback in memory.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> events <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"transitionend\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"transitioncancel\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">callback</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Whenever one of the events fires, remove all listeners.</span>\n    events<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n      event<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">removeEventListener</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">,</span> callback<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  events<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event<span class=\"token punctuation\">,</span> index</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    box<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">,</span> callback<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>This approach worked, but it’s a little convoluted, and felt like too much code to do a simple task. As a result, I moved to another tactic that didn’t involve <code>removeEventListener()</code> at all.</p>\n<h3>Cleanup Approach #2: Programatically Trigger the Remaining Listener</h3>\n<p>This method involves “faking” the event by dispatching a <code>TransitionEvent</code> instance on <em>other</em> listener. For example, whenever <code>transitionend</code> was triggered, a <code>transitioncancel</code> event would kick off to trigger &#x26; remove the remaining listener via the <code>{ once: true }</code> configuration.</p>\n<p>The key piece here is accessing the <em>other</em> event type based on the one that just fired. Conveniently, I was working with an array that had exactly two items, <strong>whose indices would always be binary</strong>, truthy/falsey values (I’d like there to be a term for such an array, but I can’t seem to find one). So, I could do something like this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> events <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"transitionend\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"transitioncancel\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n  events<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event<span class=\"token punctuation\">,</span> index</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    box<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n      box<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">dispatchEvent</span><span class=\"token punctuation\">(</span>\n        <span class=\"token comment\">// Trigger the OTHER event listener, in order to remove it.</span>\n        <span class=\"token keyword\">new</span> <span class=\"token class-name\">TransitionEvent</span><span class=\"token punctuation\">(</span><span class=\"token constant\">EVENTS</span><span class=\"token punctuation\">[</span>index <span class=\"token operator\">?</span> <span class=\"token number\">1</span> <span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">once</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>But on my byte-shaving crusade, that made my gut twist a bit (lol). If it’s a binary value I’m trying to access, I shouldn’t need to rely on a ternary to explicitly return either a <code>1</code> or a <code>0</code>. Thankfully, this is just the sort of low-level calculation bitwise operators are well-suited for. All I was interested in was the <em>opposite</em> boolean value, <strong>making the XOR operator the perfect choice.</strong></p>\n<p>The “exclusive or” operator evaluates to <code>1</code> if only <em>one</em> of the operands is <code>1</code>. This makes it a great low-level “switch,” since it’ll flip values whenever one of the operand changes, like the index of a two-item array being looped over.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> items <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'first'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'second'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Loop #1: 'first' is the current item.</span>\n<span class=\"token keyword\">let</span> index <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>items<span class=\"token punctuation\">[</span>index <span class=\"token operator\">^</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 'second' is the other.</span>\n\n<span class=\"token comment\">// Loop #2: 'second' is the current item</span>\n<span class=\"token keyword\">let</span> index <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>items<span class=\"token punctuation\">[</span>index <span class=\"token operator\">^</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 'first' is the other.</span>\n</code></pre></div>\n<p>Knowing this, I could make a subtle change to my event handling snippet:</p>\n<div class=\"remark-highlight\"><pre class=\"language-diff\"><code class=\"language-diff\">new Promise((resolve) => {\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> const events = [\"transitionend\", \"transitioncancel\"];</span>\n<span class=\"token line\"></span></span>\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> events.forEach((event, index) => {</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   box.addEventListener(event, (e) => {</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">     box.dispatchEvent(</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">       // Trigger the OTHER event listener, in order to remove it.</span>\n<span class=\"token line\"></span></span><span class=\"token deleted-sign deleted\"><span class=\"token prefix deleted\">-</span><span class=\"token line\">       new TransitionEvent(EVENTS[index ? 1 : 0])</span>\n<span class=\"token line\"></span></span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">       new TransitionEvent(EVENTS[index ^ 1])</span>\n<span class=\"token line\"></span></span><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\">     );</span>\n<span class=\"token line\"></span></span>\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\">     resolve();</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   }, { once: true });</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> });</span>\n<span class=\"token line\"></span></span>}\n</code></pre></div>\n<p>If you’re doing the math as you follow along, that change gives me a savings of <strong>four whole characters,</strong> and a fresh understanding of how bitwise operators actually work!</p>\n<h2>Was This Solution Worth It?</h2>\n<p>If you consider the amount of time spent digging into this, and the tangible value it brought to the package, lol, nope. As a friend of mine put it in response to hearing about all of this, it “sounds like a solution looking for a problem.”</p>\n<p>But! This was a small project of mine for which I chose to make bundle size a big, possibly irrational priority. Pair that with the fact that I’d been itching for a chance to learn about what this bitwise garbage even means and how I could use it, then yes, it was <em>absolutely</em> worth it.</p>\n<p>When a moment like this ever arises for yourself, I’d encourage you to do the same. At best, you’ll land on a solution with some discernible benefit. At worst, it may not have made much of a difference, but you’ll be able to take those learnings with you onto the next thing.</p>\n<p>Get bitty!</p>\n",
        "feature_image": "https://images.unsplash.com/photo-1569338270981-4159a7818c13?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;ixlib=rb-1.2.1&amp;auto=format&amp;fit=crop&amp;w=1200&amp;q=100",
        "status": "published",
        "created_at": 1621573200000,
        "published_at": 1621573200000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>There’s a certain number of JavaScript features that I’ve never really used and find highly intimidating. Bitwise operators are among them.</p>\\n<p>These operators exist for manipulating binary representations of data, and for the type of work I usually do, I’ve never met a scenario when I’ve needed to dive into nitty-gritty bit handling. As far as I imagined, they’d only be useful to NASA engineers writing their newest rover’s operating system, or something else super cerebral.</p>\\n<p>But then I found myself working on <a href=\\\"https://github.com/alexmacarthur/slide-element\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">a project</a> with an explicit priority to shave off as many bytes as possible. As it turns out, a bitwise operator could be shoehorned into supporting that objective. And at this point, I’d take any shot at justifying me spending time understanding what they do and how they work. So, I went for it.</p>\\n<h2>Quick Overview of Bitwise</h2>\\n<p>There’s a ton of great documentation out there that’ll do a better job of explaining the what, why, and how of JavaScript’s bitwise operators, but for some quick context (as well as some practice explaining this stuff myself), here’s a brief overview.</p>\\n<p>The data used in the applications we build are represented by multiple bits – 1s and 0s – that are pieced together to make up bytes of information. For example, the numbers <code>10</code>, <code>20</code>, and <code>30</code> are represented by the following bit sequences:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">01010 // 10\\n10100 // 20\\n11110 // 30</code></pre></div>\\n<p>JavaScript’s bitwise operators allow us to perform operations on the individual, corresponding bits of two values, which results in a new binary sequence. Several operators exist – AND, OR, XOR, and more – all of which compare bits in a different way.</p>\\n<p>Let’s use the bitwise AND (&#x26;) operator to illustrate. This operator will spit out a <code>1</code> when the bits in a certain positioned are both <code>1</code>. So, if we wanted to know the result of a bitwise AND operation between <code>20</code> and <code>30</code> in JavaScript, we might write something like this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token number\\\">20</span> <span class=\\\"token operator\\\">&#x26;</span> <span class=\\\"token number\\\">30</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token comment\\\">// 20</span>\\n</code></pre></div>\\n<p>To “show our work” in that operation, we can stack the binary representations of each number on top of each other, and then compare the values in each position. If they’re both <code>1</code>, the output for that position is <code>1</code>:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">// Moving vertically, compare each bit.\\n// If both are `1`, the resulting bit is `1`.\\n\\n10100 // 20\\n11110 // 30\\n-----\\n10100 // 20</code></pre></div>\\n<p>Similarly, the OR (|) operator returns a <code>1</code> if either of the corresponding bits are <code>1</code>:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">// bitwise OR\\n\\n10100 // 20\\n11110 // 30\\n-----\\n11110 // 30</code></pre></div>\\n<p>You get the idea.</p>\\n<h2>My Situation</h2>\\n<p>In my particular case, this sort of operator’s usefulness didn’t have much to do with the binary values themselves. Rather, it had more to do with allowing me to select a certain array item using the least amount of characters possible. Here’s the stage (pared-down quite a bit):</p>\\n<p>In <a href=\\\"https://github.com/alexmacarthur/slide-element\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">slide-element</a>, I return a Promise after a sliding animation is complete for an element. That animation is powered by a CSS transition, so knowing when to <code>resolve()</code> that Promise requires listening for both the <code>transitionend</code> and <code>transitioncancel</code> events. The former fires whenever an animation is allowed to fully complete (or “end”), and the latter fires whenever it’s stopped before completion (or “cancelled”). To attach those listeners, I store them in an array and loop over <code>addEventListener</code>, resolving my Promise when an animation is finished.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Promise</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">resolve</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> events <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token string\\\">\\\"transitionend\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">\\\"transitioncancel\\\"</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  events<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">forEach</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">event<span class=\\\"token punctuation\\\">,</span> index</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    box<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">addEventListener</span><span class=\\\"token punctuation\\\">(</span>event<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">e</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token comment\\\">// Animation is done... whether it's completed or cancelled.</span>\\n      <span class=\\\"token function\\\">resolve</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token literal-property property\\\">once</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">true</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<h2>Cleaning Up Unneeded Event Listeners</h2>\\n<p>Attaching the listeners and resolving the Promise is straightforward enough. Where things get a little more complicated is the cleanup. After an animation is finished, I don’t want to let old listeners hang around to potentially cause unexpected behavior or performance bottlenecks.</p>\\n<p>One thing that helps is setting <code>{ once: true }</code> on each event listener I set up. This causes the listener to detach itself after firing, removing the need for me to do it. But the <em>other</em> event listener is left to fend for itself. I went through a couple of approaches to handle this.</p>\\n<h3>Cleanup Approach #1: Loop &#x26; Remove Event Listeners</h3>\\n<p>This option entailed storing my callback as a variable, and then looping over the events whenever one of them is triggered to fire <code>removeEventListener</code>, referencing that same callback in memory.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Promise</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">resolve</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> events <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token string\\\">\\\"transitionend\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">\\\"transitioncancel\\\"</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">callback</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">e</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token comment\\\">// Whenever one of the events fires, remove all listeners.</span>\\n    events<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">forEach</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">event</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n      event<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">removeEventListener</span><span class=\\\"token punctuation\\\">(</span>event<span class=\\\"token punctuation\\\">,</span> callback<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token function\\\">resolve</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  events<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">forEach</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">event<span class=\\\"token punctuation\\\">,</span> index</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    box<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">addEventListener</span><span class=\\\"token punctuation\\\">(</span>event<span class=\\\"token punctuation\\\">,</span> callback<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>This approach worked, but it’s a little convoluted, and felt like too much code to do a simple task. As a result, I moved to another tactic that didn’t involve <code>removeEventListener()</code> at all.</p>\\n<h3>Cleanup Approach #2: Programatically Trigger the Remaining Listener</h3>\\n<p>This method involves “faking” the event by dispatching a <code>TransitionEvent</code> instance on <em>other</em> listener. For example, whenever <code>transitionend</code> was triggered, a <code>transitioncancel</code> event would kick off to trigger &#x26; remove the remaining listener via the <code>{ once: true }</code> configuration.</p>\\n<p>The key piece here is accessing the <em>other</em> event type based on the one that just fired. Conveniently, I was working with an array that had exactly two items, <strong>whose indices would always be binary</strong>, truthy/falsey values (I’d like there to be a term for such an array, but I can’t seem to find one). So, I could do something like this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Promise</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">resolve</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> events <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token string\\\">\\\"transitionend\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">\\\"transitioncancel\\\"</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  events<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">forEach</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">event<span class=\\\"token punctuation\\\">,</span> index</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    box<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">addEventListener</span><span class=\\\"token punctuation\\\">(</span>event<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">e</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n      box<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">dispatchEvent</span><span class=\\\"token punctuation\\\">(</span>\\n        <span class=\\\"token comment\\\">// Trigger the OTHER event listener, in order to remove it.</span>\\n        <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">TransitionEvent</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token constant\\\">EVENTS</span><span class=\\\"token punctuation\\\">[</span>index <span class=\\\"token operator\\\">?</span> <span class=\\\"token number\\\">1</span> <span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">0</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n      <span class=\\\"token function\\\">resolve</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token literal-property property\\\">once</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">true</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p>But on my byte-shaving crusade, that made my gut twist a bit (lol). If it’s a binary value I’m trying to access, I shouldn’t need to rely on a ternary to explicitly return either a <code>1</code> or a <code>0</code>. Thankfully, this is just the sort of low-level calculation bitwise operators are well-suited for. All I was interested in was the <em>opposite</em> boolean value, <strong>making the XOR operator the perfect choice.</strong></p>\\n<p>The “exclusive or” operator evaluates to <code>1</code> if only <em>one</em> of the operands is <code>1</code>. This makes it a great low-level “switch,” since it’ll flip values whenever one of the operand changes, like the index of a two-item array being looped over.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> items <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token string\\\">'first'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">'second'</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// Loop #1: 'first' is the current item.</span>\\n<span class=\\\"token keyword\\\">let</span> index <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">0</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span>items<span class=\\\"token punctuation\\\">[</span>index <span class=\\\"token operator\\\">^</span> <span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token comment\\\">// 'second' is the other.</span>\\n\\n<span class=\\\"token comment\\\">// Loop #2: 'second' is the current item</span>\\n<span class=\\\"token keyword\\\">let</span> index <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span>items<span class=\\\"token punctuation\\\">[</span>index <span class=\\\"token operator\\\">^</span> <span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token comment\\\">// 'first' is the other.</span>\\n</code></pre></div>\\n<p>Knowing this, I could make a subtle change to my event handling snippet:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-diff\\\"><code class=\\\"language-diff\\\">new Promise((resolve) => {\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> const events = [\\\"transitionend\\\", \\\"transitioncancel\\\"];</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> events.forEach((event, index) => {</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   box.addEventListener(event, (e) => {</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">     box.dispatchEvent(</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">       // Trigger the OTHER event listener, in order to remove it.</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token deleted-sign deleted\\\"><span class=\\\"token prefix deleted\\\">-</span><span class=\\\"token line\\\">       new TransitionEvent(EVENTS[index ? 1 : 0])</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">       new TransitionEvent(EVENTS[index ^ 1])</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">     );</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">     resolve();</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   }, { once: true });</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> });</span>\\n<span class=\\\"token line\\\"></span></span>}\\n</code></pre></div>\\n<p>If you’re doing the math as you follow along, that change gives me a savings of <strong>four whole characters,</strong> and a fresh understanding of how bitwise operators actually work!</p>\\n<h2>Was This Solution Worth It?</h2>\\n<p>If you consider the amount of time spent digging into this, and the tangible value it brought to the package, lol, nope. As a friend of mine put it in response to hearing about all of this, it “sounds like a solution looking for a problem.”</p>\\n<p>But! This was a small project of mine for which I chose to make bundle size a big, possibly irrational priority. Pair that with the fact that I’d been itching for a chance to learn about what this bitwise garbage even means and how I could use it, then yes, it was <em>absolutely</em> worth it.</p>\\n<p>When a moment like this ever arises for yourself, I’d encourage you to do the same. At best, you’ll land on a solution with some discernible benefit. At worst, it may not have made much of a difference, but you’ll be able to take those learnings with you onto the next thing.</p>\\n<p>Get bitty!</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 24,
        "title": "Set Up a Quick & Dirty FTP Server on DigitalOcean",
        "slug": "quick-dirty-ftp-server-digital-ocean",
        "html": "<p>A project of mine recently needed a simple FTP server that can give multiple different users access to the contents of specific directories (and <em>only</em> those directories). My technical requirements were stupid simple, the data I’d be dealing with wasn’t sensitive, and I wanted to avoid paying for an expensive and/or complicated service, at least to start.</p>\n<p>I did some brief discovery and determined that a good, ol’ DigitalOcean droplet is a great candidate for hosting a simple server like this. This is essentially a set of my beautified notes on the process of setting that up.</p>\n<p>Before starting, let’s set some expectations: this implementation is very bare-bones, and it isn’t concerned with making everything as secure as possible. If you’re looking on setting up a server with an SFTP protocol, or in-depth configuration capabilities, you might need to use what you see here as the foundation, but you’ll need to search elsewhere for the rest.</p>\n<h2>Getting Started</h2>\n<p>To start, I’m assuming you have a DigitalOcean droplet running on Ubuntu, and that you’re able to access it via SSH. We’ll be spending most of our time inside the droplet, so go ahead and log in.</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">ssh</span> root@YOUR.IP.ADDRESS\n</code></pre></div>\n<h2>Configuring Your FTP Server</h2>\n<p>We’ll be using <a href=\"http://www.proftpd.org/\" target=\"_blank\" rel=\"noopener\">ProFTPD</a> for our FTP server. It’s a pretty reputable tool that’s straightforward to set up. Work through these steps:</p>\n<p>Install the tool. The <code>update</code> may be especially important, depending on your version of Ubuntu (I’m on 20.04):</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">apt-get</span> update <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> proftpd\n</code></pre></div>\n<p>Add <code>/bin/false</code> to our list of valid shells in our droplet. ProFTPD’s default configuration will require that a valid shell be used to gain access, and we’ll be using this particular value to prevent direct shell access to the system.</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'/bin/false'</span> <span class=\"token operator\">>></span> /etc/shells\n</code></pre></div>\n<p>Although it’s technically optional for a stupid-simple setup, you can modify the default configuration file generated when installing ProFTPD. If you want, I’d at least recommend changing the server name to something more personalized:</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">vi</span> /etc/proftpd/proftpd.conf\n</code></pre></div>\n<p><img src='/proxy/82ffebcd-8ca9-4560-922c-fe21a857c128' alt='' loading='lazy' /></p>\n<h2>Setting Up Directories, Users, and Permissions</h2>\n<p>After that, create a new user that’ll have access to the FTP server. In the same command, also specify a home directory for that user.</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">useradd</span> yourusername <span class=\"token parameter variable\">-d</span> /home/somedirectory <span class=\"token parameter variable\">-s</span> /bin/false\n</code></pre></div>\n<p>Set a password for that user:</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">passwd</span> yourusername\n</code></pre></div>\n<p>At this point, we need to set up specific directories that we’ll allow your users to access. To do that, let’s create one and then assign permissions to it:</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">mkdir</span> /home/somedirectory\n<span class=\"token function\">chown</span> yourusername:yourusername /home/somedirectory\n</code></pre></div>\n<p>With all of that in place, restart the server for everything to take effect:</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">service</span> proftpd restart\n</code></pre></div>\n<p>And finally, let’s create an empty file in our user’s directory just to have something we can verify when we try to connect.</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Test!\"</span> <span class=\"token operator\">></span> /home/somedirectory/sample.txt\n</code></pre></div>\n<h2>Accessing Your Server</h2>\n<p>Open up an FTP client (like <a href=\"https://cyberduck.io/\" target=\"_blank\" rel=\"noopener\">Cyberduck</a>), fill in your IP address as the “server,” and use the credentials you created above to log in. Make sure the port is set to <code>21</code>.</p>\n<p><img src='/proxy/6c8e9f0f-7644-458b-afc8-2a2de8b460d0' alt='' loading='lazy' /></p>\n<p>After logging in by clicking “Connect,” you should see the <code>sample.txt</code> file we created in the user’s directory.</p>\n<p><img src='/proxy/13bbe51a-4634-46ac-ab23-a1664e87a6e6' alt='' loading='lazy' /></p>\n<h2>Setting Up a Custom Domain</h2>\n<p>Although it’s not required, it’s nice to have a dedicated domain set up for users to connect to the server (ex: <code>ftp.macarthur.me</code>). To do that, create an <code>A</code> record in your DNS management tool that points to the subdomain or domain you’d like to use. In my case, that UI looked something like this:</p>\n<p><img src='/proxy/8c290d13-798c-431a-84d2-1c16f1de2439' alt='' loading='lazy' /></p>\n<p>Afterwards, you should be able to point your FTP client to that new domain when connecting:</p>\n<h2>That’s It.</h2>\n<p>Told you it was quick.</p>\n",
        "feature_image": "https://images.unsplash.com/photo-1583521214690-73421a1829a9?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;ixlib=rb-1.2.1&amp;auto=format&amp;fit=crop&amp;w=1200&amp;q=100",
        "status": "published",
        "created_at": 1620709200000,
        "published_at": 1620709200000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>A project of mine recently needed a simple FTP server that can give multiple different users access to the contents of specific directories (and <em>only</em> those directories). My technical requirements were stupid simple, the data I’d be dealing with wasn’t sensitive, and I wanted to avoid paying for an expensive and/or complicated service, at least to start.</p>\\n<p>I did some brief discovery and determined that a good, ol’ DigitalOcean droplet is a great candidate for hosting a simple server like this. This is essentially a set of my beautified notes on the process of setting that up.</p>\\n<p>Before starting, let’s set some expectations: this implementation is very bare-bones, and it isn’t concerned with making everything as secure as possible. If you’re looking on setting up a server with an SFTP protocol, or in-depth configuration capabilities, you might need to use what you see here as the foundation, but you’ll need to search elsewhere for the rest.</p>\\n<h2>Getting Started</h2>\\n<p>To start, I’m assuming you have a DigitalOcean droplet running on Ubuntu, and that you’re able to access it via SSH. We’ll be spending most of our time inside the droplet, so go ahead and log in.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\"><span class=\\\"token function\\\">ssh</span> root@YOUR.IP.ADDRESS\\n</code></pre></div>\\n<h2>Configuring Your FTP Server</h2>\\n<p>We’ll be using <a href=\\\"http://www.proftpd.org/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">ProFTPD</a> for our FTP server. It’s a pretty reputable tool that’s straightforward to set up. Work through these steps:</p>\\n<p>Install the tool. The <code>update</code> may be especially important, depending on your version of Ubuntu (I’m on 20.04):</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\"><span class=\\\"token function\\\">apt-get</span> update <span class=\\\"token operator\\\">&#x26;&#x26;</span> <span class=\\\"token function\\\">apt-get</span> <span class=\\\"token function\\\">install</span> proftpd\\n</code></pre></div>\\n<p>Add <code>/bin/false</code> to our list of valid shells in our droplet. ProFTPD’s default configuration will require that a valid shell be used to gain access, and we’ll be using this particular value to prevent direct shell access to the system.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\"><span class=\\\"token builtin class-name\\\">echo</span> <span class=\\\"token string\\\">'/bin/false'</span> <span class=\\\"token operator\\\">>></span> /etc/shells\\n</code></pre></div>\\n<p>Although it’s technically optional for a stupid-simple setup, you can modify the default configuration file generated when installing ProFTPD. If you want, I’d at least recommend changing the server name to something more personalized:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\"><span class=\\\"token function\\\">vi</span> /etc/proftpd/proftpd.conf\\n</code></pre></div>\\n<p><img src='/proxy/82ffebcd-8ca9-4560-922c-fe21a857c128' alt='' loading='lazy' /></p>\\n<h2>Setting Up Directories, Users, and Permissions</h2>\\n<p>After that, create a new user that’ll have access to the FTP server. In the same command, also specify a home directory for that user.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\"><span class=\\\"token function\\\">useradd</span> yourusername <span class=\\\"token parameter variable\\\">-d</span> /home/somedirectory <span class=\\\"token parameter variable\\\">-s</span> /bin/false\\n</code></pre></div>\\n<p>Set a password for that user:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\"><span class=\\\"token function\\\">passwd</span> yourusername\\n</code></pre></div>\\n<p>At this point, we need to set up specific directories that we’ll allow your users to access. To do that, let’s create one and then assign permissions to it:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\"><span class=\\\"token function\\\">mkdir</span> /home/somedirectory\\n<span class=\\\"token function\\\">chown</span> yourusername:yourusername /home/somedirectory\\n</code></pre></div>\\n<p>With all of that in place, restart the server for everything to take effect:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\"><span class=\\\"token function\\\">service</span> proftpd restart\\n</code></pre></div>\\n<p>And finally, let’s create an empty file in our user’s directory just to have something we can verify when we try to connect.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\"><span class=\\\"token builtin class-name\\\">echo</span> <span class=\\\"token string\\\">\\\"Test!\\\"</span> <span class=\\\"token operator\\\">></span> /home/somedirectory/sample.txt\\n</code></pre></div>\\n<h2>Accessing Your Server</h2>\\n<p>Open up an FTP client (like <a href=\\\"https://cyberduck.io/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Cyberduck</a>), fill in your IP address as the “server,” and use the credentials you created above to log in. Make sure the port is set to <code>21</code>.</p>\\n<p><img src='/proxy/6c8e9f0f-7644-458b-afc8-2a2de8b460d0' alt='' loading='lazy' /></p>\\n<p>After logging in by clicking “Connect,” you should see the <code>sample.txt</code> file we created in the user’s directory.</p>\\n<p><img src='/proxy/13bbe51a-4634-46ac-ab23-a1664e87a6e6' alt='' loading='lazy' /></p>\\n<h2>Setting Up a Custom Domain</h2>\\n<p>Although it’s not required, it’s nice to have a dedicated domain set up for users to connect to the server (ex: <code>ftp.macarthur.me</code>). To do that, create an <code>A</code> record in your DNS management tool that points to the subdomain or domain you’d like to use. In my case, that UI looked something like this:</p>\\n<p><img src='/proxy/8c290d13-798c-431a-84d2-1c16f1de2439' alt='' loading='lazy' /></p>\\n<p>Afterwards, you should be able to point your FTP client to that new domain when connecting:</p>\\n<h2>That’s It.</h2>\\n<p>Told you it was quick.</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 25,
        "title": "Bullets, Cannonballs, and Web Components",
        "slug": "bullets-cannonballs-web-components",
        "html": "<p>In his book <em>Great by Choice</em>, Jim Collins describes how launching new initiatives is best done by first firing <a href=\"https://www.jimcollins.com/concepts/fire-bullets-then-cannonballs.html\" target=\"_blank\" rel=\"noopener\">bullets, then cannonballs</a>. That is, performing small, inexpensive experiments helps companies “calibrate their line of sight,” increasing the chance of success when the more substantial cannonballs are finally launched.</p>\n<p>It’s hard not to get excited by an approach that helps to reduce risk and make the most of your resources in such an illustrative way. And that excitement can be contagious, overflowing into areas peripheral to the business initiative you’re interested in launching. As a developer, one of those areas is (obviously) technology.</p>\n<h2>Staying Modern is Hard</h2>\n<p>It can be a hard sell getting organizations on board with adopting a modern tool on the web platform, due to a range of legitimate concerns, including these:</p>\n<ul>\n<li><strong>A subset of users is on a system that doesn’t support it</strong>, and the business doesn’t want to risk losing a paying customer.</li>\n<li><strong>It would take time away from working on proven systems,</strong> and there’s hesitancy around shifting resources onto something not guaranteed to yield a return.</li>\n<li><strong>The potential advantages are ambiguous or indirect,</strong> and the there’s resistance to investing time into anything without clear-cut, understood benefits to how the business works today.</li>\n</ul>\n<p>But when you’re just shooting bullets, the spirit of the game is different. Your work is inexpensive and confined to a small territory. The same risks don’t exist here — at least in the same capacity. And as a digital product team, this spirit can be leveraged to push the digital envelope with little risk to a business’s revenue streams, while <em>still</em> calibrating those larger ventures.</p>\n<h2>Some Real-World Context</h2>\n<p>I’m on a team that’s doing its best to adopt this “bullets, then cannonballs” mindset (it can be a difficult shift to make, btw!), and we’ve been using it at a small scale to build out a product for helping people looking to buy or sell a home get connected with trusted, local real estate agents. In doing so, we’re testing and iterating on a variety of digital experiences in a rapid fashion and with a small slice of users.</p>\n<p>A key part of this work is collecting quick user feedback for each component of those experiences, so that we can determine if our bullets are actually hitting anything. And to do that, we decided to build a small UI component that would allow users to give feedback by clicking either a “thumbs up” or “thumbs down” icon.</p>\n<p>After some discussion, the solution we landed on was a relatively new kid on the block: a <a href=\"https://developer.mozilla.org/en-US/docs/Web/Web_Components\" target=\"_blank\" rel=\"noopener\">web component</a>. This modern standard of building UI components met all of our requirements, but it did carry with it a downside: there’s <a href=\"https://caniuse.com/custom-elementsv1\" target=\"_blank\" rel=\"noopener\">no support for Internet Explorer</a>. And while usage of IE is low — <a href=\"https://caniuse.com/usage-table\" target=\"_blank\" rel=\"noopener\">well under 2%</a> — it represents enough revenue that would’ve normally caused us to hit the brakes by default. After all, in your typical, day-to-day feature building, abandoning virtually any number of paying customers was a non-starter, even if the reason for doing so had the potential to unlock greater gains.</p>\n<p>But this wasn’t day-to-day work, which meant we could take a fresh approach to vetting technology.</p>\n<h2>Guidelines for Trying Vetting Tech While Shooting Bullets</h2>\n<p>With the foundation for how we had been assessing technology shifting under our feet, it changed the tone of our feedback component discussion. And in doing so, some general criteria seemed to emerge for determining whether it made sense to experiment with this modern solution while still shooting bullets for our bigger initiative.</p>\n<p>When reading through these, keep this in mind: these are the result of me reviewing our decision-making process in hindsight, and in the scope of our team’s particular project. They aren’t intended to be exhaustive, and certainly not set in stone. Here they are:</p>\n<h3>1. It should gracefully degrade.</h3>\n<p>Calibrating your line of site doesn’t require you to shoot at every ship in the sea. Similarly, toying with a modern technology doesn’t mean every user <em>needs</em> to experience it. But at the same time, you don’t want to worsen the experience for the portion of customers being excluded. If you’re gonna try a new tool, it should fall back with users having little to no awareness that they’re missing out on something.</p>\n<p>For a web component, this is straightforward to control. For the most part, the bucket of users who can’t use web components are the same whose browsers don’t support ES modules. So, to prevent a component from being downloaded and parsed in older browsers, it’s as simple as loading the source with a <code>type=\"module\"</code> attribute attached.</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>feedback-component</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>feedback-component</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>module<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>path/to/feedback-component.js<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n</code></pre></div>\n<p>If a person is using IE, the component won’t render at all, and no errors will be thrown. For us, it just meant that this small slice of users wouldn’t contribute feedback data, and for what we were interested in testing, that was fine with us. A nice side benefit to this tactic is that we could freely use modern JavaScript’s syntax without parsing errors occurring. In fact, we could avoid any sort of transpilation altogether, simplifying &#x26; lightening our workflow even further.</p>\n<p>In other situations, graceful degradation may look entirely different. Or, it might not even be possible given the constraints. Whatever the case, it’s important to have this expectation in place so any decisions won’t bear a negative impact on the application’s core functionality, or your efforts at calibrating your larger initiative.</p>\n<h3>2. It shouldn’t take long to learn.</h3>\n<p>One of the big reasons there’s value in first shooting bullets is their low cost, and <em>time</em> is a costly resource. As such, any new technology you choose to try in this frame of mind shouldn’t require a lot of amount of time to become competent in using it at a level that allows you to effectively evaluate it.</p>\n<p>Building a web component was a good choice because while the high-level API is new, it’s written in JavaScript, and has parallels to the lifecycle of a component from mainstream UI libraries (React, for example). Since our team had at least a good baseline understanding of that world, there wasn’t a huge risk of us slowing down any of our primary work, while still allowing us to evaluate its usefulness.</p>\n<p>Another factor in this piece of the decision-making process was the solution’s future trajectory. Web components isn’t an obscure client-side JavaScript framework with a couple hundred stars on GitHub. It exists as an <a href=\"https://html.spec.whatwg.org/multipage/custom-elements.html\" target=\"_blank\" rel=\"noopener\">active web standard</a> that’ll stick around and continue to evolve for time to come. So, the time cost in learning it was also being weighed against whether we could count on it sticking around in the web platform anyway.</p>\n<h3>3. It should solve (or help to avoid) real problems.</h3>\n<p>It’s the gift of a passionate developer to manufacture problems that support choosing the flashy, new framework tending on Twitter. But for it to be a legitimate contender for a team who’s shooting bullets, these decisions need to be driven by the the need to solve problems or prevent otherwise real problems from occurring.</p>\n<p>In our particular case, we had the following basic needs to consider when choosing a solution to build our feedback component:</p>\n<ul>\n<li><strong>It would need to be portable.</strong> We’d be using it in a variety of applications for related experiments.</li>\n<li><strong>It would need to be stack-agnostic</strong>. For example, creating a view component in Ruby on Rails would’ve been a poor decision, since other consuming applications aren’t guaranteed to be built on RoR.</li>\n<li><strong>It would need to be dependency-free.</strong> This one was mainly born out of a concern for performance. For example, creating it as a React component would be bad idea since it could potentially require other applications to take on a heavy React dependency just to collect simple user feedback.</li>\n</ul>\n<p>If we’re going by those needs (or problems we wanted to avoid), web components passed with flying colors, despite the tradeoffs associated with it being a relatively new item in the toolshed.</p>\n<h3>4. The footprint of what it’s used to build should be minimal.</h3>\n<p>An equally key reason it’s best to first shoot bullets is their size. If things don’t pan out as well as you hoped, a bullet is small and easy enough to swap out for another.</p>\n<p>Our feedback component was a great candidate to try out the web component standard for a similar reason — it was small, and perhaps even more importantly, it only served as ancillary support for the primary product we were interested in testing. We knew that we’d be able to gather feedback from 98%+ of those who saw it, and even if we ran into unexpected issues, the scope of the component is so small that switching from it altogether wouldn’t have been a major lift.</p>\n<p>The outcome of this process might’ve been far different if we were dealing with more complex functional requirements, or if what we used to build with it had been absolutely critical to the larger venture we were trying to calibrate as a business.</p>\n<h2>Risk It Up Front</h2>\n<p>As exciting as the notion of “shooting bullets, then cannonballs” can be, the only reason it’s even worth thinking about is the fact that you’re gonna fail — not always, but often enough to get familiar with the feeling. That’s why, as Marty Cagan also emphasizes in his book <a href=\"https://svpg.com/inspired-how-to-create-products-customers-love/\" target=\"_blank\" rel=\"noopener\"><em>INSPIRED</em></a><em>,</em> it’s so important to tackle risks <em>up front</em>, rather than after you’ve invested a significant amount of time and resources trying to make something stick.</p>\n<p>This is important to keep in mind as you vet new technologies too. More than you’d like, you’re gonna delve into a new tool that turns out to be a total flop, resulting in you scrapping everything and switching to something else, or maybe rethinking the problem altogether. That’s not fun, but it’s a prerequisite to landing something whose trial paid off in more ways than expected.</p>\n<p>So, in more areas than just your big business initiatives, think big, test small, and start to engage with tomorrow’s tools today.</p>\n",
        "feature_image": "https://images.unsplash.com/photo-1483494970302-fffedd90fee4?ixlib=rb-1.2.1&amp;ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&amp;auto=format&amp;fit=crop&amp;w=1200&amp;q=100",
        "status": "published",
        "created_at": 1614920400000,
        "published_at": 1614920400000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "meta_description": "Guidelines for Pushing the Technological Envelope While Validating New Business Ventures",
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>In his book <em>Great by Choice</em>, Jim Collins describes how launching new initiatives is best done by first firing <a href=\\\"https://www.jimcollins.com/concepts/fire-bullets-then-cannonballs.html\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">bullets, then cannonballs</a>. That is, performing small, inexpensive experiments helps companies “calibrate their line of sight,” increasing the chance of success when the more substantial cannonballs are finally launched.</p>\\n<p>It’s hard not to get excited by an approach that helps to reduce risk and make the most of your resources in such an illustrative way. And that excitement can be contagious, overflowing into areas peripheral to the business initiative you’re interested in launching. As a developer, one of those areas is (obviously) technology.</p>\\n<h2>Staying Modern is Hard</h2>\\n<p>It can be a hard sell getting organizations on board with adopting a modern tool on the web platform, due to a range of legitimate concerns, including these:</p>\\n<ul>\\n<li><strong>A subset of users is on a system that doesn’t support it</strong>, and the business doesn’t want to risk losing a paying customer.</li>\\n<li><strong>It would take time away from working on proven systems,</strong> and there’s hesitancy around shifting resources onto something not guaranteed to yield a return.</li>\\n<li><strong>The potential advantages are ambiguous or indirect,</strong> and the there’s resistance to investing time into anything without clear-cut, understood benefits to how the business works today.</li>\\n</ul>\\n<p>But when you’re just shooting bullets, the spirit of the game is different. Your work is inexpensive and confined to a small territory. The same risks don’t exist here — at least in the same capacity. And as a digital product team, this spirit can be leveraged to push the digital envelope with little risk to a business’s revenue streams, while <em>still</em> calibrating those larger ventures.</p>\\n<h2>Some Real-World Context</h2>\\n<p>I’m on a team that’s doing its best to adopt this “bullets, then cannonballs” mindset (it can be a difficult shift to make, btw!), and we’ve been using it at a small scale to build out a product for helping people looking to buy or sell a home get connected with trusted, local real estate agents. In doing so, we’re testing and iterating on a variety of digital experiences in a rapid fashion and with a small slice of users.</p>\\n<p>A key part of this work is collecting quick user feedback for each component of those experiences, so that we can determine if our bullets are actually hitting anything. And to do that, we decided to build a small UI component that would allow users to give feedback by clicking either a “thumbs up” or “thumbs down” icon.</p>\\n<p>After some discussion, the solution we landed on was a relatively new kid on the block: a <a href=\\\"https://developer.mozilla.org/en-US/docs/Web/Web_Components\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">web component</a>. This modern standard of building UI components met all of our requirements, but it did carry with it a downside: there’s <a href=\\\"https://caniuse.com/custom-elementsv1\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">no support for Internet Explorer</a>. And while usage of IE is low — <a href=\\\"https://caniuse.com/usage-table\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">well under 2%</a> — it represents enough revenue that would’ve normally caused us to hit the brakes by default. After all, in your typical, day-to-day feature building, abandoning virtually any number of paying customers was a non-starter, even if the reason for doing so had the potential to unlock greater gains.</p>\\n<p>But this wasn’t day-to-day work, which meant we could take a fresh approach to vetting technology.</p>\\n<h2>Guidelines for Trying Vetting Tech While Shooting Bullets</h2>\\n<p>With the foundation for how we had been assessing technology shifting under our feet, it changed the tone of our feedback component discussion. And in doing so, some general criteria seemed to emerge for determining whether it made sense to experiment with this modern solution while still shooting bullets for our bigger initiative.</p>\\n<p>When reading through these, keep this in mind: these are the result of me reviewing our decision-making process in hindsight, and in the scope of our team’s particular project. They aren’t intended to be exhaustive, and certainly not set in stone. Here they are:</p>\\n<h3>1. It should gracefully degrade.</h3>\\n<p>Calibrating your line of site doesn’t require you to shoot at every ship in the sea. Similarly, toying with a modern technology doesn’t mean every user <em>needs</em> to experience it. But at the same time, you don’t want to worsen the experience for the portion of customers being excluded. If you’re gonna try a new tool, it should fall back with users having little to no awareness that they’re missing out on something.</p>\\n<p>For a web component, this is straightforward to control. For the most part, the bucket of users who can’t use web components are the same whose browsers don’t support ES modules. So, to prevent a component from being downloaded and parsed in older browsers, it’s as simple as loading the source with a <code>type=\\\"module\\\"</code> attribute attached.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>feedback-component</span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>feedback-component</span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>script</span> <span class=\\\"token attr-name\\\">type</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>module<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token attr-name\\\">src</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>path/to/feedback-component.js<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token punctuation\\\">/></span></span>\\n</code></pre></div>\\n<p>If a person is using IE, the component won’t render at all, and no errors will be thrown. For us, it just meant that this small slice of users wouldn’t contribute feedback data, and for what we were interested in testing, that was fine with us. A nice side benefit to this tactic is that we could freely use modern JavaScript’s syntax without parsing errors occurring. In fact, we could avoid any sort of transpilation altogether, simplifying &#x26; lightening our workflow even further.</p>\\n<p>In other situations, graceful degradation may look entirely different. Or, it might not even be possible given the constraints. Whatever the case, it’s important to have this expectation in place so any decisions won’t bear a negative impact on the application’s core functionality, or your efforts at calibrating your larger initiative.</p>\\n<h3>2. It shouldn’t take long to learn.</h3>\\n<p>One of the big reasons there’s value in first shooting bullets is their low cost, and <em>time</em> is a costly resource. As such, any new technology you choose to try in this frame of mind shouldn’t require a lot of amount of time to become competent in using it at a level that allows you to effectively evaluate it.</p>\\n<p>Building a web component was a good choice because while the high-level API is new, it’s written in JavaScript, and has parallels to the lifecycle of a component from mainstream UI libraries (React, for example). Since our team had at least a good baseline understanding of that world, there wasn’t a huge risk of us slowing down any of our primary work, while still allowing us to evaluate its usefulness.</p>\\n<p>Another factor in this piece of the decision-making process was the solution’s future trajectory. Web components isn’t an obscure client-side JavaScript framework with a couple hundred stars on GitHub. It exists as an <a href=\\\"https://html.spec.whatwg.org/multipage/custom-elements.html\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">active web standard</a> that’ll stick around and continue to evolve for time to come. So, the time cost in learning it was also being weighed against whether we could count on it sticking around in the web platform anyway.</p>\\n<h3>3. It should solve (or help to avoid) real problems.</h3>\\n<p>It’s the gift of a passionate developer to manufacture problems that support choosing the flashy, new framework tending on Twitter. But for it to be a legitimate contender for a team who’s shooting bullets, these decisions need to be driven by the the need to solve problems or prevent otherwise real problems from occurring.</p>\\n<p>In our particular case, we had the following basic needs to consider when choosing a solution to build our feedback component:</p>\\n<ul>\\n<li><strong>It would need to be portable.</strong> We’d be using it in a variety of applications for related experiments.</li>\\n<li><strong>It would need to be stack-agnostic</strong>. For example, creating a view component in Ruby on Rails would’ve been a poor decision, since other consuming applications aren’t guaranteed to be built on RoR.</li>\\n<li><strong>It would need to be dependency-free.</strong> This one was mainly born out of a concern for performance. For example, creating it as a React component would be bad idea since it could potentially require other applications to take on a heavy React dependency just to collect simple user feedback.</li>\\n</ul>\\n<p>If we’re going by those needs (or problems we wanted to avoid), web components passed with flying colors, despite the tradeoffs associated with it being a relatively new item in the toolshed.</p>\\n<h3>4. The footprint of what it’s used to build should be minimal.</h3>\\n<p>An equally key reason it’s best to first shoot bullets is their size. If things don’t pan out as well as you hoped, a bullet is small and easy enough to swap out for another.</p>\\n<p>Our feedback component was a great candidate to try out the web component standard for a similar reason — it was small, and perhaps even more importantly, it only served as ancillary support for the primary product we were interested in testing. We knew that we’d be able to gather feedback from 98%+ of those who saw it, and even if we ran into unexpected issues, the scope of the component is so small that switching from it altogether wouldn’t have been a major lift.</p>\\n<p>The outcome of this process might’ve been far different if we were dealing with more complex functional requirements, or if what we used to build with it had been absolutely critical to the larger venture we were trying to calibrate as a business.</p>\\n<h2>Risk It Up Front</h2>\\n<p>As exciting as the notion of “shooting bullets, then cannonballs” can be, the only reason it’s even worth thinking about is the fact that you’re gonna fail — not always, but often enough to get familiar with the feeling. That’s why, as Marty Cagan also emphasizes in his book <a href=\\\"https://svpg.com/inspired-how-to-create-products-customers-love/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\"><em>INSPIRED</em></a><em>,</em> it’s so important to tackle risks <em>up front</em>, rather than after you’ve invested a significant amount of time and resources trying to make something stick.</p>\\n<p>This is important to keep in mind as you vet new technologies too. More than you’d like, you’re gonna delve into a new tool that turns out to be a total flop, resulting in you scrapping everything and switching to something else, or maybe rethinking the problem altogether. That’s not fun, but it’s a prerequisite to landing something whose trial paid off in more ways than expected.</p>\\n<p>So, in more areas than just your big business initiatives, think big, test small, and start to engage with tomorrow’s tools today.</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 26,
        "title": "Deploying WordPress to WP Engine with GitHub Actions and Composer",
        "slug": "deploy-to-wp-engine-with-github-actions-and-composer",
        "html": "<p>It’s difficult to overstate the value of GitHub Actions in automating tasks we previously had to perform manually – deploying WordPress sites included. Recently, I was tasked with setting up a WordPress repository to automatically deploy to a <a href=\"https://wpengine.com/\" target=\"_blank\" rel=\"noopener\">WP Engine</a> environment whenever a commit is made to a particular branch. There exists a variety of actions in the marketplace for taking care of this automatically. For example, <a href=\"https://github.com/jovrtn/github-action-wpengine-git-deploy\" target=\"_blank\" rel=\"noopener\">this one</a> by <a href=\"https://ovrtn.com/\" target=\"_blank\" rel=\"noopener\">Jesse Overton</a> gets the job done well.</p>\n<p>But in my particular scenerio, I also needed to install <a href=\"https://getcomposer.org/\" target=\"_blank\" rel=\"noopener\">Composer</a> dependencies after each deployment, and while that requirement doesn’t sound terribly complex, I was new to the WP Engine ecosystem, some fundamentals of SSH, as well as some of the basics of GitHub Actions. All that “newness” didn’t mix well, and it caused some lengthy frustrations. These frustrations spurred me to break down the entire process step-by-step. You’re reading that break-down.</p>\n<p>The goal here isn’t to convince you to write your GitHub Actions workflows from scratch each time (leverage those third-party resources when you can!), but rather help bolster understanding of what’s happening behind the scenes whichever route you go, specifically as it all relates to WP Engine deployments.</p>\n<h2>Build a Workflow from Scratch</h2>\n<p>We’re gonna walk through what it looks like to build a GitHub Actions workflow from scratch which will do the following when a commit is made to the <code>main</code> branch. At a high level, here are the steps:</p>\n<ol>\n<li>Check out the repository files inside the action.</li>\n<li>Push the files to the WP Engine remote Git host (thereby deploying them).</li>\n<li>Run <code>composer install</code> inside the remote WP Engine server to install PHP dependencies.</li>\n</ol>\n<p>And again, so it’s ultra clear what’s going on under the hood, we won’t be using any third-party actions to do any of it. Just a bit of proprietary GitHub stuff, SSH, and some shell scripting.</p>\n<h3>Generate &#x26; Set SSH Keys</h3>\n<p>Before we get our hands dirty with any code, we’ll need to generate <strong>two</strong> pairs of SSH keys – one pair for authenticating with WP Engine’s Git host, and another for accessing the server itself.</p>\n<p>Run the following command, which will save a new pair of keys to <code>~/.ssh/gitkey</code> and <code>~/.ssh/gitkey.pub</code> files.</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\">sh-keygen <span class=\"token parameter variable\">-t</span> rsa <span class=\"token parameter variable\">-b</span> <span class=\"token number\">4096</span> <span class=\"token parameter variable\">-f</span> ~/.ssh/gitkey\n</code></pre></div>\n<p>After executing the command, run through all of the prompts until you see some neat terminal art indicating the key generation is complete. Next, generate the key we’ll use to access the server when running Composer.</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\">sh-keygen <span class=\"token parameter variable\">-t</span> rsa <span class=\"token parameter variable\">-b</span> <span class=\"token number\">4096</span> <span class=\"token parameter variable\">-f</span> ~/.ssh/wpeaccountkey\n</code></pre></div>\n<h3>Add Keys to WP Engine</h3>\n<p>In the WP Engine dashboard, we’ll now need to add the newly created Git SSH key to each environment to which we’ll deploy. In reality, you’ll probably have multiple environments, but our purposes, we’ll just focus on one. In that evironment, head to the “Git Push” page, which will look something like this:</p>\n<p><img src='/proxy/34e56ba6-598a-4776-9c43-685ff69a4921' alt='' loading='lazy' /></p>\n<p>Copy the first <em>public</em> key we created by running <code>pbcopy &#x3C; ~/.ssh/gitkey.pub</code> and paste that value into the “SSH public key” field you see above. Give the key a name and save it.</p>\n<p>With our Git SSH key in place, we’ll need to do the same for configuring WP Engine to allow us to connect to the running server itself. Navigate to <a href=\"https://my.wpengine.com/ssh_keys\" target=\"_blank\" rel=\"noopener\">your profile</a> in the dashboard, and create a new SSH key for your account. Locally, copy the other <em>public</em> key we created by running <code>pbcopy &#x3C; ~/.ssh/wpeaccountkey.pub</code> and pasting it into the field.</p>\n<h3>Add Keys to GitHub Secrets</h3>\n<p>While we’re at it, we’ll also need to set the <em>private</em> keys as <a href=\"https://docs.github.com/en/actions/reference/encrypted-secrets#creating-encrypted-secrets-for-a-repository\" target=\"_blank\" rel=\"noopener\">secrets within GitHub</a>, which we’ll later use in our script. Copy the <code>~/.ssh/wpeaccountkey</code> and <code>~/.ssh/gitkey</code> values and save them respectively as <code>SSH_PRIVATE_ACCOUNT_KEY</code> and <code>SSH_PRIVATE_GIT_KEY</code>. Once saved, the UI should look something like this:</p>\n<p><img src='/proxy/f3cc90a8-b282-4b91-a9fb-6ead58da4b83' alt='' loading='lazy' /></p>\n<h3>Stub Out a Shell Script</h3>\n<p>Next up, let’s start stubbing out the deployment process in a raw Shell script. Create it in the root of your WordPress project repository with the following command:</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'#!/usr/bin/env sh'</span> <span class=\"token operator\">></span> deploy.sh\n</code></pre></div>\n<h3>Push to WP Engine’s Git Host</h3>\n<p>At the top of that file, let’s first set it up to push the current repository to WP Engine’s remote Git host (<code>git.wpengine.com</code>) over the SSH protocol. Let’s store some key values in some variables – where we’ll be referencing our SSH keys, the name of the site we’re deploying, as well as a couple of other values we’ll need (your site name can be found in the <a href=\"https://my.wpengine.com/sites\" target=\"_blank\" rel=\"noopener\">WP Engine dashboard</a>).</p>\n<div class=\"remark-highlight\"><pre class=\"language-diff\"><code class=\"language-diff\"># !/usr/bin/env sh\n\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\"> SSH_PATH=\"$HOME/.ssh\"</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\"> WPE_GIT_HOST=\"git.wpengine.com\"</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\"> WPE_ENVIRONMENT=\"production\"</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\"> WPE_SITE_NAME=\"my-staging-site\"</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\"> KNOWN_HOSTS_PATH=\"$SSH_PATH/known_hosts\"</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\"> SSH_PRIVATE_GIT_KEY_PATH=$SSH_PATH/gitkey</span></span>\n</code></pre></div>\n<p>Now, we’ll need to add this Git host to a <code>known_hosts</code> file that we’ll create, so that the system can identify it as a valid host with which we’d like to communicate.</p>\n<div class=\"remark-highlight\"><pre class=\"language-diff\"><code class=\"language-diff\"># !/usr/bin/env sh\n\nSSH_PATH=\"$HOME/.ssh\"\nWPE_GIT_HOST=\"git.wpengine.com\"\nWPE_ENVIRONMENT=\"production\"\nWPE_SITE_NAME=\"my-staging-site\"\nKNOWN_HOSTS_PATH=\"$SSH_PATH/known_hosts\"\nSSH_PRIVATE_GIT_KEY_PATH=$SSH_PATH/gitkey\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\"></span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\"> mkdir $SSH_PATH &#x26;&#x26; touch $KNOWN_HOSTS_PATH</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\"> ssh-keyscan -t rsa \"$WPE_GIT_HOST\" >> \"$KNOWN_HOSTS_PATH\"</span></span>\n</code></pre></div>\n<p>So far, we’re referencing a file path where our SSH key is stored, but there’s nothing there just yet. Let’s fill it with an environment variable that’ll supply the private key from our GitHub secret.</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># ^ ...other stuff we've already written.</span>\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"<span class=\"token variable\">$SSH_PRIVATE_GIT_KEY</span>\"</span> <span class=\"token operator\">></span> <span class=\"token string\">\"<span class=\"token variable\">$SSH_PRIVATE_GIT_KEY_PATH</span>\"</span>\n</code></pre></div>\n<p>And let’s also add some permissions to these files, so the action has the authority to do what it needs to do. At the end of the file, add the following:</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># ^ ...other stuff we've already written.</span>\n\n<span class=\"token function\">chmod</span> <span class=\"token number\">700</span> <span class=\"token string\">\"<span class=\"token variable\">$SSH_PATH</span>\"</span>\n<span class=\"token function\">chmod</span> <span class=\"token number\">644</span> <span class=\"token string\">\"<span class=\"token variable\">$KNOWN_HOSTS_PATH</span>\"</span>\n<span class=\"token function\">chmod</span> <span class=\"token number\">600</span> <span class=\"token string\">\"<span class=\"token variable\">$SSH_PRIVATE_GIT_KEY_PATH</span>\"</span>\n</code></pre></div>\n<p>At this point, we’re ready to push to the remote WP Engine Git host. These lines will do it:</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> config core.sshCommand <span class=\"token string\">\"ssh -i <span class=\"token variable\">$SSH_PRIVATE_GIT_KEY_PATH</span> -o UserKnownHostsFile=<span class=\"token variable\">$KNOWN_HOSTS_PATH</span>\"</span>\n<span class=\"token function\">git</span> remote <span class=\"token function\">add</span> <span class=\"token variable\">$WPE_ENVIRONMENT</span> git@<span class=\"token variable\">$WPE_GIT_HOST</span><span class=\"token builtin class-name\">:</span><span class=\"token variable\">$WPE_ENVIRONMENT</span>/<span class=\"token variable\">$WPE_SITE_NAME</span>.git\n<span class=\"token function\">git</span> push <span class=\"token variable\">$WPE_ENVIRONMENT</span> HEAD:master <span class=\"token parameter variable\">--force</span>\n</code></pre></div>\n<p>The first line sets up Git with our SSH key for authentication. The next will add the WP Engine Git repo as our remote, and the final line pushes up the code. You’ll notice we’re being very specific about the remote branch we’re pushing too – <code>HEAD:master</code>. This is because I originally hit an error complaining that <code>src refspec master does not match any</code>. After eventually coming across this <a href=\"https://stackoverflow.com/a/4183856\" target=\"_blank\" rel=\"noopener\">StackOverflow answer</a>, it was resolved by being extra specific in where I was pushing my code.</p>\n<p>After this runs, our code will be deployed. Try it out by running <code>sh deploy.sh</code>. If all goes well, you should see output that looks something like this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\">remote:   git.wpengine.com: validating\nremote:   - warning: changes will be deployed to production application <span class=\"token punctuation\">..</span>.\nremote:   - info: validating files <span class=\"token keyword\">in</span> 53760de <span class=\"token punctuation\">..</span>.\nremote:   - info: found application servers <span class=\"token punctuation\">..</span>.\nremote:   - success: validation complete<span class=\"token operator\">!</span>\nremote:   git.wpengine.com: deploying\nremote:   - info: preparing application updates <span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span> done.\nremote:   - info: checking submodules <span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span> done.\nremote:   - info: ensuring permissions <span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span> done.\nremote:   - info: deploying to production environment <span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span> done.\nremote:   - info: purging caches <span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span> done.\nremote:   - info: cleanup <span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span> done.\nremote:   git.wpengine.com: complete<span class=\"token operator\">!</span>\n</code></pre></div>\n<h3>Install Composer Dependencies</h3>\n<p>The next piece to all of this is automatically installing Composer dependencies once our code has been pushed to WP Engine’s server.</p>\n<p>First, let’s ensure that Composer is installed on the system before attempting to install those dependencies. In order to do that, we’ll run commands on the server by passing them into an <code>ssh</code> command that authenticates us. Before we can make that <code>ssh</code> command, we’ll need to set variables defining where our other SSH key – <code>wpeaccountkey</code> – is stored on our system. We’ll also need to add our SSH host to our <code>known_hosts</code> file, and set some more permissions. I’ll group this set of commands together here, with the expectation of later organizing them with what we’ve already written above (you’ll probably notice that much of this looks familiar).</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token assign-left variable\">WPE_SSH_HOST</span><span class=\"token operator\">=</span><span class=\"token string\">\"developtrinity.ssh.wpengine.net\"</span>\n<span class=\"token assign-left variable\">SSH_PRIVATE_ACCOUNT_KEY_PATH</span><span class=\"token operator\">=</span><span class=\"token variable\">$SSH_PATH</span>/wpeaccountkey\n<span class=\"token assign-left variable\">DEPLOYMENT_DIRECTORY</span><span class=\"token operator\">=</span><span class=\"token string\">\"sites/yoursite\"</span>\n\n<span class=\"token comment\"># Our `known_hosts` file now exists, so no need to create it.</span>\nssh-keyscan <span class=\"token parameter variable\">-t</span> rsa <span class=\"token string\">\"<span class=\"token variable\">$WPE_SSH_HOST</span>\"</span> <span class=\"token operator\">>></span> <span class=\"token string\">\"<span class=\"token variable\">$KNOWN_HOSTS_PATH</span>\"</span>\n\n<span class=\"token comment\"># Fill our key file with the value from our GitHub secret.</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"<span class=\"token variable\">$SSH_PRIVATE_ACCOUNT_KEY</span>\"</span> <span class=\"token operator\">></span> <span class=\"token string\">\"<span class=\"token variable\">$SSH_PRIVATE_ACCOUNT_KEY_PATH</span>\"</span>\n\n<span class=\"token comment\"># Set file permissions.</span>\n<span class=\"token function\">chmod</span> <span class=\"token number\">600</span> <span class=\"token string\">\"<span class=\"token variable\">$SSH_PRIVATE_ACCOUNT_KEY_PATH</span>\"</span>\n</code></pre></div>\n<p>Now, drop in the <code>ssh</code> command, with which we’ll run a series of other commands setting up and running Composer. The <code>ssh</code> command allows you to either pass one command at a time, or a path to a file with several. We’re <em>sort of</em> taking the latter approach, but faking a separate file by using an <a href=\"https://en.wikipedia.org/wiki/Here_document#Unix_shells\" target=\"_blank\" rel=\"noopener\"><code>EOF</code></a><a href=\"https://en.wikipedia.org/wiki/Here_document#Unix_shells\" target=\"_blank\" rel=\"noopener\"> block</a>:</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># ^ ...other stuff we've already written.</span>\n\n<span class=\"token function\">ssh</span> <span class=\"token variable\">$WPE_SITE_NAME</span>@<span class=\"token variable\">$WPE_SSH_HOST</span> <span class=\"token parameter variable\">-i</span> <span class=\"token variable\">$SSH_PRIVATE_ACCOUNT_KEY_PATH</span> <span class=\"token parameter variable\">-o</span> <span class=\"token assign-left variable\">UserKnownHostsFile</span><span class=\"token operator\">=</span><span class=\"token variable\">$KNOWN_HOSTS_PATH</span> <span class=\"token operator\">&#x3C;&#x3C;</span> <span class=\"token string\">EOF</span>\n<span class=\"token string\">    # commands will go here</span>\n<span class=\"token string\">EOF</span>\n</code></pre></div>\n<p>This is where we’ll navigate to the directory in which our project lives, install Composer and our dependencies, and do a little clean-up:</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">ssh</span> <span class=\"token variable\">$WPE_SITE_NAME</span>@<span class=\"token variable\">$WPE_SSH_HOST</span> <span class=\"token parameter variable\">-i</span> <span class=\"token variable\">$SSH_PRIVATE_ACCOUNT_KEY_PATH</span> <span class=\"token parameter variable\">-o</span> <span class=\"token assign-left variable\">UserKnownHostsFile</span><span class=\"token operator\">=</span><span class=\"token variable\">$KNOWN_HOSTS_PATH</span> <span class=\"token operator\">&#x3C;&#x3C;</span> <span class=\"token string\">EOF\n    # Navigate to where our site lives.\n    cd <span class=\"token variable\">$DEPLOYMENT_DIRECTORY</span>\n\n    # Download &#x26; run the Composer installer.\n    curl -s https://getcomposer.org/installer | php\n\n    # Install production dependencies.\n    php composer.phar install --no-dev\n\n    # Clean up.\n    rm composer.phar\nEOF</span>\n</code></pre></div>\n<p>At this point, our script should do all we need it to do. The next step is to execute it within the context of GitHub Actions.</p>\n<h3>Turn Our Script into a Workflow</h3>\n<p>The template for this will be fairly straightforward. Inside of our WP site repository, we’ll save this file at <code>.github/workflows/wp-engine.yml</code>:</p>\n<div class=\"remark-highlight\"><pre class=\"language-text\"><code class=\"language-text\">name: Deploy to WP Engine\n\non:\n  push:\n    branches: [main]\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n\n    steps:\n      - uses: actions/checkout@v2\n      - name: Push to WP Engine &#x26;amp; Install Composer Dependencies\n        run: |\n          # Our script will go here!</code></pre></div>\n<p>If you’re unfamiliar with these workflow files, this basic template translates as:</p>\n<ul>\n<li>When a commit is pushed to the <code>main</code> branch,</li>\n<li>checkout the repository with the <code>actions/checkout</code> action,</li>\n<li>and run our script to push to WP Engine and install Composer dependencies.</li>\n</ul>\n<p>The final piece of this is to paste in our finalized script. But before we do, we’ll need to make a subtle change to our environment variables. In order to pull the correct secrets from GitHub, they’ll need to be formatted as <code>${{ secrets.VARIABLE_NAME }}</code>. Here’s our completed workflow, organized &#x26; annotated a bit following all of our previous work.</p>\n<div class=\"remark-highlight\"><pre class=\"language-text\"><code class=\"language-text\">name: Deploy to WP Engine\n\non:\n  push:\n    branches: [test]\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n\n    steps:\n      - uses: actions/checkout@v2\n      - name: Push to WP Engine &#x26;amp; Install Composer Dependencies\n        run: |\n          # Where we&#x26;#39;ll store our two SSH keys.\n          SSH_PATH=&#x26;quot;$HOME/.ssh&#x26;quot;\n\n          # WP Engine&#x26;#39;s Git host.\n          WPE_GIT_HOST=&#x26;quot;git.wpengine.com&#x26;quot;\n\n          # WP Engine&#x26;#39;s server SSH host.\n          WPE_SSH_HOST=&#x26;quot;developtrinity.ssh.wpengine.net&#x26;quot;\n\n          # WP Engine&#x26;#39;s environment.\n          WPE_ENVIRONMENT=&#x26;quot;production&#x26;quot;\n\n          # Our site name within WP Engine.\n          WPE_SITE_NAME=&#x26;quot;developtrinity&#x26;quot;\n\n          # The file SSH uses to verify validity of hosts.\n          KNOWN_HOSTS_PATH=&#x26;quot;$SSH_PATH/known_hosts&#x26;quot;\n\n          # Path to private SSH key used to authenticate w/ WP Engine&#x26;#39;s Git host.\n          SSH_PRIVATE_GIT_KEY_PATH=$SSH_PATH/wpegitkey\n\n          # Path to private SSH key used to authenticate w/ WP Engine&#x26;#39;s server.\n          SSH_PRIVATE_ACCOUNT_KEY_PATH=$SSH_PATH/wpeaccountkey\n\n          # The directory within WP Engine&#x26;#39;s server where our site files live.\n          DEPLOYMENT_DIRECTORY=&#x26;quot;sites/developtrinity&#x26;quot;\n\n          # Explicitly create the `known_hosts` file, since the next command\n          # will assume it exists &#x26;amp; attempt to append do it.\n          mkdir $SSH_PATH &#x26;amp;&#x26;amp; touch $KNOWN_HOSTS_PATH\n\n          # Add our hosts to the `known_hosts` file.\n          ssh-keyscan -t rsa &#x26;quot;$WPE_GIT_HOST&#x26;quot; &#x26;gt;&#x26;gt; &#x26;quot;$KNOWN_HOSTS_PATH&#x26;quot;\n          ssh-keyscan -t rsa &#x26;quot;$WPE_SSH_HOST&#x26;quot; &#x26;gt;&#x26;gt; &#x26;quot;$KNOWN_HOSTS_PATH&#x26;quot;\n\n          # Write our SSH keys to the appropriate files.\n          echo &#x26;quot;${{ secrets.SSH_PRIVATE_GIT_KEY }}&#x26;quot; &#x26;gt; &#x26;quot;$SSH_PRIVATE_GIT_KEY_PATH&#x26;quot;\n          echo &#x26;quot;${{ secrets.SSH_PRIVATE_ACCOUNT_KEY }}&#x26;quot; &#x26;gt; &#x26;quot;$SSH_PRIVATE_ACCOUNT_KEY_PATH&#x26;quot;\n\n          # Set file permissions.\n          chmod 700 &#x26;quot;$SSH_PATH&#x26;quot;\n          chmod 644 &#x26;quot;$KNOWN_HOSTS_PATH&#x26;quot;\n          chmod 600 &#x26;quot;$SSH_PRIVATE_GIT_KEY_PATH&#x26;quot;\n          chmod 600 &#x26;quot;$SSH_PRIVATE_ACCOUNT_KEY_PATH&#x26;quot;\n\n          # Push code to WP Engine&#x26;#39;s Git host, which will deploy it to the server.\n          git config core.sshCommand &#x26;quot;ssh -i $SSH_PRIVATE_GIT_KEY_PATH -o UserKnownHostsFile=$KNOWN_HOSTS_PATH&#x26;quot;\n          git remote add $WPE_ENVIRONMENT git@$WPE_GIT_HOST:$WPE_ENVIRONMENT/$WPE_SITE_NAME.git\n          git push $WPE_ENVIRONMENT HEAD:master --force\n\n          # Authenticate with WP Engine&#x26;#39;s server to install Composer dependencies.\n          ssh $WPE_SITE_NAME@$WPE_SSH_HOST -i $SSH_PRIVATE_ACCOUNT_KEY_PATH -o UserKnownHostsFile=$KNOWN_HOSTS_PATH &#x26;lt;&#x26;lt; EOF\n            # Navigate to the directory in which our site files live.\n            cd $DEPLOYMENT_DIRECTORY\n\n            # Download the Composer installer &#x26;amp; execute it.\n            curl -s https://getcomposer.org/installer | php\n\n            # Install production dependencies.\n            php composer.phar install --no-dev\n\n            # Clean up.\n            rm composer.phar\n          EOF</code></pre></div>\n<h2>You’re Not Finished Yet</h2>\n<p>When you commit &#x26; push this workflow file to your GitHub repositroy, you should see it successfully execute everything we planned. But! You still have some work to do. In most cases, you’ll have multiple environments to configure, each of which you might want to trigger based on a different type of action (pull request, a push to a specific branch, etc.). Hopefully, this will all help you get a better grasp of how the ecosystem works, so that you feel empowered to tackle that more complicated and unique configuration yourself.</p>\n<h2>What’s Missing?</h2>\n<p>All of what you read here is the output of my own pain working through these challenges – basically a targeted brain dump. If any of this flow is confusing, or if I skipped a key step that led to problems when you tried it out for yourself, let me know!</p>\n",
        "feature_image": "https://images.pexels.com/photos/190574/pexels-photo-190574.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=3&amp;w=1200",
        "status": "published",
        "created_at": 1613106000000,
        "published_at": 1613106000000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>It’s difficult to overstate the value of GitHub Actions in automating tasks we previously had to perform manually – deploying WordPress sites included. Recently, I was tasked with setting up a WordPress repository to automatically deploy to a <a href=\\\"https://wpengine.com/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">WP Engine</a> environment whenever a commit is made to a particular branch. There exists a variety of actions in the marketplace for taking care of this automatically. For example, <a href=\\\"https://github.com/jovrtn/github-action-wpengine-git-deploy\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">this one</a> by <a href=\\\"https://ovrtn.com/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Jesse Overton</a> gets the job done well.</p>\\n<p>But in my particular scenerio, I also needed to install <a href=\\\"https://getcomposer.org/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Composer</a> dependencies after each deployment, and while that requirement doesn’t sound terribly complex, I was new to the WP Engine ecosystem, some fundamentals of SSH, as well as some of the basics of GitHub Actions. All that “newness” didn’t mix well, and it caused some lengthy frustrations. These frustrations spurred me to break down the entire process step-by-step. You’re reading that break-down.</p>\\n<p>The goal here isn’t to convince you to write your GitHub Actions workflows from scratch each time (leverage those third-party resources when you can!), but rather help bolster understanding of what’s happening behind the scenes whichever route you go, specifically as it all relates to WP Engine deployments.</p>\\n<h2>Build a Workflow from Scratch</h2>\\n<p>We’re gonna walk through what it looks like to build a GitHub Actions workflow from scratch which will do the following when a commit is made to the <code>main</code> branch. At a high level, here are the steps:</p>\\n<ol>\\n<li>Check out the repository files inside the action.</li>\\n<li>Push the files to the WP Engine remote Git host (thereby deploying them).</li>\\n<li>Run <code>composer install</code> inside the remote WP Engine server to install PHP dependencies.</li>\\n</ol>\\n<p>And again, so it’s ultra clear what’s going on under the hood, we won’t be using any third-party actions to do any of it. Just a bit of proprietary GitHub stuff, SSH, and some shell scripting.</p>\\n<h3>Generate &#x26; Set SSH Keys</h3>\\n<p>Before we get our hands dirty with any code, we’ll need to generate <strong>two</strong> pairs of SSH keys – one pair for authenticating with WP Engine’s Git host, and another for accessing the server itself.</p>\\n<p>Run the following command, which will save a new pair of keys to <code>~/.ssh/gitkey</code> and <code>~/.ssh/gitkey.pub</code> files.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\">sh-keygen <span class=\\\"token parameter variable\\\">-t</span> rsa <span class=\\\"token parameter variable\\\">-b</span> <span class=\\\"token number\\\">4096</span> <span class=\\\"token parameter variable\\\">-f</span> ~/.ssh/gitkey\\n</code></pre></div>\\n<p>After executing the command, run through all of the prompts until you see some neat terminal art indicating the key generation is complete. Next, generate the key we’ll use to access the server when running Composer.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\">sh-keygen <span class=\\\"token parameter variable\\\">-t</span> rsa <span class=\\\"token parameter variable\\\">-b</span> <span class=\\\"token number\\\">4096</span> <span class=\\\"token parameter variable\\\">-f</span> ~/.ssh/wpeaccountkey\\n</code></pre></div>\\n<h3>Add Keys to WP Engine</h3>\\n<p>In the WP Engine dashboard, we’ll now need to add the newly created Git SSH key to each environment to which we’ll deploy. In reality, you’ll probably have multiple environments, but our purposes, we’ll just focus on one. In that evironment, head to the “Git Push” page, which will look something like this:</p>\\n<p><img src='/proxy/34e56ba6-598a-4776-9c43-685ff69a4921' alt='' loading='lazy' /></p>\\n<p>Copy the first <em>public</em> key we created by running <code>pbcopy &#x3C; ~/.ssh/gitkey.pub</code> and paste that value into the “SSH public key” field you see above. Give the key a name and save it.</p>\\n<p>With our Git SSH key in place, we’ll need to do the same for configuring WP Engine to allow us to connect to the running server itself. Navigate to <a href=\\\"https://my.wpengine.com/ssh_keys\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">your profile</a> in the dashboard, and create a new SSH key for your account. Locally, copy the other <em>public</em> key we created by running <code>pbcopy &#x3C; ~/.ssh/wpeaccountkey.pub</code> and pasting it into the field.</p>\\n<h3>Add Keys to GitHub Secrets</h3>\\n<p>While we’re at it, we’ll also need to set the <em>private</em> keys as <a href=\\\"https://docs.github.com/en/actions/reference/encrypted-secrets#creating-encrypted-secrets-for-a-repository\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">secrets within GitHub</a>, which we’ll later use in our script. Copy the <code>~/.ssh/wpeaccountkey</code> and <code>~/.ssh/gitkey</code> values and save them respectively as <code>SSH_PRIVATE_ACCOUNT_KEY</code> and <code>SSH_PRIVATE_GIT_KEY</code>. Once saved, the UI should look something like this:</p>\\n<p><img src='/proxy/f3cc90a8-b282-4b91-a9fb-6ead58da4b83' alt='' loading='lazy' /></p>\\n<h3>Stub Out a Shell Script</h3>\\n<p>Next up, let’s start stubbing out the deployment process in a raw Shell script. Create it in the root of your WordPress project repository with the following command:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\"><span class=\\\"token builtin class-name\\\">echo</span> <span class=\\\"token string\\\">'#!/usr/bin/env sh'</span> <span class=\\\"token operator\\\">></span> deploy.sh\\n</code></pre></div>\\n<h3>Push to WP Engine’s Git Host</h3>\\n<p>At the top of that file, let’s first set it up to push the current repository to WP Engine’s remote Git host (<code>git.wpengine.com</code>) over the SSH protocol. Let’s store some key values in some variables – where we’ll be referencing our SSH keys, the name of the site we’re deploying, as well as a couple of other values we’ll need (your site name can be found in the <a href=\\\"https://my.wpengine.com/sites\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">WP Engine dashboard</a>).</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-diff\\\"><code class=\\\"language-diff\\\"># !/usr/bin/env sh\\n\\n<span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"> SSH_PATH=\\\"$HOME/.ssh\\\"</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"> WPE_GIT_HOST=\\\"git.wpengine.com\\\"</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"> WPE_ENVIRONMENT=\\\"production\\\"</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"> WPE_SITE_NAME=\\\"my-staging-site\\\"</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"> KNOWN_HOSTS_PATH=\\\"$SSH_PATH/known_hosts\\\"</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"> SSH_PRIVATE_GIT_KEY_PATH=$SSH_PATH/gitkey</span></span>\\n</code></pre></div>\\n<p>Now, we’ll need to add this Git host to a <code>known_hosts</code> file that we’ll create, so that the system can identify it as a valid host with which we’d like to communicate.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-diff\\\"><code class=\\\"language-diff\\\"># !/usr/bin/env sh\\n\\nSSH_PATH=\\\"$HOME/.ssh\\\"\\nWPE_GIT_HOST=\\\"git.wpengine.com\\\"\\nWPE_ENVIRONMENT=\\\"production\\\"\\nWPE_SITE_NAME=\\\"my-staging-site\\\"\\nKNOWN_HOSTS_PATH=\\\"$SSH_PATH/known_hosts\\\"\\nSSH_PRIVATE_GIT_KEY_PATH=$SSH_PATH/gitkey\\n<span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"></span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"> mkdir $SSH_PATH &#x26;&#x26; touch $KNOWN_HOSTS_PATH</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"> ssh-keyscan -t rsa \\\"$WPE_GIT_HOST\\\" >> \\\"$KNOWN_HOSTS_PATH\\\"</span></span>\\n</code></pre></div>\\n<p>So far, we’re referencing a file path where our SSH key is stored, but there’s nothing there just yet. Let’s fill it with an environment variable that’ll supply the private key from our GitHub secret.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\"><span class=\\\"token comment\\\"># ^ ...other stuff we've already written.</span>\\n\\n<span class=\\\"token builtin class-name\\\">echo</span> <span class=\\\"token string\\\">\\\"<span class=\\\"token variable\\\">$SSH_PRIVATE_GIT_KEY</span>\\\"</span> <span class=\\\"token operator\\\">></span> <span class=\\\"token string\\\">\\\"<span class=\\\"token variable\\\">$SSH_PRIVATE_GIT_KEY_PATH</span>\\\"</span>\\n</code></pre></div>\\n<p>And let’s also add some permissions to these files, so the action has the authority to do what it needs to do. At the end of the file, add the following:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\"><span class=\\\"token comment\\\"># ^ ...other stuff we've already written.</span>\\n\\n<span class=\\\"token function\\\">chmod</span> <span class=\\\"token number\\\">700</span> <span class=\\\"token string\\\">\\\"<span class=\\\"token variable\\\">$SSH_PATH</span>\\\"</span>\\n<span class=\\\"token function\\\">chmod</span> <span class=\\\"token number\\\">644</span> <span class=\\\"token string\\\">\\\"<span class=\\\"token variable\\\">$KNOWN_HOSTS_PATH</span>\\\"</span>\\n<span class=\\\"token function\\\">chmod</span> <span class=\\\"token number\\\">600</span> <span class=\\\"token string\\\">\\\"<span class=\\\"token variable\\\">$SSH_PRIVATE_GIT_KEY_PATH</span>\\\"</span>\\n</code></pre></div>\\n<p>At this point, we’re ready to push to the remote WP Engine Git host. These lines will do it:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\"><span class=\\\"token function\\\">git</span> config core.sshCommand <span class=\\\"token string\\\">\\\"ssh -i <span class=\\\"token variable\\\">$SSH_PRIVATE_GIT_KEY_PATH</span> -o UserKnownHostsFile=<span class=\\\"token variable\\\">$KNOWN_HOSTS_PATH</span>\\\"</span>\\n<span class=\\\"token function\\\">git</span> remote <span class=\\\"token function\\\">add</span> <span class=\\\"token variable\\\">$WPE_ENVIRONMENT</span> git@<span class=\\\"token variable\\\">$WPE_GIT_HOST</span><span class=\\\"token builtin class-name\\\">:</span><span class=\\\"token variable\\\">$WPE_ENVIRONMENT</span>/<span class=\\\"token variable\\\">$WPE_SITE_NAME</span>.git\\n<span class=\\\"token function\\\">git</span> push <span class=\\\"token variable\\\">$WPE_ENVIRONMENT</span> HEAD:master <span class=\\\"token parameter variable\\\">--force</span>\\n</code></pre></div>\\n<p>The first line sets up Git with our SSH key for authentication. The next will add the WP Engine Git repo as our remote, and the final line pushes up the code. You’ll notice we’re being very specific about the remote branch we’re pushing too – <code>HEAD:master</code>. This is because I originally hit an error complaining that <code>src refspec master does not match any</code>. After eventually coming across this <a href=\\\"https://stackoverflow.com/a/4183856\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">StackOverflow answer</a>, it was resolved by being extra specific in where I was pushing my code.</p>\\n<p>After this runs, our code will be deployed. Try it out by running <code>sh deploy.sh</code>. If all goes well, you should see output that looks something like this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\">remote:   git.wpengine.com: validating\\nremote:   - warning: changes will be deployed to production application <span class=\\\"token punctuation\\\">..</span>.\\nremote:   - info: validating files <span class=\\\"token keyword\\\">in</span> 53760de <span class=\\\"token punctuation\\\">..</span>.\\nremote:   - info: found application servers <span class=\\\"token punctuation\\\">..</span>.\\nremote:   - success: validation complete<span class=\\\"token operator\\\">!</span>\\nremote:   git.wpengine.com: deploying\\nremote:   - info: preparing application updates <span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span> done.\\nremote:   - info: checking submodules <span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span> done.\\nremote:   - info: ensuring permissions <span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span> done.\\nremote:   - info: deploying to production environment <span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span> done.\\nremote:   - info: purging caches <span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span> done.\\nremote:   - info: cleanup <span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span> done.\\nremote:   git.wpengine.com: complete<span class=\\\"token operator\\\">!</span>\\n</code></pre></div>\\n<h3>Install Composer Dependencies</h3>\\n<p>The next piece to all of this is automatically installing Composer dependencies once our code has been pushed to WP Engine’s server.</p>\\n<p>First, let’s ensure that Composer is installed on the system before attempting to install those dependencies. In order to do that, we’ll run commands on the server by passing them into an <code>ssh</code> command that authenticates us. Before we can make that <code>ssh</code> command, we’ll need to set variables defining where our other SSH key – <code>wpeaccountkey</code> – is stored on our system. We’ll also need to add our SSH host to our <code>known_hosts</code> file, and set some more permissions. I’ll group this set of commands together here, with the expectation of later organizing them with what we’ve already written above (you’ll probably notice that much of this looks familiar).</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\"><span class=\\\"token assign-left variable\\\">WPE_SSH_HOST</span><span class=\\\"token operator\\\">=</span><span class=\\\"token string\\\">\\\"developtrinity.ssh.wpengine.net\\\"</span>\\n<span class=\\\"token assign-left variable\\\">SSH_PRIVATE_ACCOUNT_KEY_PATH</span><span class=\\\"token operator\\\">=</span><span class=\\\"token variable\\\">$SSH_PATH</span>/wpeaccountkey\\n<span class=\\\"token assign-left variable\\\">DEPLOYMENT_DIRECTORY</span><span class=\\\"token operator\\\">=</span><span class=\\\"token string\\\">\\\"sites/yoursite\\\"</span>\\n\\n<span class=\\\"token comment\\\"># Our `known_hosts` file now exists, so no need to create it.</span>\\nssh-keyscan <span class=\\\"token parameter variable\\\">-t</span> rsa <span class=\\\"token string\\\">\\\"<span class=\\\"token variable\\\">$WPE_SSH_HOST</span>\\\"</span> <span class=\\\"token operator\\\">>></span> <span class=\\\"token string\\\">\\\"<span class=\\\"token variable\\\">$KNOWN_HOSTS_PATH</span>\\\"</span>\\n\\n<span class=\\\"token comment\\\"># Fill our key file with the value from our GitHub secret.</span>\\n<span class=\\\"token builtin class-name\\\">echo</span> <span class=\\\"token string\\\">\\\"<span class=\\\"token variable\\\">$SSH_PRIVATE_ACCOUNT_KEY</span>\\\"</span> <span class=\\\"token operator\\\">></span> <span class=\\\"token string\\\">\\\"<span class=\\\"token variable\\\">$SSH_PRIVATE_ACCOUNT_KEY_PATH</span>\\\"</span>\\n\\n<span class=\\\"token comment\\\"># Set file permissions.</span>\\n<span class=\\\"token function\\\">chmod</span> <span class=\\\"token number\\\">600</span> <span class=\\\"token string\\\">\\\"<span class=\\\"token variable\\\">$SSH_PRIVATE_ACCOUNT_KEY_PATH</span>\\\"</span>\\n</code></pre></div>\\n<p>Now, drop in the <code>ssh</code> command, with which we’ll run a series of other commands setting up and running Composer. The <code>ssh</code> command allows you to either pass one command at a time, or a path to a file with several. We’re <em>sort of</em> taking the latter approach, but faking a separate file by using an <a href=\\\"https://en.wikipedia.org/wiki/Here_document#Unix_shells\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\"><code>EOF</code></a><a href=\\\"https://en.wikipedia.org/wiki/Here_document#Unix_shells\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\"> block</a>:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\"><span class=\\\"token comment\\\"># ^ ...other stuff we've already written.</span>\\n\\n<span class=\\\"token function\\\">ssh</span> <span class=\\\"token variable\\\">$WPE_SITE_NAME</span>@<span class=\\\"token variable\\\">$WPE_SSH_HOST</span> <span class=\\\"token parameter variable\\\">-i</span> <span class=\\\"token variable\\\">$SSH_PRIVATE_ACCOUNT_KEY_PATH</span> <span class=\\\"token parameter variable\\\">-o</span> <span class=\\\"token assign-left variable\\\">UserKnownHostsFile</span><span class=\\\"token operator\\\">=</span><span class=\\\"token variable\\\">$KNOWN_HOSTS_PATH</span> <span class=\\\"token operator\\\">&#x3C;&#x3C;</span> <span class=\\\"token string\\\">EOF</span>\\n<span class=\\\"token string\\\">    # commands will go here</span>\\n<span class=\\\"token string\\\">EOF</span>\\n</code></pre></div>\\n<p>This is where we’ll navigate to the directory in which our project lives, install Composer and our dependencies, and do a little clean-up:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\"><span class=\\\"token function\\\">ssh</span> <span class=\\\"token variable\\\">$WPE_SITE_NAME</span>@<span class=\\\"token variable\\\">$WPE_SSH_HOST</span> <span class=\\\"token parameter variable\\\">-i</span> <span class=\\\"token variable\\\">$SSH_PRIVATE_ACCOUNT_KEY_PATH</span> <span class=\\\"token parameter variable\\\">-o</span> <span class=\\\"token assign-left variable\\\">UserKnownHostsFile</span><span class=\\\"token operator\\\">=</span><span class=\\\"token variable\\\">$KNOWN_HOSTS_PATH</span> <span class=\\\"token operator\\\">&#x3C;&#x3C;</span> <span class=\\\"token string\\\">EOF\\n    # Navigate to where our site lives.\\n    cd <span class=\\\"token variable\\\">$DEPLOYMENT_DIRECTORY</span>\\n\\n    # Download &#x26; run the Composer installer.\\n    curl -s https://getcomposer.org/installer | php\\n\\n    # Install production dependencies.\\n    php composer.phar install --no-dev\\n\\n    # Clean up.\\n    rm composer.phar\\nEOF</span>\\n</code></pre></div>\\n<p>At this point, our script should do all we need it to do. The next step is to execute it within the context of GitHub Actions.</p>\\n<h3>Turn Our Script into a Workflow</h3>\\n<p>The template for this will be fairly straightforward. Inside of our WP site repository, we’ll save this file at <code>.github/workflows/wp-engine.yml</code>:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">name: Deploy to WP Engine\\n\\non:\\n  push:\\n    branches: [main]\\n\\njobs:\\n  build:\\n    runs-on: ubuntu-latest\\n\\n    steps:\\n      - uses: actions/checkout@v2\\n      - name: Push to WP Engine &#x26;amp; Install Composer Dependencies\\n        run: |\\n          # Our script will go here!</code></pre></div>\\n<p>If you’re unfamiliar with these workflow files, this basic template translates as:</p>\\n<ul>\\n<li>When a commit is pushed to the <code>main</code> branch,</li>\\n<li>checkout the repository with the <code>actions/checkout</code> action,</li>\\n<li>and run our script to push to WP Engine and install Composer dependencies.</li>\\n</ul>\\n<p>The final piece of this is to paste in our finalized script. But before we do, we’ll need to make a subtle change to our environment variables. In order to pull the correct secrets from GitHub, they’ll need to be formatted as <code>${{ secrets.VARIABLE_NAME }}</code>. Here’s our completed workflow, organized &#x26; annotated a bit following all of our previous work.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">name: Deploy to WP Engine\\n\\non:\\n  push:\\n    branches: [test]\\n\\njobs:\\n  build:\\n    runs-on: ubuntu-latest\\n\\n    steps:\\n      - uses: actions/checkout@v2\\n      - name: Push to WP Engine &#x26;amp; Install Composer Dependencies\\n        run: |\\n          # Where we&#x26;#39;ll store our two SSH keys.\\n          SSH_PATH=&#x26;quot;$HOME/.ssh&#x26;quot;\\n\\n          # WP Engine&#x26;#39;s Git host.\\n          WPE_GIT_HOST=&#x26;quot;git.wpengine.com&#x26;quot;\\n\\n          # WP Engine&#x26;#39;s server SSH host.\\n          WPE_SSH_HOST=&#x26;quot;developtrinity.ssh.wpengine.net&#x26;quot;\\n\\n          # WP Engine&#x26;#39;s environment.\\n          WPE_ENVIRONMENT=&#x26;quot;production&#x26;quot;\\n\\n          # Our site name within WP Engine.\\n          WPE_SITE_NAME=&#x26;quot;developtrinity&#x26;quot;\\n\\n          # The file SSH uses to verify validity of hosts.\\n          KNOWN_HOSTS_PATH=&#x26;quot;$SSH_PATH/known_hosts&#x26;quot;\\n\\n          # Path to private SSH key used to authenticate w/ WP Engine&#x26;#39;s Git host.\\n          SSH_PRIVATE_GIT_KEY_PATH=$SSH_PATH/wpegitkey\\n\\n          # Path to private SSH key used to authenticate w/ WP Engine&#x26;#39;s server.\\n          SSH_PRIVATE_ACCOUNT_KEY_PATH=$SSH_PATH/wpeaccountkey\\n\\n          # The directory within WP Engine&#x26;#39;s server where our site files live.\\n          DEPLOYMENT_DIRECTORY=&#x26;quot;sites/developtrinity&#x26;quot;\\n\\n          # Explicitly create the `known_hosts` file, since the next command\\n          # will assume it exists &#x26;amp; attempt to append do it.\\n          mkdir $SSH_PATH &#x26;amp;&#x26;amp; touch $KNOWN_HOSTS_PATH\\n\\n          # Add our hosts to the `known_hosts` file.\\n          ssh-keyscan -t rsa &#x26;quot;$WPE_GIT_HOST&#x26;quot; &#x26;gt;&#x26;gt; &#x26;quot;$KNOWN_HOSTS_PATH&#x26;quot;\\n          ssh-keyscan -t rsa &#x26;quot;$WPE_SSH_HOST&#x26;quot; &#x26;gt;&#x26;gt; &#x26;quot;$KNOWN_HOSTS_PATH&#x26;quot;\\n\\n          # Write our SSH keys to the appropriate files.\\n          echo &#x26;quot;${{ secrets.SSH_PRIVATE_GIT_KEY }}&#x26;quot; &#x26;gt; &#x26;quot;$SSH_PRIVATE_GIT_KEY_PATH&#x26;quot;\\n          echo &#x26;quot;${{ secrets.SSH_PRIVATE_ACCOUNT_KEY }}&#x26;quot; &#x26;gt; &#x26;quot;$SSH_PRIVATE_ACCOUNT_KEY_PATH&#x26;quot;\\n\\n          # Set file permissions.\\n          chmod 700 &#x26;quot;$SSH_PATH&#x26;quot;\\n          chmod 644 &#x26;quot;$KNOWN_HOSTS_PATH&#x26;quot;\\n          chmod 600 &#x26;quot;$SSH_PRIVATE_GIT_KEY_PATH&#x26;quot;\\n          chmod 600 &#x26;quot;$SSH_PRIVATE_ACCOUNT_KEY_PATH&#x26;quot;\\n\\n          # Push code to WP Engine&#x26;#39;s Git host, which will deploy it to the server.\\n          git config core.sshCommand &#x26;quot;ssh -i $SSH_PRIVATE_GIT_KEY_PATH -o UserKnownHostsFile=$KNOWN_HOSTS_PATH&#x26;quot;\\n          git remote add $WPE_ENVIRONMENT git@$WPE_GIT_HOST:$WPE_ENVIRONMENT/$WPE_SITE_NAME.git\\n          git push $WPE_ENVIRONMENT HEAD:master --force\\n\\n          # Authenticate with WP Engine&#x26;#39;s server to install Composer dependencies.\\n          ssh $WPE_SITE_NAME@$WPE_SSH_HOST -i $SSH_PRIVATE_ACCOUNT_KEY_PATH -o UserKnownHostsFile=$KNOWN_HOSTS_PATH &#x26;lt;&#x26;lt; EOF\\n            # Navigate to the directory in which our site files live.\\n            cd $DEPLOYMENT_DIRECTORY\\n\\n            # Download the Composer installer &#x26;amp; execute it.\\n            curl -s https://getcomposer.org/installer | php\\n\\n            # Install production dependencies.\\n            php composer.phar install --no-dev\\n\\n            # Clean up.\\n            rm composer.phar\\n          EOF</code></pre></div>\\n<h2>You’re Not Finished Yet</h2>\\n<p>When you commit &#x26; push this workflow file to your GitHub repositroy, you should see it successfully execute everything we planned. But! You still have some work to do. In most cases, you’ll have multiple environments to configure, each of which you might want to trigger based on a different type of action (pull request, a push to a specific branch, etc.). Hopefully, this will all help you get a better grasp of how the ecosystem works, so that you feel empowered to tackle that more complicated and unique configuration yourself.</p>\\n<h2>What’s Missing?</h2>\\n<p>All of what you read here is the output of my own pain working through these challenges – basically a targeted brain dump. If any of this flow is confusing, or if I skipped a key step that led to problems when you tried it out for yourself, let me know!</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 27,
        "title": "When DOM Updates Appear to Be Asynchronous",
        "slug": "when-dom-updates-appear-to-be-asynchronous",
        "html": "<p>Imagine we have some JavaScript on a page that updates an element’s contents and immediately logs those contents out:</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>span</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>element<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  original text\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>span</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n  <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'element'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">innerHTML</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"updated text\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">.</span><span class=\"token property-access\">innerHTML</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>script</span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<p>After loading the page, you’d correctly expect that “updated text” will be displayed on the screen. And when it’s exposed via that <code>console.log()</code>, you’ll see the same value there too.</p>\n<p>The fact that <code>console.log()</code> yields this result isn’t surprising because a DOM update is a <em>synchronous</em> event. When the properties of the DOM object are modified, that change is thrown onto the call stack, and no proceeding event can execute until the stack is empty again. This is how JavaScript’s event loop does it’s thing — first in, first out — even though many of those events simply kick off asynchronous work handled by browser APIs (like <code>setTimeout()</code>, for example).</p>\n<h2>Same Thread; Different Pace</h2>\n<p>Despite it being synchronous, before a DOM change can be made visible <em>on the screen</em>, <a href=\"https://developers.google.com/web/fundamentals/performance/critical-rendering-path/render-tree-construction#tldr\" target=\"_blank\" rel=\"noopener\">several processes</a> occur: the render tree is updated, the layout of the page is reflowed, and the result is finally painted. These processes all operate on the same thread as JavaScript’s event loop, <em>but at a different pace.</em> Consider this shoddy illustration I put together:</p>\n<p><img src='/proxy/a68eaeba-1926-4e41-83db-bc2ea878bc8f' alt='' loading='lazy' /></p>\n<p>The <strong>horizontal bar</strong> represents the browser’s main thread — everything operates here, unless you’re doing something like leveraging Web Workers (and <a href=\"https://macarthur.me/posts/use-web-workers-for-your-event-listeners\">you probably should be</a>).</p>\n<p>The <strong>smaller vertical bars</strong> represent the execution of JavaScript’s event loop. It’s fast, firing as quickly as it can execute items on the call stack, often communicating with browser APIs along the way.</p>\n<p>The <strong>thicker vertical bars</strong> represent how frequently the browser repaints the screen. That rate usually <a href=\"https://developers.google.com/web/fundamentals/performance/rendering\" target=\"_blank\" rel=\"noopener\">sits at around 60 frames/second</a>, or about once every ~16. 66ms. Every time it occurs, it’ll take all the DOM changes made between the current paint and the previous paint and make them visible to the user.</p>\n<p>Most of the time, the relationship between the event loop and the repaint cycle is inconsequential to our work and virtually irrelevant to the user’s experience. But sometimes, circumstances arise when this whole DOM-to-screen process can make us wonder if modifying the DOM really is a synchronous job at all.</p>\n<h2>Make a DOM Update Look Asynchronous w/ <code>alert()</code></h2>\n<p>Let’s explore one of these circumstances. To do so, I’m using a simple local Node server with a bit of HTML. You’re welcome to follow along with the changes we’ll be making by <a href=\"https://github.com/alexmacarthur/dom-updates-and-browser-repaints\" target=\"_blank\" rel=\"noopener\">cloning the repo for yourself</a> and uncommenting each example as needed. (I considered using something like <a href=\"https://codesandbox.io/\" target=\"_blank\" rel=\"noopener\">CodeSandbox</a> for these examples, but I needed an environment as pure &#x26; predictable as possible. Platforms that serve a site through an embedded iframe couldn’t quite provide that.)</p>\n<p>This time around, instead of logging out the modified DOM value, let’s expose it with an <code>alert()</code>. When that action is thrown onto the call stack, it’ll freeze the main thread, including any outstanding repaints.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> element <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'element'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nelement<span class=\"token punctuation\">.</span><span class=\"token property-access\">innerHTML</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"updated text\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">.</span><span class=\"token property-access\">innerHTML</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>After refreshing the page this time, you’ll see the “updated text” correctly revealed in the alert box, indicating that the DOM update itself <em>really was</em> synchronous. But if you look at what’s actually rendered to the screen, it’s probably not what you’d expect:</p>\n<p><img src='/proxy/07739e6f-da0d-4329-a501-94c78f613d00' alt='' loading='lazy' /></p>\n<p>The modification to the DOM object is complete, <strong>but the respective</strong> <em><strong>repaint</strong></em> <strong>has not yet been able to occur</strong> (remember — the event loop is turning over much faster than the browser’s refresh rate). The instant that the <code>alert()</code> is dismissed, repaints are allowed to proceed, and our text is updated.</p>\n<h2>Making Things Unfold More Predictably</h2>\n<p>Again, this quirk is unlikely to trip-up any real-world work, but since we’re here anyway, let’s toy with making things behave a little more predictably. Say we wanted the <code>alert()</code> to fire <em>only after the DOM change has been rendered to the screen.</em> To do so, we have a couple of options, one of which is hackier than the other.</p>\n<h3>Option #1: Delay the <code>alert()</code>.</h3>\n<p>By wrapping our <code>alert()</code> in a <code>setTimeout()</code>, we can wait long enough for any outstanding repaints to occur, and successfully fire it after the updated text has been rendered.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> element <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'element'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nelement<span class=\"token punctuation\">.</span><span class=\"token property-access\">innerHTML</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"updated text\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">.</span><span class=\"token property-access\">innerHTML</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// &#x3C;-- arbitrary number greater than refresh rate</span>\n</code></pre></div>\n<p>This “works,” but it isn’t the most elegant solution, mainly because we’re making an educated guess as to when the repaint cycle will have turned over. We don’t want to wait too long, causing an unnecessary delay for the <code>alert()</code>. But if we cut it close and the timeout fires sooner than that delay, we’re not guaranteed to see the correct text on the screen when it’s frozen, because the browser didn’t have a chance to paint outstanding DOM changes.</p>\n<p>We can illustrate this by setting the timeout’s delay to something less than the refresh rate and reload the page a few times. Much of the time, the text will still correctly render. But sooner or later, the rendered text will <em>not</em> have updated like we want.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> element <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'element'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nelement<span class=\"token punctuation\">.</span><span class=\"token property-access\">innerHTML</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"updated text\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">.</span><span class=\"token property-access\">innerHTML</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// &#x3C;-- risky, since the delay is less than the browser's refresh rate</span>\n</code></pre></div>\n<p>Since we can’t undoubtedly predict the refresh rate of the browser (especially considering the range of things that could impact the main thread’s throughput overall), this option is pretty far under the bar of “ideal.” Thankfully, the browser offers a built-in API for navigating the repaint cycle by design, providing us with a much friendlier option.</p>\n<h3>Option #2: Fire After Next Repaint</h3>\n<p>The browser’s <code>requestAnimationFrame</code> API lets us <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame\" target=\"_blank\" rel=\"noopener\">fire a callback before the browser’s next repaint</a>, allowing us to avoid any guessing games in our objective. To use it for our purposes, it’s tempting to fire our <code>alert()</code> in one of its callbacks and call it good:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> element <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"element\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nelement<span class=\"token punctuation\">.</span><span class=\"token property-access\">innerHTML</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"updated text\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">requestAnimationFrame</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">.</span><span class=\"token property-access\">innerHTML</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p><strong>But that won’t work.</strong> Firing <em>before</em> the next repaint is pointless. Instead, we want it to happen <em>after</em>, since this is when the DOM update will have been painted to the screen. To accomplish this, we just need to nest things a bit:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> element <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'element'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nelement<span class=\"token punctuation\">.</span><span class=\"token property-access\">innerHTML</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"updated text\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">requestAnimationFrame</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">// fires before next repaint</span>\n\n\t<span class=\"token function\">requestAnimationFrame</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token comment\">// fires before the _next_ next repaint</span>\n\t\t<span class=\"token comment\">// ...which is effectively _after_ the next repaint</span>\n\n\t\t<span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">.</span><span class=\"token property-access\">innerHTML</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>With that, we’re good to go! The <code>alert()</code> will only after outstanding DOM changes have been painted to the screen. As a result, what we see in the <code>alert()</code> and what’s rendered on the page will consistently be the same:</p>\n<p><img src='/proxy/8ab2010b-e60f-4d6a-8df7-242b60254509' alt='' loading='lazy' /></p>\n<h2>The Broader Implications</h2>\n<p>Experimenting like this is fun in &#x26; of itself, but it should also impact the way you think more broadly about the relationship between the DOM and the browser’s rendering engine, especially as it all impacts the performance of your code.</p>\n<p>There’s more going than what you might think when a DOM attribute is modified, and when the black box of a browser starts to become a little more translucent, it can set you up to understand &#x26; tackle tangential problems that impact user experience more apparently, like how certain changes to the DOM trigger synchronous style &#x26; layout updates (Paul Irish has <a href=\"https://gist.github.com/paulirish/5d52fb081b3570c81e3a\" target=\"_blank\" rel=\"noopener\">a good starter resource</a> on this).</p>\n<p>But even if you don’t go down a road like that, hopefully this gets you thinking about the the inner-workings of the browser more than before, if for no other reason than to appreciate the tool a little more for all that it does.</p>\n<p><em><strong>Shoutout!</strong></em> <em>All of this was inspired by</em> <a href=\"https://twitter.com/rauschma/status/1288868746682081285?s=19\" target=\"_blank\" rel=\"noopener\"><em>a tweet</em></a> <em>from</em> <a href=\"https://dr-axel.de/\" target=\"_blank\" rel=\"noopener\"><em>Dr. Axel Rauschmayer</em></a><em>, in which he asked for a safe way to fire an</em> <em><code>alert()</code></em> <em>only after a DOM change is visible on the screen. That question and the following discussion got my gears turning to fully understand why the best solution works the way it does.</em></p>\n",
        "feature_image": "https://images.pexels.com/photos/552598/pexels-photo-552598.jpeg?cs=srgb&amp;h=1200&amp;w=1200",
        "status": "published",
        "created_at": 1601355600000,
        "published_at": 1601355600000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>Imagine we have some JavaScript on a page that updates an element’s contents and immediately logs those contents out:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>span</span> <span class=\\\"token attr-name\\\">id</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>element<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>\\n  original text\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>span</span><span class=\\\"token punctuation\\\">></span></span>\\n\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>script</span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token script\\\"><span class=\\\"token language-javascript\\\">\\n  <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getElementById</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'element'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">innerHTML</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"updated text\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span>element<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">innerHTML</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</span></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>script</span><span class=\\\"token punctuation\\\">></span></span>\\n</code></pre></div>\\n<p>After loading the page, you’d correctly expect that “updated text” will be displayed on the screen. And when it’s exposed via that <code>console.log()</code>, you’ll see the same value there too.</p>\\n<p>The fact that <code>console.log()</code> yields this result isn’t surprising because a DOM update is a <em>synchronous</em> event. When the properties of the DOM object are modified, that change is thrown onto the call stack, and no proceeding event can execute until the stack is empty again. This is how JavaScript’s event loop does it’s thing — first in, first out — even though many of those events simply kick off asynchronous work handled by browser APIs (like <code>setTimeout()</code>, for example).</p>\\n<h2>Same Thread; Different Pace</h2>\\n<p>Despite it being synchronous, before a DOM change can be made visible <em>on the screen</em>, <a href=\\\"https://developers.google.com/web/fundamentals/performance/critical-rendering-path/render-tree-construction#tldr\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">several processes</a> occur: the render tree is updated, the layout of the page is reflowed, and the result is finally painted. These processes all operate on the same thread as JavaScript’s event loop, <em>but at a different pace.</em> Consider this shoddy illustration I put together:</p>\\n<p><img src='/proxy/a68eaeba-1926-4e41-83db-bc2ea878bc8f' alt='' loading='lazy' /></p>\\n<p>The <strong>horizontal bar</strong> represents the browser’s main thread — everything operates here, unless you’re doing something like leveraging Web Workers (and <a href=\\\"https://macarthur.me/posts/use-web-workers-for-your-event-listeners\\\">you probably should be</a>).</p>\\n<p>The <strong>smaller vertical bars</strong> represent the execution of JavaScript’s event loop. It’s fast, firing as quickly as it can execute items on the call stack, often communicating with browser APIs along the way.</p>\\n<p>The <strong>thicker vertical bars</strong> represent how frequently the browser repaints the screen. That rate usually <a href=\\\"https://developers.google.com/web/fundamentals/performance/rendering\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">sits at around 60 frames/second</a>, or about once every ~16. 66ms. Every time it occurs, it’ll take all the DOM changes made between the current paint and the previous paint and make them visible to the user.</p>\\n<p>Most of the time, the relationship between the event loop and the repaint cycle is inconsequential to our work and virtually irrelevant to the user’s experience. But sometimes, circumstances arise when this whole DOM-to-screen process can make us wonder if modifying the DOM really is a synchronous job at all.</p>\\n<h2>Make a DOM Update Look Asynchronous w/ <code>alert()</code></h2>\\n<p>Let’s explore one of these circumstances. To do so, I’m using a simple local Node server with a bit of HTML. You’re welcome to follow along with the changes we’ll be making by <a href=\\\"https://github.com/alexmacarthur/dom-updates-and-browser-repaints\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">cloning the repo for yourself</a> and uncommenting each example as needed. (I considered using something like <a href=\\\"https://codesandbox.io/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">CodeSandbox</a> for these examples, but I needed an environment as pure &#x26; predictable as possible. Platforms that serve a site through an embedded iframe couldn’t quite provide that.)</p>\\n<p>This time around, instead of logging out the modified DOM value, let’s expose it with an <code>alert()</code>. When that action is thrown onto the call stack, it’ll freeze the main thread, including any outstanding repaints.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> element <span class=\\\"token operator\\\">=</span> <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getElementById</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'element'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nelement<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">innerHTML</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"updated text\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token function\\\">alert</span><span class=\\\"token punctuation\\\">(</span>element<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">innerHTML</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>After refreshing the page this time, you’ll see the “updated text” correctly revealed in the alert box, indicating that the DOM update itself <em>really was</em> synchronous. But if you look at what’s actually rendered to the screen, it’s probably not what you’d expect:</p>\\n<p><img src='/proxy/07739e6f-da0d-4329-a501-94c78f613d00' alt='' loading='lazy' /></p>\\n<p>The modification to the DOM object is complete, <strong>but the respective</strong> <em><strong>repaint</strong></em> <strong>has not yet been able to occur</strong> (remember — the event loop is turning over much faster than the browser’s refresh rate). The instant that the <code>alert()</code> is dismissed, repaints are allowed to proceed, and our text is updated.</p>\\n<h2>Making Things Unfold More Predictably</h2>\\n<p>Again, this quirk is unlikely to trip-up any real-world work, but since we’re here anyway, let’s toy with making things behave a little more predictably. Say we wanted the <code>alert()</code> to fire <em>only after the DOM change has been rendered to the screen.</em> To do so, we have a couple of options, one of which is hackier than the other.</p>\\n<h3>Option #1: Delay the <code>alert()</code>.</h3>\\n<p>By wrapping our <code>alert()</code> in a <code>setTimeout()</code>, we can wait long enough for any outstanding repaints to occur, and successfully fire it after the updated text has been rendered.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> element <span class=\\\"token operator\\\">=</span> <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getElementById</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'element'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nelement<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">innerHTML</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"updated text\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token function\\\">setTimeout</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n\\t<span class=\\\"token function\\\">alert</span><span class=\\\"token punctuation\\\">(</span>element<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">innerHTML</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">20</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span> <span class=\\\"token comment\\\">// &#x3C;-- arbitrary number greater than refresh rate</span>\\n</code></pre></div>\\n<p>This “works,” but it isn’t the most elegant solution, mainly because we’re making an educated guess as to when the repaint cycle will have turned over. We don’t want to wait too long, causing an unnecessary delay for the <code>alert()</code>. But if we cut it close and the timeout fires sooner than that delay, we’re not guaranteed to see the correct text on the screen when it’s frozen, because the browser didn’t have a chance to paint outstanding DOM changes.</p>\\n<p>We can illustrate this by setting the timeout’s delay to something less than the refresh rate and reload the page a few times. Much of the time, the text will still correctly render. But sooner or later, the rendered text will <em>not</em> have updated like we want.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> element <span class=\\\"token operator\\\">=</span> <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getElementById</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'element'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nelement<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">innerHTML</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"updated text\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token function\\\">setTimeout</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n\\t<span class=\\\"token function\\\">alert</span><span class=\\\"token punctuation\\\">(</span>element<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">innerHTML</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">5</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span> <span class=\\\"token comment\\\">// &#x3C;-- risky, since the delay is less than the browser's refresh rate</span>\\n</code></pre></div>\\n<p>Since we can’t undoubtedly predict the refresh rate of the browser (especially considering the range of things that could impact the main thread’s throughput overall), this option is pretty far under the bar of “ideal.” Thankfully, the browser offers a built-in API for navigating the repaint cycle by design, providing us with a much friendlier option.</p>\\n<h3>Option #2: Fire After Next Repaint</h3>\\n<p>The browser’s <code>requestAnimationFrame</code> API lets us <a href=\\\"https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">fire a callback before the browser’s next repaint</a>, allowing us to avoid any guessing games in our objective. To use it for our purposes, it’s tempting to fire our <code>alert()</code> in one of its callbacks and call it good:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> element <span class=\\\"token operator\\\">=</span> <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getElementById</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"element\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nelement<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">innerHTML</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"updated text\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token function\\\">requestAnimationFrame</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n\\t<span class=\\\"token function\\\">alert</span><span class=\\\"token punctuation\\\">(</span>element<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">innerHTML</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p><strong>But that won’t work.</strong> Firing <em>before</em> the next repaint is pointless. Instead, we want it to happen <em>after</em>, since this is when the DOM update will have been painted to the screen. To accomplish this, we just need to nest things a bit:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> element <span class=\\\"token operator\\\">=</span> <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getElementById</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'element'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nelement<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">innerHTML</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"updated text\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token function\\\">requestAnimationFrame</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n\\t<span class=\\\"token comment\\\">// fires before next repaint</span>\\n\\n\\t<span class=\\\"token function\\\">requestAnimationFrame</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n\\t\\t<span class=\\\"token comment\\\">// fires before the _next_ next repaint</span>\\n\\t\\t<span class=\\\"token comment\\\">// ...which is effectively _after_ the next repaint</span>\\n\\n\\t\\t<span class=\\\"token function\\\">alert</span><span class=\\\"token punctuation\\\">(</span>element<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">innerHTML</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\t<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>With that, we’re good to go! The <code>alert()</code> will only after outstanding DOM changes have been painted to the screen. As a result, what we see in the <code>alert()</code> and what’s rendered on the page will consistently be the same:</p>\\n<p><img src='/proxy/8ab2010b-e60f-4d6a-8df7-242b60254509' alt='' loading='lazy' /></p>\\n<h2>The Broader Implications</h2>\\n<p>Experimenting like this is fun in &#x26; of itself, but it should also impact the way you think more broadly about the relationship between the DOM and the browser’s rendering engine, especially as it all impacts the performance of your code.</p>\\n<p>There’s more going than what you might think when a DOM attribute is modified, and when the black box of a browser starts to become a little more translucent, it can set you up to understand &#x26; tackle tangential problems that impact user experience more apparently, like how certain changes to the DOM trigger synchronous style &#x26; layout updates (Paul Irish has <a href=\\\"https://gist.github.com/paulirish/5d52fb081b3570c81e3a\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">a good starter resource</a> on this).</p>\\n<p>But even if you don’t go down a road like that, hopefully this gets you thinking about the the inner-workings of the browser more than before, if for no other reason than to appreciate the tool a little more for all that it does.</p>\\n<p><em><strong>Shoutout!</strong></em> <em>All of this was inspired by</em> <a href=\\\"https://twitter.com/rauschma/status/1288868746682081285?s=19\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\"><em>a tweet</em></a> <em>from</em> <a href=\\\"https://dr-axel.de/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\"><em>Dr. Axel Rauschmayer</em></a><em>, in which he asked for a safe way to fire an</em> <em><code>alert()</code></em> <em>only after a DOM change is visible on the screen. That question and the following discussion got my gears turning to fully understand why the best solution works the way it does.</em></p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 28,
        "title": "Why I Like Tailwind CSS",
        "slug": "why-i-like-tailwind-css",
        "html": "<p>I’ve used <a href=\"https://tailwindcss.com/\" target=\"_blank\" rel=\"noopener\">Tailwind CSS</a> for a few projects over the last several months, and it’s been steadily growing on me – to the point of it becoming <strong>my go-to tool for styling new projects</strong>.</p>\n<p>At the same time, I’m seeing a lot of people ask what all the hype is about, often in an effort to determine if it’s right for them too. I’ve responded to those questions a couple of times now, and thought it’d be handy to have a quick reference as to why I’ve come to like it myself, as well as the challenges I’ve experienced along the way. All of this is based on my own experience from recent memory, so it’s likely to change to some degree as time goes on. Still, hopefully it helps someone else grasp if it’s something they should try out themselves.</p>\n<h2>Things I Really Like</h2>\n<p><strong>1. I can prototype</strong> <em><strong>much</strong></em> <strong>more quickly.</strong></p>\n<p>Other styling approaches I’ve used require me to jump between multiple different files just to stand up a page with some basic asthetics. At minimum, that’d mean an HTML file and a stylesheet. And whenever I was in a highly-componentized BEM project (like I most often was), that could mean a <em>lot</em> of files open at once – the file containing the HTML and then one SCSS file for each UI component I was writing.</p>\n<p>With Tailwind, however, all I really need to pay attention to is the HTML. Fewer VS Code tabs for my brain to manage means I can prototype more easily and quickly.</p>\n<p><strong>2. Built-in PurgeCSS means I only ship the styles I actually use.</strong></p>\n<p>When working with other utility-based CSS frameworks, it’s a pain to ensure you don’t ship any of the CSS you don’t actually use. Depending on the framework, your options are to manually import the things you actually use, give up altogether, or try your hand at configuring a tool like <a href=\"https://purgecss.com/\" target=\"_blank\" rel=\"noopener\">PurgeCSS</a> to remove unused classes on compilation. As of v1.4, <a href=\"https://tailwindcss.com/docs/release-notes/#tailwind-css-v1-4\" target=\"_blank\" rel=\"noopener\">Tailwind has PurgeCSS built in</a>, with a lot of the hassle abstracted away, so I can focus on styling without worrying so much about CSS bloat.</p>\n<p><strong>3. I can throw away HTML without orphaning accompanying CSS.</strong></p>\n<p>Especially when I’m prototyping something, it’s common for me to spontaneously throw out HTML I thought I’d need but don’t. When my styles and makeup are maintained separately, a second step is required to remove that unnecessary CSS. I often forget to do that, forever leaving it orphaned. The markup-driven styling provided by Tailwind means all I have to throw away is the HTML itself. Nothing else (unless I have some custom components I’ve composed somewhere, but that’s rare).</p>\n<p><strong>4. I don’t need to name so many things.</strong></p>\n<p>It takes time, it’s hard, and I suck at it. When using Tailwind, the only time I need to dream up a class name is when I’m composing my own components, which isn’t often at all. For the most part, I can spend my time bringing my UI to life, rather than wasting it second-guessing what I chose to name something.</p>\n<p><strong>5. Consistent design token values (font sizes, colors, spacing, etc.) are set up for me.</strong></p>\n<p>When starting with more of a bare-bones, roll-my-own styling approach, it’s a chore to determine what my base font sizes, colors, spacing values, and everything else should be. Tailwind offers consistent sets of these values out-of-the-box, while also enabling me to <a href=\"https://tailwindcss.com/docs/margin/#customizing\" target=\"_blank\" rel=\"noopener\">customize them</a> as needed.</p>\n<p><strong>6. It’s easy to incrementally adopt in a project.</strong></p>\n<p>If you want to leverage just <em>some</em> of the utilities provided by Tailwind, or want to migrate to it more slowly, it’s relatively easy to do so without overcommitting yourself or putting the entire project through a refactor. After setting it up (the most common way to do so is probably <a href=\"https://tailwindcss.com/docs/installation#using-tailwind-with-postcss\" target=\"_blank\" rel=\"noopener\">as a PostCSS plugin</a>), you can either <a href=\"https://tailwindcss.com/docs/configuration/\" target=\"_blank\" rel=\"noopener\">manually configure Tailwind</a> to include only what you need, or rely on the aforementioned PurgeCSS integration to remove the styles you don’t use. I appreciate that flexibility.</p>\n<p><strong>7. The documentation is incredible.</strong></p>\n<p>In particular, the search functionality in the Tailwind documentation is nearly psychic (and the “press ‘/’ to focus” feature is a huge nice-to-have). If I’m looking for some utility, my first search attempt nearly always returns what I need without requiring me to try again with different terms. It’s just good. Moreover, it’s fast, thorough, and filled with helpful examples.</p>\n<h3>Some Challenges I’ve Seen</h3>\n<p>My admiration for this tool is strong, but it’d be unfair to leave out the challenges I’ve had working with it.</p>\n<p><strong>1. The learning curve can be steep.</strong></p>\n<p>At first, it sort of felt like I was relearning CSS itself, and that was frustrating. There’s a utility for virtually everything (it seems like), and trying to get my brain to map real CSS attributes to those utilities just took some time (I’m still working on it). This is where that documentation really shines, because if it weren’t for that, I’d have given up early on.</p>\n<p><strong>2. HTML can quickly become ugly &#x26; convoluted.</strong></p>\n<p>Much of this is probably just preferential, or perhaps due to the fact that it goes against what I’ve become accustomed to while working with BEM for so long. But at the same time, when working with something like JSX in React or any other templating language infused with a moderate amount of logic, it can get rough to parse everything going on in a component with utility classes sprinkled everywhere.</p>\n<p>I experienced some of this pain when building <a href=\"https://typeitjs.com/\" target=\"_blank\" rel=\"noopener\">TypeIt’s site</a> with Tailwind + <a href=\"https://gatsbyjs.org/\" target=\"_blank\" rel=\"noopener\">Gatsby</a>. In order to fine-tune the styling I wanted, I had to do stuff like this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token operator\">&#x3C;</span>div\n  className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\"></span>\n<span class=\"token string\">            lg:flex</span>\n<span class=\"token string\">            justify-center</span>\n<span class=\"token string\">            fixed</span>\n<span class=\"token string\">            lg:relative</span>\n<span class=\"token string\">            top-0</span>\n<span class=\"token string\">            left-0</span>\n<span class=\"token string\">            h-full</span>\n<span class=\"token string\">            w-full</span>\n<span class=\"token string\">            bg-white</span>\n<span class=\"token string\">            translate-left</span>\n<span class=\"token string\">            lg:translate-none</span>\n<span class=\"token string\">            overflow-scroll</span>\n<span class=\"token string\">            lg:overflow-visible</span>\n<span class=\"token string\">            pt-8</span>\n<span class=\"token string\">            md:p-0</span>\n<span class=\"token string\">            </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>menuIsOpen <span class=\"token operator\">?</span> <span class=\"token string\">\"translate-none\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"></span>\n<span class=\"token string\">          </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">}</span>\n<span class=\"token operator\">></span>\n  <span class=\"token operator\">&#x3C;</span>ul className<span class=\"token operator\">=</span><span class=\"token string\">\"self-start mx-auto lg:-mx-3 lg:mt-0 block lg:flex mb-8 lg:mb-0\"</span><span class=\"token operator\">></span>\n    <span class=\"token punctuation\">{</span>links<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">link</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">(</span>\n        <span class=\"token operator\">&#x3C;</span>li\n          key<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>link<span class=\"token punctuation\">.</span><span class=\"token property-access\">path</span><span class=\"token punctuation\">}</span>\n          ref<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>navItemRef<span class=\"token punctuation\">}</span>\n          className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">siteNavListItem flex px-5 flex-col lg:flex-row items-center font-light justify-center mb-5 lg:mb-0 relative</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">}</span>\n        <span class=\"token operator\">></span>\n          <span class=\"token punctuation\">{</span><span class=\"token comment\">/* link content... */</span><span class=\"token punctuation\">}</span>\n        <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>li<span class=\"token operator\">></span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n  <span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>ul<span class=\"token operator\">></span>\n<span class=\"token operator\">&#x3C;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n</code></pre></div>\n<p>With so many utility classes in play, it was just <em>hard</em> to figure out the best way to format everything while keeping the entire file relatively legible.</p>\n<p>Admittedly, there are some tricks to help mitigate this, mainly relying on strategies Tailwind recommends to <a href=\"https://tailwindcss.com/docs/extracting-components/\" target=\"_blank\" rel=\"noopener\">componentize parts of your UI</a>, such as:</p>\n<ul>\n<li>using Tailwind’s <code>@apply</code> directive to create single classes composed of utilities.</li>\n<li>writing templates or JS components that accept the data you’d like to display.</li>\n</ul>\n<p>But these all feel like more work I just don’t want to do. All that said, “messy” HTML, at some level, may just be a necessary trade-off of using a styling approach like Tailwind does, much like any other approach has trade-offs of its own.</p>\n<h3>Why Do You Like It?</h3>\n<p>Despite the couple of challenges I’ve seen, Tailwind has allowed me to style UI components in a more productive fashion, and I’ll likely keep it around as my go-to tool for doing such things. Even so, that might not be the case for everyone. So, I’m curious to hear what you like about Tailwind, as well as the challenges you’ve encountered. Are there things you like or hate that I don’t mention here, or are even offshoots of any of them? Bring ’em up!</p>\n",
        "feature_image": "https://images.pexels.com/photos/162553/keys-workshop-mechanic-tools-162553.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;h=1200&amp;w=1200",
        "status": "published",
        "created_at": 1596690000000,
        "published_at": 1596690000000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "meta_description": "And a Couple of Challenges I've Seen Too",
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>I’ve used <a href=\\\"https://tailwindcss.com/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Tailwind CSS</a> for a few projects over the last several months, and it’s been steadily growing on me – to the point of it becoming <strong>my go-to tool for styling new projects</strong>.</p>\\n<p>At the same time, I’m seeing a lot of people ask what all the hype is about, often in an effort to determine if it’s right for them too. I’ve responded to those questions a couple of times now, and thought it’d be handy to have a quick reference as to why I’ve come to like it myself, as well as the challenges I’ve experienced along the way. All of this is based on my own experience from recent memory, so it’s likely to change to some degree as time goes on. Still, hopefully it helps someone else grasp if it’s something they should try out themselves.</p>\\n<h2>Things I Really Like</h2>\\n<p><strong>1. I can prototype</strong> <em><strong>much</strong></em> <strong>more quickly.</strong></p>\\n<p>Other styling approaches I’ve used require me to jump between multiple different files just to stand up a page with some basic asthetics. At minimum, that’d mean an HTML file and a stylesheet. And whenever I was in a highly-componentized BEM project (like I most often was), that could mean a <em>lot</em> of files open at once – the file containing the HTML and then one SCSS file for each UI component I was writing.</p>\\n<p>With Tailwind, however, all I really need to pay attention to is the HTML. Fewer VS Code tabs for my brain to manage means I can prototype more easily and quickly.</p>\\n<p><strong>2. Built-in PurgeCSS means I only ship the styles I actually use.</strong></p>\\n<p>When working with other utility-based CSS frameworks, it’s a pain to ensure you don’t ship any of the CSS you don’t actually use. Depending on the framework, your options are to manually import the things you actually use, give up altogether, or try your hand at configuring a tool like <a href=\\\"https://purgecss.com/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">PurgeCSS</a> to remove unused classes on compilation. As of v1.4, <a href=\\\"https://tailwindcss.com/docs/release-notes/#tailwind-css-v1-4\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Tailwind has PurgeCSS built in</a>, with a lot of the hassle abstracted away, so I can focus on styling without worrying so much about CSS bloat.</p>\\n<p><strong>3. I can throw away HTML without orphaning accompanying CSS.</strong></p>\\n<p>Especially when I’m prototyping something, it’s common for me to spontaneously throw out HTML I thought I’d need but don’t. When my styles and makeup are maintained separately, a second step is required to remove that unnecessary CSS. I often forget to do that, forever leaving it orphaned. The markup-driven styling provided by Tailwind means all I have to throw away is the HTML itself. Nothing else (unless I have some custom components I’ve composed somewhere, but that’s rare).</p>\\n<p><strong>4. I don’t need to name so many things.</strong></p>\\n<p>It takes time, it’s hard, and I suck at it. When using Tailwind, the only time I need to dream up a class name is when I’m composing my own components, which isn’t often at all. For the most part, I can spend my time bringing my UI to life, rather than wasting it second-guessing what I chose to name something.</p>\\n<p><strong>5. Consistent design token values (font sizes, colors, spacing, etc.) are set up for me.</strong></p>\\n<p>When starting with more of a bare-bones, roll-my-own styling approach, it’s a chore to determine what my base font sizes, colors, spacing values, and everything else should be. Tailwind offers consistent sets of these values out-of-the-box, while also enabling me to <a href=\\\"https://tailwindcss.com/docs/margin/#customizing\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">customize them</a> as needed.</p>\\n<p><strong>6. It’s easy to incrementally adopt in a project.</strong></p>\\n<p>If you want to leverage just <em>some</em> of the utilities provided by Tailwind, or want to migrate to it more slowly, it’s relatively easy to do so without overcommitting yourself or putting the entire project through a refactor. After setting it up (the most common way to do so is probably <a href=\\\"https://tailwindcss.com/docs/installation#using-tailwind-with-postcss\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">as a PostCSS plugin</a>), you can either <a href=\\\"https://tailwindcss.com/docs/configuration/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">manually configure Tailwind</a> to include only what you need, or rely on the aforementioned PurgeCSS integration to remove the styles you don’t use. I appreciate that flexibility.</p>\\n<p><strong>7. The documentation is incredible.</strong></p>\\n<p>In particular, the search functionality in the Tailwind documentation is nearly psychic (and the “press ‘/’ to focus” feature is a huge nice-to-have). If I’m looking for some utility, my first search attempt nearly always returns what I need without requiring me to try again with different terms. It’s just good. Moreover, it’s fast, thorough, and filled with helpful examples.</p>\\n<h3>Some Challenges I’ve Seen</h3>\\n<p>My admiration for this tool is strong, but it’d be unfair to leave out the challenges I’ve had working with it.</p>\\n<p><strong>1. The learning curve can be steep.</strong></p>\\n<p>At first, it sort of felt like I was relearning CSS itself, and that was frustrating. There’s a utility for virtually everything (it seems like), and trying to get my brain to map real CSS attributes to those utilities just took some time (I’m still working on it). This is where that documentation really shines, because if it weren’t for that, I’d have given up early on.</p>\\n<p><strong>2. HTML can quickly become ugly &#x26; convoluted.</strong></p>\\n<p>Much of this is probably just preferential, or perhaps due to the fact that it goes against what I’ve become accustomed to while working with BEM for so long. But at the same time, when working with something like JSX in React or any other templating language infused with a moderate amount of logic, it can get rough to parse everything going on in a component with utility classes sprinkled everywhere.</p>\\n<p>I experienced some of this pain when building <a href=\\\"https://typeitjs.com/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">TypeIt’s site</a> with Tailwind + <a href=\\\"https://gatsbyjs.org/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Gatsby</a>. In order to fine-tune the styling I wanted, I had to do stuff like this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token operator\\\">&#x3C;</span>div\\n  className<span class=\\\"token operator\\\">=</span><span class=\\\"token punctuation\\\">{</span><span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\"></span>\\n<span class=\\\"token string\\\">            lg:flex</span>\\n<span class=\\\"token string\\\">            justify-center</span>\\n<span class=\\\"token string\\\">            fixed</span>\\n<span class=\\\"token string\\\">            lg:relative</span>\\n<span class=\\\"token string\\\">            top-0</span>\\n<span class=\\\"token string\\\">            left-0</span>\\n<span class=\\\"token string\\\">            h-full</span>\\n<span class=\\\"token string\\\">            w-full</span>\\n<span class=\\\"token string\\\">            bg-white</span>\\n<span class=\\\"token string\\\">            translate-left</span>\\n<span class=\\\"token string\\\">            lg:translate-none</span>\\n<span class=\\\"token string\\\">            overflow-scroll</span>\\n<span class=\\\"token string\\\">            lg:overflow-visible</span>\\n<span class=\\\"token string\\\">            pt-8</span>\\n<span class=\\\"token string\\\">            md:p-0</span>\\n<span class=\\\"token string\\\">            </span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>menuIsOpen <span class=\\\"token operator\\\">?</span> <span class=\\\"token string\\\">\\\"translate-none\\\"</span> <span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"\\\"</span><span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\"></span>\\n<span class=\\\"token string\\\">          </span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token operator\\\">></span>\\n  <span class=\\\"token operator\\\">&#x3C;</span>ul className<span class=\\\"token operator\\\">=</span><span class=\\\"token string\\\">\\\"self-start mx-auto lg:-mx-3 lg:mt-0 block lg:flex mb-8 lg:mb-0\\\"</span><span class=\\\"token operator\\\">></span>\\n    <span class=\\\"token punctuation\\\">{</span>links<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">map</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">link</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token punctuation\\\">(</span>\\n        <span class=\\\"token operator\\\">&#x3C;</span>li\\n          key<span class=\\\"token operator\\\">=</span><span class=\\\"token punctuation\\\">{</span>link<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">path</span><span class=\\\"token punctuation\\\">}</span>\\n          ref<span class=\\\"token operator\\\">=</span><span class=\\\"token punctuation\\\">{</span>navItemRef<span class=\\\"token punctuation\\\">}</span>\\n          className<span class=\\\"token operator\\\">=</span><span class=\\\"token punctuation\\\">{</span><span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">siteNavListItem flex px-5 flex-col lg:flex-row items-center font-light justify-center mb-5 lg:mb-0 relative</span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">}</span>\\n        <span class=\\\"token operator\\\">></span>\\n          <span class=\\\"token punctuation\\\">{</span><span class=\\\"token comment\\\">/* link content... */</span><span class=\\\"token punctuation\\\">}</span>\\n        <span class=\\\"token operator\\\">&#x3C;</span><span class=\\\"token operator\\\">/</span>li<span class=\\\"token operator\\\">></span>\\n      <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token operator\\\">&#x3C;</span><span class=\\\"token operator\\\">/</span>ul<span class=\\\"token operator\\\">></span>\\n<span class=\\\"token operator\\\">&#x3C;</span><span class=\\\"token operator\\\">/</span>div<span class=\\\"token operator\\\">></span>\\n</code></pre></div>\\n<p>With so many utility classes in play, it was just <em>hard</em> to figure out the best way to format everything while keeping the entire file relatively legible.</p>\\n<p>Admittedly, there are some tricks to help mitigate this, mainly relying on strategies Tailwind recommends to <a href=\\\"https://tailwindcss.com/docs/extracting-components/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">componentize parts of your UI</a>, such as:</p>\\n<ul>\\n<li>using Tailwind’s <code>@apply</code> directive to create single classes composed of utilities.</li>\\n<li>writing templates or JS components that accept the data you’d like to display.</li>\\n</ul>\\n<p>But these all feel like more work I just don’t want to do. All that said, “messy” HTML, at some level, may just be a necessary trade-off of using a styling approach like Tailwind does, much like any other approach has trade-offs of its own.</p>\\n<h3>Why Do You Like It?</h3>\\n<p>Despite the couple of challenges I’ve seen, Tailwind has allowed me to style UI components in a more productive fashion, and I’ll likely keep it around as my go-to tool for doing such things. Even so, that might not be the case for everyone. So, I’m curious to hear what you like about Tailwind, as well as the challenges you’ve encountered. Are there things you like or hate that I don’t mention here, or are even offshoots of any of them? Bring ’em up!</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 29,
        "title": "Don't Feel Bad About Using XMLHttpRequest",
        "slug": "dont-feel-bad-about-using-xmlhttprequest",
        "html": "<p>A while back, I began contributing to a small JavaScript library responsible for sending a POST request with some data to an endpoint. At the time, it used <a href=\"https://github.com/axios/axios\" target=\"_blank\" rel=\"noopener\">axios</a> to make that request, and I wanted to simplify things by shedding a dependency. The obvious alternative was <code>fetch</code> – modern, native, and ergonomic.</p>\n<p>But in this very particular case, the following bits of context made me wonder if this obvious choice was the <em>best</em> choice. The package…</p>\n<ol>\n<li>would be distributed amongst several teams</li>\n<li>had a simple, single responsibility, with little need to do anything after that responsibility had been fulfilled (so, a Promised-based API wasn’t a must-have)</li>\n<li>would need to work for users on IE11 (for <em>most</em> teams – some had dropped that requirement)</li>\n</ol>\n<h2>Where Fetch Held Me Up</h2>\n<p>The <code>fetch</code> API is a welcomed upgrade to making HTTP requests in JavaScript, but in order to leverage it here, teams would need to rely on two different polyfills: the <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise\" target=\"_blank\" rel=\"noopener\">Promise</a> object, and the <code>fetch</code> API itself. And that would mean putting at least a little more burden on the teams who implement it, as well as the users who interact with it:</p>\n<ul>\n<li>It’d require teams supporting IE to set up additional dependencies, which would involve vetting which polyfills to use (there are several for any given API), ensuring none are already being loaded by the application, and potentially working through unforseen issues.</li>\n<li>Unless some sort of <a href=\"https://macarthur.me/posts/should-we-implement-differential-serving\">differential serving</a> is set up, it’d require most users to download polyfills they don’t actually need (<a href=\"https://caniuse.com/#feat=fetch\" target=\"_blank\" rel=\"noopener\">~94%+ are on browsers</a> that support <code>fetch</code>).</li>\n</ul>\n<p>For my simple needs, this just felt like too much, especially considering the strong culture of performance that exists throughout the organization as a whole.</p>\n<h2>Making Prehistoric HTTP Requests</h2>\n<p>So, I thought back to what our ancestors used to do such things: <code>XMLHttpRequest</code>. The O.G. of HTTP requests in JavaScript. I’ve heard rumors of this thing. The verbosity. The insanity it’s left in its wake.</p>\n<p>Despite that reputation, I gave it a shot wiring it up. And as it turned out, <strong>for simple requests, most of those rumors were overblown.</strong> After the switch, my implementation went from something like this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword control-flow\">try</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> response <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> axios<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">post</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"http://localhost:4000\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Alex\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string-property property\">\"x-api-key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"my-api-key\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span><span class=\"token property-access\">data</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Request failed!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>To something more like this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> xhr <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">XMLHttpRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nxhr<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"POST\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"http://localhost:4000\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nxhr<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setRequestHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Content-Type\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"application/json\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nxhr<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setRequestHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x-api-key\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"my-api-key\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nxhr<span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">onload</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">status</span> <span class=\"token operator\">>=</span> <span class=\"token number\">200</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">status</span> <span class=\"token operator\">&#x3C;</span> <span class=\"token number\">400</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">parse</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">responseText</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword control-flow\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Something went wrong!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nxhr<span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">onerror</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Something went wrong!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nxhr<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">send</span><span class=\"token punctuation\">(</span><span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Alex\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>That’s a very similar amount of code for virtually the same functionality. <strong>And no polyfills.</strong></p>\n<h2>Why XMLHttpRequest Made Sense</h2>\n<p>Given all that aforementioned context, a few notable perks surfaced as a result of switching to <code>XMLHttpRequest</code>.</p>\n<h3>1. Less code shipped.</h3>\n<p>Being so old-school in terms of making HTTP requests, <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest#Browser_compatibility\" target=\"_blank\" rel=\"noopener\">browser support</a> isn’t even remotely a concern. By using it, teams can avoid loading those polyfills still required to use <code>fetch</code> in IE, saving about ~4kb of bundled code (assuming teams would’ve used these two pretty good polyfills I came across):</p>\n<table>\n<thead>\n<tr>\n<th>Polyfill</th>\n<th>Size (minified)</th>\n<th>Size (minified + gzipped)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><a href=\"https://bundlephobia.com/result?p=promise-polyfill@8.1.3\" target=\"_blank\" rel=\"noopener\"><code>promise-polyfill</code></a></td>\n<td>2.9kb</td>\n<td>1.1kb</td>\n</tr>\n<tr>\n<td><a href=\"https://bundlephobia.com/result?p=unfetch@4.1.0\" target=\"_blank\" rel=\"noopener\"><code>unfetch</code></a></td>\n<td>1kb</td>\n<td>554b</td>\n</tr>\n</tbody>\n</table>\n<p>Those savings aren’t monumental, but they shouldn’t be scoffed at either, especially considering the low amount of effort on my part, and the fact that those savings will be multipled throughout several different projects.</p>\n<h3>2. Simpler distribution.</h3>\n<p>Being polyfill-free, I don’t need to worry about asking other teams to deal with extra dependencies at all. No vetting process, no added documentation. Just grab the library &#x26; go. This also means we’ll be avoiding the consequences that arise when teams inevitably fail to read that added documentation.</p>\n<h3>3. Less risky implementation.</h3>\n<p>When pulling in the package, teams don’t need to deal with the array of potential issues that come up from introducing global dependencies, such as double-loading polyfills that are already being pulled in, or subtle differences in how a polyfill behaves relative to the actual specification. Any risk in implementing the library is limited to the package code itself. In general, the JavaScript polyfill landscape is the <a href=\"https://twitter.com/BenLesh/status/1283491594327515140\" target=\"_blank\" rel=\"noopener\">wild west</a>, with no guarantees that packages will meet the full specification of an API (in fact, many don’t intend to). Being able to sidestep the unavoidable risks in dealing with them is huge.</p>\n<h2>Some Common Objections</h2>\n<p>Despite these good things, there are a few objections I’ve seen come up a few times:</p>\n<h3>1. We should lean into writing modern JavaScript!</h3>\n<p>Agreed, but not if that means doing so <em>for the sake of</em> writing modern JavaScript. If “modern” code introduces complexity and costs that could be avoided without a significant amount of effort, there’s no shame in going old-school. There’s a balance that needs to be found with every project, and more often than not, the “new” might have the best case (in fact, most of the time, I’d just go with <code>fetch</code>). But more classic solutions shouldn’t be immediately dismissed <em>exclusively</em> because there’s a flashier option out there. “It’s 2020, use <code>fetch</code> already!” is a weak argument to me.</p>\n<h3>2. Isn’t XMLHttpRequest deprecated?</h3>\n<p>No. A <em>part</em> of it (<a href=\"https://xhr.spec.whatwg.org/#synchronous-flag\" target=\"_blank\" rel=\"noopener\">the ability to make synchronous HTTP requests</a>) is in the process of being removed from the platform due to the horrid performance issues that come along with it. But the core API itself isn’t going anywhere, and still offers advantages over <code>fetch</code>, like <a href=\"https://xhr.spec.whatwg.org/#interface-progressevent\" target=\"_blank\" rel=\"noopener\">being able to track progress</a> on file uploads.</p>\n<p>By using <code>XMLHttpRequest</code>, you’re not just piling on tech debt you’ll need to clean up a couple years from now. In fact, choosing it might actually set you up for <em>less</em> work in the future, since you’d otherwise be removing polyfills when they’re no longer needed (assuming you currently need to support IE).</p>\n<h3>3. That API is disgusting!</h3>\n<p>Yeah, it is. That’s why I’m placing decent emphasis on it being best for <em>simple</em> requests. The instant the scope of a package goes beyond that, or as soon as you drop IE as a supported browser, <code>fetch</code>(or something else) might be a better way to go. Until then, at the very least, play with it for a while instead of dismissing it based off water cooler dev chatter. You’ll likely discover (like I did) that it’s not nearly as bad as people make it out to be.</p>\n<h3>4. I like my Promise-based API!</h3>\n<p>Me too! But thankfully, it’s easy enough to wrap an <code>XMLHttpRequest</code> implementation in a Promise to retain that interface. You’ll get those ergonomics, and you’ll still have to deal with one less polyfill than if you had gone with something like <code>fetch</code>.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fire</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> xhr <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">XMLHttpRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  xhr<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"POST\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"http://localhost:4000\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  xhr<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setRequestHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Content-Type\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"application/json\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  xhr<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setRequestHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x-api-key\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"my-api-key\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    xhr<span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">onload</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">status</span> <span class=\"token operator\">>=</span> <span class=\"token number\">200</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">status</span> <span class=\"token operator\">&#x3C;</span> <span class=\"token number\">400</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">parse</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">responseText</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Something went wrong!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    xhr<span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">onerror</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Something went wrong!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    xhr<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">send</span><span class=\"token punctuation\">(</span><span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Alex\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword control-flow\">await</span> <span class=\"token function\">fire</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span><span class=\"token property-access\">message</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h2>Sometimes, New <em>Might</em> Not Be Best</h2>\n<p>It’s easy to get excited about advancements to web APIs like <code>fetch</code>, and they’re very often the best tool for the job. But if we’re not careful, it’s just as easy to become dogmatic about using newer technologies exclusively because they’re new. As you wade these waters, try to keep the full scope of your circumstances in mind – the users, the needs, the environment, everything. You may find out that the best tool for the job is the one that’s been around since your grandma was making HTTP requests.</p>\n",
        "feature_image": "",
        "status": "published",
        "created_at": 1594789200000,
        "published_at": 1594789200000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>A while back, I began contributing to a small JavaScript library responsible for sending a POST request with some data to an endpoint. At the time, it used <a href=\\\"https://github.com/axios/axios\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">axios</a> to make that request, and I wanted to simplify things by shedding a dependency. The obvious alternative was <code>fetch</code> – modern, native, and ergonomic.</p>\\n<p>But in this very particular case, the following bits of context made me wonder if this obvious choice was the <em>best</em> choice. The package…</p>\\n<ol>\\n<li>would be distributed amongst several teams</li>\\n<li>had a simple, single responsibility, with little need to do anything after that responsibility had been fulfilled (so, a Promised-based API wasn’t a must-have)</li>\\n<li>would need to work for users on IE11 (for <em>most</em> teams – some had dropped that requirement)</li>\\n</ol>\\n<h2>Where Fetch Held Me Up</h2>\\n<p>The <code>fetch</code> API is a welcomed upgrade to making HTTP requests in JavaScript, but in order to leverage it here, teams would need to rely on two different polyfills: the <a href=\\\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Promise</a> object, and the <code>fetch</code> API itself. And that would mean putting at least a little more burden on the teams who implement it, as well as the users who interact with it:</p>\\n<ul>\\n<li>It’d require teams supporting IE to set up additional dependencies, which would involve vetting which polyfills to use (there are several for any given API), ensuring none are already being loaded by the application, and potentially working through unforseen issues.</li>\\n<li>Unless some sort of <a href=\\\"https://macarthur.me/posts/should-we-implement-differential-serving\\\">differential serving</a> is set up, it’d require most users to download polyfills they don’t actually need (<a href=\\\"https://caniuse.com/#feat=fetch\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">~94%+ are on browsers</a> that support <code>fetch</code>).</li>\\n</ul>\\n<p>For my simple needs, this just felt like too much, especially considering the strong culture of performance that exists throughout the organization as a whole.</p>\\n<h2>Making Prehistoric HTTP Requests</h2>\\n<p>So, I thought back to what our ancestors used to do such things: <code>XMLHttpRequest</code>. The O.G. of HTTP requests in JavaScript. I’ve heard rumors of this thing. The verbosity. The insanity it’s left in its wake.</p>\\n<p>Despite that reputation, I gave it a shot wiring it up. And as it turned out, <strong>for simple requests, most of those rumors were overblown.</strong> After the switch, my implementation went from something like this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword control-flow\\\">try</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">let</span> response <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword control-flow\\\">await</span> axios<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">post</span><span class=\\\"token punctuation\\\">(</span>\\n    <span class=\\\"token string\\\">\\\"http://localhost:4000\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token literal-property property\\\">name</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"Alex\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token literal-property property\\\">headers</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token string-property property\\\">\\\"x-api-key\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"my-api-key\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span>response<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">data</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword control-flow\\\">catch</span> <span class=\\\"token punctuation\\\">(</span>e<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"Request failed!\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p>To something more like this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> xhr <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">XMLHttpRequest</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nxhr<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">open</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"POST\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">\\\"http://localhost:4000\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nxhr<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">setRequestHeader</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"Content-Type\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">\\\"application/json\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nxhr<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">setRequestHeader</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"x-api-key\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">\\\"my-api-key\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\nxhr<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method-variable function-variable method function property-access\\\">onload</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">status</span> <span class=\\\"token operator\\\">>=</span> <span class=\\\"token number\\\">200</span> <span class=\\\"token operator\\\">&#x26;&#x26;</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">status</span> <span class=\\\"token operator\\\">&#x3C;</span> <span class=\\\"token number\\\">400</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token known-class-name class-name\\\">JSON</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">parse</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">responseText</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword control-flow\\\">return</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"Something went wrong!\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\nxhr<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method-variable function-variable method function property-access\\\">onerror</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"Something went wrong!\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\nxhr<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">send</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token known-class-name class-name\\\">JSON</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">stringify</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span> <span class=\\\"token literal-property property\\\">name</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"Alex\\\"</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>That’s a very similar amount of code for virtually the same functionality. <strong>And no polyfills.</strong></p>\\n<h2>Why XMLHttpRequest Made Sense</h2>\\n<p>Given all that aforementioned context, a few notable perks surfaced as a result of switching to <code>XMLHttpRequest</code>.</p>\\n<h3>1. Less code shipped.</h3>\\n<p>Being so old-school in terms of making HTTP requests, <a href=\\\"https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest#Browser_compatibility\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">browser support</a> isn’t even remotely a concern. By using it, teams can avoid loading those polyfills still required to use <code>fetch</code> in IE, saving about ~4kb of bundled code (assuming teams would’ve used these two pretty good polyfills I came across):</p>\\n<table>\\n<thead>\\n<tr>\\n<th>Polyfill</th>\\n<th>Size (minified)</th>\\n<th>Size (minified + gzipped)</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td><a href=\\\"https://bundlephobia.com/result?p=promise-polyfill@8.1.3\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\"><code>promise-polyfill</code></a></td>\\n<td>2.9kb</td>\\n<td>1.1kb</td>\\n</tr>\\n<tr>\\n<td><a href=\\\"https://bundlephobia.com/result?p=unfetch@4.1.0\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\"><code>unfetch</code></a></td>\\n<td>1kb</td>\\n<td>554b</td>\\n</tr>\\n</tbody>\\n</table>\\n<p>Those savings aren’t monumental, but they shouldn’t be scoffed at either, especially considering the low amount of effort on my part, and the fact that those savings will be multipled throughout several different projects.</p>\\n<h3>2. Simpler distribution.</h3>\\n<p>Being polyfill-free, I don’t need to worry about asking other teams to deal with extra dependencies at all. No vetting process, no added documentation. Just grab the library &#x26; go. This also means we’ll be avoiding the consequences that arise when teams inevitably fail to read that added documentation.</p>\\n<h3>3. Less risky implementation.</h3>\\n<p>When pulling in the package, teams don’t need to deal with the array of potential issues that come up from introducing global dependencies, such as double-loading polyfills that are already being pulled in, or subtle differences in how a polyfill behaves relative to the actual specification. Any risk in implementing the library is limited to the package code itself. In general, the JavaScript polyfill landscape is the <a href=\\\"https://twitter.com/BenLesh/status/1283491594327515140\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">wild west</a>, with no guarantees that packages will meet the full specification of an API (in fact, many don’t intend to). Being able to sidestep the unavoidable risks in dealing with them is huge.</p>\\n<h2>Some Common Objections</h2>\\n<p>Despite these good things, there are a few objections I’ve seen come up a few times:</p>\\n<h3>1. We should lean into writing modern JavaScript!</h3>\\n<p>Agreed, but not if that means doing so <em>for the sake of</em> writing modern JavaScript. If “modern” code introduces complexity and costs that could be avoided without a significant amount of effort, there’s no shame in going old-school. There’s a balance that needs to be found with every project, and more often than not, the “new” might have the best case (in fact, most of the time, I’d just go with <code>fetch</code>). But more classic solutions shouldn’t be immediately dismissed <em>exclusively</em> because there’s a flashier option out there. “It’s 2020, use <code>fetch</code> already!” is a weak argument to me.</p>\\n<h3>2. Isn’t XMLHttpRequest deprecated?</h3>\\n<p>No. A <em>part</em> of it (<a href=\\\"https://xhr.spec.whatwg.org/#synchronous-flag\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">the ability to make synchronous HTTP requests</a>) is in the process of being removed from the platform due to the horrid performance issues that come along with it. But the core API itself isn’t going anywhere, and still offers advantages over <code>fetch</code>, like <a href=\\\"https://xhr.spec.whatwg.org/#interface-progressevent\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">being able to track progress</a> on file uploads.</p>\\n<p>By using <code>XMLHttpRequest</code>, you’re not just piling on tech debt you’ll need to clean up a couple years from now. In fact, choosing it might actually set you up for <em>less</em> work in the future, since you’d otherwise be removing polyfills when they’re no longer needed (assuming you currently need to support IE).</p>\\n<h3>3. That API is disgusting!</h3>\\n<p>Yeah, it is. That’s why I’m placing decent emphasis on it being best for <em>simple</em> requests. The instant the scope of a package goes beyond that, or as soon as you drop IE as a supported browser, <code>fetch</code>(or something else) might be a better way to go. Until then, at the very least, play with it for a while instead of dismissing it based off water cooler dev chatter. You’ll likely discover (like I did) that it’s not nearly as bad as people make it out to be.</p>\\n<h3>4. I like my Promise-based API!</h3>\\n<p>Me too! But thankfully, it’s easy enough to wrap an <code>XMLHttpRequest</code> implementation in a Promise to retain that interface. You’ll get those ergonomics, and you’ll still have to deal with one less polyfill than if you had gone with something like <code>fetch</code>.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">fire</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> xhr <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">XMLHttpRequest</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  xhr<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">open</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"POST\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">\\\"http://localhost:4000\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  xhr<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">setRequestHeader</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"Content-Type\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">\\\"application/json\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  xhr<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">setRequestHeader</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"x-api-key\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">\\\"my-api-key\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Promise</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">resolve<span class=\\\"token punctuation\\\">,</span> reject</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    xhr<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method-variable function-variable method function property-access\\\">onload</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">status</span> <span class=\\\"token operator\\\">>=</span> <span class=\\\"token number\\\">200</span> <span class=\\\"token operator\\\">&#x26;&#x26;</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">status</span> <span class=\\\"token operator\\\">&#x3C;</span> <span class=\\\"token number\\\">400</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token function\\\">resolve</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token known-class-name class-name\\\">JSON</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">parse</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">responseText</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword control-flow\\\">else</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token function\\\">reject</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Error</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"Something went wrong!\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    xhr<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method-variable function-variable method function property-access\\\">onerror</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token function\\\">reject</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Error</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"Something went wrong!\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    xhr<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">send</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token known-class-name class-name\\\">JSON</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">stringify</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span> <span class=\\\"token literal-property property\\\">name</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"Alex\\\"</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">async</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword control-flow\\\">try</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword control-flow\\\">await</span> <span class=\\\"token function\\\">fire</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword control-flow\\\">catch</span> <span class=\\\"token punctuation\\\">(</span>e<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span>e<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">message</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<h2>Sometimes, New <em>Might</em> Not Be Best</h2>\\n<p>It’s easy to get excited about advancements to web APIs like <code>fetch</code>, and they’re very often the best tool for the job. But if we’re not careful, it’s just as easy to become dogmatic about using newer technologies exclusively because they’re new. As you wade these waters, try to keep the full scope of your circumstances in mind – the users, the needs, the environment, everything. You may find out that the best tool for the job is the one that’s been around since your grandma was making HTTP requests.</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 30,
        "title": "As an Engineer, Write",
        "slug": "as-an-engineer-write",
        "html": "<p>A post on behalf of my team about why growing in your craft requires writing more than just code.</p>\n",
        "feature_image": "",
        "status": "published",
        "created_at": 1590987600000,
        "published_at": 1590987600000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>A post on behalf of my team about why growing in your craft requires writing more than just code.</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 31,
        "title": "Avoid Heavy Babel Transformations by (Sometimes) Not Writing Modern JavaScript",
        "slug": "avoid-heavy-babel-transformations-by-sometimes-not-writing-modern-javascript",
        "html": "<p>A guest post in which I explore some of the times you might consider using “old school” approaches in JavaScript in order to avoid particularly heavy Babel transformations.</p>\n",
        "feature_image": "",
        "status": "published",
        "created_at": 1589950800000,
        "published_at": 1589950800000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>A guest post in which I explore some of the times you might consider using “old school” approaches in JavaScript in order to avoid particularly heavy Babel transformations.</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 32,
        "title": "When It Makes Sense to Use a Utility Function Instead of a Polyfill",
        "slug": "when-it-makes-sense-to-use-a-utility-function-instead-of-a-polyfill",
        "html": "<p>Modern iterations of JavaScript have introduced some nice methods that make writing code a lot more legible, performant, and fun to write. Take, for example, the <code>find()</code> method on the <code>Array</code> prototype, which allows you to elegantly retrieve the first item in an array that meets some condition.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> players <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Bob\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> <span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Bill\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Baker\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Bo\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> player <span class=\"token operator\">=</span> players<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">p</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> p<span class=\"token punctuation\">.</span><span class=\"token property-access\">id</span> <span class=\"token operator\">===</span> <span class=\"token number\">9</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n\n<span class=\"token comment\">// {id: 9, name: \"Bill\"}</span>\n</code></pre></div>\n<p>Features like this are slick, so it’s a bummer when they’re not supported by your target browsers (like IE11). In those situations, it’s tempting to reach for the closest polyfill you can find, <code>npm install</code>, and press forward. But if you’re striving to keep your bundle size as slim as possible, <strong>your best option</strong> <em><strong>might</strong></em> <strong>be to write a utility function instead.</strong></p>\n<h2>Polyfills Can Be Fat</h2>\n<p>In many (if not most) cases, polyfill authors aim to keep their packages as close to the official specification as possible, or attempt to bridge the slight differences in how various browsers implement that feature. This makes sense – they’re written to be distributed and (often) to align with an established standard, and so they need to behave predictably and consistently regardless of how a consumer chooses to implement them.</p>\n<p>Consider that <code>find()</code> method. It sounds simple, but with a good share of polyfills out there, you get a lot more than what you might expect (or need). <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/find#Polyfill\" target=\"_blank\" rel=\"noopener\">The one provided by MDN</a>, for example, makes up 1,327 bytes:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// https://tc39.github.io/ecma262/#sec-array.prototype.find</span>\n<span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token class-name\">Array</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">find</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">defineProperty</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Array</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"find\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">value</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">predicate</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// 1\\. Let O be ? ToObject(this value).</span>\n      <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span> <span class=\"token operator\">==</span> <span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">throw</span> <span class=\"token known-class-name class-name\">TypeError</span><span class=\"token punctuation\">(</span><span class=\"token string\">'\"this\" is null or not defined'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token keyword\">var</span> o <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// 2\\. Let len be ? ToLength(? Get(O, \"length\")).</span>\n      <span class=\"token keyword\">var</span> len <span class=\"token operator\">=</span> o<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span> <span class=\"token operator\">>>></span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// 3\\. If IsCallable(predicate) is false, throw a TypeError exception.</span>\n      <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> predicate <span class=\"token operator\">!==</span> <span class=\"token string\">\"function\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">throw</span> <span class=\"token known-class-name class-name\">TypeError</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"predicate must be a function\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token comment\">// 4\\. If thisArg was supplied, let T be thisArg; else let T be undefined.</span>\n      <span class=\"token keyword\">var</span> thisArg <span class=\"token operator\">=</span> arguments<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// 5\\. Let k be 0.</span>\n      <span class=\"token keyword\">var</span> k <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// 6\\. Repeat, while k &#x3C; len</span>\n      <span class=\"token keyword control-flow\">while</span> <span class=\"token punctuation\">(</span>k <span class=\"token operator\">&#x3C;</span> len<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// a. Let Pk be ! ToString(k).</span>\n        <span class=\"token comment\">// b. Let kValue be ? Get(O, Pk).</span>\n        <span class=\"token comment\">// c. Let testResult be ToBoolean(? Call(predicate, T, « kValue, k, O »)).</span>\n        <span class=\"token comment\">// d. If testResult is true, return kValue.</span>\n        <span class=\"token keyword\">var</span> kValue <span class=\"token operator\">=</span> o<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>predicate<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span>thisArg<span class=\"token punctuation\">,</span> kValue<span class=\"token punctuation\">,</span> k<span class=\"token punctuation\">,</span> o<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword control-flow\">return</span> kValue<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\">// e. Increase k by 1.</span>\n        k<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token comment\">// 7\\. Return undefined.</span>\n      <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword nil\">undefined</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">configurable</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">writable</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>And from what I can find, that’s a pretty common thing. The <code>Array.prototype.fill()</code> polyfill weighs in at about <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/fill#Polyfill\" target=\"_blank\" rel=\"noopener\">928 bytes</a>, <code>Array.prototype.findIndex()</code> comes in at <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/findIndex#Polyfill\" target=\"_blank\" rel=\"noopener\">1,549 bytes</a>, and <code>Array.from()</code> sits at <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/from#Polyfill\" target=\"_blank\" rel=\"noopener\">2,665 bytes</a>.</p>\n<p>The range in file size will obviously vary from polyfill to polyfill, but the implication is still clear. These tools aren’t built to satisfy you and your specific context, and so that means you’ll likely be subscribing to more than what your circumstances require by leveraging them.</p>\n<h2>A Small Utility May Save You Some Bytes</h2>\n<p>When you don’t need the full scope of what a polyfill provides, you can shave some bundle weight by rolling something more specific to you. And depending on the method, it often doesn’t take much. Gander at these few examples from methods I fairly commonly use:</p>\n<h3>A Simple <code>Array.prototype.find()</code> Utility</h3>\n<p>Looking at <code>find()</code> once again, a suitable utility method might look like this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">find</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">arr<span class=\"token punctuation\">,</span> func</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> index <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> index <span class=\"token operator\">&#x3C;</span> arr<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span><span class=\"token punctuation\">;</span> index<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> arr<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> arr<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword nil\">undefined</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> players <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Bob\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> <span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Bill\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Baker\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Bo\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> player <span class=\"token operator\">=</span> <span class=\"token function\">find</span><span class=\"token punctuation\">(</span>players<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">p</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> p<span class=\"token punctuation\">.</span><span class=\"token property-access\">id</span> <span class=\"token operator\">===</span> <span class=\"token number\">9</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// {id: 9, name: \"Bill\"}</span>\n</code></pre></div>\n<h3>A Simple <code>Array.prototype.findIndex</code> Utility</h3>\n<p>And that could be easily converted into a <code>findIndex()</code> utility as well:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">findIndex</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">arr<span class=\"token punctuation\">,</span> func</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> index <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> index <span class=\"token operator\">&#x3C;</span> arr<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span><span class=\"token punctuation\">;</span> index<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> arr<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">return</span> index<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword nil\">undefined</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> players <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Bob\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> <span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Bill\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Baker\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Bo\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> player <span class=\"token operator\">=</span> <span class=\"token function\">findIndex</span><span class=\"token punctuation\">(</span>players<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">p</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> p<span class=\"token punctuation\">.</span><span class=\"token property-access\">id</span> <span class=\"token operator\">===</span> <span class=\"token number\">9</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 1</span>\n</code></pre></div>\n<h3>A Simple <code>Array.from()</code> Utility</h3>\n<p>If you’re simply looking to convert something like a <code>NodeList</code> into an array, you could use something like this, which in this case, performs virtually the same function as <code>Array.from()</code> (in this case), and doesn’t require that you ship those extra 2,665 bytes.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">arrayFrom</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">arrayLikeThing</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">slice</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span>arrayLikeThing<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">arrayFrom</span><span class=\"token punctuation\">(</span><span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"span\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// [ ...array of nodes ]</span>\n</code></pre></div>\n<h3>A Simple <code>Array.prototype.fill()</code> Utility</h3>\n<p>For one more example, here’s how a simple utility method for <code>fill()</code> might look:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fill</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> array<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">,</span> start <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> end <span class=\"token operator\">=</span> <span class=\"token keyword nil\">undefined</span> <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  end <span class=\"token operator\">=</span> end <span class=\"token operator\">?</span> end <span class=\"token operator\">+</span> <span class=\"token number\">1</span> <span class=\"token operator\">:</span> array<span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span><span class=\"token punctuation\">;</span>\n  array<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">splice</span><span class=\"token punctuation\">(</span>\n    start<span class=\"token punctuation\">,</span>\n    end <span class=\"token operator\">-</span> start<span class=\"token punctuation\">,</span>\n    array<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">slice</span><span class=\"token punctuation\">(</span>start<span class=\"token punctuation\">,</span> end<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">i</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> value<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">concat</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">apply</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> array<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">array</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token string\">\"x\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">start</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">end</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// [ 1, 'x', 'x', 'x', 5 ]</span>\n</code></pre></div>\n<p>Again, none of these utilities serve as a straight-up replacement for what any of the native APIs provide, and <strong>they’re not intended to do everything a polyfill would do.</strong> But they get <em>your</em> job done, they’re light, and it’s reasonably straightforward to build them yourself.</p>\n<h2>What about ready-made utility libraries?</h2>\n<p>You might be thinking of something like <a href=\"https://lodash.com/\" target=\"_blank\" rel=\"noopener\">Lodash</a> here. Depending on your needs, that might be a suitable choice. Still, similar tradeoffs exist in choosing to leverage tools like this rather than whipping up a utility more unique to your needs. Libraries like Lodash are intended for wide distribution, and so the methods they provide often just do more than what your specific circumstances require.</p>\n<p>For example, our <code>findIndex</code> implementation was less than 10 lines of code. But Lodash’s version is <a href=\"https://github.com/lodash/lodash/blob/4.6.0-npm-packages/lodash.findindex/index.js#L1743\" target=\"_blank\" rel=\"noopener\">11 lines</a>, and it also depends on a shared <code>baseFindIndex</code> method, which accounts for <a href=\"https://github.com/lodash/lodash/blob/4.6.0-npm-packages/lodash.findindex/index.js#L175\" target=\"_blank\" rel=\"noopener\"><em>another</em></a><a href=\"https://github.com/lodash/lodash/blob/4.6.0-npm-packages/lodash.findindex/index.js#L175\" target=\"_blank\" rel=\"noopener\"> 11 lines</a>.</p>\n<p>Libraries like this can provide confidence that writing your own utilities may not, and it may also be a slimmer approach than pulling in a polyfill. But even so, you’ll probably be signing up for a bit of weight that you could likely avoid by rolling something yourself.</p>\n<h2>Sometimes, a Polyfill <em>Does</em> Make Sense</h2>\n<p>This definitely isn’t a blanket prescription for how you should handle feature support for older browsers. Depending on the context, it might make perfect sense to include a polyfill, lean on a utility library, or do nothing at all. A few scenarios come to mind:</p>\n<ul>\n<li><strong>You’re writing a library to be distributed.</strong> If that’s the case, you might want to leave your code as-is and instead require consumers to polyfill themselves when needed. This is helpful because it’ll lessen package size for a majority number of people, while still providing a path forward for the minority. In fact, it’s the approach I take with <a href=\"https://typeitjs.com/\" target=\"_blank\" rel=\"noopener\">TypeIt</a>. I don’t include API polyfills for IE and older, but I do document which ones people will need to include themselves, should they need to support an older browser.</li>\n<li><strong>You use a particular feature a lot.</strong> If it’s become a habit to leverage a given feature, and each context is slightly varied, it might make sense to pull in a comprehensive polyfill. That piece of code, albeit beefy, might cover more specification gotchas between each implementation, and may also make it easier to transition away from the polyfill when native browser support becomes adequate. Not to mention, the ergonomics of some of these APIs are really good, and it may be worth the efficiency gains in developers getting to lean into them.</li>\n<li><strong>You practice differential serving.</strong> It’s possible to automatically polyfill based on your target browsers using tools like <a href=\"https://babeljs.io/docs/en/babel-preset-env#usebuiltins\" target=\"_blank\" rel=\"noopener\">@babel/preset-env</a>. If you’re automating it like this, it’s become a popular pattern to generate two separate bundles – one for modern consumers, and one for legacy. This way, <em>most</em> people get a slimmer bundle, and you can freely use certain features without worrying so much about the added bloat.</li>\n<li><strong>Ain’t got time 4 dat.</strong> It takes time to roll a utility function, and when you do, there’s always the chance you’ll miss something that a polyfill might have covered for you. That makes for the potential to spin your wheels when there may have been a better ROI by simply pulling in that polyfill.</li>\n</ul>\n<h2>Whatever You Do, Mind Your Bundle.</h2>\n<p>Especially when so many resources are quickly available via <code>npm install</code>, it’s easy to lose sight of what’s actually ending up in your bundle (and what that means for your users). So, no matter how you approach providing new-ish features to your application, do it with your production code in mind.</p>\n<p>Thanks for reading!</p>\n",
        "feature_image": "https://images.unsplash.com/37/tEREUy1vSfuSu8LzTop3_IMG_2538.jpg?ixlib=rb-1.2.1&q=80&cs=tinysrgb&fm=jpg&crop=entropy",
        "status": "published",
        "created_at": 1589518800000,
        "published_at": 1589518800000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>Modern iterations of JavaScript have introduced some nice methods that make writing code a lot more legible, performant, and fun to write. Take, for example, the <code>find()</code> method on the <code>Array</code> prototype, which allows you to elegantly retrieve the first item in an array that meets some condition.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> players <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">[</span>\\n  <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token literal-property property\\\">id</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">3</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token literal-property property\\\">name</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"Bob\\\"</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token literal-property property\\\">id</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">9</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token literal-property property\\\">name</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"Bill\\\"</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token literal-property property\\\">id</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">2</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token literal-property property\\\">name</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"Baker\\\"</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token literal-property property\\\">id</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">4</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token literal-property property\\\">name</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"Bo\\\"</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> player <span class=\\\"token operator\\\">=</span> players<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">find</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">p</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> p<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">id</span> <span class=\\\"token operator\\\">===</span> <span class=\\\"token number\\\">9</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span> \\n\\n<span class=\\\"token comment\\\">// {id: 9, name: \\\"Bill\\\"}</span>\\n</code></pre></div>\\n<p>Features like this are slick, so it’s a bummer when they’re not supported by your target browsers (like IE11). In those situations, it’s tempting to reach for the closest polyfill you can find, <code>npm install</code>, and press forward. But if you’re striving to keep your bundle size as slim as possible, <strong>your best option</strong> <em><strong>might</strong></em> <strong>be to write a utility function instead.</strong></p>\\n<h2>Polyfills Can Be Fat</h2>\\n<p>In many (if not most) cases, polyfill authors aim to keep their packages as close to the official specification as possible, or attempt to bridge the slight differences in how various browsers implement that feature. This makes sense – they’re written to be distributed and (often) to align with an established standard, and so they need to behave predictably and consistently regardless of how a consumer chooses to implement them.</p>\\n<p>Consider that <code>find()</code> method. It sounds simple, but with a good share of polyfills out there, you get a lot more than what you might expect (or need). <a href=\\\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/find#Polyfill\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">The one provided by MDN</a>, for example, makes up 1,327 bytes:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token comment\\\">// https://tc39.github.io/ecma262/#sec-array.prototype.find</span>\\n<span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span><span class=\\\"token class-name\\\">Array</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">prototype</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">find</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token known-class-name class-name\\\">Object</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">defineProperty</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token class-name\\\">Array</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">prototype</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">\\\"find\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token function-variable function\\\">value</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">predicate</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token comment\\\">// 1\\\\. Let O be ? ToObject(this value).</span>\\n      <span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">this</span> <span class=\\\"token operator\\\">==</span> <span class=\\\"token keyword null nil\\\">null</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token keyword control-flow\\\">throw</span> <span class=\\\"token known-class-name class-name\\\">TypeError</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'\\\"this\\\" is null or not defined'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span>\\n\\n      <span class=\\\"token keyword\\\">var</span> o <span class=\\\"token operator\\\">=</span> <span class=\\\"token known-class-name class-name\\\">Object</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n      <span class=\\\"token comment\\\">// 2\\\\. Let len be ? ToLength(? Get(O, \\\"length\\\")).</span>\\n      <span class=\\\"token keyword\\\">var</span> len <span class=\\\"token operator\\\">=</span> o<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">length</span> <span class=\\\"token operator\\\">>>></span> <span class=\\\"token number\\\">0</span><span class=\\\"token punctuation\\\">;</span>\\n\\n      <span class=\\\"token comment\\\">// 3\\\\. If IsCallable(predicate) is false, throw a TypeError exception.</span>\\n      <span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">typeof</span> predicate <span class=\\\"token operator\\\">!==</span> <span class=\\\"token string\\\">\\\"function\\\"</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token keyword control-flow\\\">throw</span> <span class=\\\"token known-class-name class-name\\\">TypeError</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"predicate must be a function\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span>\\n\\n      <span class=\\\"token comment\\\">// 4\\\\. If thisArg was supplied, let T be thisArg; else let T be undefined.</span>\\n      <span class=\\\"token keyword\\\">var</span> thisArg <span class=\\\"token operator\\\">=</span> arguments<span class=\\\"token punctuation\\\">[</span><span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n\\n      <span class=\\\"token comment\\\">// 5\\\\. Let k be 0.</span>\\n      <span class=\\\"token keyword\\\">var</span> k <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">0</span><span class=\\\"token punctuation\\\">;</span>\\n\\n      <span class=\\\"token comment\\\">// 6\\\\. Repeat, while k &#x3C; len</span>\\n      <span class=\\\"token keyword control-flow\\\">while</span> <span class=\\\"token punctuation\\\">(</span>k <span class=\\\"token operator\\\">&#x3C;</span> len<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token comment\\\">// a. Let Pk be ! ToString(k).</span>\\n        <span class=\\\"token comment\\\">// b. Let kValue be ? Get(O, Pk).</span>\\n        <span class=\\\"token comment\\\">// c. Let testResult be ToBoolean(? Call(predicate, T, « kValue, k, O »)).</span>\\n        <span class=\\\"token comment\\\">// d. If testResult is true, return kValue.</span>\\n        <span class=\\\"token keyword\\\">var</span> kValue <span class=\\\"token operator\\\">=</span> o<span class=\\\"token punctuation\\\">[</span>k<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n        <span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span>predicate<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">call</span><span class=\\\"token punctuation\\\">(</span>thisArg<span class=\\\"token punctuation\\\">,</span> kValue<span class=\\\"token punctuation\\\">,</span> k<span class=\\\"token punctuation\\\">,</span> o<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n          <span class=\\\"token keyword control-flow\\\">return</span> kValue<span class=\\\"token punctuation\\\">;</span>\\n        <span class=\\\"token punctuation\\\">}</span>\\n        <span class=\\\"token comment\\\">// e. Increase k by 1.</span>\\n        k<span class=\\\"token operator\\\">++</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span>\\n\\n      <span class=\\\"token comment\\\">// 7\\\\. Return undefined.</span>\\n      <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token keyword nil\\\">undefined</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token literal-property property\\\">configurable</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token literal-property property\\\">writable</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p>And from what I can find, that’s a pretty common thing. The <code>Array.prototype.fill()</code> polyfill weighs in at about <a href=\\\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/fill#Polyfill\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">928 bytes</a>, <code>Array.prototype.findIndex()</code> comes in at <a href=\\\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/findIndex#Polyfill\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">1,549 bytes</a>, and <code>Array.from()</code> sits at <a href=\\\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/from#Polyfill\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">2,665 bytes</a>.</p>\\n<p>The range in file size will obviously vary from polyfill to polyfill, but the implication is still clear. These tools aren’t built to satisfy you and your specific context, and so that means you’ll likely be subscribing to more than what your circumstances require by leveraging them.</p>\\n<h2>A Small Utility May Save You Some Bytes</h2>\\n<p>When you don’t need the full scope of what a polyfill provides, you can shave some bundle weight by rolling something more specific to you. And depending on the method, it often doesn’t take much. Gander at these few examples from methods I fairly commonly use:</p>\\n<h3>A Simple <code>Array.prototype.find()</code> Utility</h3>\\n<p>Looking at <code>find()</code> once again, a suitable utility method might look like this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">find</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">arr<span class=\\\"token punctuation\\\">,</span> func</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword control-flow\\\">for</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">let</span> index <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">0</span><span class=\\\"token punctuation\\\">;</span> index <span class=\\\"token operator\\\">&#x3C;</span> arr<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">length</span><span class=\\\"token punctuation\\\">;</span> index<span class=\\\"token operator\\\">++</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span>func<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">call</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">,</span> arr<span class=\\\"token punctuation\\\">[</span>index<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span> index<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword control-flow\\\">return</span> arr<span class=\\\"token punctuation\\\">[</span>index<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token keyword nil\\\">undefined</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> players <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">[</span>\\n  <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token literal-property property\\\">id</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">3</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token literal-property property\\\">name</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"Bob\\\"</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token literal-property property\\\">id</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">9</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token literal-property property\\\">name</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"Bill\\\"</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token literal-property property\\\">id</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">2</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token literal-property property\\\">name</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"Baker\\\"</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token literal-property property\\\">id</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">4</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token literal-property property\\\">name</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"Bo\\\"</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> player <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">find</span><span class=\\\"token punctuation\\\">(</span>players<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">p</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> p<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">id</span> <span class=\\\"token operator\\\">===</span> <span class=\\\"token number\\\">9</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// {id: 9, name: \\\"Bill\\\"}</span>\\n</code></pre></div>\\n<h3>A Simple <code>Array.prototype.findIndex</code> Utility</h3>\\n<p>And that could be easily converted into a <code>findIndex()</code> utility as well:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">findIndex</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">arr<span class=\\\"token punctuation\\\">,</span> func</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword control-flow\\\">for</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">let</span> index <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">0</span><span class=\\\"token punctuation\\\">;</span> index <span class=\\\"token operator\\\">&#x3C;</span> arr<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">length</span><span class=\\\"token punctuation\\\">;</span> index<span class=\\\"token operator\\\">++</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span>func<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">call</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">,</span> arr<span class=\\\"token punctuation\\\">[</span>index<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span> index<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword control-flow\\\">return</span> index<span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token keyword nil\\\">undefined</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> players <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">[</span>\\n  <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token literal-property property\\\">id</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">3</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token literal-property property\\\">name</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"Bob\\\"</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token literal-property property\\\">id</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">9</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token literal-property property\\\">name</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"Bill\\\"</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token literal-property property\\\">id</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">2</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token literal-property property\\\">name</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"Baker\\\"</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token literal-property property\\\">id</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">4</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token literal-property property\\\">name</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"Bo\\\"</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> player <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">findIndex</span><span class=\\\"token punctuation\\\">(</span>players<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">p</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> p<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">id</span> <span class=\\\"token operator\\\">===</span> <span class=\\\"token number\\\">9</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// 1</span>\\n</code></pre></div>\\n<h3>A Simple <code>Array.from()</code> Utility</h3>\\n<p>If you’re simply looking to convert something like a <code>NodeList</code> into an array, you could use something like this, which in this case, performs virtually the same function as <code>Array.from()</code> (in this case), and doesn’t require that you ship those extra 2,665 bytes.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">arrayFrom</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">arrayLikeThing</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">slice</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">call</span><span class=\\\"token punctuation\\\">(</span>arrayLikeThing<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token function\\\">arrayFrom</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">querySelectorAll</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"span\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// [ ...array of nodes ]</span>\\n</code></pre></div>\\n<h3>A Simple <code>Array.prototype.fill()</code> Utility</h3>\\n<p>For one more example, here’s how a simple utility method for <code>fill()</code> might look:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">fill</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\"><span class=\\\"token punctuation\\\">{</span> array<span class=\\\"token punctuation\\\">,</span> value<span class=\\\"token punctuation\\\">,</span> start <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">0</span><span class=\\\"token punctuation\\\">,</span> end <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword nil\\\">undefined</span> <span class=\\\"token punctuation\\\">}</span></span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  end <span class=\\\"token operator\\\">=</span> end <span class=\\\"token operator\\\">?</span> end <span class=\\\"token operator\\\">+</span> <span class=\\\"token number\\\">1</span> <span class=\\\"token operator\\\">:</span> array<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">length</span><span class=\\\"token punctuation\\\">;</span>\\n  array<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">splice</span><span class=\\\"token punctuation\\\">(</span>\\n    start<span class=\\\"token punctuation\\\">,</span>\\n    end <span class=\\\"token operator\\\">-</span> start<span class=\\\"token punctuation\\\">,</span>\\n    array<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">slice</span><span class=\\\"token punctuation\\\">(</span>start<span class=\\\"token punctuation\\\">,</span> end<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">map</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">i</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> value<span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">concat</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">apply</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span> array<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token function\\\">fill</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token literal-property property\\\">array</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">2</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">3</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">4</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">5</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token literal-property property\\\">value</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"x\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token literal-property property\\\">start</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token literal-property property\\\">end</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">3</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// [ 1, 'x', 'x', 'x', 5 ]</span>\\n</code></pre></div>\\n<p>Again, none of these utilities serve as a straight-up replacement for what any of the native APIs provide, and <strong>they’re not intended to do everything a polyfill would do.</strong> But they get <em>your</em> job done, they’re light, and it’s reasonably straightforward to build them yourself.</p>\\n<h2>What about ready-made utility libraries?</h2>\\n<p>You might be thinking of something like <a href=\\\"https://lodash.com/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Lodash</a> here. Depending on your needs, that might be a suitable choice. Still, similar tradeoffs exist in choosing to leverage tools like this rather than whipping up a utility more unique to your needs. Libraries like Lodash are intended for wide distribution, and so the methods they provide often just do more than what your specific circumstances require.</p>\\n<p>For example, our <code>findIndex</code> implementation was less than 10 lines of code. But Lodash’s version is <a href=\\\"https://github.com/lodash/lodash/blob/4.6.0-npm-packages/lodash.findindex/index.js#L1743\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">11 lines</a>, and it also depends on a shared <code>baseFindIndex</code> method, which accounts for <a href=\\\"https://github.com/lodash/lodash/blob/4.6.0-npm-packages/lodash.findindex/index.js#L175\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\"><em>another</em></a><a href=\\\"https://github.com/lodash/lodash/blob/4.6.0-npm-packages/lodash.findindex/index.js#L175\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\"> 11 lines</a>.</p>\\n<p>Libraries like this can provide confidence that writing your own utilities may not, and it may also be a slimmer approach than pulling in a polyfill. But even so, you’ll probably be signing up for a bit of weight that you could likely avoid by rolling something yourself.</p>\\n<h2>Sometimes, a Polyfill <em>Does</em> Make Sense</h2>\\n<p>This definitely isn’t a blanket prescription for how you should handle feature support for older browsers. Depending on the context, it might make perfect sense to include a polyfill, lean on a utility library, or do nothing at all. A few scenarios come to mind:</p>\\n<ul>\\n<li><strong>You’re writing a library to be distributed.</strong> If that’s the case, you might want to leave your code as-is and instead require consumers to polyfill themselves when needed. This is helpful because it’ll lessen package size for a majority number of people, while still providing a path forward for the minority. In fact, it’s the approach I take with <a href=\\\"https://typeitjs.com/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">TypeIt</a>. I don’t include API polyfills for IE and older, but I do document which ones people will need to include themselves, should they need to support an older browser.</li>\\n<li><strong>You use a particular feature a lot.</strong> If it’s become a habit to leverage a given feature, and each context is slightly varied, it might make sense to pull in a comprehensive polyfill. That piece of code, albeit beefy, might cover more specification gotchas between each implementation, and may also make it easier to transition away from the polyfill when native browser support becomes adequate. Not to mention, the ergonomics of some of these APIs are really good, and it may be worth the efficiency gains in developers getting to lean into them.</li>\\n<li><strong>You practice differential serving.</strong> It’s possible to automatically polyfill based on your target browsers using tools like <a href=\\\"https://babeljs.io/docs/en/babel-preset-env#usebuiltins\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">@babel/preset-env</a>. If you’re automating it like this, it’s become a popular pattern to generate two separate bundles – one for modern consumers, and one for legacy. This way, <em>most</em> people get a slimmer bundle, and you can freely use certain features without worrying so much about the added bloat.</li>\\n<li><strong>Ain’t got time 4 dat.</strong> It takes time to roll a utility function, and when you do, there’s always the chance you’ll miss something that a polyfill might have covered for you. That makes for the potential to spin your wheels when there may have been a better ROI by simply pulling in that polyfill.</li>\\n</ul>\\n<h2>Whatever You Do, Mind Your Bundle.</h2>\\n<p>Especially when so many resources are quickly available via <code>npm install</code>, it’s easy to lose sight of what’s actually ending up in your bundle (and what that means for your users). So, no matter how you approach providing new-ish features to your application, do it with your production code in mind.</p>\\n<p>Thanks for reading!</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 33,
        "title": "Why Webpacker Wouldn't Compile Assets in a Specific Environment",
        "slug": "why-webpacker-wouldnt-compile-assets-in-a-specific-environment",
        "html": "<p>A while back, I started working in a Rails application in which I needed to introduce a JavaScript file that’d be compiled with Webpacker. To do so, I created the file in my <code>packs</code> directory and loaded it up via <code>content_for</code>:</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\">&#x3C;% content_for(:body_assets) do %>\n  &#x3C;%= javascript_pack_tag(\"some-file\") %>\n&#x3C;% end %>\n</code></pre></div>\n<p>Locally, things worked great! But once I deployed, integration tests running in the CI pipeline would unexpectedly fail, even though the same tests were <em>passing</em> on my machine. After some time spent troubleshooting, it turned out to be one primary issue, which was drawn out by my misunderstanding of how Webpacker loads configuration settings for an environment. This is a quick review of the entire debugging process.</p>\n<h2>Problem #1: A <code>manifest.json</code> file wasn’t being generated.</h2>\n<p>As Rails is running a request and the <code>javascript_pack_tag</code> method is encountered, it’ll reference a <code>manifest.json</code> file in order to load the correct assets. If that file doesn’t exist, Rails vomits. This is the sort of error you’ll see:</p>\n<div class=\"remark-highlight\"><pre class=\"language-text\"><code class=\"language-text\">ActionView::Template::Error: Webpacker can&#x26;#39;t find some-script in /my/app/path/public/packs/manifest.json. Possible causes:\n\n1\\. You want to set webpacker.yml value of compile to true for your environment\n   unless you are using the `webpack -w` or the webpack-dev-server.\n2\\. webpack has not yet re-run to reflect updates.\n3\\. You have misconfigured Webpacker&#x26;#39;s config/webpacker.yml file.\n4\\. Your webpack configuration is not creating a manifest.</code></pre></div>\n<p>This made sense. Upon deploy, Webpacker was apparently not being told to compile assets <em>before</em> requests were made or <em>as</em> they were made, and so that file was never getting correctly generated.</p>\n<h3>Solution: Ensure my <code>webpacker.yml</code> file has <code>compile</code> set to <code>true</code>.</h3>\n<p>In all of my environments <em>except</em> <code>production</code>, I wanted to set <code>compile</code> to <code>true</code>, so that on each request, Rails would check to see if it needs to compile assets before continuing. Instead of duplicating this change in my <code>development</code> and <code>test</code> environments, I opted to make it the default, since <code>production</code> already had it explicitly set to <code>false</code>.</p>\n<div class=\"remark-highlight\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">default</span><span class=\"token punctuation\">:</span> <span class=\"token important\">&#x26;default</span>  \n\t<span class=\"token key atrule\">compile</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n\n<span class=\"token key atrule\">development</span><span class=\"token punctuation\">:</span>  \n\t<span class=\"token key atrule\">&#x3C;&#x3C;</span><span class=\"token punctuation\">:</span> <span class=\"token important\">*default</span> \n   <span class=\"token comment\"># other settings...</span>\n\n<span class=\"token key atrule\">test</span><span class=\"token punctuation\">:</span>  \n\t<span class=\"token key atrule\">&#x3C;&#x3C;</span><span class=\"token punctuation\">:</span> <span class=\"token important\">*default</span>  \n\t<span class=\"token comment\"># other settings...</span>\n\n<span class=\"token key atrule\">production</span><span class=\"token punctuation\">:</span>  \n\t<span class=\"token key atrule\">&#x3C;&#x3C;</span><span class=\"token punctuation\">:</span> <span class=\"token important\">*default</span>  \n\t<span class=\"token key atrule\">compile</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>    \n\t<span class=\"token comment\"># other settings...</span>\n</code></pre></div>\n<p>I felt good about this… until it failed.</p>\n<h2>Problem #2: Webpacker wasn’t respecting default settings in its configuration file.</h2>\n<p>After some brief internal rage, I noticed a particular log that I must have passed over earlier:</p>\n<div class=\"remark-highlight\"><pre class=\"language-text\"><code class=\"language-text\">RAILS_ENV=build environment is not defined in config/webpacker.yml, falling back to production environment</code></pre></div>\n<p>My tests were being run in the <code>build</code> environment – not <code>test</code>. And as it turns out, <strong>Webpacker will fall back</strong> <strong><code>production</code></strong> <strong>if it can’t find the specified environment.</strong> <em>This</em> is why my assets weren’t being compiled. A <code>build</code> environment wasn’t set in my Webpacker configuration file, so it was falling back to <code>production</code>, which was explicitly telling Webpacker to <em>not</em> compile assets.</p>\n<h3>Solution: Ensure my environment exists in the <code>webpacker.yml</code> file.</h3>\n<p>Like most bugs that tempt you to rip your hair out, the solution turned out to be two lines:</p>\n<div class=\"remark-highlight\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>    \n\t<span class=\"token key atrule\">&#x3C;&#x3C;</span><span class=\"token punctuation\">:</span> <span class=\"token important\">*default</span>\n</code></pre></div>\n<p>Sure, enough. All was green after that change.</p>\n<h2>Key Takeaway: Read Your Logs Good.</h2>\n<p>What bit me here is some assumptions I made about how Webpacker loaded a configuration. The amount of time dealing with the consequences of those assumptions might have been avoided if I had been just a little more thorough in reading through the error logs. Don’t make this mistake yourself!</p>\n",
        "feature_image": "https://images.pexels.com/photos/1181271/pexels-photo-1181271.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=1200&w=1200",
        "status": "published",
        "created_at": 1586754000000,
        "published_at": 1586754000000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>A while back, I started working in a Rails application in which I needed to introduce a JavaScript file that’d be compiled with Webpacker. To do so, I created the file in my <code>packs</code> directory and loaded it up via <code>content_for</code>:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-html\\\"><code class=\\\"language-html\\\">&#x3C;% content_for(:body_assets) do %>\\n  &#x3C;%= javascript_pack_tag(\\\"some-file\\\") %>\\n&#x3C;% end %>\\n</code></pre></div>\\n<p>Locally, things worked great! But once I deployed, integration tests running in the CI pipeline would unexpectedly fail, even though the same tests were <em>passing</em> on my machine. After some time spent troubleshooting, it turned out to be one primary issue, which was drawn out by my misunderstanding of how Webpacker loads configuration settings for an environment. This is a quick review of the entire debugging process.</p>\\n<h2>Problem #1: A <code>manifest.json</code> file wasn’t being generated.</h2>\\n<p>As Rails is running a request and the <code>javascript_pack_tag</code> method is encountered, it’ll reference a <code>manifest.json</code> file in order to load the correct assets. If that file doesn’t exist, Rails vomits. This is the sort of error you’ll see:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">ActionView::Template::Error: Webpacker can&#x26;#39;t find some-script in /my/app/path/public/packs/manifest.json. Possible causes:\\n\\n1\\\\. You want to set webpacker.yml value of compile to true for your environment\\n   unless you are using the `webpack -w` or the webpack-dev-server.\\n2\\\\. webpack has not yet re-run to reflect updates.\\n3\\\\. You have misconfigured Webpacker&#x26;#39;s config/webpacker.yml file.\\n4\\\\. Your webpack configuration is not creating a manifest.</code></pre></div>\\n<p>This made sense. Upon deploy, Webpacker was apparently not being told to compile assets <em>before</em> requests were made or <em>as</em> they were made, and so that file was never getting correctly generated.</p>\\n<h3>Solution: Ensure my <code>webpacker.yml</code> file has <code>compile</code> set to <code>true</code>.</h3>\\n<p>In all of my environments <em>except</em> <code>production</code>, I wanted to set <code>compile</code> to <code>true</code>, so that on each request, Rails would check to see if it needs to compile assets before continuing. Instead of duplicating this change in my <code>development</code> and <code>test</code> environments, I opted to make it the default, since <code>production</code> already had it explicitly set to <code>false</code>.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-yaml\\\"><code class=\\\"language-yaml\\\"><span class=\\\"token key atrule\\\">default</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token important\\\">&#x26;default</span>  \\n\\t<span class=\\\"token key atrule\\\">compile</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token boolean important\\\">true</span>\\n\\n<span class=\\\"token key atrule\\\">development</span><span class=\\\"token punctuation\\\">:</span>  \\n\\t<span class=\\\"token key atrule\\\">&#x3C;&#x3C;</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token important\\\">*default</span> \\n   <span class=\\\"token comment\\\"># other settings...</span>\\n\\n<span class=\\\"token key atrule\\\">test</span><span class=\\\"token punctuation\\\">:</span>  \\n\\t<span class=\\\"token key atrule\\\">&#x3C;&#x3C;</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token important\\\">*default</span>  \\n\\t<span class=\\\"token comment\\\"># other settings...</span>\\n\\n<span class=\\\"token key atrule\\\">production</span><span class=\\\"token punctuation\\\">:</span>  \\n\\t<span class=\\\"token key atrule\\\">&#x3C;&#x3C;</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token important\\\">*default</span>  \\n\\t<span class=\\\"token key atrule\\\">compile</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token boolean important\\\">false</span>    \\n\\t<span class=\\\"token comment\\\"># other settings...</span>\\n</code></pre></div>\\n<p>I felt good about this… until it failed.</p>\\n<h2>Problem #2: Webpacker wasn’t respecting default settings in its configuration file.</h2>\\n<p>After some brief internal rage, I noticed a particular log that I must have passed over earlier:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">RAILS_ENV=build environment is not defined in config/webpacker.yml, falling back to production environment</code></pre></div>\\n<p>My tests were being run in the <code>build</code> environment – not <code>test</code>. And as it turns out, <strong>Webpacker will fall back</strong> <strong><code>production</code></strong> <strong>if it can’t find the specified environment.</strong> <em>This</em> is why my assets weren’t being compiled. A <code>build</code> environment wasn’t set in my Webpacker configuration file, so it was falling back to <code>production</code>, which was explicitly telling Webpacker to <em>not</em> compile assets.</p>\\n<h3>Solution: Ensure my environment exists in the <code>webpacker.yml</code> file.</h3>\\n<p>Like most bugs that tempt you to rip your hair out, the solution turned out to be two lines:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-yaml\\\"><code class=\\\"language-yaml\\\"><span class=\\\"token key atrule\\\">build</span><span class=\\\"token punctuation\\\">:</span>    \\n\\t<span class=\\\"token key atrule\\\">&#x3C;&#x3C;</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token important\\\">*default</span>\\n</code></pre></div>\\n<p>Sure, enough. All was green after that change.</p>\\n<h2>Key Takeaway: Read Your Logs Good.</h2>\\n<p>What bit me here is some assumptions I made about how Webpacker loaded a configuration. The amount of time dealing with the consequences of those assumptions might have been avoided if I had been just a little more thorough in reading through the error logs. Don’t make this mistake yourself!</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 34,
        "title": "Clean Up Your Redux Store Listeners When Component State Updates",
        "slug": "clean-up-your-redux-store-listeners-when-component-state-updates",
        "html": "<p>I’m writing a Gutenberg block for <a href=\"https://typeitjs.com/\" target=\"_blank\" rel=\"noopener\">TypeIt</a> that’ll allow content creators to easily drop typewriter effects into WordPress. The Gutenberg infrastructure is heavily rooted in the React ecosystem, so building a block feels very much like building a React application.</p>\n<p>One piece of this ecosystem that’s new to me, however, is <a href=\"https://redux.js.org/\" target=\"_blank\" rel=\"noopener\">Redux</a>, and soon after I dove into it, I ran into a problem that had my head tilting for quite some time – enough time to warrant writing it down in case I ever need to explain it to myself again.</p>\n<h2>The Problem</h2>\n<p>The short version is that <strong>I seemingly couldn’t update local state inside a Redux store listener housed within that component.</strong> And in my particular setup, an infinite loop was resulting. I was dumbfounded.</p>\n<h2>The Context</h2>\n<p>In my code, I have a global Redux store that’s responsible for holding the <a href=\"https://typeitjs.com/docs#options\" target=\"_blank\" rel=\"noopener\">base options</a> for each TypeIt block on a page (why they’re managed separately like this is another conversation). Whenever a block is saved, I want to pull down that block’s options from the shared store and save them with the block itself, rather than storing them somewhere else altogether. Here is my professional artistic attempt to illustrate this arrangement:</p>\n<p><img src='/proxy/d527ddf8-acdc-4284-914d-8d4fefeda507' alt='' loading='lazy' /></p>\n<p><strong>I attempted to solve this by updating local block state whenever my global store changed.</strong> To pull it off, in my block’s component, I used Redux’s <code>subscribe</code> method to listen for any global store changes. When they occurred, I checked if the options for my specific block have changed, and if they did, I updated my block’s <code>attributes</code> (the <code>prop</code> used in a Gutenberg block to save and manage block data).</p>\n<p>That looked something like this (a bit stripped down for brevity):</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> useEffect <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> wp<span class=\"token punctuation\">.</span><span class=\"token property-access\">element</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> subscribe <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> wp<span class=\"token punctuation\">.</span><span class=\"token property-access\">data</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">registerBlockType</span><span class=\"token punctuation\">(</span><span class=\"token string\">'wp-typeit/block'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token function-variable function\">edit</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> attributes<span class=\"token punctuation\">,</span> setAttributes <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> baseSettings <span class=\"token operator\">=</span> wp<span class=\"token punctuation\">.</span><span class=\"token property-access\">data</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">select</span><span class=\"token punctuation\">(</span><span class=\"token string\">'wp-typeit/store'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getSettings</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span>instanceId<span class=\"token punctuation\">]</span>\n\n        <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span>baseSettings<span class=\"token punctuation\">)</span> <span class=\"token operator\">!==</span> <span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span>attributes<span class=\"token punctuation\">.</span><span class=\"token property-access\">settings</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token function\">setAttributes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">settings</span><span class=\"token operator\">:</span> baseSettings <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// &#x3C;-- Only set up listener on `mount`.</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>This <em>looked</em> pretty safe. But when a global store change occurred, an infinite loop was set off within the component. I soon realized that the <code>setAttributes</code> method provided by Gutenberg triggered <em>another</em> store change (I don’t yet know why). Unexpected, but it still shouldn’t be a problem. After all, the next time the listener fires, my global settings <em>should</em> exactly match my local attributes, preventing the <code>setAttributes</code> method from being called again.</p>\n<p>But that was apparently incorrect. As it turned out, within that <code>subscribe</code> listener, <em>my local state wasnt’t getting updated at all.</em> And so every time the listener fired, that equality check would fail every time, over and over again. Infinite loop.</p>\n<h2>Remember, This Is React</h2>\n<p>It took a bit, but the solution to this problem arose after remembering how React handles updates to its state. Every time a component’s state (including props) is changed, that component is re-rendered, and it’s only <em>after</em> that rerender when the updated state (including props) is available.</p>\n<p>But my <code>subscribe</code> listener wasn’t respecting that. It was being activated <em>once</em> after the component mounted, and so it was only aware of the version of the props it had at that specific time. I could call <code>setAttributes</code> all I wanted, but that specific listener instance would behave as if nothing happened at all.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Listener is created ONCE, and never aware of future state updates.</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h2>The Solution: Clean Up Store Listeners</h2>\n<p>In order to perform future store comparisons after my local state was updated, <strong>I needed to throw away my</strong> <strong><code>subscribe</code></strong> <strong>listener every time a local state change occurred</strong>. With my specific circumstances, that meant a few tweaks:</p>\n<ol>\n<li><strong>Extract the</strong> <strong><code>unsubscribe</code></strong> <strong>method</strong> returned <a href=\"https://redux.js.org/api/store#subscribelistener\" target=\"_blank\" rel=\"noopener\">when a subscribe listener is created</a>.</li>\n<li><strong>Unsubscribe immediately before the</strong> <strong><code>setAttributes</code></strong> <strong>method fires.</strong> Since <code>setAttributes</code> triggers a global store change, this unplugs the listener to prevent it from firing before the local state is technically updated.</li>\n<li><strong>Instead of setting up a single listener on</strong> <strong><code>mount</code>****, do so</strong> <em><strong>every time</strong></em> <strong>the block is updated.</strong> To avoid listeners becoming stacked upon listeners, I’m using the <a href=\"https://reactjs.org/docs/hooks-effect.html#example-using-hooks-1\" target=\"_blank\" rel=\"noopener\">cleanup mechanism</a> built into the <code>useEffect</code> hook by returning from the hook with an <code>unsubscribe()</code> method call. Even though I’m already unsubscribing every time I call <code>setAttributes</code>, this will cover my butt any time a different state change occurs, totally unrelated to these settings. The objective is to never have more than one store listener active in the component at once, and this helps guarantee that.</li>\n</ol>\n<p>In all, those changes look like this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-diff\"><code class=\"language-diff\">const { useEffect } = wp.element;\nconst { subscribe } = wp.data;\n\nregisterBlockType('wp-typeit/block', {\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> // ...</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> edit: ({ attributes, setAttributes}) => {</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   useEffect(() => {</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">     // ...</span>\n<span class=\"token line\"></span></span><span class=\"token deleted-sign deleted\"><span class=\"token prefix deleted\">-</span><span class=\"token line\">     subscribe(() => {</span>\n<span class=\"token line\"></span></span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">     const unsubscribe = subscribe(() => {</span>\n<span class=\"token line\"></span></span><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\">       let baseSettings = wp.data.select('wp-typeit/store').getSettings()[instanceId]</span>\n<span class=\"token line\"></span></span>\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\">       if (JSON.stringify(baseSettings) !== JSON.stringify(attributes.settings)) {</span>\n<span class=\"token line\"></span></span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">         unsubscribe();</span>\n<span class=\"token line\"></span></span><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\">         setAttributes({ settings: baseSettings });</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">       }</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">     }</span>\n<span class=\"token line\"></span></span>\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">      return () => {</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">        unsubscribe(); &#x3C;!-- Destroy listener after every state change.</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">      }</span>\n<span class=\"token line\"></span></span><span class=\"token deleted-sign deleted\"><span class=\"token prefix deleted\">-</span><span class=\"token line\">    }, []);</span>\n<span class=\"token line\"></span></span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">    }); // &#x3C;!-- Activate new listener after every state change.</span>\n<span class=\"token line\"></span></span><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\"> }</span>\n<span class=\"token line\"></span></span>}\n</code></pre></div>\n<h2>Takeaway: Understand the React Lifecycle</h2>\n<p>While this particular problem is highly specific to WordPress/Gutenberg, it all illustrates how important it is to have a solid understanding of the React lifecycle and the gotchas that it makes possible by nature. In fact, it’s probably a good practice to <em>start</em> troubleshooting bugs like this by rubber ducking the events leading up to and following the undesired behavior that’s occurring. If it’s anything like the challege I’ve shared here, you’ll walk away with a better understanding of how React fundamentally works, as well as confirmation that you’re not actually going insane.</p>\n",
        "feature_image": "https://images.unsplash.com/photo-1529700215145-58542a1f36b6?ixlib=rb-1.2.1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;auto=format&amp;fit=crop&amp;w=1200&amp;q=100",
        "status": "published",
        "created_at": 1585544400000,
        "published_at": 1585544400000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>I’m writing a Gutenberg block for <a href=\\\"https://typeitjs.com/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">TypeIt</a> that’ll allow content creators to easily drop typewriter effects into WordPress. The Gutenberg infrastructure is heavily rooted in the React ecosystem, so building a block feels very much like building a React application.</p>\\n<p>One piece of this ecosystem that’s new to me, however, is <a href=\\\"https://redux.js.org/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Redux</a>, and soon after I dove into it, I ran into a problem that had my head tilting for quite some time – enough time to warrant writing it down in case I ever need to explain it to myself again.</p>\\n<h2>The Problem</h2>\\n<p>The short version is that <strong>I seemingly couldn’t update local state inside a Redux store listener housed within that component.</strong> And in my particular setup, an infinite loop was resulting. I was dumbfounded.</p>\\n<h2>The Context</h2>\\n<p>In my code, I have a global Redux store that’s responsible for holding the <a href=\\\"https://typeitjs.com/docs#options\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">base options</a> for each TypeIt block on a page (why they’re managed separately like this is another conversation). Whenever a block is saved, I want to pull down that block’s options from the shared store and save them with the block itself, rather than storing them somewhere else altogether. Here is my professional artistic attempt to illustrate this arrangement:</p>\\n<p><img src='/proxy/d527ddf8-acdc-4284-914d-8d4fefeda507' alt='' loading='lazy' /></p>\\n<p><strong>I attempted to solve this by updating local block state whenever my global store changed.</strong> To pull it off, in my block’s component, I used Redux’s <code>subscribe</code> method to listen for any global store changes. When they occurred, I checked if the options for my specific block have changed, and if they did, I updated my block’s <code>attributes</code> (the <code>prop</code> used in a Gutenberg block to save and manage block data).</p>\\n<p>That looked something like this (a bit stripped down for brevity):</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">{</span> useEffect <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token operator\\\">=</span> wp<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">element</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">{</span> subscribe <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token operator\\\">=</span> wp<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">data</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token function\\\">registerBlockType</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'wp-typeit/block'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token comment\\\">// ...</span>\\n  <span class=\\\"token function-variable function\\\">edit</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\"><span class=\\\"token punctuation\\\">{</span> attributes<span class=\\\"token punctuation\\\">,</span> setAttributes <span class=\\\"token punctuation\\\">}</span></span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token comment\\\">// ...</span>\\n    <span class=\\\"token function\\\">useEffect</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token function\\\">subscribe</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token keyword\\\">let</span> baseSettings <span class=\\\"token operator\\\">=</span> wp<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">data</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">select</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'wp-typeit/store'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getSettings</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">[</span>instanceId<span class=\\\"token punctuation\\\">]</span>\\n\\n        <span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token known-class-name class-name\\\">JSON</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">stringify</span><span class=\\\"token punctuation\\\">(</span>baseSettings<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">!==</span> <span class=\\\"token known-class-name class-name\\\">JSON</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">stringify</span><span class=\\\"token punctuation\\\">(</span>attributes<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">settings</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n          <span class=\\\"token function\\\">setAttributes</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span> <span class=\\\"token literal-property property\\\">settings</span><span class=\\\"token operator\\\">:</span> baseSettings <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n        <span class=\\\"token punctuation\\\">}</span>\\n      <span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span> <span class=\\\"token comment\\\">// &#x3C;-- Only set up listener on `mount`.</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p>This <em>looked</em> pretty safe. But when a global store change occurred, an infinite loop was set off within the component. I soon realized that the <code>setAttributes</code> method provided by Gutenberg triggered <em>another</em> store change (I don’t yet know why). Unexpected, but it still shouldn’t be a problem. After all, the next time the listener fires, my global settings <em>should</em> exactly match my local attributes, preventing the <code>setAttributes</code> method from being called again.</p>\\n<p>But that was apparently incorrect. As it turned out, within that <code>subscribe</code> listener, <em>my local state wasnt’t getting updated at all.</em> And so every time the listener fired, that equality check would fail every time, over and over again. Infinite loop.</p>\\n<h2>Remember, This Is React</h2>\\n<p>It took a bit, but the solution to this problem arose after remembering how React handles updates to its state. Every time a component’s state (including props) is changed, that component is re-rendered, and it’s only <em>after</em> that rerender when the updated state (including props) is available.</p>\\n<p>But my <code>subscribe</code> listener wasn’t respecting that. It was being activated <em>once</em> after the component mounted, and so it was only aware of the version of the props it had at that specific time. I could call <code>setAttributes</code> all I wanted, but that specific listener instance would behave as if nothing happened at all.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token function\\\">useEffect</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token function\\\">subscribe</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token comment\\\">// Listener is created ONCE, and never aware of future state updates.</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<h2>The Solution: Clean Up Store Listeners</h2>\\n<p>In order to perform future store comparisons after my local state was updated, <strong>I needed to throw away my</strong> <strong><code>subscribe</code></strong> <strong>listener every time a local state change occurred</strong>. With my specific circumstances, that meant a few tweaks:</p>\\n<ol>\\n<li><strong>Extract the</strong> <strong><code>unsubscribe</code></strong> <strong>method</strong> returned <a href=\\\"https://redux.js.org/api/store#subscribelistener\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">when a subscribe listener is created</a>.</li>\\n<li><strong>Unsubscribe immediately before the</strong> <strong><code>setAttributes</code></strong> <strong>method fires.</strong> Since <code>setAttributes</code> triggers a global store change, this unplugs the listener to prevent it from firing before the local state is technically updated.</li>\\n<li><strong>Instead of setting up a single listener on</strong> <strong><code>mount</code>****, do so</strong> <em><strong>every time</strong></em> <strong>the block is updated.</strong> To avoid listeners becoming stacked upon listeners, I’m using the <a href=\\\"https://reactjs.org/docs/hooks-effect.html#example-using-hooks-1\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">cleanup mechanism</a> built into the <code>useEffect</code> hook by returning from the hook with an <code>unsubscribe()</code> method call. Even though I’m already unsubscribing every time I call <code>setAttributes</code>, this will cover my butt any time a different state change occurs, totally unrelated to these settings. The objective is to never have more than one store listener active in the component at once, and this helps guarantee that.</li>\\n</ol>\\n<p>In all, those changes look like this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-diff\\\"><code class=\\\"language-diff\\\">const { useEffect } = wp.element;\\nconst { subscribe } = wp.data;\\n\\nregisterBlockType('wp-typeit/block', {\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> // ...</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> edit: ({ attributes, setAttributes}) => {</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   useEffect(() => {</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">     // ...</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token deleted-sign deleted\\\"><span class=\\\"token prefix deleted\\\">-</span><span class=\\\"token line\\\">     subscribe(() => {</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">     const unsubscribe = subscribe(() => {</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">       let baseSettings = wp.data.select('wp-typeit/store').getSettings()[instanceId]</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">       if (JSON.stringify(baseSettings) !== JSON.stringify(attributes.settings)) {</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">         unsubscribe();</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">         setAttributes({ settings: baseSettings });</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">       }</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">     }</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">      return () => {</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">        unsubscribe(); &#x3C;!-- Destroy listener after every state change.</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">      }</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token deleted-sign deleted\\\"><span class=\\\"token prefix deleted\\\">-</span><span class=\\\"token line\\\">    }, []);</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">    }); // &#x3C;!-- Activate new listener after every state change.</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\"> }</span>\\n<span class=\\\"token line\\\"></span></span>}\\n</code></pre></div>\\n<h2>Takeaway: Understand the React Lifecycle</h2>\\n<p>While this particular problem is highly specific to WordPress/Gutenberg, it all illustrates how important it is to have a solid understanding of the React lifecycle and the gotchas that it makes possible by nature. In fact, it’s probably a good practice to <em>start</em> troubleshooting bugs like this by rubber ducking the events leading up to and following the undesired behavior that’s occurring. If it’s anything like the challege I’ve shared here, you’ll walk away with a better understanding of how React fundamentally works, as well as confirmation that you’re not actually going insane.</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 35,
        "title": "Streamlining Conditional Statements with Logical Operators",
        "slug": "streamlining-conditional-statements-with-logical-operators",
        "html": "<p>I’ve been seeing my preference change in how I write simple conditional statements in JavaScript. Consider the following:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>snack<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n\t<span class=\"token function\">eat</span><span class=\"token punctuation\">(</span>snack<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Back in the day, that’s how just about every “if I have this, then do this” statement looked. As complexity and context changed, I might have pivoted a bit, but for the most part, this was the go-to pattern. And for good reason – it’s clear and easy to translate into spoken vernacular:</p>\n<div class=\"remark-highlight\"><pre class=\"language-text\"><code class=\"language-text\">If I have a snack, then eat it.</code></pre></div>\n<h2>Early Return Gets the Worm</h2>\n<p>Then, I started to shift toward preferring the early return:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>snack<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n\t<span class=\"token keyword control-flow\">return</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">cat</span><span class=\"token punctuation\">(</span>snack<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Not having to nest the meat of my code in an <code>if/else</code> block felt simpler. Do a quick check, and if you’re not qualified to be here, don’t bother running anything else. Just get outta the way.</p>\n<p>My hunch is that once fluency with the semantics of the language became stronger, my brain naturally began to style the code in light of how it’s <em>read as code</em>, rather than <em>spoken as English.</em> And for whatever reason, the flow of an early return was cognitively easier to grasp, particularly as the complexity of the method potentially grew.</p>\n<p>This becomes clearer with a more complex example. Something like this is totally fine:</p>\n<h3>Before Early Returns</h3>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> greeting<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isFamily</span><span class=\"token punctuation\">(</span>person<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  greeting <span class=\"token operator\">=</span> <span class=\"token string\">\"hug\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isBuddy</span><span class=\"token punctuation\">(</span>person<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  greeting <span class=\"token operator\">=</span> <span class=\"token string\">\"high five\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n  greeting <span class=\"token operator\">=</span> <span class=\"token string\">\"handshake\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword control-flow\">return</span> greeting<span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>But it feels stringy and a little more difficult to read than something like this:</p>\n<h3>After Early Returns</h3>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isFamily</span><span class=\"token punctuation\">(</span>person<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token string\">\"hug\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isBuddy</span><span class=\"token punctuation\">(</span>person<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token string\">\"high five\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword control-flow\">return</span> <span class=\"token string\">\"handshake\"</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>What’s interesting here is that while it’s easier to read <em>as code</em>, it’s not at all <em>how people speak</em>. As the semantics become more second nature, the oral flow of the code seems to become less of a concern.</p>\n<h2>Along Came Short-Circuiting</h2>\n<p>Soon enough, my preference changed again. This time, toward leveraging <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Logical_Operators\" target=\"_blank\" rel=\"noopener\">logical operators</a> for simple expressions.</p>\n<p>After executing one side of the <code>&#x26;&#x26;</code> or <code>||</code> operators, JavaScript will <em>short-circuit</em> if it’s logically unnecessary to run the remaining expression(s), returning the value of the last expression that was evaluated. You’ve probably seen short-circuiting used with the <code>||</code> operator when setting fallback values for variables.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> myVar <span class=\"token operator\">=</span> <span class=\"token string\">\"left side\"</span> <span class=\"token operator\">||</span> <span class=\"token string\">\"right side\"</span><span class=\"token punctuation\">;</span> \n<span class=\"token comment\">// evaluates to \"left side\"</span>\n\n<span class=\"token keyword\">const</span> myOtherVar <span class=\"token operator\">=</span> <span class=\"token keyword null nil\">null</span> <span class=\"token operator\">||</span> <span class=\"token string\">\"not null at all\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// evaulates to \"not null at all\"</span>\n</code></pre></div>\n<p>This tactic is cleaner than using a ternary, and far more elegant than an <code>if/else</code> block.</p>\n<h3>Good: <code>If/Then</code> Block</h3>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> myVar<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>otherVal<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  myVar <span class=\"token operator\">=</span> otherVal<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n  myVar <span class=\"token operator\">=</span> <span class=\"token string\">\"fallback\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h3>Better: Ternary</h3>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> myVar <span class=\"token operator\">=</span> otherVal <span class=\"token operator\">?</span> otherVal <span class=\"token operator\">:</span> <span class=\"token string\">\"fallback\"</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h3>Best: Logical Operator</h3>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> myVar <span class=\"token operator\">=</span> otherVal <span class=\"token operator\">||</span> <span class=\"token string\">\"fallback\"</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Similarly, the <code>&#x26;&#x26;</code> operator continues to evaluate as long as the previous value is <code>truthy</code>, returning the last evaluated expression.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> myVar <span class=\"token operator\">=</span> <span class=\"token string\">\"left side\"</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token string\">\"right side\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// evaluates to \"right side\"</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">func</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token string\">\"a string\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> myVar <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token function\">func</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// evaluates to \"\"</span>\n</code></pre></div>\n<h3>A Simple Short-Circuited Conditional</h3>\n<p>And that makes for some succinct conditional statements, allowing you to abandon the <code>if/else</code> block altogether. As long as the first expression is <code>truthy</code>, the next will be evaluated as well.</p>\n<h3>Before: <code>If/Then</code> Block</h3>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>snack<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n\t<span class=\"token function\">eat</span><span class=\"token punctuation\">(</span>snack<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h3>After: Logical Operator</h3>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\">snack <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token function\">eat</span><span class=\"token punctuation\">(</span>snack<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h3>A Slightly More Intense Example</h3>\n<p>For something a little more involved, let’s say you wanted to attempt a chain of actions only until one is successful, storing that value in a variable. And if none is successful, fall back to a default value. It’s possible to pull this off using the same sort of <code>if/else</code> block, dealing with the stringy nature of the flow.</p>\n<h3>Option #1: <code>If/Else</code> Block</h3>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> firstTruthyReturnValue<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">tryIt</span><span class=\"token punctuation\">(</span>var1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  firstTruthyReturnValue <span class=\"token operator\">=</span> <span class=\"token function\">tryIt</span><span class=\"token punctuation\">(</span>var1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">tryIt</span><span class=\"token punctuation\">(</span>var2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  firstTruthyReturnValue <span class=\"token operator\">=</span> <span class=\"token function\">tryIt</span><span class=\"token punctuation\">(</span>var2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">tryIt</span><span class=\"token punctuation\">(</span>var3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  firstTruthyReturnValue <span class=\"token operator\">=</span> <span class=\"token function\">tryIt</span><span class=\"token punctuation\">(</span>var3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">else</span> <span class=\"token punctuation\">{</span>\n  firstTruthyReturnValue <span class=\"token operator\">=</span> <span class=\"token string\">\"default value\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Or, for a more modern approach, you could use <code>Array.prototype.find()</code> to <em>find</em> that value. It’s a bit more elegant, but requires that you also handle the default value a bit more explicitly than you might have hoped.</p>\n<h3>Option #2: <code>Array.prototype.find()</code></h3>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> possibilities <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>val1<span class=\"token punctuation\">,</span> val2<span class=\"token punctuation\">,</span> val3<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> firstTruthyReturnValue <span class=\"token operator\">=</span> possibilities<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">val</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token function\">tryIt</span><span class=\"token punctuation\">(</span>val<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nfirstTruthyReturnValue <span class=\"token operator\">=</span> firstTruthyReturnValue <span class=\"token operator\">===</span> <span class=\"token keyword nil\">undefined</span> \n\t<span class=\"token operator\">?</span> <span class=\"token string\">\"default\"</span> \n\t<span class=\"token operator\">:</span> firstTruthyReturnValue<span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>But by using a logical operator, all that mess can be pulled together more elegantly, while preserving the ability set a default value.</p>\n<h3>Option #3: Logical Operators</h3>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> firstTruthyReturnValue <span class=\"token operator\">=</span>\n  <span class=\"token function\">tryIt</span><span class=\"token punctuation\">(</span>var1<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token function\">tryIt</span><span class=\"token punctuation\">(</span>var2<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token function\">tryIt</span><span class=\"token punctuation\">(</span>var3<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token string\">\"default value\"</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h2>Possible Objections</h2>\n<p>There may be some purists out there who insist on strictly using the <code>if/else</code> block, switch statement, and ternary for their conditionals. That’s fine – I’m only documenting my personal progression of preference to date.</p>\n<p>There are also those who probably say this approach makes the code less readable. I empathize with that. It takes a second to get your brain to reliably parse conditionals written in this way especially when it’s so far removed from how people speak.</p>\n<p>But that’s not a deterrent for me, maybe for the same reason many favor the early return, or even those who are good with using the <code>||</code> operator to set fallback values for variables. Once you get used to the semantics, the gained elegance might hook you for life.</p>\n<p>Or, you might yet again change your preference a few months down the road, which is entirely possible for me.</p>\n",
        "feature_image": "",
        "status": "published",
        "created_at": 1583730000000,
        "published_at": 1583730000000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>I’ve been seeing my preference change in how I write simple conditional statements in JavaScript. Consider the following:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span>snack<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>  \\n\\t<span class=\\\"token function\\\">eat</span><span class=\\\"token punctuation\\\">(</span>snack<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p>Back in the day, that’s how just about every “if I have this, then do this” statement looked. As complexity and context changed, I might have pivoted a bit, but for the most part, this was the go-to pattern. And for good reason – it’s clear and easy to translate into spoken vernacular:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">If I have a snack, then eat it.</code></pre></div>\\n<h2>Early Return Gets the Worm</h2>\\n<p>Then, I started to shift toward preferring the early return:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>snack<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>  \\n\\t<span class=\\\"token keyword control-flow\\\">return</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token function\\\">cat</span><span class=\\\"token punctuation\\\">(</span>snack<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>Not having to nest the meat of my code in an <code>if/else</code> block felt simpler. Do a quick check, and if you’re not qualified to be here, don’t bother running anything else. Just get outta the way.</p>\\n<p>My hunch is that once fluency with the semantics of the language became stronger, my brain naturally began to style the code in light of how it’s <em>read as code</em>, rather than <em>spoken as English.</em> And for whatever reason, the flow of an early return was cognitively easier to grasp, particularly as the complexity of the method potentially grew.</p>\\n<p>This becomes clearer with a more complex example. Something like this is totally fine:</p>\\n<h3>Before Early Returns</h3>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">let</span> greeting<span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token function\\\">isFamily</span><span class=\\\"token punctuation\\\">(</span>person<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  greeting <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"hug\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword control-flow\\\">else</span> <span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token function\\\">isBuddy</span><span class=\\\"token punctuation\\\">(</span>person<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  greeting <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"high five\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword control-flow\\\">else</span> <span class=\\\"token punctuation\\\">{</span>\\n  greeting <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"handshake\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token keyword control-flow\\\">return</span> greeting<span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>But it feels stringy and a little more difficult to read than something like this:</p>\\n<h3>After Early Returns</h3>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token function\\\">isFamily</span><span class=\\\"token punctuation\\\">(</span>person<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token string\\\">\\\"hug\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token function\\\">isBuddy</span><span class=\\\"token punctuation\\\">(</span>person<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token string\\\">\\\"high five\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token string\\\">\\\"handshake\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>What’s interesting here is that while it’s easier to read <em>as code</em>, it’s not at all <em>how people speak</em>. As the semantics become more second nature, the oral flow of the code seems to become less of a concern.</p>\\n<h2>Along Came Short-Circuiting</h2>\\n<p>Soon enough, my preference changed again. This time, toward leveraging <a href=\\\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Logical_Operators\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">logical operators</a> for simple expressions.</p>\\n<p>After executing one side of the <code>&#x26;&#x26;</code> or <code>||</code> operators, JavaScript will <em>short-circuit</em> if it’s logically unnecessary to run the remaining expression(s), returning the value of the last expression that was evaluated. You’ve probably seen short-circuiting used with the <code>||</code> operator when setting fallback values for variables.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> myVar <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"left side\\\"</span> <span class=\\\"token operator\\\">||</span> <span class=\\\"token string\\\">\\\"right side\\\"</span><span class=\\\"token punctuation\\\">;</span> \\n<span class=\\\"token comment\\\">// evaluates to \\\"left side\\\"</span>\\n\\n<span class=\\\"token keyword\\\">const</span> myOtherVar <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword null nil\\\">null</span> <span class=\\\"token operator\\\">||</span> <span class=\\\"token string\\\">\\\"not null at all\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token comment\\\">// evaulates to \\\"not null at all\\\"</span>\\n</code></pre></div>\\n<p>This tactic is cleaner than using a ternary, and far more elegant than an <code>if/else</code> block.</p>\\n<h3>Good: <code>If/Then</code> Block</h3>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">let</span> myVar<span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span>otherVal<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  myVar <span class=\\\"token operator\\\">=</span> otherVal<span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword control-flow\\\">else</span> <span class=\\\"token punctuation\\\">{</span>\\n  myVar <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"fallback\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<h3>Better: Ternary</h3>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">let</span> myVar <span class=\\\"token operator\\\">=</span> otherVal <span class=\\\"token operator\\\">?</span> otherVal <span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"fallback\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<h3>Best: Logical Operator</h3>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">let</span> myVar <span class=\\\"token operator\\\">=</span> otherVal <span class=\\\"token operator\\\">||</span> <span class=\\\"token string\\\">\\\"fallback\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>Similarly, the <code>&#x26;&#x26;</code> operator continues to evaluate as long as the previous value is <code>truthy</code>, returning the last evaluated expression.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> myVar <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"left side\\\"</span> <span class=\\\"token operator\\\">&#x26;&#x26;</span> <span class=\\\"token string\\\">\\\"right side\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token comment\\\">// evaluates to \\\"right side\\\"</span>\\n\\n<span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">func</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token string\\\">\\\"a string\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">const</span> myVar <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"\\\"</span> <span class=\\\"token operator\\\">&#x26;&#x26;</span> <span class=\\\"token function\\\">func</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token comment\\\">// evaluates to \\\"\\\"</span>\\n</code></pre></div>\\n<h3>A Simple Short-Circuited Conditional</h3>\\n<p>And that makes for some succinct conditional statements, allowing you to abandon the <code>if/else</code> block altogether. As long as the first expression is <code>truthy</code>, the next will be evaluated as well.</p>\\n<h3>Before: <code>If/Then</code> Block</h3>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span>snack<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>  \\n\\t<span class=\\\"token function\\\">eat</span><span class=\\\"token punctuation\\\">(</span>snack<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<h3>After: Logical Operator</h3>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\">snack <span class=\\\"token operator\\\">&#x26;&#x26;</span> <span class=\\\"token function\\\">eat</span><span class=\\\"token punctuation\\\">(</span>snack<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<h3>A Slightly More Intense Example</h3>\\n<p>For something a little more involved, let’s say you wanted to attempt a chain of actions only until one is successful, storing that value in a variable. And if none is successful, fall back to a default value. It’s possible to pull this off using the same sort of <code>if/else</code> block, dealing with the stringy nature of the flow.</p>\\n<h3>Option #1: <code>If/Else</code> Block</h3>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">let</span> firstTruthyReturnValue<span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token function\\\">tryIt</span><span class=\\\"token punctuation\\\">(</span>var1<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  firstTruthyReturnValue <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">tryIt</span><span class=\\\"token punctuation\\\">(</span>var1<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword control-flow\\\">else</span> <span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token function\\\">tryIt</span><span class=\\\"token punctuation\\\">(</span>var2<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  firstTruthyReturnValue <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">tryIt</span><span class=\\\"token punctuation\\\">(</span>var2<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword control-flow\\\">else</span> <span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token function\\\">tryIt</span><span class=\\\"token punctuation\\\">(</span>var3<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  firstTruthyReturnValue <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">tryIt</span><span class=\\\"token punctuation\\\">(</span>var3<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword control-flow\\\">else</span> <span class=\\\"token punctuation\\\">{</span>\\n  firstTruthyReturnValue <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"default value\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p>Or, for a more modern approach, you could use <code>Array.prototype.find()</code> to <em>find</em> that value. It’s a bit more elegant, but requires that you also handle the default value a bit more explicitly than you might have hoped.</p>\\n<h3>Option #2: <code>Array.prototype.find()</code></h3>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> possibilities <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">[</span>val1<span class=\\\"token punctuation\\\">,</span> val2<span class=\\\"token punctuation\\\">,</span> val3<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">let</span> firstTruthyReturnValue <span class=\\\"token operator\\\">=</span> possibilities<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">find</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">val</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token function\\\">tryIt</span><span class=\\\"token punctuation\\\">(</span>val<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\nfirstTruthyReturnValue <span class=\\\"token operator\\\">=</span> firstTruthyReturnValue <span class=\\\"token operator\\\">===</span> <span class=\\\"token keyword nil\\\">undefined</span> \\n\\t<span class=\\\"token operator\\\">?</span> <span class=\\\"token string\\\">\\\"default\\\"</span> \\n\\t<span class=\\\"token operator\\\">:</span> firstTruthyReturnValue<span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>But by using a logical operator, all that mess can be pulled together more elegantly, while preserving the ability set a default value.</p>\\n<h3>Option #3: Logical Operators</h3>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">let</span> firstTruthyReturnValue <span class=\\\"token operator\\\">=</span>\\n  <span class=\\\"token function\\\">tryIt</span><span class=\\\"token punctuation\\\">(</span>var1<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">||</span> <span class=\\\"token function\\\">tryIt</span><span class=\\\"token punctuation\\\">(</span>var2<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">||</span> <span class=\\\"token function\\\">tryIt</span><span class=\\\"token punctuation\\\">(</span>var3<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">||</span> <span class=\\\"token string\\\">\\\"default value\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<h2>Possible Objections</h2>\\n<p>There may be some purists out there who insist on strictly using the <code>if/else</code> block, switch statement, and ternary for their conditionals. That’s fine – I’m only documenting my personal progression of preference to date.</p>\\n<p>There are also those who probably say this approach makes the code less readable. I empathize with that. It takes a second to get your brain to reliably parse conditionals written in this way especially when it’s so far removed from how people speak.</p>\\n<p>But that’s not a deterrent for me, maybe for the same reason many favor the early return, or even those who are good with using the <code>||</code> operator to set fallback values for variables. Once you get used to the semantics, the gained elegance might hook you for life.</p>\\n<p>Or, you might yet again change your preference a few months down the road, which is entirely possible for me.</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 36,
        "title": "If Democratic Candidates were JavaScript Packages",
        "slug": "if-democratic-candidates-were-javascript-packages",
        "html": "<p><strong>BernieSanders.js</strong> - a helper library for making next-generation punch card programs for the browser.</p>\n<p><strong>ElizabethWarren.js</strong> - a probability and statistics library widely used in reservation casinos.</p>\n<p><strong>AmyKlobuchar.js</strong> - a highly opinionated alternative to ESLint, providing harsher, more demanding errors (no warnings).</p>\n<p><strong>JoeBiden.js</strong> - a battle-tested framework for building RPG games for the browser, featuring an API just as approachable to junior devs <a href=\"https://t.co/ReXr7Njg53?amp=1\" target=\"_blank\" rel=\"noopener\">as white devs.</a></p>\n<p><strong>PeteButtigieg.js</strong> - not really sure what it does or when to use it, but it’s popular up in South Bend.</p>\n<p><strong>AndrewYang.js</strong> - an inline podcast audio player that will literally pay you to use it.</p>\n<p><strong>TulsiGabbard.js</strong> - Russian asset bundler.</p>\n<p><strong>MikeBloomberg.js</strong> - a financial charting library embracing many of the exciting new features available in Netscape Navigator.</p>\n<p>Got one I missed? <a href=\"https://github.com/alexmacarthur/macarthur-me/blob/master/src/posts/2020-01-19-if-democratic-candidates-were-javascript-packages.md\" target=\"_blank\" rel=\"noopener\">Make a pull request</a> with your addition followed by “(contributed by Your Name)”, and I might include it.</p>\n",
        "feature_image": "",
        "status": "published",
        "created_at": 1579410000000,
        "published_at": 1579410000000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p><strong>BernieSanders.js</strong> - a helper library for making next-generation punch card programs for the browser.</p>\\n<p><strong>ElizabethWarren.js</strong> - a probability and statistics library widely used in reservation casinos.</p>\\n<p><strong>AmyKlobuchar.js</strong> - a highly opinionated alternative to ESLint, providing harsher, more demanding errors (no warnings).</p>\\n<p><strong>JoeBiden.js</strong> - a battle-tested framework for building RPG games for the browser, featuring an API just as approachable to junior devs <a href=\\\"https://t.co/ReXr7Njg53?amp=1\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">as white devs.</a></p>\\n<p><strong>PeteButtigieg.js</strong> - not really sure what it does or when to use it, but it’s popular up in South Bend.</p>\\n<p><strong>AndrewYang.js</strong> - an inline podcast audio player that will literally pay you to use it.</p>\\n<p><strong>TulsiGabbard.js</strong> - Russian asset bundler.</p>\\n<p><strong>MikeBloomberg.js</strong> - a financial charting library embracing many of the exciting new features available in Netscape Navigator.</p>\\n<p>Got one I missed? <a href=\\\"https://github.com/alexmacarthur/macarthur-me/blob/master/src/posts/2020-01-19-if-democratic-candidates-were-javascript-packages.md\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Make a pull request</a> with your addition followed by “(contributed by Your Name)”, and I might include it.</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 37,
        "title": "A Plot Proposal for Frozen III",
        "slug": "frozen-three-plot-proposal",
        "html": "<p>Kristoff, seeking a career more marketable than being an iceman, enrolls in a coding bootcamp in the Southern Isles, where a bitter and vengeful Prince Hans has been forced by his brothers to maintain a legacy Backbone application.</p>\n<p>Faking a change of heart, Hans befriends Kristoff, hoping to leverage his connection to Arendelle’s icing industry in order to exact revenge on the kingdom. It works, and Hans convinces Kristoff to hire him to rebuild the ice delivery e-commerce platform.</p>\n<p>Hans’ software exploits a performance vulnerability in Chromium browsers (used by the vast majority of the kingdom), causing every machine to get real hot every time a purchase is made.</p>\n<p>Soon enough, the kingdom’s climate begins to get dangerously warm, feeding a vicious cycle: ordering more ice causes the kingdom to get warmer, which causes people to order more ice, and so on.</p>\n<p>Elsa, Anna, and the gang embark on a mission to convince all of Arendelle to switch to Firefox.</p>\n",
        "feature_image": "https://images.pexels.com/photos/326240/pexels-photo-326240.jpeg?cs=srgb&amp;dl=full-frame-shot-of-snowflakes-326240.jpg&amp;fm=jpg",
        "status": "published",
        "created_at": 1577509200000,
        "published_at": 1577509200000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>Kristoff, seeking a career more marketable than being an iceman, enrolls in a coding bootcamp in the Southern Isles, where a bitter and vengeful Prince Hans has been forced by his brothers to maintain a legacy Backbone application.</p>\\n<p>Faking a change of heart, Hans befriends Kristoff, hoping to leverage his connection to Arendelle’s icing industry in order to exact revenge on the kingdom. It works, and Hans convinces Kristoff to hire him to rebuild the ice delivery e-commerce platform.</p>\\n<p>Hans’ software exploits a performance vulnerability in Chromium browsers (used by the vast majority of the kingdom), causing every machine to get real hot every time a purchase is made.</p>\\n<p>Soon enough, the kingdom’s climate begins to get dangerously warm, feeding a vicious cycle: ordering more ice causes the kingdom to get warmer, which causes people to order more ice, and so on.</p>\\n<p>Elsa, Anna, and the gang embark on a mission to convince all of Arendelle to switch to Firefox.</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 38,
        "title": "For the Sake of Your Event Listeners, Use Web Workers",
        "slug": "use-web-workers-for-your-event-listeners",
        "html": "<p>I’ve been tinkering with the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers\" target=\"_blank\" rel=\"noopener\">Web Worker API</a> lately, and as a result, I’m really feeling the guilt of not looking into this well-supported tool a lot sooner. Modern web applications are seriously upping demands on the browser’s main thread, impacting performance and the ability to deliver smooth user experiences. This tool is just one way to address the challenge.</p>\n<h2>Where Things on(‘click’)ed for Me</h2>\n<p>The advantages of Web Workers are many, but things really clicked for me when it came to the several DOM event listeners in any given application (form submissions, window resizes, button clicks, etc.) These all necessarily live on the browser’s main thread, and if that thread is congested by a long-running process, the responsiveness of those listeners begins to suffer, stalling the entire application until the event loop is free to continue firing.</p>\n<p>Admittedly, the reason listeners stick out to me so much is due to my initial misunderstanding about the problems Workers are meant to solve. At first, I thought it was mainly about the <em>speed</em> of my code execution, start to finish. “If I can do more on separate threads in parallel, my code will execute so much more quickly!” But! It’s pretty common to <em>need</em> to wait for one thing to happen before another can start, like when you don’t want to update the DOM until some sort of calculation has taken place. “If I’m gonna have to wait anyway, I don’t see the point of moving something into a separate thread,” naive me thought.</p>\n<p>Here’s the type of code that came to mind:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> calculateResultsButton <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">\"calculateResultsButton\"</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> openMenuButton <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#openMenuButton\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> resultBox <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"resultBox\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\ncalculateResultsButton<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// \"Why put this into a Worker when I</span>\n  <span class=\"token comment\">// can't update the DOM until it's done anyway?\"</span>\n  <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token function\">performLongRunningCalculation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  resultBox<span class=\"token punctuation\">.</span><span class=\"token property-access\">innerText</span> <span class=\"token operator\">=</span> result<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nopenMenuButton<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Do stuff to open menu.</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Here, I update the text of a box after performing some sort of presumably heavy calculation. Doing these things in parallel would be pointless (the DOM update necessarily depends on the calculation), so <em>of course</em> I want everything to be synchronous. What I didn’t initially understand was that <strong>none of the</strong> <em><strong>other</strong></em> <strong>listeners can fire if the thread is blocked</strong>. Meaning: things get janky.</p>\n<h2>The Jank, Illustrated</h2>\n<p>In the example below, clicking “Freeze” will kick off a synchronous pause for three seconds (simulating a long-running calculation) before incrementing the click count, and the “Increment” button will increment that count immediately. During the first button’s pause, the whole thread is at a standstill, preventing <em>any</em> other main thread activities from firing until the event loop can turn over again.</p>\n<p>To witness this, click the first button and immediately click the second.</p>\n<p><a href=\"https://codepen.io/alexmacarthur/pen/XWWKyGe\" target=\"_blank\" rel=\"noopener\">https://codepen.io/alexmacarthur/pen/XWWKyGe</a></p>\n<p>Frozen, because that long, synchronous pause is blocking the thread. And the impact goes beyond that. Do it again, but this time, immediately try to resize the blue-bordered box after clicking “Freeze.” Since the main thread is also where all layout changes and repainting occur, you’re yet again stuck until the timer is complete.</p>\n<h2>They’re Listening More Than You Think</h2>\n<p>Any normal user would be annoyed to have to deal with an experience like this – and we were only dealing with a couple of event listeners. In the real world, though, there’s a lot more going on. Using Chrome’s <code>getEventListeners</code> method, I used the following script to take a tally of all event listeners attached to every DOM element on a page. Drop it into the inspector, and it’ll spit back a total.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">[</span><span class=\"token dom variable\">document</span><span class=\"token punctuation\">,</span> <span class=\"token spread operator\">...</span><span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"*\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">accumulator<span class=\"token punctuation\">,</span> node</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> listeners <span class=\"token operator\">=</span> <span class=\"token function\">getEventListeners</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> property <span class=\"token keyword\">in</span> listeners<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    accumulator <span class=\"token operator\">=</span> accumulator <span class=\"token operator\">+</span> listeners<span class=\"token punctuation\">[</span>property<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword control-flow\">return</span> accumulator<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>I ran it on an arbitrary page within each of the following applications to get a quick count of the active listeners.</p>\n<table>\n<thead>\n<tr>\n<th>Application</th>\n<th>Number of Listeners</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Dropbox</td>\n<td>602</td>\n</tr>\n<tr>\n<td>Google Messages</td>\n<td>581</td>\n</tr>\n<tr>\n<td>Reddit</td>\n<td>692</td>\n</tr>\n<tr>\n<td>YouTube</td>\n<td>6,054 (!!!)</td>\n</tr>\n</tbody>\n</table>\n<p>Pay little attention to the specific numbers. The point is that the numbers are big, and <strong>if even a single long-running process in your application goes awry,</strong> <em><strong>all</strong></em> <strong>of these listeners will be unresponsive.</strong> That’s a lot of opportunity to frustrate your users.</p>\n<h2>Same Illustration, but Less Jank (Thx, Web Workers!)</h2>\n<p>With all that in mind, let’s upgrade the example from before. Same idea, but this time, that long-running operation has been moved into its own thread. Performing the same clicks again, you’ll see that clicking “Freeze” still delays the click count from being updated for 3 seconds, but it <em>doesn’t block any other event listeners on the page</em>. Instead, other buttons still click and boxes still resize, which is exactly what we want.</p>\n<p><a href=\"https://codepen.io/alexmacarthur/pen/qBEORdO\" target=\"_blank\" rel=\"noopener\">https://codepen.io/alexmacarthur/pen/qBEORdO</a></p>\n<p>If you dig into that code a bit, you’ll notice that while the Web Worker API could be a little more ergonomic, it really isn’t as scary as you might expect (a lot of that scariness is due to the way I quickly threw the example together). And to make things even <em>less</em> scary, there are some good tools out there to ease their implementation. Here are a few that caught my eye:</p>\n<ul>\n<li><a href=\"https://github.com/developit/workerize\" target=\"_blank\" rel=\"noopener\">workerize</a> – run a module inside a Web Worker</li>\n<li><a href=\"https://github.com/developit/greenlet\" target=\"_blank\" rel=\"noopener\">greenlet</a> – run an arbitrary piece of async code inside a worker</li>\n<li><a href=\"https://github.com/GoogleChromeLabs/comlink\" target=\"_blank\" rel=\"noopener\">comlink</a> – a friendly layer of abstraction over the Web Worker API</li>\n</ul>\n<h2>Start Threadin’ (Where It Makes Sense)</h2>\n<p>If your application is typical, it probably has a lot of listenin’ going on. And it also probably does a lot of computing that just doesn’t need to happen on the main thread. So, do these listeners and your users a favor by considering where it makes sense to employ Web Workers.</p>\n<p>To be clear, going all-in and throwing literally <em>all</em> non-UI work into worker threads is probably the wrong approach. You might just be introducing a lot of refactoring &#x26; complexity to your app for little gain. Instead, maybe start by identifying notably intense processes and spin up a small Web Worker for them. Over time, it could make sense to stick your feet in a little deeper and rethink your UI/Worker architecture more at a wider scale.</p>\n<p>Whatever the case, dig into it. With their solid browser support and the growing performance demands of modern applications, we’re running out of reasons to not invest in tools like this.</p>\n<p>Happy threadin’!</p>\n",
        "feature_image": "",
        "status": "published",
        "created_at": 1573880400000,
        "published_at": 1573880400000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>I’ve been tinkering with the <a href=\\\"https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Web Worker API</a> lately, and as a result, I’m really feeling the guilt of not looking into this well-supported tool a lot sooner. Modern web applications are seriously upping demands on the browser’s main thread, impacting performance and the ability to deliver smooth user experiences. This tool is just one way to address the challenge.</p>\\n<h2>Where Things on(‘click’)ed for Me</h2>\\n<p>The advantages of Web Workers are many, but things really clicked for me when it came to the several DOM event listeners in any given application (form submissions, window resizes, button clicks, etc.) These all necessarily live on the browser’s main thread, and if that thread is congested by a long-running process, the responsiveness of those listeners begins to suffer, stalling the entire application until the event loop is free to continue firing.</p>\\n<p>Admittedly, the reason listeners stick out to me so much is due to my initial misunderstanding about the problems Workers are meant to solve. At first, I thought it was mainly about the <em>speed</em> of my code execution, start to finish. “If I can do more on separate threads in parallel, my code will execute so much more quickly!” But! It’s pretty common to <em>need</em> to wait for one thing to happen before another can start, like when you don’t want to update the DOM until some sort of calculation has taken place. “If I’m gonna have to wait anyway, I don’t see the point of moving something into a separate thread,” naive me thought.</p>\\n<p>Here’s the type of code that came to mind:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> calculateResultsButton <span class=\\\"token operator\\\">=</span> <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getElementById</span><span class=\\\"token punctuation\\\">(</span>\\n  <span class=\\\"token string\\\">\\\"calculateResultsButton\\\"</span>\\n<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">const</span> openMenuButton <span class=\\\"token operator\\\">=</span> <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getElementById</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"#openMenuButton\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">const</span> resultBox <span class=\\\"token operator\\\">=</span> <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getElementById</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"resultBox\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\ncalculateResultsButton<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">addEventListener</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"click\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">e</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token comment\\\">// \\\"Why put this into a Worker when I</span>\\n  <span class=\\\"token comment\\\">// can't update the DOM until it's done anyway?\\\"</span>\\n  <span class=\\\"token keyword\\\">const</span> result <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">performLongRunningCalculation</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  resultBox<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">innerText</span> <span class=\\\"token operator\\\">=</span> result<span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\nopenMenuButton<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">addEventListener</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"click\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">e</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token comment\\\">// Do stuff to open menu.</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>Here, I update the text of a box after performing some sort of presumably heavy calculation. Doing these things in parallel would be pointless (the DOM update necessarily depends on the calculation), so <em>of course</em> I want everything to be synchronous. What I didn’t initially understand was that <strong>none of the</strong> <em><strong>other</strong></em> <strong>listeners can fire if the thread is blocked</strong>. Meaning: things get janky.</p>\\n<h2>The Jank, Illustrated</h2>\\n<p>In the example below, clicking “Freeze” will kick off a synchronous pause for three seconds (simulating a long-running calculation) before incrementing the click count, and the “Increment” button will increment that count immediately. During the first button’s pause, the whole thread is at a standstill, preventing <em>any</em> other main thread activities from firing until the event loop can turn over again.</p>\\n<p>To witness this, click the first button and immediately click the second.</p>\\n<p><a href=\\\"https://codepen.io/alexmacarthur/pen/XWWKyGe\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">https://codepen.io/alexmacarthur/pen/XWWKyGe</a></p>\\n<p>Frozen, because that long, synchronous pause is blocking the thread. And the impact goes beyond that. Do it again, but this time, immediately try to resize the blue-bordered box after clicking “Freeze.” Since the main thread is also where all layout changes and repainting occur, you’re yet again stuck until the timer is complete.</p>\\n<h2>They’re Listening More Than You Think</h2>\\n<p>Any normal user would be annoyed to have to deal with an experience like this – and we were only dealing with a couple of event listeners. In the real world, though, there’s a lot more going on. Using Chrome’s <code>getEventListeners</code> method, I used the following script to take a tally of all event listeners attached to every DOM element on a page. Drop it into the inspector, and it’ll spit back a total.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token punctuation\\\">[</span><span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token spread operator\\\">...</span><span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">querySelectorAll</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"*\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">reduce</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">accumulator<span class=\\\"token punctuation\\\">,</span> node</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">let</span> listeners <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">getEventListeners</span><span class=\\\"token punctuation\\\">(</span>node<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword control-flow\\\">for</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">let</span> property <span class=\\\"token keyword\\\">in</span> listeners<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    accumulator <span class=\\\"token operator\\\">=</span> accumulator <span class=\\\"token operator\\\">+</span> listeners<span class=\\\"token punctuation\\\">[</span>property<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">length</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token keyword control-flow\\\">return</span> accumulator<span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">0</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>I ran it on an arbitrary page within each of the following applications to get a quick count of the active listeners.</p>\\n<table>\\n<thead>\\n<tr>\\n<th>Application</th>\\n<th>Number of Listeners</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td>Dropbox</td>\\n<td>602</td>\\n</tr>\\n<tr>\\n<td>Google Messages</td>\\n<td>581</td>\\n</tr>\\n<tr>\\n<td>Reddit</td>\\n<td>692</td>\\n</tr>\\n<tr>\\n<td>YouTube</td>\\n<td>6,054 (!!!)</td>\\n</tr>\\n</tbody>\\n</table>\\n<p>Pay little attention to the specific numbers. The point is that the numbers are big, and <strong>if even a single long-running process in your application goes awry,</strong> <em><strong>all</strong></em> <strong>of these listeners will be unresponsive.</strong> That’s a lot of opportunity to frustrate your users.</p>\\n<h2>Same Illustration, but Less Jank (Thx, Web Workers!)</h2>\\n<p>With all that in mind, let’s upgrade the example from before. Same idea, but this time, that long-running operation has been moved into its own thread. Performing the same clicks again, you’ll see that clicking “Freeze” still delays the click count from being updated for 3 seconds, but it <em>doesn’t block any other event listeners on the page</em>. Instead, other buttons still click and boxes still resize, which is exactly what we want.</p>\\n<p><a href=\\\"https://codepen.io/alexmacarthur/pen/qBEORdO\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">https://codepen.io/alexmacarthur/pen/qBEORdO</a></p>\\n<p>If you dig into that code a bit, you’ll notice that while the Web Worker API could be a little more ergonomic, it really isn’t as scary as you might expect (a lot of that scariness is due to the way I quickly threw the example together). And to make things even <em>less</em> scary, there are some good tools out there to ease their implementation. Here are a few that caught my eye:</p>\\n<ul>\\n<li><a href=\\\"https://github.com/developit/workerize\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">workerize</a> – run a module inside a Web Worker</li>\\n<li><a href=\\\"https://github.com/developit/greenlet\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">greenlet</a> – run an arbitrary piece of async code inside a worker</li>\\n<li><a href=\\\"https://github.com/GoogleChromeLabs/comlink\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">comlink</a> – a friendly layer of abstraction over the Web Worker API</li>\\n</ul>\\n<h2>Start Threadin’ (Where It Makes Sense)</h2>\\n<p>If your application is typical, it probably has a lot of listenin’ going on. And it also probably does a lot of computing that just doesn’t need to happen on the main thread. So, do these listeners and your users a favor by considering where it makes sense to employ Web Workers.</p>\\n<p>To be clear, going all-in and throwing literally <em>all</em> non-UI work into worker threads is probably the wrong approach. You might just be introducing a lot of refactoring &#x26; complexity to your app for little gain. Instead, maybe start by identifying notably intense processes and spin up a small Web Worker for them. Over time, it could make sense to stick your feet in a little deeper and rethink your UI/Worker architecture more at a wider scale.</p>\\n<p>Whatever the case, dig into it. With their solid browser support and the growing performance demands of modern applications, we’re running out of reasons to not invest in tools like this.</p>\\n<p>Happy threadin’!</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 39,
        "title": "Blog for Your Own Sake",
        "slug": "blog-for-your-own-sake",
        "html": "<p>The front-end development space is exhausting. It moves too fast, contains too much, and it won’t wait for you to catch up. It’s hard. One thing that makes it eaiser is writing about it all — the problem solving, the tinkering with new technologies, the rubber duck attempts to wrap your head around a concept. All of it. I’ve been trying to be more diligent about this, and I’ve seen benefits as a result. Here are some reasons you should do it too:</p>\n<h3>You’ll better understand the solutions that solve your problems.</h3>\n<p>It’s easy to stumble through an implementation that solves a problem and move on. It’s hard to understand why that implementation works in the first place, and what makes it the best choice over something else. If there’s anything that distinguishes a developer from an engineer, it’s this. So, slow down, break it down, and write it down. You’ll find satisfaction in understanding why your code works, and soon enough, you’ll be proactively solving problems before they happen, rather than reactively fixing things after they’re a mess.</p>\n<h3>You’ll become your own resource.</h3>\n<p>It’s startling how often I find myself facing a problem, only to remember that I’ve already solved &#x26; written about something similar in the past. And sometimes, the old post that helps me out has only a thin thread of overlap. When you write, you become a resource for your future self. It’ll save you time (pulling up your own blog post is a lot quicker than a fresh Google search), you’ll get all the credit (instead of some Stack Overflow post), and it’ll make all that writing feel even more worthwhile.</p>\n<h3>You’ll look alive.</h3>\n<p>The old adage is true: <em>Out of (web)site, out of mind.</em> When developers don’t consistently show up and contribute in some way (blogging, open-sourcing, teaching, tweeting, <em>anything else</em>), it’s impossible to be noticed and to build any level of stature in the community. When you write, you get points for showing up, and that’s not a bad thing. Showing up means you care enough to contribute, even if what you contribute is small or useless to almost everyone else. Over time, all that showing up will oddly grow into credibility. This is more than what can be said for the clever genius who keeps their insight to themselves.</p>\n<h2>Don’t Fret It, Ship It</h2>\n<p>Quit worrying about your word count, outline, or humor. Stop caring about your rhetorical prowess so much that you’re too paralyzed to say anything at all. Jot down your jumbled, incoherent thoughts, <em>ship</em> them, and iterate on them later. There’s a thing I saw Chris Coyier tweet out once:</p>\n<blockquote>\n<p>Write the article you wish you found when you googled something.</p>\n</blockquote>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">[October 30, 2017](https://twitter.com/chriscoyier/status/925081793576837120?ref_src=twsrc%5Etfw)</code></pre></div>\n<p>I like that. The stuff you write will probably most benefit people just like you – those who hit the same problems and search for solutions the same way. Your challenges aren’t unique, and that small, choppy post might help someone else cut the corners you had to travel to get to a solution or to understand something. So, blog for your own sake. You’ll be better off for it, and others will be too.</p>\n",
        "feature_image": "",
        "status": "published",
        "created_at": 1573362000000,
        "published_at": 1573362000000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>The front-end development space is exhausting. It moves too fast, contains too much, and it won’t wait for you to catch up. It’s hard. One thing that makes it eaiser is writing about it all — the problem solving, the tinkering with new technologies, the rubber duck attempts to wrap your head around a concept. All of it. I’ve been trying to be more diligent about this, and I’ve seen benefits as a result. Here are some reasons you should do it too:</p>\\n<h3>You’ll better understand the solutions that solve your problems.</h3>\\n<p>It’s easy to stumble through an implementation that solves a problem and move on. It’s hard to understand why that implementation works in the first place, and what makes it the best choice over something else. If there’s anything that distinguishes a developer from an engineer, it’s this. So, slow down, break it down, and write it down. You’ll find satisfaction in understanding why your code works, and soon enough, you’ll be proactively solving problems before they happen, rather than reactively fixing things after they’re a mess.</p>\\n<h3>You’ll become your own resource.</h3>\\n<p>It’s startling how often I find myself facing a problem, only to remember that I’ve already solved &#x26; written about something similar in the past. And sometimes, the old post that helps me out has only a thin thread of overlap. When you write, you become a resource for your future self. It’ll save you time (pulling up your own blog post is a lot quicker than a fresh Google search), you’ll get all the credit (instead of some Stack Overflow post), and it’ll make all that writing feel even more worthwhile.</p>\\n<h3>You’ll look alive.</h3>\\n<p>The old adage is true: <em>Out of (web)site, out of mind.</em> When developers don’t consistently show up and contribute in some way (blogging, open-sourcing, teaching, tweeting, <em>anything else</em>), it’s impossible to be noticed and to build any level of stature in the community. When you write, you get points for showing up, and that’s not a bad thing. Showing up means you care enough to contribute, even if what you contribute is small or useless to almost everyone else. Over time, all that showing up will oddly grow into credibility. This is more than what can be said for the clever genius who keeps their insight to themselves.</p>\\n<h2>Don’t Fret It, Ship It</h2>\\n<p>Quit worrying about your word count, outline, or humor. Stop caring about your rhetorical prowess so much that you’re too paralyzed to say anything at all. Jot down your jumbled, incoherent thoughts, <em>ship</em> them, and iterate on them later. There’s a thing I saw Chris Coyier tweet out once:</p>\\n<blockquote>\\n<p>Write the article you wish you found when you googled something.</p>\\n</blockquote>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-unknown\\\"><code class=\\\"language-unknown\\\">[October 30, 2017](https://twitter.com/chriscoyier/status/925081793576837120?ref_src=twsrc%5Etfw)</code></pre></div>\\n<p>I like that. The stuff you write will probably most benefit people just like you – those who hit the same problems and search for solutions the same way. Your challenges aren’t unique, and that small, choppy post might help someone else cut the corners you had to travel to get to a solution or to understand something. So, blog for your own sake. You’ll be better off for it, and others will be too.</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 40,
        "title": "Building a Shell Function to Copy the Latest Commit SHA",
        "slug": "building-a-shell-function-to-copy-latest-commit-sha",
        "html": "<p>Frequently enough, I find myself needing to copy the SHA of the latest commit in project, and doing it manually was becoming a chore. I’d been getting more comfortable and excited about improving efficiency by rolling custom shell functions (<a href=\"/posts/formatting-my-php-more-efficiently-with-a-bash-function\" target=\"_blank\" rel=\"noopener\">like I wrote about here</a>), and so this felt like a good candidate for another one. After a bit of searching, this was confirmed – very little was out there on someone else building a simple terminal command to do such a thing. So, I went for it.</p>\n<p><strong>Problem:</strong> Copy the SHA of my last commit is clunky and takes time.</p>\n<p><strong>Solution:</strong> Make a shell function that’ll allow me to do it with a simple terminal command.</p>\n<h2>Building the Function</h2>\n<p>Most of the experimentation I did for this was done in a regular shell script on my machine. But to quickly test the script as a terminal command, I copied my iterations inside my <code>~/.zshrc</code> and sourced it with <code>source ~/.zshrc</code>. Over time, this is how those iterations progressed.</p>\n<h3>Iteration #1 :: Stupid Simple</h3>\n<p>Setting up the basics of the function was pretty straightforward:</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># `clc` stands for `copy last commit`.function clc {    LAST_COMMIT_SHA=$(git rev-parse HEAD)    echo \"$LAST_COMMIT_SHA\" | tr -d '\\n' | pbcopy    echo \"Copied ${LAST_COMMIT_SHA}.\"}</span>\n</code></pre></div>\n<p>At this point, I can run <code>clc</code> in my terminal, and by doing so, grab the last commit SHA, remove the line breaks, copy it to the clipboard, and spit out a nice confirmation message. Gets the job done! But.</p>\n<h3>Iteration #2 :: Copy From Different Branch</h3>\n<p>When I’m cherry-picking, I often want the latest commit SHA from different branch – not my current one. So, I upgraded the function to accept a branch name as a parameter. If the parameter is set, check out that branch, grab the latest commit SHA, and return to the original branch.</p>\n<div class=\"remark-highlight\"><pre class=\"language-diff\"><code class=\"language-diff\">function clc {+    # The original script wrapped in a nested function:+    function copy_last_commit() {        LAST_COMMIT_SHA=$(git rev-parse HEAD)        echo \"$LAST_COMMIT_SHA\" | tr -d '\\n' | pbcopy        echo \"Copied ${LAST_COMMIT_SHA}.\"+    }++    # Added to check out branch, if parameter is set.+    if [ ! -z \"$1\" ]; then+        if git checkout $1 >/dev/null; then+            copy_last_commit+            git checkout - >/dev/null+        else+            echo \"Checkout wasn't successful. Didn't copy anything.\"+        fi+    else+        copy_last_commit+    fi}\n</code></pre></div>\n<p>Now, we can run something like <code>clc some-branch</code>. That’ll cause the branch to be checked out (<code>git checkout $1 >/dev/null</code>), and if that’s successful, the copying will commence, spitting out something like this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-text\"><code class=\"language-text\">Switched to branch &#x26;#39;my-branch&#x26;#39;\nCopied 3ccbd742f916659c50cbff6c2f63e2ba28a168b5.\nSwitched to branch &#x26;#39;master&#x26;#39;</code></pre></div>\n<p>If, by chance, I pass a non-existent branch name and it fails, an error message is output. And, of course, if no branch parameter is passed, the just check go straight to copying the commit SHA of the current branch. But!</p>\n<h3>Iteration #3 :: Respect Unstaged Changes</h3>\n<p>Often times, my active branch has a bunch of unstaged changes, and running this command to grab a SHA from a different branch produces this message:</p>\n<div class=\"remark-highlight\"><pre class=\"language-text\"><code class=\"language-text\">Please commit your changes or stash them before you switch branches.\nAborting\nCheckout wasn&#x26;#39;t successful. Didn&#x26;#39;t copy anything.</code></pre></div>\n<p>So, I went for upgrading this again – this time, instead of completely checking out the branch, using <code>git stash</code> to stash away our changes and restore them. It’s lot more flexible, not requiring that you have a clean working directory.</p>\n<p>In doing this, it’s important that we only <code>stash</code> when it’s actually needed. Running <code>git stash</code> when there’s nothing to stash does <em>nothing</em> – no new stash is created. And if we automatically run <code>git stash pop</code> when a new stash wasn’t actually created, we might end up restoring a previous stash we don’t want (you can view all the stashes in your repo using <code>git stash list</code>).</p>\n<p>I performed this check using <code>git status -s</code> and saving it to the variable <code>IS_DIRTY</code>. If the working tree is “dirty,” stash the changes, and restore them when we’re all done.</p>\n<div class=\"remark-highlight\"><pre class=\"language-diff\"><code class=\"language-diff\">function clc {    # The original script wrapped in a nested function:    function copy_last_commit() {        LAST_COMMIT_SHA=$(git rev-parse HEAD)        echo \"$LAST_COMMIT_SHA\" | tr -d '\\n' | pbcopy        echo \"Copied ${LAST_COMMIT_SHA}.\"    }    # Added to check out branch, if parameter is set.    if [ ! -z \"$1\" ]; then+        IS_DIRTY=$(git status -s)++        if [[ ! -z $IS_DIRTY ]]; then+            git stash push -u >/dev/null+            echo \"Stashed unstaged stages.\"+        fi        if git checkout $1 >/dev/null; then            copy_last_commit            git checkout - >/dev/null        else            echo \"Checkout wasn't successful. Didn't copy anything.\"        fi+        if [[ ! -z $IS_DIRTY ]]; then+            git stash pop >/dev/null+            echo \"Restored unstaged changes.\"+        fi    else        copy_last_commit    fi}\n</code></pre></div>\n<p>Because it tripped me up, take extra notice that I’m not using a simple <code>git stash</code> command to stash my changes. Instead I’m using <code>git stash push -u</code>. This is because I want to stash away <em>all</em> my current changes, including files I might have just created but not yet committed. The more verbose <code>git stash push</code> followed by the <code>-u</code> (which stands for <code>--include-untracked</code>) flag will do just that.</p>\n<h2>Iteration #4 :: Tear Down &#x26; Rebuild Everything 🤦</h2>\n<p>At this point, I was feeling pretty good about myself. I had worked through all the weird shell issues I had hit along the way, and actually published this very blog post on the whole process.</p>\n<p>And then, a couple of Reddit users (thanks, <a href=\"https://www.reddit.com/user/nunull/\" target=\"_blank\" rel=\"noopener\">nunull</a> and <a href=\"https://www.reddit.com/user/austin-schaffer/\" target=\"_blank\" rel=\"noopener\">austin-schaffer</a>!) pointed out that I don’t actually <em>need</em> to perform a checkout just to get at a commit SHA. This should have been obvious since was already using <code>git rev-parse HEAD</code> to pull the SHA. Swapping out <code>HEAD</code> for whatever branch I need would have done the trick, completely removing the need for any of that complicated checkout and stash logic 🤦.</p>\n<p>With that revelation, the function goes from all of those lines of code down to just a few:</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token keyword\">function</span> <span class=\"token function-name function\">clc</span> <span class=\"token punctuation\">{</span>    <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-z</span> <span class=\"token variable\">$1</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token assign-left variable\">BRANCH</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">git</span> rev-parse --abbrev-ref HEAD<span class=\"token variable\">)</span></span> <span class=\"token operator\">||</span> <span class=\"token assign-left variable\">BRANCH</span><span class=\"token operator\">=</span><span class=\"token variable\">$1</span>    <span class=\"token assign-left variable\">LAST_COMMIT_SHA</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">git</span> rev-parse $BRANCH <span class=\"token operator\">|</span> <span class=\"token function\">tail</span> <span class=\"token parameter variable\">-n</span> <span class=\"token number\">1</span><span class=\"token variable\">)</span></span>    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"<span class=\"token variable\">$LAST_COMMIT_SHA</span>\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">tr</span> <span class=\"token parameter variable\">-d</span> <span class=\"token string\">'\\n'</span> <span class=\"token operator\">|</span> pbcopy    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Copied <span class=\"token variable\">${LAST_COMMIT_SHA}</span>.\"</span><span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>See, Reddit ain’t so bad! Thanks again to the two who called this out!</p>\n<h2>See the Touched Up Final Product</h2>\n<p>I’ve added a couple of pretty terminal colors in the version that lives in <a href=\"https://gist.github.com/alexmacarthur/933a50c3e072baaf7b6ed18b94e0e873\" target=\"_blank\" rel=\"noopener\">this Gist</a>.</p>\n<h2>Using the Function</h2>\n<p>To use this in your local shell, you could throw it in your <code>~/.bashrc</code> or <code>~/.zshrc</code> file, but it’s probably better to store it somewhere else on your system. I can’t speak for <code>bash</code> users, but if you’re using <code>zsh</code>, that’s just a matter of putting the file in your <code>$ZSH/custom</code> directory and sourcing it.</p>\n<h3>Install as Custom ZSH Function</h3>\n<p>To make it super easy, run the following command, which will retrieve the function from my GitHub Gist and put it into the appropriate location:</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">curl</span> https://gist.githubusercontent.com/alexmacarthur/933a50c3e072baaf7b6ed18b94e0e873/raw/59f22ae740d83f39a88b70f4aebb0c27b2f9805f/copy-last-commit.zsh <span class=\"token parameter variable\">-o</span> <span class=\"token variable\">$ZSH</span>/custom/clc.zsh\n</code></pre></div>\n<h3>Running the Command</h3>\n<p>After doing that, source it up with <code>source ~/.zshrc</code>, and you should be able to run the command.</p>\n<p>Running <code>clc</code> will return something like this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-text\"><code class=\"language-text\">Copied 3ccbd742f916659c50cbff6c2f63e2ba28a168b5 from master.</code></pre></div>\n<p>Running <code>clc new-branch</code> will return something like this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-text\"><code class=\"language-text\">Copied 3ccbd742f916659c50cbff6c2f63e2ba28a168b5 from new-branch.</code></pre></div>\n<h2>Did I Miss Something?</h2>\n<p>It wouldn’t surprise me. If you have any suggestions or improvements, let me know!</p>\n",
        "feature_image": "",
        "status": "published",
        "created_at": 1567054800000,
        "published_at": 1567054800000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>Frequently enough, I find myself needing to copy the SHA of the latest commit in project, and doing it manually was becoming a chore. I’d been getting more comfortable and excited about improving efficiency by rolling custom shell functions (<a href=\\\"/posts/formatting-my-php-more-efficiently-with-a-bash-function\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">like I wrote about here</a>), and so this felt like a good candidate for another one. After a bit of searching, this was confirmed – very little was out there on someone else building a simple terminal command to do such a thing. So, I went for it.</p>\\n<p><strong>Problem:</strong> Copy the SHA of my last commit is clunky and takes time.</p>\\n<p><strong>Solution:</strong> Make a shell function that’ll allow me to do it with a simple terminal command.</p>\\n<h2>Building the Function</h2>\\n<p>Most of the experimentation I did for this was done in a regular shell script on my machine. But to quickly test the script as a terminal command, I copied my iterations inside my <code>~/.zshrc</code> and sourced it with <code>source ~/.zshrc</code>. Over time, this is how those iterations progressed.</p>\\n<h3>Iteration #1 :: Stupid Simple</h3>\\n<p>Setting up the basics of the function was pretty straightforward:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\"><span class=\\\"token comment\\\"># `clc` stands for `copy last commit`.function clc {    LAST_COMMIT_SHA=$(git rev-parse HEAD)    echo \\\"$LAST_COMMIT_SHA\\\" | tr -d '\\\\n' | pbcopy    echo \\\"Copied ${LAST_COMMIT_SHA}.\\\"}</span>\\n</code></pre></div>\\n<p>At this point, I can run <code>clc</code> in my terminal, and by doing so, grab the last commit SHA, remove the line breaks, copy it to the clipboard, and spit out a nice confirmation message. Gets the job done! But.</p>\\n<h3>Iteration #2 :: Copy From Different Branch</h3>\\n<p>When I’m cherry-picking, I often want the latest commit SHA from different branch – not my current one. So, I upgraded the function to accept a branch name as a parameter. If the parameter is set, check out that branch, grab the latest commit SHA, and return to the original branch.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-diff\\\"><code class=\\\"language-diff\\\">function clc {+    # The original script wrapped in a nested function:+    function copy_last_commit() {        LAST_COMMIT_SHA=$(git rev-parse HEAD)        echo \\\"$LAST_COMMIT_SHA\\\" | tr -d '\\\\n' | pbcopy        echo \\\"Copied ${LAST_COMMIT_SHA}.\\\"+    }++    # Added to check out branch, if parameter is set.+    if [ ! -z \\\"$1\\\" ]; then+        if git checkout $1 >/dev/null; then+            copy_last_commit+            git checkout - >/dev/null+        else+            echo \\\"Checkout wasn't successful. Didn't copy anything.\\\"+        fi+    else+        copy_last_commit+    fi}\\n</code></pre></div>\\n<p>Now, we can run something like <code>clc some-branch</code>. That’ll cause the branch to be checked out (<code>git checkout $1 >/dev/null</code>), and if that’s successful, the copying will commence, spitting out something like this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">Switched to branch &#x26;#39;my-branch&#x26;#39;\\nCopied 3ccbd742f916659c50cbff6c2f63e2ba28a168b5.\\nSwitched to branch &#x26;#39;master&#x26;#39;</code></pre></div>\\n<p>If, by chance, I pass a non-existent branch name and it fails, an error message is output. And, of course, if no branch parameter is passed, the just check go straight to copying the commit SHA of the current branch. But!</p>\\n<h3>Iteration #3 :: Respect Unstaged Changes</h3>\\n<p>Often times, my active branch has a bunch of unstaged changes, and running this command to grab a SHA from a different branch produces this message:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">Please commit your changes or stash them before you switch branches.\\nAborting\\nCheckout wasn&#x26;#39;t successful. Didn&#x26;#39;t copy anything.</code></pre></div>\\n<p>So, I went for upgrading this again – this time, instead of completely checking out the branch, using <code>git stash</code> to stash away our changes and restore them. It’s lot more flexible, not requiring that you have a clean working directory.</p>\\n<p>In doing this, it’s important that we only <code>stash</code> when it’s actually needed. Running <code>git stash</code> when there’s nothing to stash does <em>nothing</em> – no new stash is created. And if we automatically run <code>git stash pop</code> when a new stash wasn’t actually created, we might end up restoring a previous stash we don’t want (you can view all the stashes in your repo using <code>git stash list</code>).</p>\\n<p>I performed this check using <code>git status -s</code> and saving it to the variable <code>IS_DIRTY</code>. If the working tree is “dirty,” stash the changes, and restore them when we’re all done.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-diff\\\"><code class=\\\"language-diff\\\">function clc {    # The original script wrapped in a nested function:    function copy_last_commit() {        LAST_COMMIT_SHA=$(git rev-parse HEAD)        echo \\\"$LAST_COMMIT_SHA\\\" | tr -d '\\\\n' | pbcopy        echo \\\"Copied ${LAST_COMMIT_SHA}.\\\"    }    # Added to check out branch, if parameter is set.    if [ ! -z \\\"$1\\\" ]; then+        IS_DIRTY=$(git status -s)++        if [[ ! -z $IS_DIRTY ]]; then+            git stash push -u >/dev/null+            echo \\\"Stashed unstaged stages.\\\"+        fi        if git checkout $1 >/dev/null; then            copy_last_commit            git checkout - >/dev/null        else            echo \\\"Checkout wasn't successful. Didn't copy anything.\\\"        fi+        if [[ ! -z $IS_DIRTY ]]; then+            git stash pop >/dev/null+            echo \\\"Restored unstaged changes.\\\"+        fi    else        copy_last_commit    fi}\\n</code></pre></div>\\n<p>Because it tripped me up, take extra notice that I’m not using a simple <code>git stash</code> command to stash my changes. Instead I’m using <code>git stash push -u</code>. This is because I want to stash away <em>all</em> my current changes, including files I might have just created but not yet committed. The more verbose <code>git stash push</code> followed by the <code>-u</code> (which stands for <code>--include-untracked</code>) flag will do just that.</p>\\n<h2>Iteration #4 :: Tear Down &#x26; Rebuild Everything 🤦</h2>\\n<p>At this point, I was feeling pretty good about myself. I had worked through all the weird shell issues I had hit along the way, and actually published this very blog post on the whole process.</p>\\n<p>And then, a couple of Reddit users (thanks, <a href=\\\"https://www.reddit.com/user/nunull/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">nunull</a> and <a href=\\\"https://www.reddit.com/user/austin-schaffer/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">austin-schaffer</a>!) pointed out that I don’t actually <em>need</em> to perform a checkout just to get at a commit SHA. This should have been obvious since was already using <code>git rev-parse HEAD</code> to pull the SHA. Swapping out <code>HEAD</code> for whatever branch I need would have done the trick, completely removing the need for any of that complicated checkout and stash logic 🤦.</p>\\n<p>With that revelation, the function goes from all of those lines of code down to just a few:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\"><span class=\\\"token keyword\\\">function</span> <span class=\\\"token function-name function\\\">clc</span> <span class=\\\"token punctuation\\\">{</span>    <span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">[</span> <span class=\\\"token parameter variable\\\">-z</span> <span class=\\\"token variable\\\">$1</span> <span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">&#x26;&#x26;</span> <span class=\\\"token assign-left variable\\\">BRANCH</span><span class=\\\"token operator\\\">=</span><span class=\\\"token variable\\\"><span class=\\\"token variable\\\">$(</span><span class=\\\"token function\\\">git</span> rev-parse --abbrev-ref HEAD<span class=\\\"token variable\\\">)</span></span> <span class=\\\"token operator\\\">||</span> <span class=\\\"token assign-left variable\\\">BRANCH</span><span class=\\\"token operator\\\">=</span><span class=\\\"token variable\\\">$1</span>    <span class=\\\"token assign-left variable\\\">LAST_COMMIT_SHA</span><span class=\\\"token operator\\\">=</span><span class=\\\"token variable\\\"><span class=\\\"token variable\\\">$(</span><span class=\\\"token function\\\">git</span> rev-parse $BRANCH <span class=\\\"token operator\\\">|</span> <span class=\\\"token function\\\">tail</span> <span class=\\\"token parameter variable\\\">-n</span> <span class=\\\"token number\\\">1</span><span class=\\\"token variable\\\">)</span></span>    <span class=\\\"token builtin class-name\\\">echo</span> <span class=\\\"token string\\\">\\\"<span class=\\\"token variable\\\">$LAST_COMMIT_SHA</span>\\\"</span> <span class=\\\"token operator\\\">|</span> <span class=\\\"token function\\\">tr</span> <span class=\\\"token parameter variable\\\">-d</span> <span class=\\\"token string\\\">'\\\\n'</span> <span class=\\\"token operator\\\">|</span> pbcopy    <span class=\\\"token builtin class-name\\\">echo</span> <span class=\\\"token string\\\">\\\"Copied <span class=\\\"token variable\\\">${LAST_COMMIT_SHA}</span>.\\\"</span><span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p>See, Reddit ain’t so bad! Thanks again to the two who called this out!</p>\\n<h2>See the Touched Up Final Product</h2>\\n<p>I’ve added a couple of pretty terminal colors in the version that lives in <a href=\\\"https://gist.github.com/alexmacarthur/933a50c3e072baaf7b6ed18b94e0e873\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">this Gist</a>.</p>\\n<h2>Using the Function</h2>\\n<p>To use this in your local shell, you could throw it in your <code>~/.bashrc</code> or <code>~/.zshrc</code> file, but it’s probably better to store it somewhere else on your system. I can’t speak for <code>bash</code> users, but if you’re using <code>zsh</code>, that’s just a matter of putting the file in your <code>$ZSH/custom</code> directory and sourcing it.</p>\\n<h3>Install as Custom ZSH Function</h3>\\n<p>To make it super easy, run the following command, which will retrieve the function from my GitHub Gist and put it into the appropriate location:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\"><span class=\\\"token function\\\">curl</span> https://gist.githubusercontent.com/alexmacarthur/933a50c3e072baaf7b6ed18b94e0e873/raw/59f22ae740d83f39a88b70f4aebb0c27b2f9805f/copy-last-commit.zsh <span class=\\\"token parameter variable\\\">-o</span> <span class=\\\"token variable\\\">$ZSH</span>/custom/clc.zsh\\n</code></pre></div>\\n<h3>Running the Command</h3>\\n<p>After doing that, source it up with <code>source ~/.zshrc</code>, and you should be able to run the command.</p>\\n<p>Running <code>clc</code> will return something like this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">Copied 3ccbd742f916659c50cbff6c2f63e2ba28a168b5 from master.</code></pre></div>\\n<p>Running <code>clc new-branch</code> will return something like this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">Copied 3ccbd742f916659c50cbff6c2f63e2ba28a168b5 from new-branch.</code></pre></div>\\n<h2>Did I Miss Something?</h2>\\n<p>It wouldn’t surprise me. If you have any suggestions or improvements, let me know!</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 41,
        "title": "Should We All Start Implementing Differential Serving?",
        "slug": "should-we-implement-differential-serving",
        "html": "<p>There’s been a lot of discussion around the potential to serve browsers the JavaScript bundles they can support. For example, if a user’s on Internet Explorer, serve a transpiled, polyfilled bundle. If they’re on a modern version of Chrome, deliver the slimmer, non-transpiled version.</p>\n<p>To accomplish this, the <code>module</code> / <code>nomodule</code> trick has been thrown around quite a bit. It looks like this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>module<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>scripts.modern.min.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>script</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>script</span> <span class=\"token attr-name\">nomodule</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>scripts.min.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>script</span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<p>Old browsers will pass over <code>type=\"module\"</code>and download the <code>nomodule</code> version. Modern browsers will pass over the <code>nomodule</code> attribute and download the <code>type=\"module\"</code> version. As a result, browsers get the code they can handle. These days, most of them can understand modern JavaScript anyway, so serving bundles in this way benefits most of sites’ visitors.</p>\n<h2>Yeah, but is it reliable?</h2>\n<p>From what I’ve read and witnessed, not very. <a href=\"https://www.johnstewart.dev/\" target=\"_blank\" rel=\"noopener\">John Stewart</a> has some <a href=\"https://github.com/johnstew/differential-serving#tests\" target=\"_blank\" rel=\"noopener\">really interesting results</a> he shared from his own research, revealing (and verified by my own tinkering) that quite a few browser versions end up downloading bundles they shouldn’t – sometimes even multiple times. So, if your user just happens to be using MS Edge 18, for example, you’re actually <em>harming</em> performance – not helping.</p>\n<p>And even if the community’s generally moving away from the browsers with these issues, their use is still widespread enough to deter me from using the <code>module</code> / <code>nomodule</code> trick in production. At least for now.</p>\n<h2>Is there another way?</h2>\n<p>Yes, a couple of them.</p>\n<h3>A Server-Side Alternative</h3>\n<p>Some have explored <a href=\"https://www.johnstewart.dev/differential-serving#alternative-approach\" target=\"_blank\" rel=\"noopener\">a server-side solution</a> that examines a browser’s user agent before serving the correct assets. It’s more reliable in appearance (albeit certainly not bulletproof), but when caching and other factors are added to the mix, it gets complicated and unpredictable real fast. <a href=\"https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/RequestAndResponseBehaviorCustomOrigin.html#request-custom-user-agent-header\" target=\"_blank\" rel=\"noopener\">CloudFront, for example</a>, totally overrides the <code>User-Agent</code> header, and recommends that you don’t cache objects based on its incoming value anyway. Mozilla takes an even stronger position against <code>User-Agent</code> sniffing, outright saying that <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Browser_detection_using_the_user_agent#Considerations_before_using_browser_detection\" target=\"_blank\" rel=\"noopener\">you should just </a><a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Browser_detection_using_the_user_agent#Considerations_before_using_browser_detection\" target=\"_blank\" rel=\"noopener\"><strong>never</strong></a><a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Browser_detection_using_the_user_agent#Considerations_before_using_browser_detection\" target=\"_blank\" rel=\"noopener\"> do it</a>. Bold words! Literally. Their words are in bold on their site.</p>\n<h3>A Client-Side Alternative</h3>\n<p>Dare I say it, there <em>is</em> a JavaScript approach to explore:</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token keyword\">var</span> <span class=\"token constant\">MODERN_BUNDLE</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"assets/dist/js/scripts.modern.min.js\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> <span class=\"token constant\">LEGACY_BUNDLE</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"assets/dist/js/scripts.min.js\"</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">function</span> <span class=\"token function\">isModern</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword control-flow\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">new</span> <span class=\"token class-name\">Function</span><span class=\"token punctuation\">(</span><span class=\"token string\">'import(\"\")'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword control-flow\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">var</span> scriptTag <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"script\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    scriptTag<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"src\"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">isModern</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token constant\">MODERN_BUNDLE</span> <span class=\"token operator\">:</span> <span class=\"token constant\">LEGACY_BUNDLE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">body</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">appendChild</span><span class=\"token punctuation\">(</span>scriptTag<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>script</span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<p>By wrapping some modern feature inside a <code>try/catch</code> block, we can return a <code>boolean</code> in checking if a browser can understand modern JS. Once we know that, a <code>&#x3C;script></code> tag can be attached to the body to tell it exactly which file to download. I implemented this in my own sandbox, and it appears to work even using the problem browsers mentioned above.</p>\n<p>Points for reliability, but it still doesn’t feel right. There’s an inherent performance tradeoff in needing go wait for a small piece of JS to parse and execute before you can download a big piece of JS. And after digging into this a little more, the performance losses were more significant than I anticipated.</p>\n<h3>Testing the Client-Side Approach</h3>\n<p>I ran through some scenarios loading a <strong>~300kb transpiled file</strong> and a <strong>~50kb “modern” file</strong> in three different ways. In my own experimentation, the amount of code I saved by not transpiling ranged from 10% - 50%, so I figured I’d test with a more extreme example (> 80% savings) to determine if the load-via-JS approach is even reasonable. All of these examples involved loading the files at the end of the body, with the results being the approximate average of each approach with a simple static site on my local machine. Here they are:</p>\n<p><strong>Standard</strong>: a simple <code>&#x3C;script></code> tag loading the 300kb file.</p>\n<p><strong>Modern via HTML:</strong> loading the slim version with the <code>module</code> / <code>nomodule</code> trick.</p>\n<p><strong>Modern via JS:</strong> loading the slim version after feature detection with JS.</p>\n<p><a href=\"2634c99c-fe6b-4b10-b339-a673f55afa20\" target=\"_blank\" rel=\"noopener\">child_database</a></p>\n<p>To no surprise, the slimmer file takes less time to download, but when it’s loaded via JS, it gets queued to download <em>far</em> later on. The embedded and JS approaches end up comparing something like this:</p>\n<p><img src='/proxy/5948ba1d-363b-4d6f-8dbb-2318b33e691e' alt='' loading='lazy' /></p>\n<p>That’s significant. And likely due to a couple of reasons:</p>\n<p><strong>First, it takes time to parse and execute JavaScript.</strong> There’s a whole lotta information out there on that, with one of the most well-known voices being Addy Osmani and his <a href=\"https://v8.dev/blog/cost-of-javascript-2019\" target=\"_blank\" rel=\"noopener\">Cost of JavaScript talks</a>.</p>\n<p><strong>Second (and most primarily), you can’t take advantage of the browser’s speculative parsing</strong> (also referred to as “preload scanning”) when the file you want to download isn’t actually embedded into the document. <a href=\"https://hacks.mozilla.org/2017/09/building-the-dom-faster-speculative-parsing-async-defer-and-preload/\" target=\"_blank\" rel=\"noopener\">Milica Mihajlija has a great article on this</a> (which was published on my birthday – huge).</p>\n<p>She explains that when loading the page, not-ancient browsers (meaning those since 2008) don’t strictly fetch scripts in the order they appear in the document. Instead, at the start of the page lifecycle, they “speculatively” discover assets that will eventually be needed and start loading them in the background. So, embedded scripts have a huge leg up vs. those loaded by JS, which first have to wait for their time to come in the DOM-building process before they can even <em>start</em> downloading. And that’s why that waterfall looks the way it does.</p>\n<h3>Can we make this more performant?</h3>\n<p>A couple of options did come to mind:</p>\n<p>First, I tried loading the scripts in the <code>&#x3C;head></code> of the document rather than the <code>&#x3C;body></code>. It didn’t help much. I saved around 10-15ms due to the file being queued sooner, which doesn’t make up for the ~100ms lost in comparison to embedding those files into the document.</p>\n<p>Second, I experimented with preloading the modern bundle in the <code>&#x3C;head></code> of the page. Queue times were <em>much</em> sooner in the page lifecycle, since speculative parsing can be leveraged, and since older browsers <a href=\"https://caniuse.com/#feat=link-rel-preload\" target=\"_blank\" rel=\"noopener\">don’t support the preload resource hint</a>, they won’t unnecessarily download assets they shouldn’t. This sounds good, but it also means that those same browsers will be slave to the gross loading times we discovered above. Depending on your industry, that’s often still a <em>lot</em> of users.</p>\n<p>So, after all of that, the client-side approach turned out to be less than impressive.</p>\n<h2>What does all this mean?</h2>\n<p>The big implication of this stuff should be pretty obvious: as it’s been pitched, differential serving isn’t ready for mainstream implementation. As far as I’ve seen, there’s just too much hassle and unpredictability for not enough gain.</p>\n<p>And even if it’s a matter of waiting for browsers to more consistently handle the <code>module</code> / <code>nomodule</code> trick, by the time they do, it might not be worth creating two different bundles at all. <a href=\"https://caniuse.com/#feat=es6\" target=\"_blank\" rel=\"noopener\">Support for ES2015 is getting </a><a href=\"https://caniuse.com/#feat=es6\" target=\"_blank\" rel=\"noopener\"><em>really</em></a><a href=\"https://caniuse.com/#feat=es6\" target=\"_blank\" rel=\"noopener\"> good</a>, with <strong>~91%</strong> of users being on browsers with full support, and <strong>~96%</strong> having at least partial support. And on top of that, the release rhythm for most browsers is pretty quick nowadays – around every couple of months or so, based on <a href=\"https://www.chromium.org/developers/calendar\" target=\"_blank\" rel=\"noopener\">Chromium’s</a> and <a href=\"https://wiki.mozilla.org/Release_Management/Calendar\" target=\"_blank\" rel=\"noopener\">Firefox’s</a> release calendars.</p>\n<p>The point is that it probably won’t be long before “modern JavaScript” will just be understood as “JavaScript,” and worrying about getting differential serving down will probably amount to a lot of wasted energy.</p>\n<h2>Sorry!</h2>\n<p>If you read this in anticipation of me revealing a surprise, reliable alternative approach to differential serving… I apologize. At the very least, I hope you’ve gained some nuggets of insight!</p>\n",
        "feature_image": "https://images.pexels.com/photos/262978/pexels-photo-262978.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=3&amp;h=1200&amp;w=1200",
        "status": "published",
        "created_at": 1566450000000,
        "published_at": 1566450000000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>There’s been a lot of discussion around the potential to serve browsers the JavaScript bundles they can support. For example, if a user’s on Internet Explorer, serve a transpiled, polyfilled bundle. If they’re on a modern version of Chrome, deliver the slimmer, non-transpiled version.</p>\\n<p>To accomplish this, the <code>module</code> / <code>nomodule</code> trick has been thrown around quite a bit. It looks like this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>script</span> <span class=\\\"token attr-name\\\">type</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>module<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token attr-name\\\">src</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>scripts.modern.min.js<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token script\\\"></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>script</span><span class=\\\"token punctuation\\\">></span></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>script</span> <span class=\\\"token attr-name\\\">nomodule</span> <span class=\\\"token attr-name\\\">src</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>scripts.min.js<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token script\\\"></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>script</span><span class=\\\"token punctuation\\\">></span></span>\\n</code></pre></div>\\n<p>Old browsers will pass over <code>type=\\\"module\\\"</code>and download the <code>nomodule</code> version. Modern browsers will pass over the <code>nomodule</code> attribute and download the <code>type=\\\"module\\\"</code> version. As a result, browsers get the code they can handle. These days, most of them can understand modern JavaScript anyway, so serving bundles in this way benefits most of sites’ visitors.</p>\\n<h2>Yeah, but is it reliable?</h2>\\n<p>From what I’ve read and witnessed, not very. <a href=\\\"https://www.johnstewart.dev/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">John Stewart</a> has some <a href=\\\"https://github.com/johnstew/differential-serving#tests\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">really interesting results</a> he shared from his own research, revealing (and verified by my own tinkering) that quite a few browser versions end up downloading bundles they shouldn’t – sometimes even multiple times. So, if your user just happens to be using MS Edge 18, for example, you’re actually <em>harming</em> performance – not helping.</p>\\n<p>And even if the community’s generally moving away from the browsers with these issues, their use is still widespread enough to deter me from using the <code>module</code> / <code>nomodule</code> trick in production. At least for now.</p>\\n<h2>Is there another way?</h2>\\n<p>Yes, a couple of them.</p>\\n<h3>A Server-Side Alternative</h3>\\n<p>Some have explored <a href=\\\"https://www.johnstewart.dev/differential-serving#alternative-approach\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">a server-side solution</a> that examines a browser’s user agent before serving the correct assets. It’s more reliable in appearance (albeit certainly not bulletproof), but when caching and other factors are added to the mix, it gets complicated and unpredictable real fast. <a href=\\\"https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/RequestAndResponseBehaviorCustomOrigin.html#request-custom-user-agent-header\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">CloudFront, for example</a>, totally overrides the <code>User-Agent</code> header, and recommends that you don’t cache objects based on its incoming value anyway. Mozilla takes an even stronger position against <code>User-Agent</code> sniffing, outright saying that <a href=\\\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Browser_detection_using_the_user_agent#Considerations_before_using_browser_detection\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">you should just </a><a href=\\\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Browser_detection_using_the_user_agent#Considerations_before_using_browser_detection\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\"><strong>never</strong></a><a href=\\\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Browser_detection_using_the_user_agent#Considerations_before_using_browser_detection\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\"> do it</a>. Bold words! Literally. Their words are in bold on their site.</p>\\n<h3>A Client-Side Alternative</h3>\\n<p>Dare I say it, there <em>is</em> a JavaScript approach to explore:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>script</span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token script\\\"><span class=\\\"token language-javascript\\\">\\n    <span class=\\\"token keyword\\\">var</span> <span class=\\\"token constant\\\">MODERN_BUNDLE</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"assets/dist/js/scripts.modern.min.js\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword\\\">var</span> <span class=\\\"token constant\\\">LEGACY_BUNDLE</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"assets/dist/js/scripts.min.js\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\">isModern</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword control-flow\\\">try</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Function</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'import(\\\"\\\")'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n        <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword control-flow\\\">catch</span> <span class=\\\"token punctuation\\\">(</span>err<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n\\n    <span class=\\\"token keyword\\\">var</span> scriptTag <span class=\\\"token operator\\\">=</span> <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">createElement</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"script\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    scriptTag<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">setAttribute</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"src\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token function\\\">isModern</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">?</span> <span class=\\\"token constant\\\">MODERN_BUNDLE</span> <span class=\\\"token operator\\\">:</span> <span class=\\\"token constant\\\">LEGACY_BUNDLE</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">body</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">appendChild</span><span class=\\\"token punctuation\\\">(</span>scriptTag<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</span></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>script</span><span class=\\\"token punctuation\\\">></span></span>\\n</code></pre></div>\\n<p>By wrapping some modern feature inside a <code>try/catch</code> block, we can return a <code>boolean</code> in checking if a browser can understand modern JS. Once we know that, a <code>&#x3C;script></code> tag can be attached to the body to tell it exactly which file to download. I implemented this in my own sandbox, and it appears to work even using the problem browsers mentioned above.</p>\\n<p>Points for reliability, but it still doesn’t feel right. There’s an inherent performance tradeoff in needing go wait for a small piece of JS to parse and execute before you can download a big piece of JS. And after digging into this a little more, the performance losses were more significant than I anticipated.</p>\\n<h3>Testing the Client-Side Approach</h3>\\n<p>I ran through some scenarios loading a <strong>~300kb transpiled file</strong> and a <strong>~50kb “modern” file</strong> in three different ways. In my own experimentation, the amount of code I saved by not transpiling ranged from 10% - 50%, so I figured I’d test with a more extreme example (> 80% savings) to determine if the load-via-JS approach is even reasonable. All of these examples involved loading the files at the end of the body, with the results being the approximate average of each approach with a simple static site on my local machine. Here they are:</p>\\n<p><strong>Standard</strong>: a simple <code>&#x3C;script></code> tag loading the 300kb file.</p>\\n<p><strong>Modern via HTML:</strong> loading the slim version with the <code>module</code> / <code>nomodule</code> trick.</p>\\n<p><strong>Modern via JS:</strong> loading the slim version after feature detection with JS.</p>\\n<p><a href=\\\"2634c99c-fe6b-4b10-b339-a673f55afa20\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">child_database</a></p>\\n<p>To no surprise, the slimmer file takes less time to download, but when it’s loaded via JS, it gets queued to download <em>far</em> later on. The embedded and JS approaches end up comparing something like this:</p>\\n<p><img src='/proxy/5948ba1d-363b-4d6f-8dbb-2318b33e691e' alt='' loading='lazy' /></p>\\n<p>That’s significant. And likely due to a couple of reasons:</p>\\n<p><strong>First, it takes time to parse and execute JavaScript.</strong> There’s a whole lotta information out there on that, with one of the most well-known voices being Addy Osmani and his <a href=\\\"https://v8.dev/blog/cost-of-javascript-2019\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Cost of JavaScript talks</a>.</p>\\n<p><strong>Second (and most primarily), you can’t take advantage of the browser’s speculative parsing</strong> (also referred to as “preload scanning”) when the file you want to download isn’t actually embedded into the document. <a href=\\\"https://hacks.mozilla.org/2017/09/building-the-dom-faster-speculative-parsing-async-defer-and-preload/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Milica Mihajlija has a great article on this</a> (which was published on my birthday – huge).</p>\\n<p>She explains that when loading the page, not-ancient browsers (meaning those since 2008) don’t strictly fetch scripts in the order they appear in the document. Instead, at the start of the page lifecycle, they “speculatively” discover assets that will eventually be needed and start loading them in the background. So, embedded scripts have a huge leg up vs. those loaded by JS, which first have to wait for their time to come in the DOM-building process before they can even <em>start</em> downloading. And that’s why that waterfall looks the way it does.</p>\\n<h3>Can we make this more performant?</h3>\\n<p>A couple of options did come to mind:</p>\\n<p>First, I tried loading the scripts in the <code>&#x3C;head></code> of the document rather than the <code>&#x3C;body></code>. It didn’t help much. I saved around 10-15ms due to the file being queued sooner, which doesn’t make up for the ~100ms lost in comparison to embedding those files into the document.</p>\\n<p>Second, I experimented with preloading the modern bundle in the <code>&#x3C;head></code> of the page. Queue times were <em>much</em> sooner in the page lifecycle, since speculative parsing can be leveraged, and since older browsers <a href=\\\"https://caniuse.com/#feat=link-rel-preload\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">don’t support the preload resource hint</a>, they won’t unnecessarily download assets they shouldn’t. This sounds good, but it also means that those same browsers will be slave to the gross loading times we discovered above. Depending on your industry, that’s often still a <em>lot</em> of users.</p>\\n<p>So, after all of that, the client-side approach turned out to be less than impressive.</p>\\n<h2>What does all this mean?</h2>\\n<p>The big implication of this stuff should be pretty obvious: as it’s been pitched, differential serving isn’t ready for mainstream implementation. As far as I’ve seen, there’s just too much hassle and unpredictability for not enough gain.</p>\\n<p>And even if it’s a matter of waiting for browsers to more consistently handle the <code>module</code> / <code>nomodule</code> trick, by the time they do, it might not be worth creating two different bundles at all. <a href=\\\"https://caniuse.com/#feat=es6\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Support for ES2015 is getting </a><a href=\\\"https://caniuse.com/#feat=es6\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\"><em>really</em></a><a href=\\\"https://caniuse.com/#feat=es6\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\"> good</a>, with <strong>~91%</strong> of users being on browsers with full support, and <strong>~96%</strong> having at least partial support. And on top of that, the release rhythm for most browsers is pretty quick nowadays – around every couple of months or so, based on <a href=\\\"https://www.chromium.org/developers/calendar\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Chromium’s</a> and <a href=\\\"https://wiki.mozilla.org/Release_Management/Calendar\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Firefox’s</a> release calendars.</p>\\n<p>The point is that it probably won’t be long before “modern JavaScript” will just be understood as “JavaScript,” and worrying about getting differential serving down will probably amount to a lot of wasted energy.</p>\\n<h2>Sorry!</h2>\\n<p>If you read this in anticipation of me revealing a surprise, reliable alternative approach to differential serving… I apologize. At the very least, I hope you’ve gained some nuggets of insight!</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 42,
        "title": "Deploying Code with a Git Hook on a DigitalOcean Droplet",
        "slug": "deploying-code-with-a-git-hook",
        "html": "<p>I’ve been working on a project involving long-running, resource-intensive batch jobs in Node. At first, when my needs were simpler, I used Heroku to run these jobs. It was great, but eventually, the price:performance ratio offered became a little too unwieldy, and I chose to make a move from Heroku to DigitalOcean.</p>\n<p>Almost immediately, I was impressed. In just a short while, I was up and running these jobs with little issue. But there was one challenge I had yet to work out: setting up some sort of deployment process to get the code from my Git repository to my droplet. I was spoiled with Heroku. They make that part of the job incredibly hassle-free. But thankfully, when I made the move to DO, my needs were relatively straightforward:</p>\n<ul>\n<li>On a <code>git push</code>, I wanted my code to be copied to my droplet.</li>\n<li>On that same push, I wanted to <code>npm install</code> the dependencies in my <code>package.json</code>.</li>\n<li>I wanted the option to control which branches would trigger a deployment to that droplet.</li>\n</ul>\n<p>As it turned out, the setup was less complicated than I had been expecting. A single Git hook and a little local configuration meet all the needs noted above. This post is basically me backing up and documenting all that I pieced together from experimenting and Googling. Note that I’m not gonna get into the weeds of configuring a DigitalOcean or any other VPS. For the purposes of what I’m showing off here, just make sure you have a SSH access to your droplet, and that Git’s installed on it.</p>\n<h2>Configure a Remote Repository on Your Droplet</h2>\n<p><strong>First, create a bare repository on your droplet.</strong> A bare repository is one created without a working tree and used solely for <em>sharing</em> code – not working with it. We’ll only be pushing to this repository, so <code>--bare</code> is the way to go.</p>\n<p>For this example, kick this of by <code>ssh</code>-ing into your droplet, creating a <code>neat-app-repo</code> directory, and initializing that repository.</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">ssh</span> user@your-ip-address\n<span class=\"token builtin class-name\">cd</span> /home\n<span class=\"token function\">mkdir</span> neat-app-repo\n<span class=\"token builtin class-name\">cd</span> neat-app-repo\n<span class=\"token function\">git</span> init <span class=\"token parameter variable\">--bare</span>\n</code></pre></div>\n<p><strong>Create a</strong> <strong><code>post-receive</code></strong> <strong>hook file inside your newly created repository.</strong> If you’re unfamiliar with them, <a href=\"https://git-scm.com/book/en/v2/Customizing-Git-Git-Hook\" target=\"_blank\" rel=\"noopener\">catch up.</a> In short, this hook will allows to do <em>something</em> after code has been <em>received</em> by the repository on the droplet (ie. when we do a <code>git push</code>). In our case, all we want to happen after our code is received is for it to be moved to a different directory and its dependencies installed.</p>\n<p>If you <code>cd</code> into your <code>neat-app-repo/hooks</code> directory (this is one of the directories created when you initialized the bare repository), you should see a long list of <code>*.sample</code> Git hooks. While you’re there, create a <em>new</em> <code>post-receive</code> hook:</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">touch</span> post-receive\n</code></pre></div>\n<p>And paste the following bones in there:</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token shebang important\">#!/bin/bash</span>\n\n<span class=\"token keyword\">while</span> <span class=\"token builtin class-name\">read</span> oldrev newrev ref\n<span class=\"token keyword\">do</span>\n    <span class=\"token comment\"># We gonna do stuff.</span>\n<span class=\"token keyword\">done</span>\n</code></pre></div>\n<p>That’s a <code>bash</code> <code>while read</code> loop with three parameters:</p>\n<p><code>oldrev</code> - The SHA for the previous commit in the pushed branch.</p>\n<p><code>newrev</code> - the SHA for the new commit in the pushed branch.</p>\n<p><code>ref</code> - the Git reference of the branch just pushed. Example: <code>refs/heads/master</code></p>\n<p>Inside of that block, we’re free to do whatever we want, like copy the branch that was just pushed to a different directory:</p>\n<div class=\"remark-highlight\"><pre class=\"language-diff\"><code class=\"language-diff\">#!/bin/bash\n\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\"># Location of our bare repository.</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">GIT_DIR=\"/home/neat-app-repo\"</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\"></span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\"># Where we want to copy our code.</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">TARGET=\"/home/neat-app-deployed\"</span>\n<span class=\"token line\"></span></span>\nwhile read oldrev newrev ref\ndo\n<span class=\"token deleted-sign deleted\"><span class=\"token prefix deleted\">-</span><span class=\"token line\">   # We gonna do stuff.</span>\n<span class=\"token line\"></span></span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">   # Neat trick to get the branch name of the reference just pushed:</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   BRANCH=$(git rev-parse --symbolic --abbrev-ref $ref)</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\"></span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   # Send a nice message to the machine pushing to this remote repository.</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   echo \"Push received! Deploying branch: ${BRANCH}...\"</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\"></span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   # \"Deploy\" the branch we just pushed to a specific directory.</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   git --work-tree=$TARGET --git-dir=$GIT_DIR checkout -f $BRANCH</span>\n<span class=\"token line\"></span></span>done\n</code></pre></div>\n<p>After saving that, a couple more steps are required before it’s actually usable:</p>\n<ol>\n<li>Make sure that hook is executable. If you skip this, you’ll get a <code>The 'hooks/post-receive' hook was ignored because it's not set as executable</code> error when you push from your machine.</li>\n</ol>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">chmod</span> +x post-receive\n</code></pre></div>\n<ol>\n<li>Make sure the target directory actually exists. If it doesn’t, you’ll get another error.</li>\n</ol>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">mkdir</span> /home/neat-app-deployed\n</code></pre></div>\n<p>Now, for testing purposes, open up the repository on your local machine and set the <code>origin</code> to where your bare repository is located on your droplet.</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> remote <span class=\"token function\">add</span> origin root@YOUR_IP_ADDRESS:/home/neat-app-repo\n</code></pre></div>\n<p>Make an arbitrary commit and give it a <code>git push</code>. If successful, you should see something like this.</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\">remote: Push received<span class=\"token operator\">!</span> Deploying branch: master<span class=\"token punctuation\">..</span>.\nremote: Switched to branch <span class=\"token string\">'master'</span>\n</code></pre></div>\n<p><strong>Now, let’s (optionally) limit new deployments to specific branches.</strong> If you make a new branch and push it to your droplet, you’ll see it deploys successfully, just as if you were on <code>master</code>. Probably less than ideal, so let’s modify our hook to deploy only when the master branch is pushed.</p>\n<div class=\"remark-highlight\"><pre class=\"language-diff\"><code class=\"language-diff\">#!/bin/bash\n\n# Location of our bare repository.\nGIT_DIR=\"/home/neat-app-repo\"\n\n# Where we want to copy our code.\nTARGET=\"/home/neat-app-deployed\"\n\nwhile read oldrev newrev ref\ndo\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   # Neat trick to get the branch name of the reference just pushed:</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   BRANCH=$(git rev-parse --symbolic --abbrev-ref $ref)</span>\n<span class=\"token line\"></span></span>\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">    if [[ $BRANCH == \"master\" ]];</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">    then</span>\n<span class=\"token line\"></span></span><span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\">       # Send a nice message to the machine pushing to this remote repository.</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">       echo \"Push received! Deploying branch: ${BRANCH}...\"</span>\n<span class=\"token line\"></span></span>\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\">       # \"Deploy\" the branch we just pushed to a specific directory.</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">       git --work-tree=$TARGET --git-dir=$GIT_DIR checkout -f $BRANCH</span>\n<span class=\"token line\"></span></span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">    else</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">       echo \"Not master branch. Skipping.\"</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">    fi</span>\n<span class=\"token line\"></span></span>done\n</code></pre></div>\n<p>Gr8! Now, since my project was in Node, I needed to set up one final thing: <strong>run</strong> **<code>npm install</code>**<strong>on each deployment.</strong> In my case, <code>nvm</code> is in charge of specifying which version of Node I run, so updating my hook looks like this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-diff\"><code class=\"language-diff\">#!/bin/bash\n\n# Location of our bare repository.\nGIT_DIR=\"/home/neat-app-repo\"\n\n# Where we want to copy our code.\nTARGET=\"/home/neat-app-deployed\"\n\nwhile read oldrev newrev ref\ndo\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   # Neat trick to get the branch name of the reference just pushed:</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   BRANCH=$(git rev-parse --symbolic --abbrev-ref $ref)</span>\n<span class=\"token line\"></span></span>\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   if [[ $BRANCH == \"master\" ]];</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   then</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">       # Send a nice message to the machine pushing to this remote repository.</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">       echo \"Push received! Deploying branch: ${BRANCH}...\"</span>\n<span class=\"token line\"></span></span>\n<span class=\"token unchanged\"><span class=\"token prefix unchanged\"> </span><span class=\"token line\">       # \"Deploy\" the branch we just pushed to a specific directory.</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">       git --work-tree=$TARGET --git-dir=$GIT_DIR checkout -f $BRANCH</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   else</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">       echo \"Not master branch. Skipping.\"</span>\n<span class=\"token line\"></span><span class=\"token prefix unchanged\"> </span><span class=\"token line\">   fi</span>\n<span class=\"token line\"></span></span>\n<span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">   # Source nvm to make it available for use inside this script.</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   . $HOME/.nvm/nvm.sh</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\"></span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   # Use the LTS version of Node.</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   nvm use --lts</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\"></span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   # Navigate to where my deployed code lives.</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   cd /home/neat-app-deployed</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\"></span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   # Install dependencies in production mode.</span>\n<span class=\"token line\"></span><span class=\"token prefix inserted\">+</span><span class=\"token line\">   npm install --production</span>\n<span class=\"token line\"></span></span>done\n</code></pre></div>\n<p>And with that, pushing to my droplet will now deploy my code exactly where I want it, as well as install the dependencies it needs to run.</p>\n<h2>Configure Your Local Repository for Easier Deployments</h2>\n<p>When I first got this all set up, I assumed that if I wanted to push my code up to a remote GitHub repository <em>and</em> deploy it to DO simultaneously, I’d need to create two remotes and push them separately. Then I saw this tweet:</p>\n<blockquote>\n<p>TIL you can add two different Git repo URLs on the same remote and a single git push will push to both. Sometimes the orange website is useful! pic.twitter.com/lwjEmj1RAM</p>\n</blockquote>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">[July 22, 2019](https://twitter.com/dceddia/status/1153365976588664833?ref_src=twsrc%5Etfw)</code></pre></div>\n<p>One push, two destinations. And with our <code>post-receive</code> hook only deploying pushes to the <code>master</code> branch, this is a good balance of efficiency and safety for our workflow.</p>\n<p>Admittedly, configuring my Git remotes locally was a little weird, but working it all out eventually came to this. Note: this assumes you already had the DO droplet set as your <code>origin</code>.</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># Change the `fetch` URL, so we always pull code from GitHub.</span>\n<span class=\"token function\">git</span> remote set-url origin git@github.com:alexmacarthur/neat-app.git\n\n<span class=\"token comment\"># Re-add `push` URLs, so that we push to GitHub AND DigitalOcean.</span>\n<span class=\"token function\">git</span> remote set-url <span class=\"token parameter variable\">--add</span> <span class=\"token parameter variable\">--push</span> origin root@YOUR_IP_ADDRESS:/home/neat-app-repo\n<span class=\"token function\">git</span> remote set-url <span class=\"token parameter variable\">--add</span> <span class=\"token parameter variable\">--push</span> origin git@github.com:alexmacarthur/neat-app.git\n</code></pre></div>\n<p>In the end <code>git remote -v</code> returns this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\">origin  root@YOUR_IP_ADDRESS:/home/neat-app-repo <span class=\"token punctuation\">(</span>fetch<span class=\"token punctuation\">)</span>\norigin  git@github.com:alexmacarthur/neat-app.git <span class=\"token punctuation\">(</span>push<span class=\"token punctuation\">)</span>\norigin  root@YOUR_IP_ADDRESS:/home/neat-app-repo <span class=\"token punctuation\">(</span>push<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>With that configured, a simple <code>git push</code> sends your code to two separate remotes, saving you seconds per day, perhaps.</p>\n<h2>Expect Gotchas</h2>\n<p>While it might be conceptually straightforward, working through the details of all this was periodically frustrating for me, especially since it was my first time pulling off such a thing. That said, give yourself a little grace in dealing with the gotchas that will inevitably come up. Hopefully what you read here will help alleviate the pains of the process even just a little bit. If that’s true, writing this all out was worth it.</p>\n",
        "feature_image": "https://images.pexels.com/photos/256229/pexels-photo-256229.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;h=1200&amp;w=1200",
        "status": "published",
        "created_at": 1566190800000,
        "published_at": 1566190800000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>I’ve been working on a project involving long-running, resource-intensive batch jobs in Node. At first, when my needs were simpler, I used Heroku to run these jobs. It was great, but eventually, the price:performance ratio offered became a little too unwieldy, and I chose to make a move from Heroku to DigitalOcean.</p>\\n<p>Almost immediately, I was impressed. In just a short while, I was up and running these jobs with little issue. But there was one challenge I had yet to work out: setting up some sort of deployment process to get the code from my Git repository to my droplet. I was spoiled with Heroku. They make that part of the job incredibly hassle-free. But thankfully, when I made the move to DO, my needs were relatively straightforward:</p>\\n<ul>\\n<li>On a <code>git push</code>, I wanted my code to be copied to my droplet.</li>\\n<li>On that same push, I wanted to <code>npm install</code> the dependencies in my <code>package.json</code>.</li>\\n<li>I wanted the option to control which branches would trigger a deployment to that droplet.</li>\\n</ul>\\n<p>As it turned out, the setup was less complicated than I had been expecting. A single Git hook and a little local configuration meet all the needs noted above. This post is basically me backing up and documenting all that I pieced together from experimenting and Googling. Note that I’m not gonna get into the weeds of configuring a DigitalOcean or any other VPS. For the purposes of what I’m showing off here, just make sure you have a SSH access to your droplet, and that Git’s installed on it.</p>\\n<h2>Configure a Remote Repository on Your Droplet</h2>\\n<p><strong>First, create a bare repository on your droplet.</strong> A bare repository is one created without a working tree and used solely for <em>sharing</em> code – not working with it. We’ll only be pushing to this repository, so <code>--bare</code> is the way to go.</p>\\n<p>For this example, kick this of by <code>ssh</code>-ing into your droplet, creating a <code>neat-app-repo</code> directory, and initializing that repository.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\"><span class=\\\"token function\\\">ssh</span> user@your-ip-address\\n<span class=\\\"token builtin class-name\\\">cd</span> /home\\n<span class=\\\"token function\\\">mkdir</span> neat-app-repo\\n<span class=\\\"token builtin class-name\\\">cd</span> neat-app-repo\\n<span class=\\\"token function\\\">git</span> init <span class=\\\"token parameter variable\\\">--bare</span>\\n</code></pre></div>\\n<p><strong>Create a</strong> <strong><code>post-receive</code></strong> <strong>hook file inside your newly created repository.</strong> If you’re unfamiliar with them, <a href=\\\"https://git-scm.com/book/en/v2/Customizing-Git-Git-Hook\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">catch up.</a> In short, this hook will allows to do <em>something</em> after code has been <em>received</em> by the repository on the droplet (ie. when we do a <code>git push</code>). In our case, all we want to happen after our code is received is for it to be moved to a different directory and its dependencies installed.</p>\\n<p>If you <code>cd</code> into your <code>neat-app-repo/hooks</code> directory (this is one of the directories created when you initialized the bare repository), you should see a long list of <code>*.sample</code> Git hooks. While you’re there, create a <em>new</em> <code>post-receive</code> hook:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\"><span class=\\\"token function\\\">touch</span> post-receive\\n</code></pre></div>\\n<p>And paste the following bones in there:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\"><span class=\\\"token shebang important\\\">#!/bin/bash</span>\\n\\n<span class=\\\"token keyword\\\">while</span> <span class=\\\"token builtin class-name\\\">read</span> oldrev newrev ref\\n<span class=\\\"token keyword\\\">do</span>\\n    <span class=\\\"token comment\\\"># We gonna do stuff.</span>\\n<span class=\\\"token keyword\\\">done</span>\\n</code></pre></div>\\n<p>That’s a <code>bash</code> <code>while read</code> loop with three parameters:</p>\\n<p><code>oldrev</code> - The SHA for the previous commit in the pushed branch.</p>\\n<p><code>newrev</code> - the SHA for the new commit in the pushed branch.</p>\\n<p><code>ref</code> - the Git reference of the branch just pushed. Example: <code>refs/heads/master</code></p>\\n<p>Inside of that block, we’re free to do whatever we want, like copy the branch that was just pushed to a different directory:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-diff\\\"><code class=\\\"language-diff\\\">#!/bin/bash\\n\\n<span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"># Location of our bare repository.</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">GIT_DIR=\\\"/home/neat-app-repo\\\"</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"></span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"># Where we want to copy our code.</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">TARGET=\\\"/home/neat-app-deployed\\\"</span>\\n<span class=\\\"token line\\\"></span></span>\\nwhile read oldrev newrev ref\\ndo\\n<span class=\\\"token deleted-sign deleted\\\"><span class=\\\"token prefix deleted\\\">-</span><span class=\\\"token line\\\">   # We gonna do stuff.</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   # Neat trick to get the branch name of the reference just pushed:</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   BRANCH=$(git rev-parse --symbolic --abbrev-ref $ref)</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"></span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   # Send a nice message to the machine pushing to this remote repository.</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   echo \\\"Push received! Deploying branch: ${BRANCH}...\\\"</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"></span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   # \\\"Deploy\\\" the branch we just pushed to a specific directory.</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   git --work-tree=$TARGET --git-dir=$GIT_DIR checkout -f $BRANCH</span>\\n<span class=\\\"token line\\\"></span></span>done\\n</code></pre></div>\\n<p>After saving that, a couple more steps are required before it’s actually usable:</p>\\n<ol>\\n<li>Make sure that hook is executable. If you skip this, you’ll get a <code>The 'hooks/post-receive' hook was ignored because it's not set as executable</code> error when you push from your machine.</li>\\n</ol>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\"><span class=\\\"token function\\\">chmod</span> +x post-receive\\n</code></pre></div>\\n<ol>\\n<li>Make sure the target directory actually exists. If it doesn’t, you’ll get another error.</li>\\n</ol>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\"><span class=\\\"token function\\\">mkdir</span> /home/neat-app-deployed\\n</code></pre></div>\\n<p>Now, for testing purposes, open up the repository on your local machine and set the <code>origin</code> to where your bare repository is located on your droplet.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\"><span class=\\\"token function\\\">git</span> remote <span class=\\\"token function\\\">add</span> origin root@YOUR_IP_ADDRESS:/home/neat-app-repo\\n</code></pre></div>\\n<p>Make an arbitrary commit and give it a <code>git push</code>. If successful, you should see something like this.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\">remote: Push received<span class=\\\"token operator\\\">!</span> Deploying branch: master<span class=\\\"token punctuation\\\">..</span>.\\nremote: Switched to branch <span class=\\\"token string\\\">'master'</span>\\n</code></pre></div>\\n<p><strong>Now, let’s (optionally) limit new deployments to specific branches.</strong> If you make a new branch and push it to your droplet, you’ll see it deploys successfully, just as if you were on <code>master</code>. Probably less than ideal, so let’s modify our hook to deploy only when the master branch is pushed.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-diff\\\"><code class=\\\"language-diff\\\">#!/bin/bash\\n\\n# Location of our bare repository.\\nGIT_DIR=\\\"/home/neat-app-repo\\\"\\n\\n# Where we want to copy our code.\\nTARGET=\\\"/home/neat-app-deployed\\\"\\n\\nwhile read oldrev newrev ref\\ndo\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   # Neat trick to get the branch name of the reference just pushed:</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   BRANCH=$(git rev-parse --symbolic --abbrev-ref $ref)</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">    if [[ $BRANCH == \\\"master\\\" ]];</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">    then</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">       # Send a nice message to the machine pushing to this remote repository.</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">       echo \\\"Push received! Deploying branch: ${BRANCH}...\\\"</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">       # \\\"Deploy\\\" the branch we just pushed to a specific directory.</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">       git --work-tree=$TARGET --git-dir=$GIT_DIR checkout -f $BRANCH</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">    else</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">       echo \\\"Not master branch. Skipping.\\\"</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">    fi</span>\\n<span class=\\\"token line\\\"></span></span>done\\n</code></pre></div>\\n<p>Gr8! Now, since my project was in Node, I needed to set up one final thing: <strong>run</strong> **<code>npm install</code>**<strong>on each deployment.</strong> In my case, <code>nvm</code> is in charge of specifying which version of Node I run, so updating my hook looks like this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-diff\\\"><code class=\\\"language-diff\\\">#!/bin/bash\\n\\n# Location of our bare repository.\\nGIT_DIR=\\\"/home/neat-app-repo\\\"\\n\\n# Where we want to copy our code.\\nTARGET=\\\"/home/neat-app-deployed\\\"\\n\\nwhile read oldrev newrev ref\\ndo\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   # Neat trick to get the branch name of the reference just pushed:</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   BRANCH=$(git rev-parse --symbolic --abbrev-ref $ref)</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   if [[ $BRANCH == \\\"master\\\" ]];</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   then</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">       # Send a nice message to the machine pushing to this remote repository.</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">       echo \\\"Push received! Deploying branch: ${BRANCH}...\\\"</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token unchanged\\\"><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">       # \\\"Deploy\\\" the branch we just pushed to a specific directory.</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">       git --work-tree=$TARGET --git-dir=$GIT_DIR checkout -f $BRANCH</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   else</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">       echo \\\"Not master branch. Skipping.\\\"</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix unchanged\\\"> </span><span class=\\\"token line\\\">   fi</span>\\n<span class=\\\"token line\\\"></span></span>\\n<span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   # Source nvm to make it available for use inside this script.</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   . $HOME/.nvm/nvm.sh</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"></span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   # Use the LTS version of Node.</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   nvm use --lts</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"></span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   # Navigate to where my deployed code lives.</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   cd /home/neat-app-deployed</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\"></span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   # Install dependencies in production mode.</span>\\n<span class=\\\"token line\\\"></span><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">   npm install --production</span>\\n<span class=\\\"token line\\\"></span></span>done\\n</code></pre></div>\\n<p>And with that, pushing to my droplet will now deploy my code exactly where I want it, as well as install the dependencies it needs to run.</p>\\n<h2>Configure Your Local Repository for Easier Deployments</h2>\\n<p>When I first got this all set up, I assumed that if I wanted to push my code up to a remote GitHub repository <em>and</em> deploy it to DO simultaneously, I’d need to create two remotes and push them separately. Then I saw this tweet:</p>\\n<blockquote>\\n<p>TIL you can add two different Git repo URLs on the same remote and a single git push will push to both. Sometimes the orange website is useful! pic.twitter.com/lwjEmj1RAM</p>\\n</blockquote>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-unknown\\\"><code class=\\\"language-unknown\\\">[July 22, 2019](https://twitter.com/dceddia/status/1153365976588664833?ref_src=twsrc%5Etfw)</code></pre></div>\\n<p>One push, two destinations. And with our <code>post-receive</code> hook only deploying pushes to the <code>master</code> branch, this is a good balance of efficiency and safety for our workflow.</p>\\n<p>Admittedly, configuring my Git remotes locally was a little weird, but working it all out eventually came to this. Note: this assumes you already had the DO droplet set as your <code>origin</code>.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\"><span class=\\\"token comment\\\"># Change the `fetch` URL, so we always pull code from GitHub.</span>\\n<span class=\\\"token function\\\">git</span> remote set-url origin git@github.com:alexmacarthur/neat-app.git\\n\\n<span class=\\\"token comment\\\"># Re-add `push` URLs, so that we push to GitHub AND DigitalOcean.</span>\\n<span class=\\\"token function\\\">git</span> remote set-url <span class=\\\"token parameter variable\\\">--add</span> <span class=\\\"token parameter variable\\\">--push</span> origin root@YOUR_IP_ADDRESS:/home/neat-app-repo\\n<span class=\\\"token function\\\">git</span> remote set-url <span class=\\\"token parameter variable\\\">--add</span> <span class=\\\"token parameter variable\\\">--push</span> origin git@github.com:alexmacarthur/neat-app.git\\n</code></pre></div>\\n<p>In the end <code>git remote -v</code> returns this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\">origin  root@YOUR_IP_ADDRESS:/home/neat-app-repo <span class=\\\"token punctuation\\\">(</span>fetch<span class=\\\"token punctuation\\\">)</span>\\norigin  git@github.com:alexmacarthur/neat-app.git <span class=\\\"token punctuation\\\">(</span>push<span class=\\\"token punctuation\\\">)</span>\\norigin  root@YOUR_IP_ADDRESS:/home/neat-app-repo <span class=\\\"token punctuation\\\">(</span>push<span class=\\\"token punctuation\\\">)</span>\\n</code></pre></div>\\n<p>With that configured, a simple <code>git push</code> sends your code to two separate remotes, saving you seconds per day, perhaps.</p>\\n<h2>Expect Gotchas</h2>\\n<p>While it might be conceptually straightforward, working through the details of all this was periodically frustrating for me, especially since it was my first time pulling off such a thing. That said, give yourself a little grace in dealing with the gotchas that will inevitably come up. Hopefully what you read here will help alleviate the pains of the process even just a little bit. If that’s true, writing this all out was worth it.</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 43,
        "title": "A Simpler Unit Testing Setup for WordPress",
        "slug": "simpler-unit-testing-for-wordpress",
        "html": "<p>When I was getting started in web development, I remember how conceptually overwhelming it was to understand the whys, whats, and hows around things like unit testing. And to make it even more difficult, WordPress was the environment in which I spent most of my time — a platform not well-known for its strong culture of unit testing.</p>\n<p>As far as I can tell, the most-recommended resource for unit testing in WordPress is the <a href=\"https://make.wordpress.org/cli/handbook/plugin-unit-tests/\" target=\"_blank\" rel=\"noopener\">scaffolding provided by the WP-CLI.</a> Run a command, and it’ll do things like download a copy of WordPress, set up a test database, and provide some nice-to-have methods for integrating your tests with the WP infrastructure itself. The problem is that every time I’ve tried to get this set up — for both themes and plugins — I’ve run into unexpected database or file structure issues. I spend a good share of time working through them, and then <em>maybe</em> have enough mental motivation to write a test.</p>\n<p><em><strong>There’s got to be an easier way to set this stuff up.</strong></em></p>\n<p>I like what the WP-CLI approach has to offer. The helper methods provided by <code>WP_UnitTestCase</code> (the class you can extend rather than <code>PHPUnit\\Framework\\TestCase</code>) alone might make it worth working through the setup friction. But sometimes, you just wanna start writing some friggin’ tests to build some value for your theme or plugin. In those cases, there’s a better way: <strong>hook it up yourself.</strong> It’s not as scary as it sounds.</p>\n<h2>Let’s Get Set Up</h2>\n<p>For this run-through, I’ll be using my <a href=\"https://github.com/alexmacarthur/wp-skateboard\" target=\"_blank\" rel=\"noopener\">wp-skateboard</a> setup, which runs on Docker, but it really doesn’t matter whether you’re using this, Vagrant, or anything else. But if you are using Docker, make sure you run any of the following commands inside your running container. To help with that, <code>wp-skateboard</code> allows you to run <code>make bash</code> to easily enter the container with a bash prompt.</p>\n<p>We’ll also be using Composer for package management and autoloading. And because most tutorials I’ve found focus on plugins, we’ll stick there too.</p>\n<h3>Install PHPUnit with Composer.</h3>\n<p>To start, <code>cd</code> into your plugin, and go through the prompts of the <code>composer init</code> command. If you already have a <code>composer.json</code> file in the directory, just move on.</p>\n<p>After that, add bit of autoloading data that’ll come in handy later. Here, we tell Composer to automatically include certain files within the <code>tests/</code> directory (where our tests will live) when they’re namespaced to <code>PluginTests</code>. A little more on that in a bit.</p>\n<div class=\"remark-highlight\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"autoload-dev\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"psr-4\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"PluginTests\\\\\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"tests/\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Next up, we need to install PHPUnit.</p>\n<p><code>composer require phpunit/phpunit --dev</code></p>\n<p>After this completes, test your installation with by running the following command.</p>\n<p><code>vendor/bin/phpunit</code></p>\n<p>You should see a bunch of information looking something like this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\">PHPUnit <span class=\"token number\">8.2</span>.3 by Sebastian Bergmann and contributors.\n\nUsage: phpunit <span class=\"token punctuation\">[</span>options<span class=\"token punctuation\">]</span> UnitTest <span class=\"token punctuation\">[</span>UnitTest.php<span class=\"token punctuation\">]</span>\n        phpunit <span class=\"token punctuation\">[</span>options<span class=\"token punctuation\">]</span> <span class=\"token operator\">&#x3C;</span>directory<span class=\"token operator\">></span>\n\nCode Coverage Options:\n\n    --coverage-clover <span class=\"token operator\">&#x3C;</span>file<span class=\"token operator\">></span>    Generate code coverage report <span class=\"token keyword\">in</span> Clover XML <span class=\"token function\">format</span>\n    --coverage-crap4j <span class=\"token operator\">&#x3C;</span>file<span class=\"token operator\">></span>    Generate code coverage report <span class=\"token keyword\">in</span> Crap4J XML <span class=\"token function\">format</span>\n    <span class=\"token punctuation\">..</span>.\n</code></pre></div>\n<h3>Load WordPress via our phpunit.xml file.</h3>\n<p>Since this is a <em>WordPress</em> plugin, we’ll likely need access to some level of WP core functionality in order to effectively test our code. To make all of that available, we’re going to load WP core during our tests by bootstrapping it in our <code>phpunit.xml</code> file. Throw some basic configuration into that file, and take special note of the <code>bootstrap</code> attribute:</p>\n<div class=\"remark-highlight\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token prolog\">&#x3C;?xml version=\"1.0\" encoding=\"UTF-8\"?></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>phpunit</span> <span class=\"token attr-name\">bootstrap</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>bootstrap.php<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>testsuites</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>testsuite</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>WP Unit Testing<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>directory</span> <span class=\"token attr-name\">suffix</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Test.php<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>./tests/<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>directory</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>testsuite</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>testsuites</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>phpunit</span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<p>Here, we’re loading a <code>bootstrap.php</code> file, which will be created in our plugin directory, loading two things:</p>\n<ul>\n<li><code>autoload.php</code> - This is generated by running <code>composer install</code>, and will take care of the PHP autoloading configuration we added earlier.</li>\n<li><code>wp-load.php</code> - This is a file from WordPress core that’ll load the CMS functionality we’ll need to run our plugin’s code as we test it.</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&#x3C;?php</span>\n\n<span class=\"token comment\">// bootstrap.php</span>\n\n<span class=\"token keyword\">require_once</span><span class=\"token punctuation\">(</span><span class=\"token constant\">__DIR__</span> <span class=\"token operator\">.</span> <span class=\"token string double-quoted-string\">\"/../vendor/autoload.php\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">require_once</span><span class=\"token punctuation\">(</span><span class=\"token constant\">__DIR__</span> <span class=\"token operator\">.</span> <span class=\"token string double-quoted-string\">\"/../../../../wp-load.php\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n</code></pre></div>\n<p>With this in place, these two files will be loaded every time our test suite runs, providing us with the resources we need to test.</p>\n<p>Also, take note of this line back in our <code>phpunit.xml</code> file:</p>\n<div class=\"remark-highlight\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>directory</span> <span class=\"token attr-name\">suffix</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Test.php<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>./tests/<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>directory</span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<p>What this is doing is specifying the type of named files we’re doing to run as tests within the <code>./tests</code> directory. Since that suffix is set to “Test.php,” any file that ends with that string will be run.</p>\n<p>At this point, try running <code>vendor/bin/phpunit</code> again. This time, you should see something that looks more like this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\">PHPUnit <span class=\"token number\">7.3</span>.5 by Sebastian Bergmann and contributors.\n\n\n\nTime: <span class=\"token number\">1.03</span> seconds, Memory: <span class=\"token number\">22</span>.00MB\n\nNo tests executed<span class=\"token operator\">!</span>\n</code></pre></div>\n<h2>Testing Time</h2>\n<p>Create a <code>tests</code> directory in your plugin, and inside that, a <code>SomeClassTest.php</code> file. Remember, that file name is important. Now, let’s just verify that we can get a test to run without issue. Throw some meaningless test in there. A method is deemed a test when its name starts with <code>test</code>.</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&#x3C;?php</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">SomeClassTest</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name class-name-fully-qualified\"><span class=\"token punctuation\">\\</span>PHPUnit<span class=\"token punctuation\">\\</span>Framework<span class=\"token punctuation\">\\</span>TestCase</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">test_shouldWork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">assertTrue</span><span class=\"token punctuation\">(</span><span class=\"token constant boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span>\n</code></pre></div>\n<p>Running <code>vendor/bin/phpunit</code> should produce something like the following:</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\">PHPUnit <span class=\"token number\">8.2</span>.3 by Sebastian Bergmann and contributors.\n\n<span class=\"token builtin class-name\">.</span>                                                                   <span class=\"token number\">1</span> / <span class=\"token number\">1</span> <span class=\"token punctuation\">(</span><span class=\"token number\">100</span>%<span class=\"token punctuation\">)</span>\n\nTime: <span class=\"token number\">2.59</span> seconds, Memory: <span class=\"token number\">54.25</span> MB\n</code></pre></div>\n<p>Noice.</p>\n<h3>Let’s make things more WordPress-y.</h3>\n<p>From here on out, we can start leveraging the WordPress ecosystem as needed. For a stupid example, let’s say we have a method that’ll retrieve the content of a post in an emotionalized based on the tags attached to the post. Specifically, we’ll format the content differently if the post is tagged <code>angry</code>, <code>excited</code>, or <code>obnoxious</code>.</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&#x3C;?php</span>\n\n<span class=\"token comment\">/*</span>\n<span class=\"token comment\">Plugin Name: Unit Testing Plugin</span>\n<span class=\"token comment\">*/</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function-definition function\">getEmotionalizedContent</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$postId</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$content</span> <span class=\"token operator\">=</span> <span class=\"token function\">get_the_content</span><span class=\"token punctuation\">(</span><span class=\"token constant\">null</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$postId</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">has_tag</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'angry'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$postId</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$content</span> <span class=\"token operator\">=</span> <span class=\"token function\">strtoupper</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$content</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">has_tag</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'excited'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$postId</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$loudContent</span> <span class=\"token operator\">=</span> <span class=\"token function\">array_map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$character</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$character</span> <span class=\"token operator\">===</span> <span class=\"token string double-quoted-string\">\".\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> <span class=\"token function\">str_repeat</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"!\"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">rand</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">return</span> <span class=\"token variable\">$character</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token function\">str_split</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$content</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$content</span> <span class=\"token operator\">=</span> <span class=\"token function\">implode</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$loudContent</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">has_tag</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'obnoxious'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$postId</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$content</span> <span class=\"token operator\">=</span> <span class=\"token function\">str_replace</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\" \"</span><span class=\"token punctuation\">,</span> <span class=\"token string double-quoted-string\">\" 👏 \"</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$content</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token variable\">$content</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></span>\n</code></pre></div>\n<p>Because our PHPUnit configuration is set to import WordPress core, our tests will have access to this plugin (make sure it’s active in the WP admin!), as well as everything else loaded by WordPress’ <code>wp-load.php</code> file. So, we should be ready to dive in &#x26; test.</p>\n<p>First off, let’s add some code to <code>SomePostClass</code> that’ll provide us with a post to manipulate and clean up after we’re finished.</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">SomePostClass</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name class-name-fully-qualified\"><span class=\"token punctuation\">\\</span>PHPUnit<span class=\"token punctuation\">\\</span>Framework<span class=\"token punctuation\">\\</span>TestCase</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$testPostId</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">setUp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword return-type\">void</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">testPostId</span> <span class=\"token operator\">=</span> <span class=\"token function\">wp_insert_post</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n            <span class=\"token string single-quoted-string\">'post_title'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'Sample Post'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'post_content'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'This is just some sample post content.'</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">tearDown</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword return-type\">void</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">wp_delete_post</span><span class=\"token punctuation\">(</span><span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">testPostId</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">//... tests will go here.</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Leveraging <code>setUp()</code> and <code>tearDown()</code>, we’re creating a fresh WP post and deleting it after any given test method is complete. Since we’re passing <code>true</code> to <code>wp_delete_post</code>, it’ll also <a href=\"https://codex.wordpress.org/Function_Reference/wp_delete_post\" target=\"_blank\" rel=\"noopener\">clean up any attached post meta we create along the way.</a></p>\n<p>After that, we can add our method-specific tests to cover all of our cases.</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">test_getEmotionalizedContent_shouldBeAngryWhenTagIsApplied</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token function\">wp_set_post_tags</span><span class=\"token punctuation\">(</span><span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">testPostId</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'angry'</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">assertEquals</span><span class=\"token punctuation\">(</span>\n        <span class=\"token function\">getEmotionalizedContent</span><span class=\"token punctuation\">(</span><span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">testPostId</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string double-quoted-string\">\"THIS IS JUST SOME SAMPLE POST CONTENT.\"</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">test_getEmotionalizedContent_shouldBeExcitedWhenTagIsApplied</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token function\">wp_set_post_tags</span><span class=\"token punctuation\">(</span><span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">testPostId</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'excited'</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">assertStringEndsWith</span><span class=\"token punctuation\">(</span>\n        <span class=\"token string double-quoted-string\">\"!\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token function\">getEmotionalizedContent</span><span class=\"token punctuation\">(</span><span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">testPostId</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">test_getEmotionalizedContent_shouldBeObnoxiousWhenTagIsApplied</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token function\">wp_set_post_tags</span><span class=\"token punctuation\">(</span><span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">testPostId</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'obnoxious'</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">assertEquals</span><span class=\"token punctuation\">(</span>\n        <span class=\"token function\">getEmotionalizedContent</span><span class=\"token punctuation\">(</span><span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">testPostId</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string double-quoted-string\">\"This 👏 is 👏 just 👏 some 👏 sample 👏 post 👏 content.\"</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">test_getEmotionalizedContent_shouldBeEverythingWhenTagAreApplied</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token function\">wp_set_post_tags</span><span class=\"token punctuation\">(</span><span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">testPostId</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'obnoxious'</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">wp_set_post_tags</span><span class=\"token punctuation\">(</span><span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">testPostId</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'excited'</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">wp_set_post_tags</span><span class=\"token punctuation\">(</span><span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">testPostId</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'angry'</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token function\">getEmotionalizedContent</span><span class=\"token punctuation\">(</span><span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">testPostId</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">assertStringStartsWith</span><span class=\"token punctuation\">(</span>\n        <span class=\"token string double-quoted-string\">\"THIS 👏 IS 👏 JUST 👏 SOME 👏 SAMPLE 👏 POST 👏 CONTENT\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token variable\">$result</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token function\">assertStringEndsWith</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"!\"</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$result</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Running <code>vendor/bin/phpunit</code> again, you should see some success:</p>\n<div class=\"remark-highlight\"><pre class=\"language-shell\"><code class=\"language-shell\">root@bc37c28f5d63:/var/www/html/wp-content/plugins/unit-testing-plugin<span class=\"token comment\"># vendor/bin/phpunitPHPUnit 8.2.3 by Sebastian Bergmann and contributors.</span>\n\n<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>                                                                <span class=\"token number\">4</span> / <span class=\"token number\">4</span> <span class=\"token punctuation\">(</span><span class=\"token number\">100</span>%<span class=\"token punctuation\">)</span>\n\nTime: <span class=\"token number\">3.44</span> seconds, Memory: <span class=\"token number\">32.00</span> MB\n\nOK <span class=\"token punctuation\">(</span><span class=\"token number\">4</span> tests, <span class=\"token number\">5</span> assertions<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>Gr8 work. But as your tests grow, it’s likely that you’ll need to interact with posts throughout several different classes. So, let’s abstract a bit of this WordPress-specific stuff out into its own class that extends <code>\\PHPUnit\\Framework\\TestCase</code>.</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&#x3C;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">PluginTests</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">PostTestCase</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name class-name-fully-qualified\"><span class=\"token punctuation\">\\</span>PHPUnit<span class=\"token punctuation\">\\</span>Framework<span class=\"token punctuation\">\\</span>TestCase</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$testPostId</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">setUp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword return-type\">void</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">testPostId</span> <span class=\"token operator\">=</span> <span class=\"token function\">wp_insert_post</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n            <span class=\"token string single-quoted-string\">'post_title'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'Sample Post'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'post_content'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'This is just some sample post content.'</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">tearDown</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword return-type\">void</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">wp_delete_post</span><span class=\"token punctuation\">(</span><span class=\"token this keyword\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">testPostId</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span>\n</code></pre></div>\n<p>Then, in our test class, we can extend this new helper class:</p>\n<div class=\"remark-highlight\"><pre class=\"language-diff\"><code class=\"language-diff\"><span class=\"token deleted-sign deleted\"><span class=\"token prefix deleted\">-</span><span class=\"token line\">class SomePostTest extends \\PHPUnit\\Framework\\TestCase</span>\n<span class=\"token line\"></span></span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">class SomePostTest extends \\PluginTests\\PostTestCase</span></span>\n</code></pre></div>\n<p>Thanks to that bit of autoloading configuration we did earlier, we don’t need to include our new helper class — it happens automatically, out of sight. And as a result, from here on out, we can easily access <code>$this->testPostId</code> and any other resource we choose to make available in <code>PostTestCase</code>, rather than handling all of the setup and cleanup within our individual test classes.</p>\n<p>As the need arises, you can create your own different test cases from which to extend, perhaps based on the type of resource you need. For example, a <code>\\PluginTests\\UserTestCase</code> might be good to have in order to easily test code pertaining to WordPress user objects.</p>\n<h2>Yeah, Trade-Offs Exist</h2>\n<p>The value this entire approach gives is (hopefully) a quicker path to start writing tests in WordPress. That said, there are some trade-offs that come along it. For example:</p>\n<ul>\n<li><strong>If you’re not careful in how you clean up the data you create when running tests, your local DB could get pretty muddy.</strong> In many cases, it might be better to manually create a test DB and point your application to that while testing. I’m sure there’s some clever programmatic way to do this with the setup I’ve explained, but I haven’t explored those waters much.</li>\n<li><strong>You miss out on the features included with the WordPress-recommended test suite setup.</strong> Yeah, a lot of this would be nice to be able to leverage, but I’ve found that I don’t need much in order to set up valuable tests for my code using this simplified approach here. That could change at any given moment, but until that happens, I’m good with this being sacrificed.</li>\n</ul>\n<h2>Feedback: Whatcha Got?</h2>\n<p>If you’ve got some tips to improve this whole setup without losing its relative simplicity, share them! At any rate, hope this is helpful.</p>\n",
        "feature_image": "https://images.pexels.com/photos/1366942/pexels-photo-1366942.jpeg?cs=srgb&amp;dl=beaker-biology-chemical-1366942.jpg&amp;fm=jpg",
        "status": "published",
        "created_at": 1563944400000,
        "published_at": 1563944400000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>When I was getting started in web development, I remember how conceptually overwhelming it was to understand the whys, whats, and hows around things like unit testing. And to make it even more difficult, WordPress was the environment in which I spent most of my time — a platform not well-known for its strong culture of unit testing.</p>\\n<p>As far as I can tell, the most-recommended resource for unit testing in WordPress is the <a href=\\\"https://make.wordpress.org/cli/handbook/plugin-unit-tests/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">scaffolding provided by the WP-CLI.</a> Run a command, and it’ll do things like download a copy of WordPress, set up a test database, and provide some nice-to-have methods for integrating your tests with the WP infrastructure itself. The problem is that every time I’ve tried to get this set up — for both themes and plugins — I’ve run into unexpected database or file structure issues. I spend a good share of time working through them, and then <em>maybe</em> have enough mental motivation to write a test.</p>\\n<p><em><strong>There’s got to be an easier way to set this stuff up.</strong></em></p>\\n<p>I like what the WP-CLI approach has to offer. The helper methods provided by <code>WP_UnitTestCase</code> (the class you can extend rather than <code>PHPUnit\\\\Framework\\\\TestCase</code>) alone might make it worth working through the setup friction. But sometimes, you just wanna start writing some friggin’ tests to build some value for your theme or plugin. In those cases, there’s a better way: <strong>hook it up yourself.</strong> It’s not as scary as it sounds.</p>\\n<h2>Let’s Get Set Up</h2>\\n<p>For this run-through, I’ll be using my <a href=\\\"https://github.com/alexmacarthur/wp-skateboard\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">wp-skateboard</a> setup, which runs on Docker, but it really doesn’t matter whether you’re using this, Vagrant, or anything else. But if you are using Docker, make sure you run any of the following commands inside your running container. To help with that, <code>wp-skateboard</code> allows you to run <code>make bash</code> to easily enter the container with a bash prompt.</p>\\n<p>We’ll also be using Composer for package management and autoloading. And because most tutorials I’ve found focus on plugins, we’ll stick there too.</p>\\n<h3>Install PHPUnit with Composer.</h3>\\n<p>To start, <code>cd</code> into your plugin, and go through the prompts of the <code>composer init</code> command. If you already have a <code>composer.json</code> file in the directory, just move on.</p>\\n<p>After that, add bit of autoloading data that’ll come in handy later. Here, we tell Composer to automatically include certain files within the <code>tests/</code> directory (where our tests will live) when they’re namespaced to <code>PluginTests</code>. A little more on that in a bit.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-json\\\"><code class=\\\"language-json\\\"><span class=\\\"token property\\\">\\\"autoload-dev\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token property\\\">\\\"psr-4\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token property\\\">\\\"PluginTests\\\\\\\\\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"tests/\\\"</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p>Next up, we need to install PHPUnit.</p>\\n<p><code>composer require phpunit/phpunit --dev</code></p>\\n<p>After this completes, test your installation with by running the following command.</p>\\n<p><code>vendor/bin/phpunit</code></p>\\n<p>You should see a bunch of information looking something like this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\">PHPUnit <span class=\\\"token number\\\">8.2</span>.3 by Sebastian Bergmann and contributors.\\n\\nUsage: phpunit <span class=\\\"token punctuation\\\">[</span>options<span class=\\\"token punctuation\\\">]</span> UnitTest <span class=\\\"token punctuation\\\">[</span>UnitTest.php<span class=\\\"token punctuation\\\">]</span>\\n        phpunit <span class=\\\"token punctuation\\\">[</span>options<span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">&#x3C;</span>directory<span class=\\\"token operator\\\">></span>\\n\\nCode Coverage Options:\\n\\n    --coverage-clover <span class=\\\"token operator\\\">&#x3C;</span>file<span class=\\\"token operator\\\">></span>    Generate code coverage report <span class=\\\"token keyword\\\">in</span> Clover XML <span class=\\\"token function\\\">format</span>\\n    --coverage-crap4j <span class=\\\"token operator\\\">&#x3C;</span>file<span class=\\\"token operator\\\">></span>    Generate code coverage report <span class=\\\"token keyword\\\">in</span> Crap4J XML <span class=\\\"token function\\\">format</span>\\n    <span class=\\\"token punctuation\\\">..</span>.\\n</code></pre></div>\\n<h3>Load WordPress via our phpunit.xml file.</h3>\\n<p>Since this is a <em>WordPress</em> plugin, we’ll likely need access to some level of WP core functionality in order to effectively test our code. To make all of that available, we’re going to load WP core during our tests by bootstrapping it in our <code>phpunit.xml</code> file. Throw some basic configuration into that file, and take special note of the <code>bootstrap</code> attribute:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-xml\\\"><code class=\\\"language-xml\\\"><span class=\\\"token prolog\\\">&#x3C;?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>phpunit</span> <span class=\\\"token attr-name\\\">bootstrap</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>bootstrap.php<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>\\n    <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>testsuites</span><span class=\\\"token punctuation\\\">></span></span>\\n        <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>testsuite</span> <span class=\\\"token attr-name\\\">name</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>WP Unit Testing<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>\\n            <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>directory</span> <span class=\\\"token attr-name\\\">suffix</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>Test.php<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>./tests/<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>directory</span><span class=\\\"token punctuation\\\">></span></span>\\n        <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>testsuite</span><span class=\\\"token punctuation\\\">></span></span>\\n    <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>testsuites</span><span class=\\\"token punctuation\\\">></span></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>phpunit</span><span class=\\\"token punctuation\\\">></span></span>\\n</code></pre></div>\\n<p>Here, we’re loading a <code>bootstrap.php</code> file, which will be created in our plugin directory, loading two things:</p>\\n<ul>\\n<li><code>autoload.php</code> - This is generated by running <code>composer install</code>, and will take care of the PHP autoloading configuration we added earlier.</li>\\n<li><code>wp-load.php</code> - This is a file from WordPress core that’ll load the CMS functionality we’ll need to run our plugin’s code as we test it.</li>\\n</ul>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token php language-php\\\"><span class=\\\"token delimiter important\\\">&#x3C;?php</span>\\n\\n<span class=\\\"token comment\\\">// bootstrap.php</span>\\n\\n<span class=\\\"token keyword\\\">require_once</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token constant\\\">__DIR__</span> <span class=\\\"token operator\\\">.</span> <span class=\\\"token string double-quoted-string\\\">\\\"/../vendor/autoload.php\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">require_once</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token constant\\\">__DIR__</span> <span class=\\\"token operator\\\">.</span> <span class=\\\"token string double-quoted-string\\\">\\\"/../../../../wp-load.php\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span></span>\\n</code></pre></div>\\n<p>With this in place, these two files will be loaded every time our test suite runs, providing us with the resources we need to test.</p>\\n<p>Also, take note of this line back in our <code>phpunit.xml</code> file:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-xml\\\"><code class=\\\"language-xml\\\"><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>directory</span> <span class=\\\"token attr-name\\\">suffix</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>Test.php<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>./tests/<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>directory</span><span class=\\\"token punctuation\\\">></span></span>\\n</code></pre></div>\\n<p>What this is doing is specifying the type of named files we’re doing to run as tests within the <code>./tests</code> directory. Since that suffix is set to “Test.php,” any file that ends with that string will be run.</p>\\n<p>At this point, try running <code>vendor/bin/phpunit</code> again. This time, you should see something that looks more like this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\">PHPUnit <span class=\\\"token number\\\">7.3</span>.5 by Sebastian Bergmann and contributors.\\n\\n\\n\\nTime: <span class=\\\"token number\\\">1.03</span> seconds, Memory: <span class=\\\"token number\\\">22</span>.00MB\\n\\nNo tests executed<span class=\\\"token operator\\\">!</span>\\n</code></pre></div>\\n<h2>Testing Time</h2>\\n<p>Create a <code>tests</code> directory in your plugin, and inside that, a <code>SomeClassTest.php</code> file. Remember, that file name is important. Now, let’s just verify that we can get a test to run without issue. Throw some meaningless test in there. A method is deemed a test when its name starts with <code>test</code>.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token php language-php\\\"><span class=\\\"token delimiter important\\\">&#x3C;?php</span>\\n\\n<span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name-definition class-name\\\">SomeClassTest</span> <span class=\\\"token keyword\\\">extends</span> <span class=\\\"token class-name class-name-fully-qualified\\\"><span class=\\\"token punctuation\\\">\\\\</span>PHPUnit<span class=\\\"token punctuation\\\">\\\\</span>Framework<span class=\\\"token punctuation\\\">\\\\</span>TestCase</span>\\n<span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">public</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token function-definition function\\\">test_shouldWork</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token this keyword\\\">$this</span><span class=\\\"token operator\\\">-></span><span class=\\\"token function\\\">assertTrue</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token constant boolean\\\">true</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span></span>\\n</code></pre></div>\\n<p>Running <code>vendor/bin/phpunit</code> should produce something like the following:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\">PHPUnit <span class=\\\"token number\\\">8.2</span>.3 by Sebastian Bergmann and contributors.\\n\\n<span class=\\\"token builtin class-name\\\">.</span>                                                                   <span class=\\\"token number\\\">1</span> / <span class=\\\"token number\\\">1</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token number\\\">100</span>%<span class=\\\"token punctuation\\\">)</span>\\n\\nTime: <span class=\\\"token number\\\">2.59</span> seconds, Memory: <span class=\\\"token number\\\">54.25</span> MB\\n</code></pre></div>\\n<p>Noice.</p>\\n<h3>Let’s make things more WordPress-y.</h3>\\n<p>From here on out, we can start leveraging the WordPress ecosystem as needed. For a stupid example, let’s say we have a method that’ll retrieve the content of a post in an emotionalized based on the tags attached to the post. Specifically, we’ll format the content differently if the post is tagged <code>angry</code>, <code>excited</code>, or <code>obnoxious</code>.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token php language-php\\\"><span class=\\\"token delimiter important\\\">&#x3C;?php</span>\\n\\n<span class=\\\"token comment\\\">/*</span>\\n<span class=\\\"token comment\\\">Plugin Name: Unit Testing Plugin</span>\\n<span class=\\\"token comment\\\">*/</span>\\n\\n<span class=\\\"token keyword\\\">function</span> <span class=\\\"token function-definition function\\\">getEmotionalizedContent</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">$postId</span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token variable\\\">$content</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">get_the_content</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token constant\\\">null</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constant boolean\\\">false</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token variable\\\">$postId</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token function\\\">has_tag</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string single-quoted-string\\\">'angry'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token variable\\\">$postId</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token variable\\\">$content</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">strtoupper</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">$content</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token function\\\">has_tag</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string single-quoted-string\\\">'excited'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token variable\\\">$postId</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token variable\\\">$loudContent</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">array_map</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">$character</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n            <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">$character</span> <span class=\\\"token operator\\\">===</span> <span class=\\\"token string double-quoted-string\\\">\\\".\\\"</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n                <span class=\\\"token keyword\\\">return</span> <span class=\\\"token function\\\">str_repeat</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string double-quoted-string\\\">\\\"!\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token function\\\">rand</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">10</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n            <span class=\\\"token punctuation\\\">}</span>\\n            <span class=\\\"token keyword\\\">return</span> <span class=\\\"token variable\\\">$character</span><span class=\\\"token punctuation\\\">;</span>\\n        <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token function\\\">str_split</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">$content</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n        <span class=\\\"token variable\\\">$content</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">implode</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">$loudContent</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token function\\\">has_tag</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string single-quoted-string\\\">'obnoxious'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token variable\\\">$postId</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token variable\\\">$content</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">str_replace</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string double-quoted-string\\\">\\\" \\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string double-quoted-string\\\">\\\" 👏 \\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token variable\\\">$content</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n\\n    <span class=\\\"token keyword\\\">return</span> <span class=\\\"token variable\\\">$content</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span></span>\\n</code></pre></div>\\n<p>Because our PHPUnit configuration is set to import WordPress core, our tests will have access to this plugin (make sure it’s active in the WP admin!), as well as everything else loaded by WordPress’ <code>wp-load.php</code> file. So, we should be ready to dive in &#x26; test.</p>\\n<p>First off, let’s add some code to <code>SomePostClass</code> that’ll provide us with a post to manipulate and clean up after we’re finished.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name-definition class-name\\\">SomePostClass</span> <span class=\\\"token keyword\\\">extends</span> <span class=\\\"token class-name class-name-fully-qualified\\\"><span class=\\\"token punctuation\\\">\\\\</span>PHPUnit<span class=\\\"token punctuation\\\">\\\\</span>Framework<span class=\\\"token punctuation\\\">\\\\</span>TestCase</span>\\n<span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">public</span> <span class=\\\"token variable\\\">$testPostId</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword\\\">protected</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token function-definition function\\\">setUp</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token keyword return-type\\\">void</span>\\n    <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token this keyword\\\">$this</span><span class=\\\"token operator\\\">-></span><span class=\\\"token property\\\">testPostId</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">wp_insert_post</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">[</span>\\n            <span class=\\\"token string single-quoted-string\\\">'post_title'</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token string single-quoted-string\\\">'Sample Post'</span><span class=\\\"token punctuation\\\">,</span>\\n            <span class=\\\"token string single-quoted-string\\\">'post_content'</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token string single-quoted-string\\\">'This is just some sample post content.'</span>\\n        <span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token keyword\\\">protected</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token function-definition function\\\">tearDown</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token keyword return-type\\\">void</span>\\n    <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token function\\\">wp_delete_post</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token this keyword\\\">$this</span><span class=\\\"token operator\\\">-></span><span class=\\\"token property\\\">testPostId</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constant boolean\\\">true</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n\\n    <span class=\\\"token comment\\\">//... tests will go here.</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p>Leveraging <code>setUp()</code> and <code>tearDown()</code>, we’re creating a fresh WP post and deleting it after any given test method is complete. Since we’re passing <code>true</code> to <code>wp_delete_post</code>, it’ll also <a href=\\\"https://codex.wordpress.org/Function_Reference/wp_delete_post\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">clean up any attached post meta we create along the way.</a></p>\\n<p>After that, we can add our method-specific tests to cover all of our cases.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token keyword\\\">public</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token function-definition function\\\">test_getEmotionalizedContent_shouldBeAngryWhenTagIsApplied</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token function\\\">wp_set_post_tags</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token this keyword\\\">$this</span><span class=\\\"token operator\\\">-></span><span class=\\\"token property\\\">testPostId</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string single-quoted-string\\\">'angry'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constant boolean\\\">true</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token this keyword\\\">$this</span><span class=\\\"token operator\\\">-></span><span class=\\\"token function\\\">assertEquals</span><span class=\\\"token punctuation\\\">(</span>\\n        <span class=\\\"token function\\\">getEmotionalizedContent</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token this keyword\\\">$this</span><span class=\\\"token operator\\\">-></span><span class=\\\"token property\\\">testPostId</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span>\\n        <span class=\\\"token string double-quoted-string\\\">\\\"THIS IS JUST SOME SAMPLE POST CONTENT.\\\"</span>\\n    <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token keyword\\\">public</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token function-definition function\\\">test_getEmotionalizedContent_shouldBeExcitedWhenTagIsApplied</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token function\\\">wp_set_post_tags</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token this keyword\\\">$this</span><span class=\\\"token operator\\\">-></span><span class=\\\"token property\\\">testPostId</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string single-quoted-string\\\">'excited'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constant boolean\\\">true</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token this keyword\\\">$this</span><span class=\\\"token operator\\\">-></span><span class=\\\"token function\\\">assertStringEndsWith</span><span class=\\\"token punctuation\\\">(</span>\\n        <span class=\\\"token string double-quoted-string\\\">\\\"!\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n        <span class=\\\"token function\\\">getEmotionalizedContent</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token this keyword\\\">$this</span><span class=\\\"token operator\\\">-></span><span class=\\\"token property\\\">testPostId</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token keyword\\\">public</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token function-definition function\\\">test_getEmotionalizedContent_shouldBeObnoxiousWhenTagIsApplied</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token function\\\">wp_set_post_tags</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token this keyword\\\">$this</span><span class=\\\"token operator\\\">-></span><span class=\\\"token property\\\">testPostId</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string single-quoted-string\\\">'obnoxious'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constant boolean\\\">true</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token this keyword\\\">$this</span><span class=\\\"token operator\\\">-></span><span class=\\\"token function\\\">assertEquals</span><span class=\\\"token punctuation\\\">(</span>\\n        <span class=\\\"token function\\\">getEmotionalizedContent</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token this keyword\\\">$this</span><span class=\\\"token operator\\\">-></span><span class=\\\"token property\\\">testPostId</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span>\\n        <span class=\\\"token string double-quoted-string\\\">\\\"This 👏 is 👏 just 👏 some 👏 sample 👏 post 👏 content.\\\"</span>\\n    <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token keyword\\\">public</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token function-definition function\\\">test_getEmotionalizedContent_shouldBeEverythingWhenTagAreApplied</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token function\\\">wp_set_post_tags</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token this keyword\\\">$this</span><span class=\\\"token operator\\\">-></span><span class=\\\"token property\\\">testPostId</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string single-quoted-string\\\">'obnoxious'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constant boolean\\\">true</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token function\\\">wp_set_post_tags</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token this keyword\\\">$this</span><span class=\\\"token operator\\\">-></span><span class=\\\"token property\\\">testPostId</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string single-quoted-string\\\">'excited'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constant boolean\\\">true</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token function\\\">wp_set_post_tags</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token this keyword\\\">$this</span><span class=\\\"token operator\\\">-></span><span class=\\\"token property\\\">testPostId</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string single-quoted-string\\\">'angry'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constant boolean\\\">true</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token variable\\\">$result</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">getEmotionalizedContent</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token this keyword\\\">$this</span><span class=\\\"token operator\\\">-></span><span class=\\\"token property\\\">testPostId</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token this keyword\\\">$this</span><span class=\\\"token operator\\\">-></span><span class=\\\"token function\\\">assertStringStartsWith</span><span class=\\\"token punctuation\\\">(</span>\\n        <span class=\\\"token string double-quoted-string\\\">\\\"THIS 👏 IS 👏 JUST 👏 SOME 👏 SAMPLE 👏 POST 👏 CONTENT\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n        <span class=\\\"token variable\\\">$result</span>\\n    <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token this keyword\\\">$this</span><span class=\\\"token operator\\\">-></span><span class=\\\"token function\\\">assertStringEndsWith</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string double-quoted-string\\\">\\\"!\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token variable\\\">$result</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p>Running <code>vendor/bin/phpunit</code> again, you should see some success:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-shell\\\"><code class=\\\"language-shell\\\">root@bc37c28f5d63:/var/www/html/wp-content/plugins/unit-testing-plugin<span class=\\\"token comment\\\"># vendor/bin/phpunitPHPUnit 8.2.3 by Sebastian Bergmann and contributors.</span>\\n\\n<span class=\\\"token punctuation\\\">..</span><span class=\\\"token punctuation\\\">..</span>                                                                <span class=\\\"token number\\\">4</span> / <span class=\\\"token number\\\">4</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token number\\\">100</span>%<span class=\\\"token punctuation\\\">)</span>\\n\\nTime: <span class=\\\"token number\\\">3.44</span> seconds, Memory: <span class=\\\"token number\\\">32.00</span> MB\\n\\nOK <span class=\\\"token punctuation\\\">(</span><span class=\\\"token number\\\">4</span> tests, <span class=\\\"token number\\\">5</span> assertions<span class=\\\"token punctuation\\\">)</span>\\n</code></pre></div>\\n<p>Gr8 work. But as your tests grow, it’s likely that you’ll need to interact with posts throughout several different classes. So, let’s abstract a bit of this WordPress-specific stuff out into its own class that extends <code>\\\\PHPUnit\\\\Framework\\\\TestCase</code>.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token php language-php\\\"><span class=\\\"token delimiter important\\\">&#x3C;?php</span>\\n\\n<span class=\\\"token keyword\\\">namespace</span> <span class=\\\"token package\\\">PluginTests</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name-definition class-name\\\">PostTestCase</span> <span class=\\\"token keyword\\\">extends</span> <span class=\\\"token class-name class-name-fully-qualified\\\"><span class=\\\"token punctuation\\\">\\\\</span>PHPUnit<span class=\\\"token punctuation\\\">\\\\</span>Framework<span class=\\\"token punctuation\\\">\\\\</span>TestCase</span>\\n<span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">public</span> <span class=\\\"token variable\\\">$testPostId</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword\\\">public</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token function-definition function\\\">setUp</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token keyword return-type\\\">void</span>\\n    <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token this keyword\\\">$this</span><span class=\\\"token operator\\\">-></span><span class=\\\"token property\\\">testPostId</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">wp_insert_post</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">[</span>\\n            <span class=\\\"token string single-quoted-string\\\">'post_title'</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token string single-quoted-string\\\">'Sample Post'</span><span class=\\\"token punctuation\\\">,</span>\\n            <span class=\\\"token string single-quoted-string\\\">'post_content'</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token string single-quoted-string\\\">'This is just some sample post content.'</span>\\n        <span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n\\n    <span class=\\\"token keyword\\\">public</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token function-definition function\\\">tearDown</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token keyword return-type\\\">void</span>\\n    <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token function\\\">wp_delete_post</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token this keyword\\\">$this</span><span class=\\\"token operator\\\">-></span><span class=\\\"token property\\\">testPostId</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constant boolean\\\">true</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span></span>\\n</code></pre></div>\\n<p>Then, in our test class, we can extend this new helper class:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-diff\\\"><code class=\\\"language-diff\\\"><span class=\\\"token deleted-sign deleted\\\"><span class=\\\"token prefix deleted\\\">-</span><span class=\\\"token line\\\">class SomePostTest extends \\\\PHPUnit\\\\Framework\\\\TestCase</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">class SomePostTest extends \\\\PluginTests\\\\PostTestCase</span></span>\\n</code></pre></div>\\n<p>Thanks to that bit of autoloading configuration we did earlier, we don’t need to include our new helper class — it happens automatically, out of sight. And as a result, from here on out, we can easily access <code>$this->testPostId</code> and any other resource we choose to make available in <code>PostTestCase</code>, rather than handling all of the setup and cleanup within our individual test classes.</p>\\n<p>As the need arises, you can create your own different test cases from which to extend, perhaps based on the type of resource you need. For example, a <code>\\\\PluginTests\\\\UserTestCase</code> might be good to have in order to easily test code pertaining to WordPress user objects.</p>\\n<h2>Yeah, Trade-Offs Exist</h2>\\n<p>The value this entire approach gives is (hopefully) a quicker path to start writing tests in WordPress. That said, there are some trade-offs that come along it. For example:</p>\\n<ul>\\n<li><strong>If you’re not careful in how you clean up the data you create when running tests, your local DB could get pretty muddy.</strong> In many cases, it might be better to manually create a test DB and point your application to that while testing. I’m sure there’s some clever programmatic way to do this with the setup I’ve explained, but I haven’t explored those waters much.</li>\\n<li><strong>You miss out on the features included with the WordPress-recommended test suite setup.</strong> Yeah, a lot of this would be nice to be able to leverage, but I’ve found that I don’t need much in order to set up valuable tests for my code using this simplified approach here. That could change at any given moment, but until that happens, I’m good with this being sacrificed.</li>\\n</ul>\\n<h2>Feedback: Whatcha Got?</h2>\\n<p>If you’ve got some tips to improve this whole setup without losing its relative simplicity, share them! At any rate, hope this is helpful.</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 44,
        "title": "Creating a .map() Method for Objects, Strings, Sets, and Maps",
        "slug": "creating-a-map-method-for-objects-strings-sets-and-maps",
        "html": "<p>It’s a well-established truth of the universe that JavaScript’s <code>Array.prototype.map()</code> is one of the best parts of the language, allowing us to write cleaner, simpler code to manipulate array values, instead of using something like <code>forEach()</code>.</p>\n<p>For example, let’s say we want to create a copy of an array with values that are tripled.</p>\n<p><strong>The Uncool Way</strong></p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> someNumz <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> someTripledNumz <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\nsomeNumz<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">value<span class=\"token punctuation\">,</span> index</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  someTripledNumz<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">push</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">*</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>someNumz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//-- [2, 3, 5, 4, 5]</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>someTripledNumz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//-- [6, 9, 15, 12, 15]</span>\n</code></pre></div>\n<p>That works, but it’s rough around the edges. We need to declare an empty <code>someTripledNumz</code> array above, and <em>then</em> go through the process of tripling everything. But with <code>.map()</code>, things look better:</p>\n<p><strong>The Cool Way</strong></p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> someNumz <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> someTripledNumz <span class=\"token operator\">=</span> someNumz<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span> <span class=\"token arrow operator\">=></span> item <span class=\"token operator\">*</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>someNumz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//-- [2, 3, 5, 4, 5]</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>someTripledNumz<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//-- [6, 9, 15, 12, 15]</span>\n</code></pre></div>\n<h2>What if we want to <code>map()</code> over the values of an <em>object</em>?</h2>\n<p>As it stands, you can’t. There’s no <code>.map()</code> method that exists on any object for us to use out of the box. But, thanks to <a href=\"https://medium.com/@kevincennis/prototypal-inheritance-781bccc97edb\" target=\"_blank\" rel=\"noopener\">prototypal inheritance</a>, JavaScript provides a way to make that happen. We’re gonna try it out, so that afterward, we’ll be able to do something like this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> oldObject <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">first</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">second</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">third</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> newObject <span class=\"token operator\">=</span> oldObject<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">,</span> thing</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> item <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>newObject<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// { first: 2, second: 4, third: 6 }</span>\n</code></pre></div>\n<h2>Let’s Map() Over an Object</h2>\n<p>First, let’s add an empty <code>.map()</code> method to the <code>Object</code> prototype. That method will accept a single argument: the callback method we’d like to fire on each of the values.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">map</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">func</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Next up, let’s pull all of our values out of the object we we’d like to map (it’ll be available within the <code>this</code> object), and actually <code>map()</code> over them like any other array, firing our function on each item.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">map</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">func</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Collect an array of each value within the object.</span>\n  <span class=\"token keyword\">let</span> oldValues <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">values</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Manipulate those values with the provided callback method.</span>\n  <span class=\"token keyword\">let</span> newValues <span class=\"token operator\">=</span> oldValues<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item<span class=\"token punctuation\">,</span> index</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> func<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span><span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span> item<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Notice that when we fire that method, we’re also passing in the <code>index</code> and the original object itself as parameters. This is to keep our method as close to the actual <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map#Syntax\" target=\"_blank\" rel=\"noopener\">specification</a> as reasonably possible.</p>\n<p>Once we have those manipulated values, we can piece our object back together with the appropriate keys.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">map</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">func</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Collect an array of each value within the object.</span>\n  <span class=\"token keyword\">let</span> oldValues <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">values</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Manipulate those values with the provided callback method.</span>\n  <span class=\"token keyword\">let</span> newValues <span class=\"token operator\">=</span> oldValues<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item<span class=\"token punctuation\">,</span> index</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> func<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span><span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span> item<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Reconstruct our object with each modified value.</span>\n  <span class=\"token keyword\">let</span> mappedObject <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">keys</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">key<span class=\"token punctuation\">,</span> index</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      mappedObject<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> newValues<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword control-flow\">return</span> mappedObject<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>We did it! But if you’re like me, you’re hungry for more. So, let’s:</p>\n<p><img src='/proxy/0ba610da-74cc-445e-b709-cc1aed76fc98' alt='' loading='lazy' /></p>\n<p>Sidebar: It was <em>really</em> difficult to commit to using that meme. So overused. So 2013. But I’m choosing to submit to its applicability for this post. Now, we continue:</p>\n<h2>Let’s Map() Over a String()</h2>\n<p>This one’s a bit simpler than our <code>Object</code> map. Turn the target string into an array, <code>map()</code> over it as per usual, and turn it back into a string:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">map</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">func</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> stringArray <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">let</span> newStringArray <span class=\"token operator\">=</span> stringArray<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item<span class=\"token punctuation\">,</span> index</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> func<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span><span class=\"token dom variable\">window</span><span class=\"token punctuation\">,</span> item<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword control-flow\">return</span> newStringArray<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Then, we can do something like this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> newString <span class=\"token operator\">=</span> <span class=\"token string\">\"I want to scream this!\"</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">item<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">,</span> thing</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> item<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toUpperCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>newString<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 'I WANT TO SCREAM THIS!'</span>\n</code></pre></div>\n<h2>Let’s Map() Over a Set()</h2>\n<p>Since it’s array-like, mapping over a Set is also relatively straightforward. Make it into an array, do the things, turn it back into a set. Thanks to the syntax of modern JavaScript, it looks pretty clean.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token class-name\">Set</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">map</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">func</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> setArray <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token spread operator\">...</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">let</span> newSetArray <span class=\"token operator\">=</span> setArray<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item<span class=\"token punctuation\">,</span> index</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> func<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span><span class=\"token dom variable\">window</span><span class=\"token punctuation\">,</span> item<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Set</span><span class=\"token punctuation\">(</span>newSetArray<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> oldSet <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> newSet <span class=\"token operator\">=</span> oldSet<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">item<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">,</span> thing</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> item <span class=\"token operator\">*</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>newSet<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Set { 3, 6, 9, 12, 15 }</span>\n</code></pre></div>\n<h2>Let’s Map() Over a Map</h2>\n<p>This is where things get a wee bit nuttier. As we did before, the first thing we want to do in performing a <code>map()</code> on a <code>Map()</code> is get our target Map as an array. Take note of the format of this new array. Each item in that array is stored as an array itself, with the first item being the key, and the second being the value:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> myMap <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmyMap<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'item 1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'value 1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmyMap<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'item 2'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'value 2'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token spread operator\">...</span>myMap<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// [ [ 'item 1', 'value 1' ], [ 'item 2', 'value 2' ] ]</span>\n</code></pre></div>\n<p>So, our prototype method beings like this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token class-name\">Map</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">map</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">func</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> mapAsArray <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token spread operator\">...</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>And then, we’ll map over each item, handing if off to our callback method to do its thing.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token class-name\">Map</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">map</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">func</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> mapAsArray <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token spread operator\">...</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">let</span> newMapAsArray <span class=\"token operator\">=</span> mapAsArray<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item<span class=\"token punctuation\">,</span> index</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> func<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span><span class=\"token dom variable\">window</span><span class=\"token punctuation\">,</span> item<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>And finally, piece that sucker back together by creating a new Map and adding values it it from our <code>newMapAsArray</code>.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token class-name\">Map</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">prototype</span><span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">map</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">func</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> mapAsArray <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token spread operator\">...</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">let</span> newMapAsArray <span class=\"token operator\">=</span> mapAsArray<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item<span class=\"token punctuation\">,</span> index</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> func<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">call</span><span class=\"token punctuation\">(</span><span class=\"token dom variable\">window</span><span class=\"token punctuation\">,</span> item<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Construct a new Map() with our modified values.</span>\n  <span class=\"token keyword\">let</span> newMap <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  newMapAsArray<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Remember, each item contains the [key, value] for our Map item.</span>\n    newMap<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">set</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> item<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword control-flow\">return</span> newMap<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Let’s try it out. If you weren’t aware, the keys or values don’t <em>have</em> to be of a particular type — objects, numbers, functions, etc. So, <code>map()</code> with responsibility.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> myMap <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmyMap<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'my first item'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmyMap<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> newMap <span class=\"token operator\">=</span> myMap<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">item<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">,</span> thing</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// We only want to modify the _value_ of the item.</span>\n  item<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> item<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">*</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword control-flow\">return</span> item<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Turn it back into an array just for ease of inspection.</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token spread operator\">...</span>newMap<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// [ [ 'my first item', 3 ], [ {}, 6 ] ]</span>\n</code></pre></div>\n<h2>Try the Package</h2>\n<p>Since what I wrote here includes a lot of functional, possibly useful code, I wrapped it all up into a package, ready for consumption. You can <a href=\"https://github.com/alexmacarthur/map-everything\" target=\"_blank\" rel=\"noopener\">check it out here</a>, and/or dive right in with <code>npm install map-everything</code>.</p>\n<h2>Code with Caution</h2>\n<p>Most of this was born out of “wouldn’t it be cool, if” within my brain. So, before shipping anything to production, be very intentional about what you’re manipulating, or deciding if it’s even worth adding these methods to all of these prototypes. All that said, this sure was fun! Thanks for mapping with me.</p>\n",
        "feature_image": "https://images.pexels.com/photos/1078850/pexels-photo-1078850.jpeg?auto=format%2Ccompress&amp;cs=tinysrgb&amp;dpr=2&amp;h=750&amp;w=1260",
        "status": "published",
        "created_at": 1560920400000,
        "published_at": 1560920400000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>It’s a well-established truth of the universe that JavaScript’s <code>Array.prototype.map()</code> is one of the best parts of the language, allowing us to write cleaner, simpler code to manipulate array values, instead of using something like <code>forEach()</code>.</p>\\n<p>For example, let’s say we want to create a copy of an array with values that are tripled.</p>\\n<p><strong>The Uncool Way</strong></p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">let</span> someNumz <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token number\\\">2</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">3</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">5</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">4</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">5</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">let</span> someTripledNumz <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n\\nsomeNumz<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">forEach</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">value<span class=\\\"token punctuation\\\">,</span> index</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  someTripledNumz<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">push</span><span class=\\\"token punctuation\\\">(</span>value <span class=\\\"token operator\\\">*</span> <span class=\\\"token number\\\">3</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span>someNumz<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span> <span class=\\\"token comment\\\">//-- [2, 3, 5, 4, 5]</span>\\n<span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span>someTripledNumz<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span> <span class=\\\"token comment\\\">//-- [6, 9, 15, 12, 15]</span>\\n</code></pre></div>\\n<p>That works, but it’s rough around the edges. We need to declare an empty <code>someTripledNumz</code> array above, and <em>then</em> go through the process of tripling everything. But with <code>.map()</code>, things look better:</p>\\n<p><strong>The Cool Way</strong></p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">let</span> someNumz <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token number\\\">2</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">3</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">5</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">4</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">5</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">let</span> someTripledNumz <span class=\\\"token operator\\\">=</span> someNumz<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">map</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">item</span> <span class=\\\"token arrow operator\\\">=></span> item <span class=\\\"token operator\\\">*</span> <span class=\\\"token number\\\">3</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span>someNumz<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span> <span class=\\\"token comment\\\">//-- [2, 3, 5, 4, 5]</span>\\n<span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span>someTripledNumz<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span> <span class=\\\"token comment\\\">//-- [6, 9, 15, 12, 15]</span>\\n</code></pre></div>\\n<h2>What if we want to <code>map()</code> over the values of an <em>object</em>?</h2>\\n<p>As it stands, you can’t. There’s no <code>.map()</code> method that exists on any object for us to use out of the box. But, thanks to <a href=\\\"https://medium.com/@kevincennis/prototypal-inheritance-781bccc97edb\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">prototypal inheritance</a>, JavaScript provides a way to make that happen. We’re gonna try it out, so that afterward, we’ll be able to do something like this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">let</span> oldObject <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token literal-property property\\\">first</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token literal-property property\\\">second</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">2</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token literal-property property\\\">third</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">3</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">let</span> newObject <span class=\\\"token operator\\\">=</span> oldObject<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">map</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">function</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">item<span class=\\\"token punctuation\\\">,</span> index<span class=\\\"token punctuation\\\">,</span> thing</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword control-flow\\\">return</span> item <span class=\\\"token operator\\\">*</span> <span class=\\\"token number\\\">2</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span>newObject<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// { first: 2, second: 4, third: 6 }</span>\\n</code></pre></div>\\n<h2>Let’s Map() Over an Object</h2>\\n<p>First, let’s add an empty <code>.map()</code> method to the <code>Object</code> prototype. That method will accept a single argument: the callback method we’d like to fire on each of the values.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token class-name\\\">Object</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">prototype</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method-variable function-variable method function property-access\\\">map</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">func</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p>Next up, let’s pull all of our values out of the object we we’d like to map (it’ll be available within the <code>this</code> object), and actually <code>map()</code> over them like any other array, firing our function on each item.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token class-name\\\">Object</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">prototype</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method-variable function-variable method function property-access\\\">map</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">func</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token comment\\\">// Collect an array of each value within the object.</span>\\n  <span class=\\\"token keyword\\\">let</span> oldValues <span class=\\\"token operator\\\">=</span> <span class=\\\"token known-class-name class-name\\\">Object</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">values</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token comment\\\">// Manipulate those values with the provided callback method.</span>\\n  <span class=\\\"token keyword\\\">let</span> newValues <span class=\\\"token operator\\\">=</span> oldValues<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">map</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">item<span class=\\\"token punctuation\\\">,</span> index</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword control-flow\\\">return</span> func<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">call</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword null nil\\\">null</span><span class=\\\"token punctuation\\\">,</span> item<span class=\\\"token punctuation\\\">,</span> index<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p>Notice that when we fire that method, we’re also passing in the <code>index</code> and the original object itself as parameters. This is to keep our method as close to the actual <a href=\\\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map#Syntax\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">specification</a> as reasonably possible.</p>\\n<p>Once we have those manipulated values, we can piece our object back together with the appropriate keys.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token class-name\\\">Object</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">prototype</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method-variable function-variable method function property-access\\\">map</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">func</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token comment\\\">// Collect an array of each value within the object.</span>\\n  <span class=\\\"token keyword\\\">let</span> oldValues <span class=\\\"token operator\\\">=</span> <span class=\\\"token known-class-name class-name\\\">Object</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">values</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token comment\\\">// Manipulate those values with the provided callback method.</span>\\n  <span class=\\\"token keyword\\\">let</span> newValues <span class=\\\"token operator\\\">=</span> oldValues<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">map</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">item<span class=\\\"token punctuation\\\">,</span> index</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword control-flow\\\">return</span> func<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">call</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword null nil\\\">null</span><span class=\\\"token punctuation\\\">,</span> item<span class=\\\"token punctuation\\\">,</span> index<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token comment\\\">// Reconstruct our object with each modified value.</span>\\n  <span class=\\\"token keyword\\\">let</span> mappedObject <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token known-class-name class-name\\\">Object</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">keys</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">forEach</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">key<span class=\\\"token punctuation\\\">,</span> index</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      mappedObject<span class=\\\"token punctuation\\\">[</span>key<span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">=</span> newValues<span class=\\\"token punctuation\\\">[</span>index<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword control-flow\\\">return</span> mappedObject<span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p>We did it! But if you’re like me, you’re hungry for more. So, let’s:</p>\\n<p><img src='/proxy/0ba610da-74cc-445e-b709-cc1aed76fc98' alt='' loading='lazy' /></p>\\n<p>Sidebar: It was <em>really</em> difficult to commit to using that meme. So overused. So 2013. But I’m choosing to submit to its applicability for this post. Now, we continue:</p>\\n<h2>Let’s Map() Over a String()</h2>\\n<p>This one’s a bit simpler than our <code>Object</code> map. Turn the target string into an array, <code>map()</code> over it as per usual, and turn it back into a string:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token class-name\\\">String</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">prototype</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method-variable function-variable method function property-access\\\">map</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">function</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">func</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">let</span> stringArray <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">split</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">let</span> newStringArray <span class=\\\"token operator\\\">=</span> stringArray<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">map</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">item<span class=\\\"token punctuation\\\">,</span> index</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword control-flow\\\">return</span> func<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">call</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token dom variable\\\">window</span><span class=\\\"token punctuation\\\">,</span> item<span class=\\\"token punctuation\\\">,</span> index<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword control-flow\\\">return</span> newStringArray<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">join</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>Then, we can do something like this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">let</span> newString <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"I want to scream this!\\\"</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">map</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">item<span class=\\\"token punctuation\\\">,</span> index<span class=\\\"token punctuation\\\">,</span> thing</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword control-flow\\\">return</span> item<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">toUpperCase</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span>newString<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// 'I WANT TO SCREAM THIS!'</span>\\n</code></pre></div>\\n<h2>Let’s Map() Over a Set()</h2>\\n<p>Since it’s array-like, mapping over a Set is also relatively straightforward. Make it into an array, do the things, turn it back into a set. Thanks to the syntax of modern JavaScript, it looks pretty clean.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token class-name\\\">Set</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">prototype</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method-variable function-variable method function property-access\\\">map</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">function</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">func</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">let</span> setArray <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token spread operator\\\">...</span><span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">let</span> newSetArray <span class=\\\"token operator\\\">=</span> setArray<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">map</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">item<span class=\\\"token punctuation\\\">,</span> index</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword control-flow\\\">return</span> func<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">call</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token dom variable\\\">window</span><span class=\\\"token punctuation\\\">,</span> item<span class=\\\"token punctuation\\\">,</span> index<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Set</span><span class=\\\"token punctuation\\\">(</span>newSetArray<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">let</span> oldSet <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Set</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">[</span><span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">2</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">3</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">4</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">5</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">let</span> newSet <span class=\\\"token operator\\\">=</span> oldSet<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">map</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">item<span class=\\\"token punctuation\\\">,</span> index<span class=\\\"token punctuation\\\">,</span> thing</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword control-flow\\\">return</span> item <span class=\\\"token operator\\\">*</span> <span class=\\\"token number\\\">3</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span>newSet<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// Set { 3, 6, 9, 12, 15 }</span>\\n</code></pre></div>\\n<h2>Let’s Map() Over a Map</h2>\\n<p>This is where things get a wee bit nuttier. As we did before, the first thing we want to do in performing a <code>map()</code> on a <code>Map()</code> is get our target Map as an array. Take note of the format of this new array. Each item in that array is stored as an array itself, with the first item being the key, and the second being the value:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">let</span> myMap <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Map</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nmyMap<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">set</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'item 1'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">'value 1'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nmyMap<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">set</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'item 2'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">'value 2'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">[</span><span class=\\\"token spread operator\\\">...</span>myMap<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// [ [ 'item 1', 'value 1' ], [ 'item 2', 'value 2' ] ]</span>\\n</code></pre></div>\\n<p>So, our prototype method beings like this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token class-name\\\">Map</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">prototype</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method-variable function-variable method function property-access\\\">map</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">function</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">func</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">let</span> mapAsArray <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token spread operator\\\">...</span><span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>And then, we’ll map over each item, handing if off to our callback method to do its thing.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token class-name\\\">Map</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">prototype</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method-variable function-variable method function property-access\\\">map</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">function</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">func</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">let</span> mapAsArray <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token spread operator\\\">...</span><span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">let</span> newMapAsArray <span class=\\\"token operator\\\">=</span> mapAsArray<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">map</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">item<span class=\\\"token punctuation\\\">,</span> index</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword control-flow\\\">return</span> func<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">call</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token dom variable\\\">window</span><span class=\\\"token punctuation\\\">,</span> item<span class=\\\"token punctuation\\\">,</span> index<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>And finally, piece that sucker back together by creating a new Map and adding values it it from our <code>newMapAsArray</code>.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token class-name\\\">Map</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">prototype</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method-variable function-variable method function property-access\\\">map</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">function</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">func</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">let</span> mapAsArray <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token spread operator\\\">...</span><span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">let</span> newMapAsArray <span class=\\\"token operator\\\">=</span> mapAsArray<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">map</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">item<span class=\\\"token punctuation\\\">,</span> index</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword control-flow\\\">return</span> func<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">call</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token dom variable\\\">window</span><span class=\\\"token punctuation\\\">,</span> item<span class=\\\"token punctuation\\\">,</span> index<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token comment\\\">// Construct a new Map() with our modified values.</span>\\n  <span class=\\\"token keyword\\\">let</span> newMap <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Map</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  newMapAsArray<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">forEach</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">item</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token comment\\\">// Remember, each item contains the [key, value] for our Map item.</span>\\n    newMap<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">set</span><span class=\\\"token punctuation\\\">(</span>item<span class=\\\"token punctuation\\\">[</span><span class=\\\"token number\\\">0</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span> item<span class=\\\"token punctuation\\\">[</span><span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword control-flow\\\">return</span> newMap<span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>Let’s try it out. If you weren’t aware, the keys or values don’t <em>have</em> to be of a particular type — objects, numbers, functions, etc. So, <code>map()</code> with responsibility.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">let</span> myMap <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Map</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nmyMap<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">set</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'my first item'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nmyMap<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">set</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">2</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">let</span> newMap <span class=\\\"token operator\\\">=</span> myMap<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">map</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">item<span class=\\\"token punctuation\\\">,</span> index<span class=\\\"token punctuation\\\">,</span> thing</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token comment\\\">// We only want to modify the _value_ of the item.</span>\\n  item<span class=\\\"token punctuation\\\">[</span><span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">=</span> item<span class=\\\"token punctuation\\\">[</span><span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">*</span> <span class=\\\"token number\\\">3</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword control-flow\\\">return</span> item<span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// Turn it back into an array just for ease of inspection.</span>\\n<span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">[</span><span class=\\\"token spread operator\\\">...</span>newMap<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// [ [ 'my first item', 3 ], [ {}, 6 ] ]</span>\\n</code></pre></div>\\n<h2>Try the Package</h2>\\n<p>Since what I wrote here includes a lot of functional, possibly useful code, I wrapped it all up into a package, ready for consumption. You can <a href=\\\"https://github.com/alexmacarthur/map-everything\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">check it out here</a>, and/or dive right in with <code>npm install map-everything</code>.</p>\\n<h2>Code with Caution</h2>\\n<p>Most of this was born out of “wouldn’t it be cool, if” within my brain. So, before shipping anything to production, be very intentional about what you’re manipulating, or deciding if it’s even worth adding these methods to all of these prototypes. All that said, this sure was fun! Thanks for mapping with me.</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 45,
        "title": "Remember to Probably Target an Empty Object with Object.assign()",
        "slug": "remember-to-probably-target-an-empty-object-with-object-assign",
        "html": "<p>Hearken back, for a moment, to what it was like merging objects in 2014. There was no support for the feature in JavaScript runtimes themselves, and it was quite common to find a solution to the problem by wading through StackOverflow to find something like this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">merge</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">obj1<span class=\"token punctuation\">,</span> obj2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> newObject <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> attributeName <span class=\"token keyword\">in</span> obj1<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    newObject<span class=\"token punctuation\">[</span>attributeName<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> obj1<span class=\"token punctuation\">[</span>attributeName<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> attributeName <span class=\"token keyword\">in</span> obj2<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    newObject<span class=\"token punctuation\">[</span>attributeName<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> obj2<span class=\"token punctuation\">[</span>attributeName<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword control-flow\">return</span> newObject<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> var1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">key1</span><span class=\"token operator\">:</span> <span class=\"token string\">\"value1\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> var2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">key2</span><span class=\"token operator\">:</span> <span class=\"token string\">\"value2\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">merge</span><span class=\"token punctuation\">(</span>var1<span class=\"token punctuation\">,</span> var2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// { key1: \"value1\", key2: \"value2\" }</span>\n</code></pre></div>\n<p>Despite the advancements JavaScript has made since then, I reminisce this approach. It’s extremely clear what’s going on when you throw values into the method. The two objects are received, and a new, separate object is returned containing the properties &#x26; values of both. Neither of your arguments are modified at all, and you could continue to go on and use <code>var1</code> and <code>var2</code> elsewhere, unscathed.</p>\n<p>Recently, I made the mistake in assuming that <code>Object.assign()</code> operates in a similar way. I wanted a new merged object, but I also wanted to preserve the values I passed into the method for later use.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> var1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">key1</span><span class=\"token operator\">:</span> <span class=\"token string\">\"value1\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> var2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">key2</span><span class=\"token operator\">:</span> <span class=\"token string\">\"value2\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> var3 <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">assign</span><span class=\"token punctuation\">(</span>var1<span class=\"token punctuation\">,</span> var2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>I <em>expected</em> this to leave each of my three variables with the following values:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// What I THOUGHT I'd get:</span>\n\nvar1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">key1</span><span class=\"token operator\">:</span> <span class=\"token string\">\"value1\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nvar2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">key2</span><span class=\"token operator\">:</span> <span class=\"token string\">\"value2\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nvar3 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">key1</span><span class=\"token operator\">:</span> <span class=\"token string\">\"value1\"</span>\n  <span class=\"token literal-property property\">key2</span><span class=\"token operator\">:</span> <span class=\"token string\">\"value2\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>But that’s not what I got. Instead, <code>var1</code> had been mutated, giving it the exact same value as <code>var3</code>:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// What I ACTUALLY got:</span>\n\nvar1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">key1</span><span class=\"token operator\">:</span> <span class=\"token string\">\"value1\"</span>\n  <span class=\"token literal-property property\">key2</span><span class=\"token operator\">:</span> <span class=\"token string\">\"value2\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nvar2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">key2</span><span class=\"token operator\">:</span> <span class=\"token string\">\"value2\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nvar3 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">key1</span><span class=\"token operator\">:</span> <span class=\"token string\">\"value1\"</span>\n  <span class=\"token literal-property property\">key2</span><span class=\"token operator\">:</span> <span class=\"token string\">\"value2\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Looking at <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\" target=\"_blank\" rel=\"noopener\">the documentation</a> for <code>Object.assign()</code>, this makes sense. Here’s the syntax:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token known-class-name class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">assign</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> <span class=\"token spread operator\">...</span>sources<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>And the description is pretty clear about what it does:</p>\n<p>“The Object.assign() method is used to copy the values of all enumerable own properties from one or more <em>source</em> objects to a <em>target</em> object. It will return the target object.”</p>\n<p>The method makes no promises to not mutate that target object. It’ll copy over properties to it and spit it that mutated version back to you.</p>\n<p>Obviously, the solution to this is pretty simple. Pass a new, empty object as the target, and you’re good to go:</p>\n<div class=\"remark-highlight\"><pre class=\"language-diff\"><code class=\"language-diff\"><span class=\"token deleted-sign deleted\"><span class=\"token prefix deleted\">-</span><span class=\"token line\">let var3 = Object.assign(var1, var2);</span>\n<span class=\"token line\"></span></span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span><span class=\"token line\">let var3 = Object.assign({}, var1, var2);</span></span>\n</code></pre></div>\n<p>A few more characters, a lot less frustration, and no more surprise mutations.</p>\n",
        "feature_image": "https://images.unsplash.com/photo-1646654643578-9ecf13a0f61a?ixlib=rb-1.2.1&q=80&cs=tinysrgb&fm=jpg&crop=entropy",
        "status": "published",
        "created_at": 1557982800000,
        "published_at": 1557982800000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>Hearken back, for a moment, to what it was like merging objects in 2014. There was no support for the feature in JavaScript runtimes themselves, and it was quite common to find a solution to the problem by wading through StackOverflow to find something like this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\">merge</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">obj1<span class=\\\"token punctuation\\\">,</span> obj2</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">var</span> newObject <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword control-flow\\\">for</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">var</span> attributeName <span class=\\\"token keyword\\\">in</span> obj1<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    newObject<span class=\\\"token punctuation\\\">[</span>attributeName<span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">=</span> obj1<span class=\\\"token punctuation\\\">[</span>attributeName<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token keyword control-flow\\\">for</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">var</span> attributeName <span class=\\\"token keyword\\\">in</span> obj2<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    newObject<span class=\\\"token punctuation\\\">[</span>attributeName<span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">=</span> obj2<span class=\\\"token punctuation\\\">[</span>attributeName<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token keyword control-flow\\\">return</span> newObject<span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">var</span> var1 <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token literal-property property\\\">key1</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"value1\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">var</span> var2 <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token literal-property property\\\">key2</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"value2\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token function\\\">merge</span><span class=\\\"token punctuation\\\">(</span>var1<span class=\\\"token punctuation\\\">,</span> var2<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// { key1: \\\"value1\\\", key2: \\\"value2\\\" }</span>\\n</code></pre></div>\\n<p>Despite the advancements JavaScript has made since then, I reminisce this approach. It’s extremely clear what’s going on when you throw values into the method. The two objects are received, and a new, separate object is returned containing the properties &#x26; values of both. Neither of your arguments are modified at all, and you could continue to go on and use <code>var1</code> and <code>var2</code> elsewhere, unscathed.</p>\\n<p>Recently, I made the mistake in assuming that <code>Object.assign()</code> operates in a similar way. I wanted a new merged object, but I also wanted to preserve the values I passed into the method for later use.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">let</span> var1 <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token literal-property property\\\">key1</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"value1\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">let</span> var2 <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token literal-property property\\\">key2</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"value2\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">let</span> var3 <span class=\\\"token operator\\\">=</span> <span class=\\\"token known-class-name class-name\\\">Object</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">assign</span><span class=\\\"token punctuation\\\">(</span>var1<span class=\\\"token punctuation\\\">,</span> var2<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>I <em>expected</em> this to leave each of my three variables with the following values:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token comment\\\">// What I THOUGHT I'd get:</span>\\n\\nvar1 <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token literal-property property\\\">key1</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"value1\\\"</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\nvar2 <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token literal-property property\\\">key2</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"value2\\\"</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\nvar3 <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token literal-property property\\\">key1</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"value1\\\"</span>\\n  <span class=\\\"token literal-property property\\\">key2</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"value2\\\"</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>But that’s not what I got. Instead, <code>var1</code> had been mutated, giving it the exact same value as <code>var3</code>:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token comment\\\">// What I ACTUALLY got:</span>\\n\\nvar1 <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token literal-property property\\\">key1</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"value1\\\"</span>\\n  <span class=\\\"token literal-property property\\\">key2</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"value2\\\"</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\nvar2 <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token literal-property property\\\">key2</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"value2\\\"</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\nvar3 <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token literal-property property\\\">key1</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"value1\\\"</span>\\n  <span class=\\\"token literal-property property\\\">key2</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"value2\\\"</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>Looking at <a href=\\\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">the documentation</a> for <code>Object.assign()</code>, this makes sense. Here’s the syntax:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token known-class-name class-name\\\">Object</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">assign</span><span class=\\\"token punctuation\\\">(</span>target<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token spread operator\\\">...</span>sources<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>And the description is pretty clear about what it does:</p>\\n<p>“The Object.assign() method is used to copy the values of all enumerable own properties from one or more <em>source</em> objects to a <em>target</em> object. It will return the target object.”</p>\\n<p>The method makes no promises to not mutate that target object. It’ll copy over properties to it and spit it that mutated version back to you.</p>\\n<p>Obviously, the solution to this is pretty simple. Pass a new, empty object as the target, and you’re good to go:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-diff\\\"><code class=\\\"language-diff\\\"><span class=\\\"token deleted-sign deleted\\\"><span class=\\\"token prefix deleted\\\">-</span><span class=\\\"token line\\\">let var3 = Object.assign(var1, var2);</span>\\n<span class=\\\"token line\\\"></span></span><span class=\\\"token inserted-sign inserted\\\"><span class=\\\"token prefix inserted\\\">+</span><span class=\\\"token line\\\">let var3 = Object.assign({}, var1, var2);</span></span>\\n</code></pre></div>\\n<p>A few more characters, a lot less frustration, and no more surprise mutations.</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 46,
        "title": "Formatting PHP More Efficiently with a Bash Function",
        "slug": "formatting-my-php-more-efficiently-with-a-bash-function",
        "html": "<p>For quite some time now, I’ve been working with a PHP application that, up until recently, had no clearly-defined coding standards in place. At some point, the decision was made to enforce PSR-2, and to do so at an incremental level. When a file is touched, format to PSR-2.</p>\n<p>To do this in the command line, I’ve been using <a href=\"https://github.com/FriendsOfPHP/PHP-CS-Fixer\" target=\"_blank\" rel=\"noopener\">PHP-CS-Fixer</a>. It’s pretty straightforward in how it works. Call the command, pass a file, specify a standard:</p>\n<div class=\"remark-highlight\"><pre class=\"language-text\"><code class=\"language-text\">php-cs-fixer /path/to/file.php --rules=@PSR2</code></pre></div>\n<p>But fairly quickly, typing all those characters added up, and it was made more difficult by the fact that I need to hold <code>SHIFT</code> + <code>2</code> in order to crank out an <code>@</code>. Woe is me!</p>\n<h2>Wrap that Complexity in a Function</h2>\n<p>To remedy this a bit, I turned to writing a simple Bash function to wrap up some of the work I had been doing over and over. It was a good move. Here’s how it went:</p>\n<p>In my <code>~./zshrc</code> file, save the following function declaration. If you’re not using <a href=\"https://ohmyz.sh/\" target=\"_blank\" rel=\"noopener\">Oh My ZSH</a>, this would be placed in your <code>~/.bashrc</code> file, or the configuration file for whatever shell you’re using.</p>\n<div class=\"remark-highlight\"><pre class=\"language-text\"><code class=\"language-text\">function fphp {\n    php-cs-fixer fix $1 --rules=@PSR2\n}</code></pre></div>\n<p>To actually use the function, you’ll need to reload your configuration file.</p>\n<div class=\"remark-highlight\"><pre class=\"language-text\"><code class=\"language-text\">source ~/.zshrc</code></pre></div>\n<p>After that, you’re ready to run! Instead of specifying a long command name, pasting in the file path, and setting a standard, you can just run this to get the same result.</p>\n<div class=\"remark-highlight\"><pre class=\"language-text\"><code class=\"language-text\">fphp /path/to/file.php</code></pre></div>\n<h2>Handling Multiple Paths</h2>\n<p>That’s much better, but sometimes, you might want to format several different files by file path at once. Using the version of PHP-CS-Fixer that I am (2.14.0), it’s technically possible to do this, but requires <a href=\"https://github.com/FriendsOfPHP/PHP-CS-Fixer/issues/2390\" target=\"_blank\" rel=\"noopener\">some extra work</a> I didn’t want to deal with. Without doing that extra work, the following error is thrown:</p>\n<div class=\"remark-highlight\"><pre class=\"language-text\"><code class=\"language-text\">php-cs-fixer /path/to/file.php /path/to/some/other/file.php --rules=@PSR2</code></pre></div>\n<div class=\"remark-highlight\"><pre class=\"language-text\"><code class=\"language-text\">In ConfigurationResolver.php line 579:\nFor multiple paths config parameter is required.</code></pre></div>\n<p>Thankfully, since the functionality we want is all wrapped up in a function, it’s relatively easy to beef that sucker up to handle multiple paths as we provide them. Basically, take whatever arguments our function is given and run the same command on each of them.</p>\n<div class=\"remark-highlight\"><pre class=\"language-text\"><code class=\"language-text\">function fphp {\n    for filePath in &#x26;quot;$@&#x26;quot;\n    do\n        php-cs-fixer fix $filePath --rules=@PSR2\n    done\n}</code></pre></div>\n<p>Run <code>source ~/.zshrc</code>, and now we can easily format multiple files at once:</p>\n<div class=\"remark-highlight\"><pre class=\"language-text\"><code class=\"language-text\">fphp /path/to/file.php /path/to/some/other/file.php</code></pre></div>\n<h2>We’ve Only Bashed the Surface</h2>\n<p>Obviously, my use case here is pretty specific, and there are a bazillion other ways Bash funcification (just coined that; it better stick) can optimize your command line workflow. As a top-of-mind example, my teammate and <em>buddy</em> <a href=\"https://medium.freecodecamp.org/bash-shortcuts-to-enhance-your-git-workflow-5107d64ea0ff\" target=\"_blank\" rel=\"noopener\">Buddy Reno has written about using them</a> to awesomely overhaul how you use Git in your projects.</p>\n<p>Whatever your entry point has been or will be, do your part and be generous with your findings! To start, if you’ve got a Bash-related tip that’s been helpful to you in the past, share it here!</p>\n<p><a href=\"06de3e87-c97e-487a-931e-217387993ac9\" target=\"_blank\" rel=\"noopener\">2022-02-22-send-an-http-request-on-page-exit</a></p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">A post on CSS Tricks exploring why HTTP requests sent during page navigation are at risk of abandonment, as well as options available to prevent it from happening.</code></pre></div>\n<p><a href=\"50da6983-e31b-494b-87ee-1144354395ca\" target=\"_blank\" rel=\"noopener\">2022-06-15-maps-store-objects-by-reference</a></p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">No matter how many times I revisit it, I have pretty consistent track record of being tripped up by how JavaScript assigns values to variables.\n\n\n## Primitives: Assigned by Value\n\n\nPrimitive values (numbers, strings, etc.) are assigned by _value,_ meaning that assigning one variable to another variable assigned to a primitive value will result in _two, distinct values_ being stored in memory. The entire _value_ is copied.\n\n\n```text\nconst number1 = 100;const number2 = number1;// Variable / Memory Value:// number1 -&#x26;gt; 100// number2 -&#x26;gt; 100\n```\n\n\n## Objects: Assigned by Reference\n\n\nEverything else (objects, including functions, arrays, etc.) are assigned by _reference_. Assigning a newly created object to a variable is actually creating a _reference_ to that object’s location in memory. Any further variable assignments will also point to that exact same location.\n\n\n```text\nconst object1 = { someProperty: &#x26;#39;some value&#x26;#39; };const object2 = object1;// Variable / Memory Value:// object1 -&#x26;gt; { someProperty: &#x26;#39;some value&#x26;#39; }// object2 -&#x26;gt; object1\n```\n\n\nAnd that’s why things like this work. If you mess with the properties of an object — no matter which variable is referencing it — that central value in memory will be changed, impacting every variable pointing to it.\n\n\n```text\nlet object1 = { someProperty: &#x26;#39;some value&#x26;#39; };let object2 = object1;let object3 = object2;let object4 = object3;let object5 = object4;object5.someProperty = &#x26;#39;some OTHER value!&#x26;#39;;console.log(object1);// { someProperty: &#x26;#39;some OTHER value!&#x26;#39; }\n```\n\n\n## A Map() Follows the Same Rules\n\n\nThis is a pretty fundamental concept in JavaScript, but that didn’t stop me from forgetting about it while dealing with a `Map()`. Just like a regular, old variable, a value inside a Map() is stored differently depending on the value’s type — primitive or otherwise. From [MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map/get):\n\n\n&#x26;gt; If the value that is associated to the provided key is an object, then you will get a reference to that object and any change made to that object will effectively modify it inside the Map object.\n\n\nIn my case, I was working with somthing like this (highly contrived):\n\n\n```html\nconst aMap = new Map();const anObj = {  name: &#x26;#39;Alex&#x26;#39;}aMap.set(&#x26;#39;a&#x26;#39;, anObj);aMap.set(&#x26;#39;b&#x26;#39;, anObj);aMap.set(&#x26;#39;c&#x26;#39;, anObj);aMap.get(&#x26;#39;c&#x26;#39;).name = &#x26;#39;Bob&#x26;#39;;console.table(Array.from(aMap.entries()));\n```\n\n\nWhile I was intending to modify the `name` only by on the `a` key, the results prints as follows:\n\n\n```html\n| (index) |  0  |        1        |-----------------------------------|    0    | &#x26;#39;a&#x26;#39; | { name: &#x26;#39;Bob&#x26;#39; } ||    1    | &#x26;#39;b&#x26;#39; | { name: &#x26;#39;Bob&#x26;#39; } ||    2    | &#x26;#39;c&#x26;#39; | { name: &#x26;#39;Bob&#x26;#39; } |\n```\n\n\nBob is everywhere. In hindsight, this is no surprise. _Primitives by value, objects by reference._ If I want these values to be updated independently, the answer is to duplicate the object, reserving it a new, distinct place in memory:\n\n\n```diff\nconst aMap = new Map();const anObj = {  name: &#x26;#39;Alex&#x26;#39;}- aMap.set(&#x26;#39;a&#x26;#39;, anObj);+ aMap.set(&#x26;#39;a&#x26;#39;, {...anObj});- aMap.set(&#x26;#39;b&#x26;#39;, anObj);+ aMap.set(&#x26;#39;b&#x26;#39;, {...anObj});- aMap.set(&#x26;#39;c&#x26;#39;, anObj);+ aMap.set(&#x26;#39;c&#x26;#39;, {...anObj});aMap.get(&#x26;#39;c&#x26;#39;).name = &#x26;#39;Bob&#x26;#39;;console.table(Array.from(aMap.entries()));\n```\n\n\nAnd with that, you’re released to update properties freely:\n\n\n```html\n| (index) |  0  |        1         |------------------------------------|    0    | &#x26;#39;a&#x26;#39; | { name: &#x26;#39;Alex&#x26;#39; }  ||    1    | &#x26;#39;b&#x26;#39; | { name: &#x26;#39;Alex&#x26;#39; } ||    2    | &#x26;#39;c&#x26;#39; | { name: &#x26;#39;Bob&#x26;#39; } |\n```\n\n\nJust one “Bob,” as desired.\n\n\n## Only a Matter of Time\n\n\nStay tuned for another post basically covering the same concept within another context after it inevitably trips me up again.</code></pre></div>\n",
        "feature_image": "",
        "status": "published",
        "created_at": 1555390800000,
        "published_at": 1555390800000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>For quite some time now, I’ve been working with a PHP application that, up until recently, had no clearly-defined coding standards in place. At some point, the decision was made to enforce PSR-2, and to do so at an incremental level. When a file is touched, format to PSR-2.</p>\\n<p>To do this in the command line, I’ve been using <a href=\\\"https://github.com/FriendsOfPHP/PHP-CS-Fixer\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">PHP-CS-Fixer</a>. It’s pretty straightforward in how it works. Call the command, pass a file, specify a standard:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">php-cs-fixer /path/to/file.php --rules=@PSR2</code></pre></div>\\n<p>But fairly quickly, typing all those characters added up, and it was made more difficult by the fact that I need to hold <code>SHIFT</code> + <code>2</code> in order to crank out an <code>@</code>. Woe is me!</p>\\n<h2>Wrap that Complexity in a Function</h2>\\n<p>To remedy this a bit, I turned to writing a simple Bash function to wrap up some of the work I had been doing over and over. It was a good move. Here’s how it went:</p>\\n<p>In my <code>~./zshrc</code> file, save the following function declaration. If you’re not using <a href=\\\"https://ohmyz.sh/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Oh My ZSH</a>, this would be placed in your <code>~/.bashrc</code> file, or the configuration file for whatever shell you’re using.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">function fphp {\\n    php-cs-fixer fix $1 --rules=@PSR2\\n}</code></pre></div>\\n<p>To actually use the function, you’ll need to reload your configuration file.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">source ~/.zshrc</code></pre></div>\\n<p>After that, you’re ready to run! Instead of specifying a long command name, pasting in the file path, and setting a standard, you can just run this to get the same result.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">fphp /path/to/file.php</code></pre></div>\\n<h2>Handling Multiple Paths</h2>\\n<p>That’s much better, but sometimes, you might want to format several different files by file path at once. Using the version of PHP-CS-Fixer that I am (2.14.0), it’s technically possible to do this, but requires <a href=\\\"https://github.com/FriendsOfPHP/PHP-CS-Fixer/issues/2390\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">some extra work</a> I didn’t want to deal with. Without doing that extra work, the following error is thrown:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">php-cs-fixer /path/to/file.php /path/to/some/other/file.php --rules=@PSR2</code></pre></div>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">In ConfigurationResolver.php line 579:\\nFor multiple paths config parameter is required.</code></pre></div>\\n<p>Thankfully, since the functionality we want is all wrapped up in a function, it’s relatively easy to beef that sucker up to handle multiple paths as we provide them. Basically, take whatever arguments our function is given and run the same command on each of them.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">function fphp {\\n    for filePath in &#x26;quot;$@&#x26;quot;\\n    do\\n        php-cs-fixer fix $filePath --rules=@PSR2\\n    done\\n}</code></pre></div>\\n<p>Run <code>source ~/.zshrc</code>, and now we can easily format multiple files at once:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">fphp /path/to/file.php /path/to/some/other/file.php</code></pre></div>\\n<h2>We’ve Only Bashed the Surface</h2>\\n<p>Obviously, my use case here is pretty specific, and there are a bazillion other ways Bash funcification (just coined that; it better stick) can optimize your command line workflow. As a top-of-mind example, my teammate and <em>buddy</em> <a href=\\\"https://medium.freecodecamp.org/bash-shortcuts-to-enhance-your-git-workflow-5107d64ea0ff\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Buddy Reno has written about using them</a> to awesomely overhaul how you use Git in your projects.</p>\\n<p>Whatever your entry point has been or will be, do your part and be generous with your findings! To start, if you’ve got a Bash-related tip that’s been helpful to you in the past, share it here!</p>\\n<p><a href=\\\"06de3e87-c97e-487a-931e-217387993ac9\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">2022-02-22-send-an-http-request-on-page-exit</a></p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-unknown\\\"><code class=\\\"language-unknown\\\">A post on CSS Tricks exploring why HTTP requests sent during page navigation are at risk of abandonment, as well as options available to prevent it from happening.</code></pre></div>\\n<p><a href=\\\"50da6983-e31b-494b-87ee-1144354395ca\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">2022-06-15-maps-store-objects-by-reference</a></p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-unknown\\\"><code class=\\\"language-unknown\\\">No matter how many times I revisit it, I have pretty consistent track record of being tripped up by how JavaScript assigns values to variables.\\n\\n\\n## Primitives: Assigned by Value\\n\\n\\nPrimitive values (numbers, strings, etc.) are assigned by _value,_ meaning that assigning one variable to another variable assigned to a primitive value will result in _two, distinct values_ being stored in memory. The entire _value_ is copied.\\n\\n\\n```text\\nconst number1 = 100;const number2 = number1;// Variable / Memory Value:// number1 -&#x26;gt; 100// number2 -&#x26;gt; 100\\n```\\n\\n\\n## Objects: Assigned by Reference\\n\\n\\nEverything else (objects, including functions, arrays, etc.) are assigned by _reference_. Assigning a newly created object to a variable is actually creating a _reference_ to that object’s location in memory. Any further variable assignments will also point to that exact same location.\\n\\n\\n```text\\nconst object1 = { someProperty: &#x26;#39;some value&#x26;#39; };const object2 = object1;// Variable / Memory Value:// object1 -&#x26;gt; { someProperty: &#x26;#39;some value&#x26;#39; }// object2 -&#x26;gt; object1\\n```\\n\\n\\nAnd that’s why things like this work. If you mess with the properties of an object — no matter which variable is referencing it — that central value in memory will be changed, impacting every variable pointing to it.\\n\\n\\n```text\\nlet object1 = { someProperty: &#x26;#39;some value&#x26;#39; };let object2 = object1;let object3 = object2;let object4 = object3;let object5 = object4;object5.someProperty = &#x26;#39;some OTHER value!&#x26;#39;;console.log(object1);// { someProperty: &#x26;#39;some OTHER value!&#x26;#39; }\\n```\\n\\n\\n## A Map() Follows the Same Rules\\n\\n\\nThis is a pretty fundamental concept in JavaScript, but that didn’t stop me from forgetting about it while dealing with a `Map()`. Just like a regular, old variable, a value inside a Map() is stored differently depending on the value’s type — primitive or otherwise. From [MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map/get):\\n\\n\\n&#x26;gt; If the value that is associated to the provided key is an object, then you will get a reference to that object and any change made to that object will effectively modify it inside the Map object.\\n\\n\\nIn my case, I was working with somthing like this (highly contrived):\\n\\n\\n```html\\nconst aMap = new Map();const anObj = {  name: &#x26;#39;Alex&#x26;#39;}aMap.set(&#x26;#39;a&#x26;#39;, anObj);aMap.set(&#x26;#39;b&#x26;#39;, anObj);aMap.set(&#x26;#39;c&#x26;#39;, anObj);aMap.get(&#x26;#39;c&#x26;#39;).name = &#x26;#39;Bob&#x26;#39;;console.table(Array.from(aMap.entries()));\\n```\\n\\n\\nWhile I was intending to modify the `name` only by on the `a` key, the results prints as follows:\\n\\n\\n```html\\n| (index) |  0  |        1        |-----------------------------------|    0    | &#x26;#39;a&#x26;#39; | { name: &#x26;#39;Bob&#x26;#39; } ||    1    | &#x26;#39;b&#x26;#39; | { name: &#x26;#39;Bob&#x26;#39; } ||    2    | &#x26;#39;c&#x26;#39; | { name: &#x26;#39;Bob&#x26;#39; } |\\n```\\n\\n\\nBob is everywhere. In hindsight, this is no surprise. _Primitives by value, objects by reference._ If I want these values to be updated independently, the answer is to duplicate the object, reserving it a new, distinct place in memory:\\n\\n\\n```diff\\nconst aMap = new Map();const anObj = {  name: &#x26;#39;Alex&#x26;#39;}- aMap.set(&#x26;#39;a&#x26;#39;, anObj);+ aMap.set(&#x26;#39;a&#x26;#39;, {...anObj});- aMap.set(&#x26;#39;b&#x26;#39;, anObj);+ aMap.set(&#x26;#39;b&#x26;#39;, {...anObj});- aMap.set(&#x26;#39;c&#x26;#39;, anObj);+ aMap.set(&#x26;#39;c&#x26;#39;, {...anObj});aMap.get(&#x26;#39;c&#x26;#39;).name = &#x26;#39;Bob&#x26;#39;;console.table(Array.from(aMap.entries()));\\n```\\n\\n\\nAnd with that, you’re released to update properties freely:\\n\\n\\n```html\\n| (index) |  0  |        1         |------------------------------------|    0    | &#x26;#39;a&#x26;#39; | { name: &#x26;#39;Alex&#x26;#39; }  ||    1    | &#x26;#39;b&#x26;#39; | { name: &#x26;#39;Alex&#x26;#39; } ||    2    | &#x26;#39;c&#x26;#39; | { name: &#x26;#39;Bob&#x26;#39; } |\\n```\\n\\n\\nJust one “Bob,” as desired.\\n\\n\\n## Only a Matter of Time\\n\\n\\nStay tuned for another post basically covering the same concept within another context after it inevitably trips me up again.</code></pre></div>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 47,
        "title": "Quickly Spin Up MySQL with Docker Compose",
        "slug": "local-mysql-with-docker",
        "html": "<p>I’ve often needed to quickly spin up a local instance of MySQL. <a href=\"https://docs.docker.com/compose/\" target=\"_blank\" rel=\"noopener\">Docker Compose</a> this makes it stupid easy. Rather than running a long, convoluted <code>docker</code> command, I can configure an image just the way I want it while maintaining the ability to turn it easily turn it on and off as needed.</p>\n<h2>Getting Set Up</h2>\n<p>Inside a new directory, create a <code>data</code> directory and <code>docker-compose.yml</code> file.</p>\n<div class=\"remark-highlight\"><pre class=\"language-text\"><code class=\"language-text\">new-directory\n├── data\n└── docker-compose.yml</code></pre></div>\n<p>Paste the following into your <code>docker-compose.yml</code> file:</p>\n<div class=\"remark-highlight\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'3'</span>\n\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">db</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> docker<span class=\"token punctuation\">-</span>local<span class=\"token punctuation\">-</span>mysql\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> mysql<span class=\"token punctuation\">:</span>5.7.21\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"./data:/var/lib/mysql\"</span>\n    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> 3306<span class=\"token punctuation\">:</span><span class=\"token number\">3306</span>\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">MYSQL_ROOT_PASSWORD</span><span class=\"token punctuation\">:</span> root\n\n</code></pre></div>\n<h2>Managing a Container</h2>\n<p>To start the container, run <code>docker-compose up</code>. To stop &#x26; remove the container, run <code>docker-compose down</code>. For more information on the plethora of commands avaible to leverage your container, <a href=\"https://docs.docker.com/compose/reference/\" target=\"_blank\" rel=\"noopener\">see here</a>.</p>\n<h2>Persisting Data</h2>\n<p>Whenever MySQL modifies any data within the container, it will persist locally inside your <code>./data</code> directory, even after you stop and restart everything. This is configured by the <code>volumes:</code> property in your <code>docker-compose.yml</code> file.</p>\n<h2>Running Commands Inside Container</h2>\n<p>To run any Bash commands inside the running container, use <code>docker-compose exec db bash</code>.</p>\n<h2>Connecting w/ SequelPro or Similar Tool</h2>\n<p>Use the following values to connect to the running container.</p>\n<p><strong>Host:</strong> 127.0.0.1</p>\n<p><strong>Username:</strong> root</p>\n<p><strong>Password:</strong> root</p>\n<p><strong>Port:</strong> 3306</p>\n<h2>Looking to Set Up Other DBs w/ Docker Compose?</h2>\n<p>I’ve put this Compose setup and a few others <a href=\"https://github.com/alexmacarthur/local-docker-db\" target=\"_blank\" rel=\"noopener\">into a repository</a> for easy access. At the time I’m writing this, it includes MySQL, Postgres, and Mongo. Feel free to use it as needed, as well as contrbute any other configurations you’ve found useful.</p>\n<h2>The End.</h2>\n<p>Boom. With a single command, you have a running, persistent, self-contained MySQL instance ready for your development needs. Have a helpful tip related to anything here? Share it!</p>\n",
        "feature_image": "https://images.pexels.com/photos/15798/night-computer-hdd-hard-drive.jpg?auto=compress&amp;cs=tinysrgb&amp;dpr=2&amp;h=750&amp;w=1260",
        "status": "published",
        "created_at": 1549429200000,
        "published_at": 1549429200000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>I’ve often needed to quickly spin up a local instance of MySQL. <a href=\\\"https://docs.docker.com/compose/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Docker Compose</a> this makes it stupid easy. Rather than running a long, convoluted <code>docker</code> command, I can configure an image just the way I want it while maintaining the ability to turn it easily turn it on and off as needed.</p>\\n<h2>Getting Set Up</h2>\\n<p>Inside a new directory, create a <code>data</code> directory and <code>docker-compose.yml</code> file.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">new-directory\\n├── data\\n└── docker-compose.yml</code></pre></div>\\n<p>Paste the following into your <code>docker-compose.yml</code> file:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-yaml\\\"><code class=\\\"language-yaml\\\"><span class=\\\"token key atrule\\\">version</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'3'</span>\\n\\n<span class=\\\"token key atrule\\\">services</span><span class=\\\"token punctuation\\\">:</span>\\n  <span class=\\\"token key atrule\\\">db</span><span class=\\\"token punctuation\\\">:</span>\\n    <span class=\\\"token key atrule\\\">container_name</span><span class=\\\"token punctuation\\\">:</span> docker<span class=\\\"token punctuation\\\">-</span>local<span class=\\\"token punctuation\\\">-</span>mysql\\n    <span class=\\\"token key atrule\\\">image</span><span class=\\\"token punctuation\\\">:</span> mysql<span class=\\\"token punctuation\\\">:</span>5.7.21\\n    <span class=\\\"token key atrule\\\">volumes</span><span class=\\\"token punctuation\\\">:</span>\\n      <span class=\\\"token punctuation\\\">-</span> <span class=\\\"token string\\\">\\\"./data:/var/lib/mysql\\\"</span>\\n    <span class=\\\"token key atrule\\\">restart</span><span class=\\\"token punctuation\\\">:</span> always\\n    <span class=\\\"token key atrule\\\">ports</span><span class=\\\"token punctuation\\\">:</span>\\n      <span class=\\\"token punctuation\\\">-</span> 3306<span class=\\\"token punctuation\\\">:</span><span class=\\\"token number\\\">3306</span>\\n    <span class=\\\"token key atrule\\\">environment</span><span class=\\\"token punctuation\\\">:</span>\\n      <span class=\\\"token key atrule\\\">MYSQL_ROOT_PASSWORD</span><span class=\\\"token punctuation\\\">:</span> root\\n\\n</code></pre></div>\\n<h2>Managing a Container</h2>\\n<p>To start the container, run <code>docker-compose up</code>. To stop &#x26; remove the container, run <code>docker-compose down</code>. For more information on the plethora of commands avaible to leverage your container, <a href=\\\"https://docs.docker.com/compose/reference/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">see here</a>.</p>\\n<h2>Persisting Data</h2>\\n<p>Whenever MySQL modifies any data within the container, it will persist locally inside your <code>./data</code> directory, even after you stop and restart everything. This is configured by the <code>volumes:</code> property in your <code>docker-compose.yml</code> file.</p>\\n<h2>Running Commands Inside Container</h2>\\n<p>To run any Bash commands inside the running container, use <code>docker-compose exec db bash</code>.</p>\\n<h2>Connecting w/ SequelPro or Similar Tool</h2>\\n<p>Use the following values to connect to the running container.</p>\\n<p><strong>Host:</strong> 127.0.0.1</p>\\n<p><strong>Username:</strong> root</p>\\n<p><strong>Password:</strong> root</p>\\n<p><strong>Port:</strong> 3306</p>\\n<h2>Looking to Set Up Other DBs w/ Docker Compose?</h2>\\n<p>I’ve put this Compose setup and a few others <a href=\\\"https://github.com/alexmacarthur/local-docker-db\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">into a repository</a> for easy access. At the time I’m writing this, it includes MySQL, Postgres, and Mongo. Feel free to use it as needed, as well as contrbute any other configurations you’ve found useful.</p>\\n<h2>The End.</h2>\\n<p>Boom. With a single command, you have a running, persistent, self-contained MySQL instance ready for your development needs. Have a helpful tip related to anything here? Share it!</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 48,
        "title": "Writing a Regular Expression to Target Images Without a Class",
        "slug": "writing-a-regular-expression-to-target-images-without-a-class",
        "html": "<p>A while back, <a href=\"https://macarthur.me/posts/build-your-own-simple-lazy-loading-functionality-in-wordpress\">I wrote about</a> building your own lazy loading functionality into WordPress. In that post, I use a regular expression to add a <code>lazy-load</code> class to image tags that don’t already have <em>any</em> class.</p>\n<p>It failed. Rather than adding it to images with no preexisting class, it was added to <em>every</em> image, resulting in some images having two class attributes:</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token comment\">&#x3C;!--- This is bad. ---></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>img</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>lazy-load<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>my-class<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/img/path.jpg<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<p>Thankfully, a couple of readers caught the issue, sending me back to the regex drawing board, and causing me to feel a little deserved shame for blindly borrowing that initial expression from deep within the crevices of the internet.</p>\n<h3>What Went Wrong</h3>\n<p>Here’s where I started. I <em>thought</em> I had an expression that would match <code>img</code> tags void of the word “class,” but instead, I had one that was finding matches way too eagerly.</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token variable\">$content</span> <span class=\"token operator\">=</span> <span class=\"token function\">preg_replace</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string single-quoted-string\">'/&#x3C;img(.*?)(?!\\bclass\\b)(.*?)>/i'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string single-quoted-string\">'&#x3C;img$1 class=\"lazy-load\"$2>'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token variable\">$content</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>If you’re not already familiar with the <code>preg_replace()</code> method, <a href=\"http://php.net/manual/en/function.preg-replace.php\" target=\"_blank\" rel=\"noopener\">read about it here</a>. In short, it’s used to find matching regex patterns in a string, and then construct a new string that may or may not contain matching groups that have been captured (signified by <code>$[number]</code>).</p>\n<p>Let’s toy with my initial expression. Take note of the first matching group: <code>(.*?)</code>. This group matches any bunch of characters (including a string as small as zero characters in length) that is <em>not</em> immediately followed by the word “class,” as indicated by <code>(?!\\bclass\\b)</code>. This all <em>sounds</em> like it should get the job done, but actually ends up matching a lot of stuff we don’t want, way too early on.</p>\n<p>Here’s my string:</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>img</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>my-class<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/img/path.jpg<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<p>To start, the pattern matches the point immediately following <code>&#x3C;img</code> in any image tag, since the next immediate character is <em>not</em> the initial boundary for the word “class,” but instead a space. Remember, the <code>(.*?)</code> group doesn’t require a match to have any length, so we get something like this:</p>\n<p><img src='/proxy/32a9b02b-4126-4c93-8243-eec2604f73c9' alt='' loading='lazy' /></p>\n<p><img src='/proxy/ce2275ee-cc05-489d-b901-861921db3878' alt='' loading='lazy' /></p>\n<p>And because of this result, here’s how the string is processed by <code>preg_replace()</code>:</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token comment\">&#x3C;!-- Before: --></span>\n&#x3C;img [MATCH\\][/MATCH] class=\"my-class\" src=\"/img/path.jpg\">\n\n<span class=\"token comment\">&#x3C;!-- After: TWO class attributes!= --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>img</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>lazy-load<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>my-class<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/img/path.jpg<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<p>Swapping attributes makes no difference – there will always be a zero-length match after <code>&#x3C;img</code>, since a space (and not a the beginning of the word “class”) always follows it. The <code>lazy-load</code> is always going to be added to that match, even when we don’t want it.</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token comment\">&#x3C;!-- Before: --></span>\n&#x3C;img\\[MATCH\\][/MATCH] src=\"/img/path.jpg\" class=\"my-class\">\n\n<span class=\"token comment\">&#x3C;!-- After --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>img</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>lazy-load<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/img/path.jpg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>my-class<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<p>Unfortunately, adding an explicit space after <code>&#x3C;img</code> to our pattern does nothing, because there’s guaranteed to always be at least one point at least zero characters long that meets the conditions of the expression.</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token variable\">$content</span> <span class=\"token operator\">=</span> <span class=\"token function\">preg_replace</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string single-quoted-string\">'/&#x3C;img (.*?)(?!\\bclass\\b)(.*?)>/i'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string single-quoted-string\">'&#x3C;img $1class=\"lazy-load\"$2>'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token variable\">$content</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token comment\">&#x3C;!-- Before: --></span>\n&#x3C;img \\[MATCH\\][/MATCH]src=\"/img/path.jpg\" class=\"my-class\">\n\n<span class=\"token comment\">&#x3C;!-- After: FAIL --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>img</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>lazy-load<span class=\"token punctuation\">\"</span></span><span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/img/path.jpg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>my-class<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<p>Or, with attributes reversed:</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token comment\">&#x3C;!-- Before: --></span>\n&#x3C;img [MATCH]c[/MATCH]lass=\"my-class\" src=\"/img/path.jpg\">\n\n<span class=\"token comment\">&#x3C;!-- After: FAIL --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>img</span> <span class=\"token attr-name\">cclass</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>lazy-load<span class=\"token punctuation\">\"</span></span><span class=\"token attr-name\">lass</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>my-class<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/img/path.jpg<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<p>This is where it made sense to experiment with the <code>+</code> quantifier, which, unlike the <code>*</code> quantifier, requires a match of <em>at least one character</em>. But yet again, that doesn’t help us much, because a match is nearly guaranteed to be found when progressing through each individual character of a string.</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token variable\">$content</span> <span class=\"token operator\">=</span> <span class=\"token function\">preg_replace</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string single-quoted-string\">'/&#x3C;img (.+?)(?!\\bclass\\b)(.*?)>/i'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string single-quoted-string\">'&#x3C;img $1class=\"lazy-load\"$2>'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token variable\">$content</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Similar markup, but shaken up attributes:</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token comment\">&#x3C;!-- Before: --></span>\n&#x3C;img[MATCH]s[/MATCH]rc=\"/img/path.jpg\" class=\"my-class\">\n\n<span class=\"token comment\">&#x3C;!-- After: FAIL --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>imgs</span> <span class=\"token attr-name\">sclass</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>lazy-load<span class=\"token punctuation\">\"</span></span><span class=\"token attr-name\">rc</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/img/path.jpg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>my-class<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<h3>What Worked</h3>\n<p>Clearly, my expression’s main fault was its tendency to find a match way too soon, without searching the entire <code>img</code> string to know if it has <code>class=</code> or not. So, after several hours of beating my head against a screen, I ended up with this.</p>\n<div class=\"remark-highlight\"><pre class=\"language-text\"><code class=\"language-text\">/&#x26;lt;img((.(?!class=))*)\\/?&#x26;gt;/</code></pre></div>\n<p>Let’s take this real slow and piece it together from scratch.</p>\n<p>First, I knew I wanted to target <code>img</code> tags, which have an opening <code>&#x3C;img</code>, followed by attributes and stuff (like a <code>src</code>, duh), and a closing bracket with an optional slash. Here are the components I started with:</p>\n<p><a href=\"996bc1e0-6eea-4509-a213-9e4878df89ff\" target=\"_blank\" rel=\"noopener\">child_database</a></p>\n<div class=\"remark-highlight\"><pre class=\"language-text\"><code class=\"language-text\">/&#x26;lt;img(.*)\\/?&#x26;gt;/</code></pre></div>\n<p>Expectedly, this will match pretty much anything that has the shell of an <code>img</code> tag containing any characters, any number of times – signified by <code>(.*)</code>.</p>\n<p><img src='/proxy/82d0bddb-5186-4d68-ae51-157f895efdc4' alt='' loading='lazy' /></p>\n<p>And I know that within that shell, I’m just fine with matching anything – UNLESS it’s a class attribute. So, let’s modify that inner group. Rather than matching <em>any</em> character, let’s replace that character to target any character that is <em>not</em> followed by a class attribute.</p>\n<div class=\"remark-highlight\"><pre class=\"language-text\"><code class=\"language-text\">/&#x26;lt;img((.(?!class=))*)\\/?&#x26;gt;/</code></pre></div>\n<p>Here are our updated components:</p>\n<p><a href=\"f8566bb4-f696-4da5-9284-20a230a6566c\" target=\"_blank\" rel=\"noopener\">child_database</a></p>\n<p>Here’s what we get for matches when we run it against our string:</p>\n<p><img src='/proxy/e0b07e11-302f-421d-a0c1-8064f6504995' alt='' loading='lazy' /></p>\n<p>Great, no match!</p>\n<p>And if we were to remove that class attribute:</p>\n<p><img src='/proxy/edf2cd82-ddbf-4b88-88a8-d4e9e12b518e' alt='' loading='lazy' /></p>\n<p>Nailed it! This <em>should</em> cover most of our scenarios, allowing us to accurately add a new <code>class</code> attribute only to the images that don’t have any. From what I can tell, the only time we would get a match is when <code>class</code> is butt right up against <code>&#x3C;img</code>, when there would be no other character to precede the attribute.</p>\n<p><img src='/proxy/60133900-448a-44b2-8daf-ef163f184c1c' alt='' loading='lazy' /></p>\n<p>But that’s no longer a valid image tag, so that sort of risk really isn’t one at all. And with that, here’s our updated PHP call that should work exactly as we expect it.</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token variable\">$content</span> <span class=\"token operator\">=</span> <span class=\"token function\">preg_replace</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string single-quoted-string\">'/&#x3C;img((.(?!class=))*)\\/?>/i'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string single-quoted-string\">'&#x3C;img class=\"lazy-load\"$1>'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token variable\">$content</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h2>Takeaways</h2>\n<p>First, learning to break up &#x26; understand the fundamentals of regular expressions doesn’t <em>need</em> to be terrifying, especially if you’re patient and willing to start slow. This is, by far, the most significant thing with which I walked away from this process.</p>\n<p>Second, with the patience &#x26; willingness to understand why regular expressions behave the way they do, stop trusting any given expression you find on the street. With a renewed confidence in tackling stuff like this, I’m much less likely to be burned in the future.</p>\n<p>Finally, find a good tool you’re willing to get comfortable with as you break these things apart. I spent a lot of time with <a href=\"https://regex101.com/\" target=\"_blank\" rel=\"noopener\">regex101</a>. For you, it might be something different. That’s cool, just know what it is, so you can jump to it when it’s needed.</p>\n<p>Thanks for embarking on this journey with me!</p>\n",
        "feature_image": "https://images.unsplash.com/photo-1497796742626-fe30f204ec54?ixlib=rb-1.2.1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;auto=format&amp;fit=crop&amp;w=1200&amp;q=100",
        "status": "published",
        "created_at": 1547614800000,
        "published_at": 1547614800000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>A while back, <a href=\\\"https://macarthur.me/posts/build-your-own-simple-lazy-loading-functionality-in-wordpress\\\">I wrote about</a> building your own lazy loading functionality into WordPress. In that post, I use a regular expression to add a <code>lazy-load</code> class to image tags that don’t already have <em>any</em> class.</p>\\n<p>It failed. Rather than adding it to images with no preexisting class, it was added to <em>every</em> image, resulting in some images having two class attributes:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token comment\\\">&#x3C;!--- This is bad. ---></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>img</span> <span class=\\\"token attr-name\\\">class</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>lazy-load<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token attr-name\\\">class</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>my-class<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token attr-name\\\">src</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>/img/path.jpg<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>\\n</code></pre></div>\\n<p>Thankfully, a couple of readers caught the issue, sending me back to the regex drawing board, and causing me to feel a little deserved shame for blindly borrowing that initial expression from deep within the crevices of the internet.</p>\\n<h3>What Went Wrong</h3>\\n<p>Here’s where I started. I <em>thought</em> I had an expression that would match <code>img</code> tags void of the word “class,” but instead, I had one that was finding matches way too eagerly.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token variable\\\">$content</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">preg_replace</span><span class=\\\"token punctuation\\\">(</span>\\n  <span class=\\\"token string single-quoted-string\\\">'/&#x3C;img(.*?)(?!\\\\bclass\\\\b)(.*?)>/i'</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token string single-quoted-string\\\">'&#x3C;img$1 class=\\\"lazy-load\\\"$2>'</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token variable\\\">$content</span>\\n<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>If you’re not already familiar with the <code>preg_replace()</code> method, <a href=\\\"http://php.net/manual/en/function.preg-replace.php\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">read about it here</a>. In short, it’s used to find matching regex patterns in a string, and then construct a new string that may or may not contain matching groups that have been captured (signified by <code>$[number]</code>).</p>\\n<p>Let’s toy with my initial expression. Take note of the first matching group: <code>(.*?)</code>. This group matches any bunch of characters (including a string as small as zero characters in length) that is <em>not</em> immediately followed by the word “class,” as indicated by <code>(?!\\\\bclass\\\\b)</code>. This all <em>sounds</em> like it should get the job done, but actually ends up matching a lot of stuff we don’t want, way too early on.</p>\\n<p>Here’s my string:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>img</span> <span class=\\\"token attr-name\\\">class</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>my-class<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token attr-name\\\">src</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>/img/path.jpg<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>\\n</code></pre></div>\\n<p>To start, the pattern matches the point immediately following <code>&#x3C;img</code> in any image tag, since the next immediate character is <em>not</em> the initial boundary for the word “class,” but instead a space. Remember, the <code>(.*?)</code> group doesn’t require a match to have any length, so we get something like this:</p>\\n<p><img src='/proxy/32a9b02b-4126-4c93-8243-eec2604f73c9' alt='' loading='lazy' /></p>\\n<p><img src='/proxy/ce2275ee-cc05-489d-b901-861921db3878' alt='' loading='lazy' /></p>\\n<p>And because of this result, here’s how the string is processed by <code>preg_replace()</code>:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token comment\\\">&#x3C;!-- Before: --></span>\\n&#x3C;img [MATCH\\\\][/MATCH] class=\\\"my-class\\\" src=\\\"/img/path.jpg\\\">\\n\\n<span class=\\\"token comment\\\">&#x3C;!-- After: TWO class attributes!= --></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>img</span> <span class=\\\"token attr-name\\\">class</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>lazy-load<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token attr-name\\\">class</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>my-class<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token attr-name\\\">src</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>/img/path.jpg<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>\\n</code></pre></div>\\n<p>Swapping attributes makes no difference – there will always be a zero-length match after <code>&#x3C;img</code>, since a space (and not a the beginning of the word “class”) always follows it. The <code>lazy-load</code> is always going to be added to that match, even when we don’t want it.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token comment\\\">&#x3C;!-- Before: --></span>\\n&#x3C;img\\\\[MATCH\\\\][/MATCH] src=\\\"/img/path.jpg\\\" class=\\\"my-class\\\">\\n\\n<span class=\\\"token comment\\\">&#x3C;!-- After --></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>img</span> <span class=\\\"token attr-name\\\">class</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>lazy-load<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token attr-name\\\">src</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>/img/path.jpg<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token attr-name\\\">class</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>my-class<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>\\n</code></pre></div>\\n<p>Unfortunately, adding an explicit space after <code>&#x3C;img</code> to our pattern does nothing, because there’s guaranteed to always be at least one point at least zero characters long that meets the conditions of the expression.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token variable\\\">$content</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">preg_replace</span><span class=\\\"token punctuation\\\">(</span>\\n  <span class=\\\"token string single-quoted-string\\\">'/&#x3C;img (.*?)(?!\\\\bclass\\\\b)(.*?)>/i'</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token string single-quoted-string\\\">'&#x3C;img $1class=\\\"lazy-load\\\"$2>'</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token variable\\\">$content</span>\\n<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token comment\\\">&#x3C;!-- Before: --></span>\\n&#x3C;img \\\\[MATCH\\\\][/MATCH]src=\\\"/img/path.jpg\\\" class=\\\"my-class\\\">\\n\\n<span class=\\\"token comment\\\">&#x3C;!-- After: FAIL --></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>img</span> <span class=\\\"token attr-name\\\">class</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>lazy-load<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token attr-name\\\">src</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>/img/path.jpg<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token attr-name\\\">class</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>my-class<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>\\n</code></pre></div>\\n<p>Or, with attributes reversed:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token comment\\\">&#x3C;!-- Before: --></span>\\n&#x3C;img [MATCH]c[/MATCH]lass=\\\"my-class\\\" src=\\\"/img/path.jpg\\\">\\n\\n<span class=\\\"token comment\\\">&#x3C;!-- After: FAIL --></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>img</span> <span class=\\\"token attr-name\\\">cclass</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>lazy-load<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token attr-name\\\">lass</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>my-class<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token attr-name\\\">src</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>/img/path.jpg<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>\\n</code></pre></div>\\n<p>This is where it made sense to experiment with the <code>+</code> quantifier, which, unlike the <code>*</code> quantifier, requires a match of <em>at least one character</em>. But yet again, that doesn’t help us much, because a match is nearly guaranteed to be found when progressing through each individual character of a string.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token variable\\\">$content</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">preg_replace</span><span class=\\\"token punctuation\\\">(</span>\\n  <span class=\\\"token string single-quoted-string\\\">'/&#x3C;img (.+?)(?!\\\\bclass\\\\b)(.*?)>/i'</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token string single-quoted-string\\\">'&#x3C;img $1class=\\\"lazy-load\\\"$2>'</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token variable\\\">$content</span>\\n<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>Similar markup, but shaken up attributes:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token comment\\\">&#x3C;!-- Before: --></span>\\n&#x3C;img[MATCH]s[/MATCH]rc=\\\"/img/path.jpg\\\" class=\\\"my-class\\\">\\n\\n<span class=\\\"token comment\\\">&#x3C;!-- After: FAIL --></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>imgs</span> <span class=\\\"token attr-name\\\">sclass</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>lazy-load<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token attr-name\\\">rc</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>/img/path.jpg<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token attr-name\\\">class</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>my-class<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>\\n</code></pre></div>\\n<h3>What Worked</h3>\\n<p>Clearly, my expression’s main fault was its tendency to find a match way too soon, without searching the entire <code>img</code> string to know if it has <code>class=</code> or not. So, after several hours of beating my head against a screen, I ended up with this.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">/&#x26;lt;img((.(?!class=))*)\\\\/?&#x26;gt;/</code></pre></div>\\n<p>Let’s take this real slow and piece it together from scratch.</p>\\n<p>First, I knew I wanted to target <code>img</code> tags, which have an opening <code>&#x3C;img</code>, followed by attributes and stuff (like a <code>src</code>, duh), and a closing bracket with an optional slash. Here are the components I started with:</p>\\n<p><a href=\\\"996bc1e0-6eea-4509-a213-9e4878df89ff\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">child_database</a></p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">/&#x26;lt;img(.*)\\\\/?&#x26;gt;/</code></pre></div>\\n<p>Expectedly, this will match pretty much anything that has the shell of an <code>img</code> tag containing any characters, any number of times – signified by <code>(.*)</code>.</p>\\n<p><img src='/proxy/82d0bddb-5186-4d68-ae51-157f895efdc4' alt='' loading='lazy' /></p>\\n<p>And I know that within that shell, I’m just fine with matching anything – UNLESS it’s a class attribute. So, let’s modify that inner group. Rather than matching <em>any</em> character, let’s replace that character to target any character that is <em>not</em> followed by a class attribute.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">/&#x26;lt;img((.(?!class=))*)\\\\/?&#x26;gt;/</code></pre></div>\\n<p>Here are our updated components:</p>\\n<p><a href=\\\"f8566bb4-f696-4da5-9284-20a230a6566c\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">child_database</a></p>\\n<p>Here’s what we get for matches when we run it against our string:</p>\\n<p><img src='/proxy/e0b07e11-302f-421d-a0c1-8064f6504995' alt='' loading='lazy' /></p>\\n<p>Great, no match!</p>\\n<p>And if we were to remove that class attribute:</p>\\n<p><img src='/proxy/edf2cd82-ddbf-4b88-88a8-d4e9e12b518e' alt='' loading='lazy' /></p>\\n<p>Nailed it! This <em>should</em> cover most of our scenarios, allowing us to accurately add a new <code>class</code> attribute only to the images that don’t have any. From what I can tell, the only time we would get a match is when <code>class</code> is butt right up against <code>&#x3C;img</code>, when there would be no other character to precede the attribute.</p>\\n<p><img src='/proxy/60133900-448a-44b2-8daf-ef163f184c1c' alt='' loading='lazy' /></p>\\n<p>But that’s no longer a valid image tag, so that sort of risk really isn’t one at all. And with that, here’s our updated PHP call that should work exactly as we expect it.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token variable\\\">$content</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">preg_replace</span><span class=\\\"token punctuation\\\">(</span>\\n  <span class=\\\"token string single-quoted-string\\\">'/&#x3C;img((.(?!class=))*)\\\\/?>/i'</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token string single-quoted-string\\\">'&#x3C;img class=\\\"lazy-load\\\"$1>'</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token variable\\\">$content</span>\\n<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<h2>Takeaways</h2>\\n<p>First, learning to break up &#x26; understand the fundamentals of regular expressions doesn’t <em>need</em> to be terrifying, especially if you’re patient and willing to start slow. This is, by far, the most significant thing with which I walked away from this process.</p>\\n<p>Second, with the patience &#x26; willingness to understand why regular expressions behave the way they do, stop trusting any given expression you find on the street. With a renewed confidence in tackling stuff like this, I’m much less likely to be burned in the future.</p>\\n<p>Finally, find a good tool you’re willing to get comfortable with as you break these things apart. I spent a lot of time with <a href=\\\"https://regex101.com/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">regex101</a>. For you, it might be something different. That’s cool, just know what it is, so you can jump to it when it’s needed.</p>\\n<p>Thanks for embarking on this journey with me!</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 49,
        "title": "Best-ish Practices for Dynamically Prefetching & Prerendering Pages with JavaScript",
        "slug": "best-ish-practices-for-dynamically-prefetching-and-prerendering-with-javascript",
        "html": "<p><a href=\"https://www.w3.org/TR/resource-hints/\" target=\"_blank\" rel=\"noopener\">Resource hints</a> (preload, prefetch, prerender, etc.) have breathed some fresh life into the front-end performance game, especially as browsers are coming to support them more &#x26; more. For a traditional server-rendered application, a lot of these hints are pretty straightforward in terms of knowing when to implement them. For example, you should <em>preload</em> critical assets when you know they’ll be needed later on the page, and you should perform a <em>dns-prefetch</em> when you know you’ll be loading a bunch of assets from the same domain, like those from a CDN.</p>\n<p>Other hints, however, are a bit more challenging. Both <code>prefetch</code> and <code>prerender</code> are concerned with loading an asset when it’s <em>likely</em> that the user will need it in the <em>future</em>. But predicting the future is really hard. And for this reason, instead of hard-coding these hints in your HTML, it’s often better to create them dynamically with JavaScript in response to a user’s behavior.</p>\n<p>This really isn’t a new thing. In fact, there’s a lot of discussion and how-tos out there that explore using JavaScript to do things like <a href=\"https://css-tricks.com/prerender-on-hover/\" target=\"_blank\" rel=\"noopener\">prerender a page on hover</a>, <a href=\"https://www.mskog.com/posts/instant-page-loads-with-turbolinks-and-prefetch/\" target=\"_blank\" rel=\"noopener\">prefetch pages on intended click</a>, and a whole lot more. Much of this talk focuses on the <em>how,</em> rather than exploring any of the rationale for why you might do it to begin with. That said, there’a a lot of room for clarity in answering a few questions:</p>\n<p><em>When using JavaScript to do it…</em></p>\n<ul>\n<li><em>…how do I know if I should I prefetch vs. prerender a page?</em></li>\n<li><em>…how many pages should I prefetch and/or prerender at any given time?</em></li>\n<li><em>…how do I know when I should trigger any</em> <code>prefetch</code> <em>or</em> <code>prerender</code><em>?</em></li>\n</ul>\n<p>All of these questions hover around a delicate balance. If we prefetch and/or prerender too much, we risk bloating our user’s network bandwidth and may end up <em>harming</em> performance. If too little (or unintelligently), all of our work could be for nothing because no one actually benefits from it. The fulcrum for this balance is positioned differently for almost every application you encounter, and it’s only complicated by the flexibility JavaScript provides in leveraging these tools.</p>\n<p>Based on what I’ve found while experimenting, here are some miscellaneous, <em>highly opinionated</em> personal best-ish practices for using JavaScript to dynamically and intelligently generate <code>prerender</code> and <code>prefetch</code> hints. As we move through these recommendations, we’ll be crafting some code to actualize all of this a little more. Let’s go!</p>\n<h2>1. <em>Do</em> use JavaScript to prefetch or prerender on <em>probable</em> click.</h2>\n<p>Unless you’re working with a site that has very little content and only a few links, it’s generally a bad idea to do a blanket prefetch or prerender for every link on the page, immediately after page load. Why? That’s a lot of data downloaded all at once, and much of it will never even be used. Instead, it’s best to reserve these tasks for when you can be reasonably confident a user is going to click on something.</p>\n<p>One straightforward way to do this is to trigger an action on hover:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">link</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  link<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mouseover\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//-- Prefetch or prerender!</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>For a lot of cases, I think this is just fine. But, if you’re working on a page with a significant number of links, or if you’re hoping to do a resource-intensive <code>prerender</code>, it’s just not intelligent enough to give us full confidence that a click is actually about to happen. For all we know, the user could just be navigating the mouse from one part of the page to another. Triggering a prefetch or prerender for any of these hovers may be a little too generous.</p>\n<p>So, let’s up our prediction game by triggering something on hover with <em>intentiona</em>. We could get really hairy with our level of sophistication here, but to keep things simple, let’s assume that the longer a person hovers, the more likely they are to click something.</p>\n<p>To help with this, I wrote <a href=\"https://github.com/alexmacarthur/probaclick\" target=\"_blank\" rel=\"noopener\">ProbaClick</a>, a small utility that fires an action when a user hovers over something for a collective period time. By default that period of time is 500ms. If any number of hovers add up to that time, the callback is fired. Let’s wire that up here. A small side benefit is that its API will make our implementation a little cleaner.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//- Fire some action when any &#x3C;a /> element is hovered over for some time.</span>\n<span class=\"token function\"><span class=\"token maybe-class-name\">ProbaClick</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">callback</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">element</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//-- Prefetch or prerender!</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>And to cut to the chase, let’s start to generate some hints for links that a user is probably going to click:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">makeHint</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">href<span class=\"token punctuation\">,</span> type</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> link <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"link\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  link<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"rel\"</span><span class=\"token punctuation\">,</span> type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  link<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"href\"</span><span class=\"token punctuation\">,</span> href<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">head</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">appendChild</span><span class=\"token punctuation\">(</span>link<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword control-flow\">return</span> href<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> hasBeenPrerendered <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> hasBeenPrefetched <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\"><span class=\"token maybe-class-name\">ProbaClick</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">callback</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">link</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> href <span class=\"token operator\">=</span> link<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"href\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">//-- Only generate hint if we haven't done so already for this URL.</span>\n\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>hasBeenPrerendered<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">includes</span><span class=\"token punctuation\">(</span>href<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      hasBeenPrerendered<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">push</span><span class=\"token punctuation\">(</span><span class=\"token function\">makeHint</span><span class=\"token punctuation\">(</span>href<span class=\"token punctuation\">,</span> <span class=\"token string\">\"prerender\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>hasBeenPrefetched<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">includes</span><span class=\"token punctuation\">(</span>href<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      hasBeenPrefetched<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">push</span><span class=\"token punctuation\">(</span><span class=\"token function\">makeHint</span><span class=\"token punctuation\">(</span>href<span class=\"token punctuation\">,</span> <span class=\"token string\">\"prefetch\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Summary of that snippet: When a user hovers over a link for a total of 500ms, we append <code>prerender</code> and <code>prefetch</code> hints to the <code>&#x3C;head></code> of the document, but only if those respective hints haven’t already been generated in the past.</p>\n<p>This is a step in the right direction, but there’s an adjustment in this we need to make, specifically dealing with how we’re prerendering pages.</p>\n<h2>2. <em>Do not</em> use JS to <em>prerender</em> more than one page per load.</h2>\n<p>Just like how our code is currently set up, it’s tempting to generate a <code>prender</code> hint for every link that will probably be clicked. But don’t waste your time, because technically, it’s only possible to run a single prerender process per instance of the browser, which means that we’re just wasting our time doing anything more than that. While I haven’t found any official documentation on this being the case for <em>all</em> browsers, it does seem to be largely agreed upon. <a href=\"http://ipullrank.com/how-i-sped-up-my-site-68-percent-with-one-line-of-code/\" target=\"_blank\" rel=\"noopener\">This nice blog post</a>, <a href=\"https://stackoverflow.com/questions/26387612/html-performance-prerendering-of-multiple-pages\" target=\"_blank\" rel=\"noopener\">this StackOverflow question</a>, and my personal experience all confirm it.</p>\n<p>Before adjusting our code to account for this, let’s dive into the behavior of the <code>prerender</code> hint a little bit.</p>\n<p><strong>How Prerendering Behaves w/ Hard-Coded HTML</strong></p>\n<p>Prior to touching any JavaScript, I played with some hard-coded <code>prerender</code> hints, just to get an idea of how the browser might do things out of the box. To verify what was actually being prerendered, I used Chrome’s Net Internals tool: <a href=\"chrome://net-internals/#prerender\" target=\"_blank\" rel=\"noopener\">chrome://net-internals/#prerender</a></p>\n<p>Here’s what I had in the head of my HTML:</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>prerender<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://www.typeitjs.com<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>prerender<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://www.typeitjs.com/docs<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n</code></pre></div>\n<p>When I loaded the page, only the <em>first</em> hint was respected, and nothing was done with the second. It was seemingly just ignored. Interestingly, though, after I refreshed that same page, the <em>second</em> URL was actively prerendered, with the first hint being designated as a “duplicate.” Apparently, the browser holds onto previously prerendered pages, at least for a little while. And when I refreshed again, neither was prerendered.</p>\n<p>The lesson learned here is that the browser will prerender the first hint it finds that’s not already cached (if we can call it that). Once a prerender process has started, any of the following <code>prerender</code> hints are useless.</p>\n<p><strong>How Prerendering Behaves w/ JavaScript</strong></p>\n<p>All of those observations provided some clarity in understanding why using JavaScript to prerender hints ended up being pretty weird when I first tried it.</p>\n<p>To experiment, I set up a single page with three links, all of which had different <code>href</code> attributes. No resource hints existed on the page.</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://www.typeitjs.com<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Home<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>a</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://www.typeitjs.com/docs<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Docs<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>a</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://github.com/alexmacarthur/typeit<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>GitHub<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>a</span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<p>Then, with JavaScript, I waited for each link to be hovered over.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">link</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  link<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mouseover\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> href <span class=\"token operator\">=</span> link<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"href\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> prerenderLink <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"link\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    prerenderLink<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"rel\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"prerender\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    prerenderLink<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"href\"</span><span class=\"token punctuation\">,</span> href<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">//-- Spit out the prerender hint.</span>\n    <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">head</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">appendChild</span><span class=\"token punctuation\">(</span>prerenderLink<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>At first, I had what I thought was a pretty straightforward hypothesis: When a link was hovered over, the respective URL would actively prerendered. That was correct… sort of.</p>\n<p>When I hovered over the <em>first</em> link, everything worked as expected. The URL was preloaded, which I verified with both the Net Internals tool, as well as <a href=\"https://www.lifewire.com/google-chrome-task-manager-4103619\" target=\"_blank\" rel=\"noopener\">Google’s Task Manager</a> pane. But on any subsequent hover, and to my frustration, nothing changed. The same initial link remained “active,” and I gained nothing by hovering over any of the other links. In hindsight, this makes perfect sense because of what we discovered with hard-coded hints. When the browser starts a prerender process, you can’t start another one. This makes it rather difficult to effectively leverage JavaScript to prerender multiple pages, because once it’s done, it’s done.</p>\n<p>Let’s apply this lesson to our code. To be a little more responsible with our hint generation, we need to prevent any subsequent prerendering after we’ve done it once.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">makeHint</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">href<span class=\"token punctuation\">,</span> type</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> link <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"link\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  link<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"rel\"</span><span class=\"token punctuation\">,</span> type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  link<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"href\"</span><span class=\"token punctuation\">,</span> href<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">head</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">appendChild</span><span class=\"token punctuation\">(</span>link<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword control-flow\">return</span> href<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> hasBeenPrerendered <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> hasBeenPrefetched <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\"><span class=\"token maybe-class-name\">ProbaClick</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">callback</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">link</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> href <span class=\"token operator\">=</span> link<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"href\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">//-- Only generate hint if we haven't done so already for this URL.</span>\n\n    <span class=\"token comment\">//-- Only prerender if _nothing_ has been prerenderd before.</span>\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>hasBeenPrerendered<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      hasBeenPrerendered <span class=\"token operator\">=</span> <span class=\"token function\">makeHint</span><span class=\"token punctuation\">(</span>href<span class=\"token punctuation\">,</span> <span class=\"token string\">\"prerender\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>hasBeenPrefetched<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">includes</span><span class=\"token punctuation\">(</span>href<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      hasBeenPrefetched<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">push</span><span class=\"token punctuation\">(</span><span class=\"token function\">makeHint</span><span class=\"token punctuation\">(</span>href<span class=\"token punctuation\">,</span> <span class=\"token string\">\"prefetch\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>This is helpful, but because we only get once chance to prerender a page, it feels a little, uh, not right, to be using the exact same criteria to prerender as we do prefetch. Let’s do something about that.</p>\n<h2>3. <em>Do</em> be <em>very</em> intentional in how you decide when you should prerender a page.</h2>\n<p>There’s a decent amount at stake when choosing to dynamically prerender a page. We get one shot, and if we’re wrong, we waste a good chunk of our user’s bandwidth for nothing. To help us be a lot more intentional with choosing how to prerender, let’s pull it out of our current setup altogether and beef up the logic we use to pull the trigger.</p>\n<p>For this separate set of logic, instead of just doing something like increasing the delay before firing the action, ProbaClick also allows you to set a maximum hover count to do so. If a user hovers over an element a certain number of times OR if the total hover duration time is met, that event fires.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">makeHint</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">href<span class=\"token punctuation\">,</span> type</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> link <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"link\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  link<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"rel\"</span><span class=\"token punctuation\">,</span> type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  link<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"href\"</span><span class=\"token punctuation\">,</span> href<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">head</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">appendChild</span><span class=\"token punctuation\">(</span>link<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword control-flow\">return</span> href<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> hasBeenPrefetched <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\"><span class=\"token maybe-class-name\">ProbaClick</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">callback</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">link</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> href <span class=\"token operator\">=</span> link<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"href\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>hasBeenPrefetched<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">includes</span><span class=\"token punctuation\">(</span>href<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      hasBeenPrefetched<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">push</span><span class=\"token punctuation\">(</span><span class=\"token function\">makeHint</span><span class=\"token punctuation\">(</span>href<span class=\"token punctuation\">,</span> <span class=\"token string\">\"prefetch\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> hasBeenPrerendered <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\"><span class=\"token maybe-class-name\">ProbaClick</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">delay</span><span class=\"token operator\">:</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">count</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">callback</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">link</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> href <span class=\"token operator\">=</span> link<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"href\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>hasBeenPrerendered<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      hasBeenPrerendered <span class=\"token operator\">=</span> <span class=\"token function\">makeHint</span><span class=\"token punctuation\">(</span>href<span class=\"token punctuation\">,</span> <span class=\"token string\">\"prerender\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>With that change, we’re generating hints based on the following criteria:</p>\n<p><strong>Prefetch</strong> when user collectively hovers over a link for 500ms. <strong>Prerender</strong> when user collectively hovers over a link for 1000ms, OR when they’ve hovered 3 different times.</p>\n<p>This feels more appropriate, given the fact that <code>prefetch</code> and <code>prerender</code> hints do different things in different ways.</p>\n<h2>4. <em>Do not</em> prefetch or prerender pages on someone else’s site.</h2>\n<p>The main reason for this is the fact that you didn’t build that other site, and so you probably don’t know in detail how it’s constructed – including its page weight, code quality, or maybe even some insecure practices it may be employing. By prefetching or prerendering someone else’s site, you necessarily take on a notable level of risk. The level of this risk obviously varies from site to site, but on the whole, it’s enough for me to say “naaah” to the practice altogether.</p>\n<p>This is particularly a big deal when prerendering pages. As mentioned earlier, prerendering is resource-intensive and involves more than just “fetching” a page document for later rendering. A <code>prerender</code> hint <em>prerenders</em> the page, which includes fetching and execution of the page’s sub-resources. It’s a feat.</p>\n<p>So, let’s say you publish a blog post encouraging people to donate to a GoFundMe cause, and your post contains a link to the donation page. To quicken the subsequent render when someone clicks that link, you <em>could</em> prerender it in the background. But don’t, for these reasons:</p>\n<ul>\n<li>You might not be aware of the fact that its main JavaScript file is a 500MB behemoth. And that’s just one file, before it’s even been parsed and executed. By prerendering that page, you just maxed out your user’s mobile data plan for the month, when they MIGHT not even have visited the page anyway.</li>\n<li>You have no idea what kind of third party scripts that site may be using, much less the impact it may have on your own site’s performance and security.</li>\n</ul>\n<p>So, let’s make a modification to <em>not</em> prefetch or prerender any links that belong to a different domain than our own.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">makeHint</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">href<span class=\"token punctuation\">,</span> type</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> link <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"link\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  link<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"rel\"</span><span class=\"token punctuation\">,</span> type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  link<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"href\"</span><span class=\"token punctuation\">,</span> href<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">head</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">appendChild</span><span class=\"token punctuation\">(</span>link<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword control-flow\">return</span> href<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">isExternalLink</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">href</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token operator\">!</span>href<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">match</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\"><span class=\"token anchor function\">^</span><span class=\"token escape\">\\/</span></span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token operator\">!</span>href<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">includes</span><span class=\"token punctuation\">(</span><span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">location</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">host</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> hasBeenPrefetched <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\"><span class=\"token maybe-class-name\">ProbaClick</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">callback</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">link</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> href <span class=\"token operator\">=</span> link<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"href\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isExternalLink</span><span class=\"token punctuation\">(</span>href<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword control-flow\">return</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>hasBeenPrefetched<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">includes</span><span class=\"token punctuation\">(</span>href<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      hasBeenPrefetched<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">push</span><span class=\"token punctuation\">(</span><span class=\"token function\">makeHint</span><span class=\"token punctuation\">(</span>href<span class=\"token punctuation\">,</span> <span class=\"token string\">\"prefetch\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> hasBeenPrerendered <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\"><span class=\"token maybe-class-name\">ProbaClick</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">delay</span><span class=\"token operator\">:</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">count</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">callback</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">link</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> href <span class=\"token operator\">=</span> link<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"href\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isExternalLink</span><span class=\"token punctuation\">(</span>href<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword control-flow\">return</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>hasBeenPrerendered<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      hasBeenPrerendered <span class=\"token operator\">=</span> <span class=\"token function\">makeHint</span><span class=\"token punctuation\">(</span>href<span class=\"token punctuation\">,</span> <span class=\"token string\">\"prerender\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h2>Clean-Up Time</h2>\n<p>Nice! We’ve got the meat of our code written, but let’s tidy some things up a bit:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> hasBeen <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">prefetch</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">prerender</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">makeHint</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">href<span class=\"token punctuation\">,</span> type</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> link <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"link\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  link<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"rel\"</span><span class=\"token punctuation\">,</span> type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  link<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"href\"</span><span class=\"token punctuation\">,</span> href<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">head</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">appendChild</span><span class=\"token punctuation\">(</span>link<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword control-flow\">return</span> href<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">isExternalLink</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">href</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token operator\">!</span>href<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">match</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\"><span class=\"token anchor function\">^</span><span class=\"token escape\">\\/</span></span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token operator\">!</span>href<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">includes</span><span class=\"token punctuation\">(</span><span class=\"token dom variable\">window</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">location</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">host</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">maybeMakeHint</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> link<span class=\"token punctuation\">,</span> type<span class=\"token punctuation\">,</span> max <span class=\"token operator\">=</span> <span class=\"token keyword null nil\">null</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> href <span class=\"token operator\">=</span> link<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"href\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isExternalLink</span><span class=\"token punctuation\">(</span>href<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword control-flow\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>hasBeen<span class=\"token punctuation\">[</span>type<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">includes</span><span class=\"token punctuation\">(</span>href<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword control-flow\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>max <span class=\"token operator\">!==</span> <span class=\"token keyword null nil\">null</span> <span class=\"token operator\">&#x26;&#x26;</span> hasBeen<span class=\"token punctuation\">[</span>type<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span> <span class=\"token operator\">>=</span> max<span class=\"token punctuation\">)</span> <span class=\"token keyword control-flow\">return</span><span class=\"token punctuation\">;</span>\n\n  hasBeen<span class=\"token punctuation\">[</span>type<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">push</span><span class=\"token punctuation\">(</span><span class=\"token function\">makeHint</span><span class=\"token punctuation\">(</span>href<span class=\"token punctuation\">,</span> type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\"><span class=\"token maybe-class-name\">ProbaClick</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">callback</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">link</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">maybeMakeHint</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      link<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">\"prefetch\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\"><span class=\"token maybe-class-name\">ProbaClick</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">delay</span><span class=\"token operator\">:</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">count</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">callback</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">link</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">maybeMakeHint</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      link<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">\"prerender\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">max</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>There we have it: a few lines of untested code following some higly-opinionated best-ish practices related to using JavaScript to generate <code>prerender</code> and <code>prefetch</code> resource hints. If you have a better way to implement anything here, have any additions, or if you take deep offense to something I said, say something! At the very least, I hope you walk away from all of this thinking things like this:</p>\n<ul>\n<li>“There really are quite a few things I need to be careful about when using these tactics in my own application.”</li>\n<li>“I just feel like I have better clarity into how these hints work and how they differ.”</li>\n<li>“The level of general interest and excitability I experienced when reading this post was high enough for me to tweet about it.”</li>\n</ul>\n<p>Thanks for reading!</p>\n",
        "feature_image": "https://images.pexels.com/photos/730134/pexels-photo-730134.jpeg",
        "status": "published",
        "created_at": 1542085200000,
        "published_at": 1542085200000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p><a href=\\\"https://www.w3.org/TR/resource-hints/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Resource hints</a> (preload, prefetch, prerender, etc.) have breathed some fresh life into the front-end performance game, especially as browsers are coming to support them more &#x26; more. For a traditional server-rendered application, a lot of these hints are pretty straightforward in terms of knowing when to implement them. For example, you should <em>preload</em> critical assets when you know they’ll be needed later on the page, and you should perform a <em>dns-prefetch</em> when you know you’ll be loading a bunch of assets from the same domain, like those from a CDN.</p>\\n<p>Other hints, however, are a bit more challenging. Both <code>prefetch</code> and <code>prerender</code> are concerned with loading an asset when it’s <em>likely</em> that the user will need it in the <em>future</em>. But predicting the future is really hard. And for this reason, instead of hard-coding these hints in your HTML, it’s often better to create them dynamically with JavaScript in response to a user’s behavior.</p>\\n<p>This really isn’t a new thing. In fact, there’s a lot of discussion and how-tos out there that explore using JavaScript to do things like <a href=\\\"https://css-tricks.com/prerender-on-hover/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">prerender a page on hover</a>, <a href=\\\"https://www.mskog.com/posts/instant-page-loads-with-turbolinks-and-prefetch/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">prefetch pages on intended click</a>, and a whole lot more. Much of this talk focuses on the <em>how,</em> rather than exploring any of the rationale for why you might do it to begin with. That said, there’a a lot of room for clarity in answering a few questions:</p>\\n<p><em>When using JavaScript to do it…</em></p>\\n<ul>\\n<li><em>…how do I know if I should I prefetch vs. prerender a page?</em></li>\\n<li><em>…how many pages should I prefetch and/or prerender at any given time?</em></li>\\n<li><em>…how do I know when I should trigger any</em> <code>prefetch</code> <em>or</em> <code>prerender</code><em>?</em></li>\\n</ul>\\n<p>All of these questions hover around a delicate balance. If we prefetch and/or prerender too much, we risk bloating our user’s network bandwidth and may end up <em>harming</em> performance. If too little (or unintelligently), all of our work could be for nothing because no one actually benefits from it. The fulcrum for this balance is positioned differently for almost every application you encounter, and it’s only complicated by the flexibility JavaScript provides in leveraging these tools.</p>\\n<p>Based on what I’ve found while experimenting, here are some miscellaneous, <em>highly opinionated</em> personal best-ish practices for using JavaScript to dynamically and intelligently generate <code>prerender</code> and <code>prefetch</code> hints. As we move through these recommendations, we’ll be crafting some code to actualize all of this a little more. Let’s go!</p>\\n<h2>1. <em>Do</em> use JavaScript to prefetch or prerender on <em>probable</em> click.</h2>\\n<p>Unless you’re working with a site that has very little content and only a few links, it’s generally a bad idea to do a blanket prefetch or prerender for every link on the page, immediately after page load. Why? That’s a lot of data downloaded all at once, and much of it will never even be used. Instead, it’s best to reserve these tasks for when you can be reasonably confident a user is going to click on something.</p>\\n<p>One straightforward way to do this is to trigger an action on hover:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">querySelectorAll</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"a\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">forEach</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">link</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  link<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">addEventListener</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"mouseover\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">e</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token comment\\\">//-- Prefetch or prerender!</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>For a lot of cases, I think this is just fine. But, if you’re working on a page with a significant number of links, or if you’re hoping to do a resource-intensive <code>prerender</code>, it’s just not intelligent enough to give us full confidence that a click is actually about to happen. For all we know, the user could just be navigating the mouse from one part of the page to another. Triggering a prefetch or prerender for any of these hovers may be a little too generous.</p>\\n<p>So, let’s up our prediction game by triggering something on hover with <em>intentiona</em>. We could get really hairy with our level of sophistication here, but to keep things simple, let’s assume that the longer a person hovers, the more likely they are to click something.</p>\\n<p>To help with this, I wrote <a href=\\\"https://github.com/alexmacarthur/probaclick\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">ProbaClick</a>, a small utility that fires an action when a user hovers over something for a collective period time. By default that period of time is 500ms. If any number of hovers add up to that time, the callback is fired. Let’s wire that up here. A small side benefit is that its API will make our implementation a little cleaner.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token comment\\\">//- Fire some action when any &#x3C;a /> element is hovered over for some time.</span>\\n<span class=\\\"token function\\\"><span class=\\\"token maybe-class-name\\\">ProbaClick</span></span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"a\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token function-variable function\\\">callback</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">element</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token comment\\\">//-- Prefetch or prerender!</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>And to cut to the chase, let’s start to generate some hints for links that a user is probably going to click:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">makeHint</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">href<span class=\\\"token punctuation\\\">,</span> type</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">let</span> link <span class=\\\"token operator\\\">=</span> <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">createElement</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"link\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  link<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">setAttribute</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"rel\\\"</span><span class=\\\"token punctuation\\\">,</span> type<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  link<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">setAttribute</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"href\\\"</span><span class=\\\"token punctuation\\\">,</span> href<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">head</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">appendChild</span><span class=\\\"token punctuation\\\">(</span>link<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword control-flow\\\">return</span> href<span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">let</span> hasBeenPrerendered <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">let</span> hasBeenPrefetched <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token function\\\"><span class=\\\"token maybe-class-name\\\">ProbaClick</span></span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"a\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token function-variable function\\\">callback</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">link</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">let</span> href <span class=\\\"token operator\\\">=</span> link<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getAttribute</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"href\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token comment\\\">//-- Only generate hint if we haven't done so already for this URL.</span>\\n\\n    <span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>hasBeenPrerendered<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">includes</span><span class=\\\"token punctuation\\\">(</span>href<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      hasBeenPrerendered<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">push</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token function\\\">makeHint</span><span class=\\\"token punctuation\\\">(</span>href<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">\\\"prerender\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n\\n    <span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>hasBeenPrefetched<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">includes</span><span class=\\\"token punctuation\\\">(</span>href<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      hasBeenPrefetched<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">push</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token function\\\">makeHint</span><span class=\\\"token punctuation\\\">(</span>href<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">\\\"prefetch\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>Summary of that snippet: When a user hovers over a link for a total of 500ms, we append <code>prerender</code> and <code>prefetch</code> hints to the <code>&#x3C;head></code> of the document, but only if those respective hints haven’t already been generated in the past.</p>\\n<p>This is a step in the right direction, but there’s an adjustment in this we need to make, specifically dealing with how we’re prerendering pages.</p>\\n<h2>2. <em>Do not</em> use JS to <em>prerender</em> more than one page per load.</h2>\\n<p>Just like how our code is currently set up, it’s tempting to generate a <code>prender</code> hint for every link that will probably be clicked. But don’t waste your time, because technically, it’s only possible to run a single prerender process per instance of the browser, which means that we’re just wasting our time doing anything more than that. While I haven’t found any official documentation on this being the case for <em>all</em> browsers, it does seem to be largely agreed upon. <a href=\\\"http://ipullrank.com/how-i-sped-up-my-site-68-percent-with-one-line-of-code/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">This nice blog post</a>, <a href=\\\"https://stackoverflow.com/questions/26387612/html-performance-prerendering-of-multiple-pages\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">this StackOverflow question</a>, and my personal experience all confirm it.</p>\\n<p>Before adjusting our code to account for this, let’s dive into the behavior of the <code>prerender</code> hint a little bit.</p>\\n<p><strong>How Prerendering Behaves w/ Hard-Coded HTML</strong></p>\\n<p>Prior to touching any JavaScript, I played with some hard-coded <code>prerender</code> hints, just to get an idea of how the browser might do things out of the box. To verify what was actually being prerendered, I used Chrome’s Net Internals tool: <a href=\\\"chrome://net-internals/#prerender\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">chrome://net-internals/#prerender</a></p>\\n<p>Here’s what I had in the head of my HTML:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>link</span> <span class=\\\"token attr-name\\\">rel</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>prerender<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token attr-name\\\">href</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>https://www.typeitjs.com<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token punctuation\\\">/></span></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>link</span> <span class=\\\"token attr-name\\\">rel</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>prerender<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token attr-name\\\">href</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>https://www.typeitjs.com/docs<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token punctuation\\\">/></span></span>\\n</code></pre></div>\\n<p>When I loaded the page, only the <em>first</em> hint was respected, and nothing was done with the second. It was seemingly just ignored. Interestingly, though, after I refreshed that same page, the <em>second</em> URL was actively prerendered, with the first hint being designated as a “duplicate.” Apparently, the browser holds onto previously prerendered pages, at least for a little while. And when I refreshed again, neither was prerendered.</p>\\n<p>The lesson learned here is that the browser will prerender the first hint it finds that’s not already cached (if we can call it that). Once a prerender process has started, any of the following <code>prerender</code> hints are useless.</p>\\n<p><strong>How Prerendering Behaves w/ JavaScript</strong></p>\\n<p>All of those observations provided some clarity in understanding why using JavaScript to prerender hints ended up being pretty weird when I first tried it.</p>\\n<p>To experiment, I set up a single page with three links, all of which had different <code>href</code> attributes. No resource hints existed on the page.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>a</span> <span class=\\\"token attr-name\\\">href</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>https://www.typeitjs.com<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>Home<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>a</span><span class=\\\"token punctuation\\\">></span></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>a</span> <span class=\\\"token attr-name\\\">href</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>https://www.typeitjs.com/docs<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>Docs<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>a</span><span class=\\\"token punctuation\\\">></span></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>a</span> <span class=\\\"token attr-name\\\">href</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>https://github.com/alexmacarthur/typeit<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>GitHub<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>a</span><span class=\\\"token punctuation\\\">></span></span>\\n</code></pre></div>\\n<p>Then, with JavaScript, I waited for each link to be hovered over.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">querySelectorAll</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"a\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">forEach</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">link</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  link<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">addEventListener</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"mouseover\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">e</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">let</span> href <span class=\\\"token operator\\\">=</span> link<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getAttribute</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"href\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword\\\">let</span> prerenderLink <span class=\\\"token operator\\\">=</span> <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">createElement</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"link\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    prerenderLink<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">setAttribute</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"rel\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">\\\"prerender\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    prerenderLink<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">setAttribute</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"href\\\"</span><span class=\\\"token punctuation\\\">,</span> href<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token comment\\\">//-- Spit out the prerender hint.</span>\\n    <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">head</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">appendChild</span><span class=\\\"token punctuation\\\">(</span>prerenderLink<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>At first, I had what I thought was a pretty straightforward hypothesis: When a link was hovered over, the respective URL would actively prerendered. That was correct… sort of.</p>\\n<p>When I hovered over the <em>first</em> link, everything worked as expected. The URL was preloaded, which I verified with both the Net Internals tool, as well as <a href=\\\"https://www.lifewire.com/google-chrome-task-manager-4103619\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Google’s Task Manager</a> pane. But on any subsequent hover, and to my frustration, nothing changed. The same initial link remained “active,” and I gained nothing by hovering over any of the other links. In hindsight, this makes perfect sense because of what we discovered with hard-coded hints. When the browser starts a prerender process, you can’t start another one. This makes it rather difficult to effectively leverage JavaScript to prerender multiple pages, because once it’s done, it’s done.</p>\\n<p>Let’s apply this lesson to our code. To be a little more responsible with our hint generation, we need to prevent any subsequent prerendering after we’ve done it once.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">makeHint</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">href<span class=\\\"token punctuation\\\">,</span> type</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">let</span> link <span class=\\\"token operator\\\">=</span> <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">createElement</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"link\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  link<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">setAttribute</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"rel\\\"</span><span class=\\\"token punctuation\\\">,</span> type<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  link<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">setAttribute</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"href\\\"</span><span class=\\\"token punctuation\\\">,</span> href<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">head</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">appendChild</span><span class=\\\"token punctuation\\\">(</span>link<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword control-flow\\\">return</span> href<span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">let</span> hasBeenPrerendered <span class=\\\"token operator\\\">=</span> <span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">let</span> hasBeenPrefetched <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token function\\\"><span class=\\\"token maybe-class-name\\\">ProbaClick</span></span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"a\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token function-variable function\\\">callback</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">link</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">let</span> href <span class=\\\"token operator\\\">=</span> link<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getAttribute</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"href\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token comment\\\">//-- Only generate hint if we haven't done so already for this URL.</span>\\n\\n    <span class=\\\"token comment\\\">//-- Only prerender if _nothing_ has been prerenderd before.</span>\\n    <span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>hasBeenPrerendered<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      hasBeenPrerendered <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">makeHint</span><span class=\\\"token punctuation\\\">(</span>href<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">\\\"prerender\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n\\n    <span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>hasBeenPrefetched<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">includes</span><span class=\\\"token punctuation\\\">(</span>href<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      hasBeenPrefetched<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">push</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token function\\\">makeHint</span><span class=\\\"token punctuation\\\">(</span>href<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">\\\"prefetch\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>This is helpful, but because we only get once chance to prerender a page, it feels a little, uh, not right, to be using the exact same criteria to prerender as we do prefetch. Let’s do something about that.</p>\\n<h2>3. <em>Do</em> be <em>very</em> intentional in how you decide when you should prerender a page.</h2>\\n<p>There’s a decent amount at stake when choosing to dynamically prerender a page. We get one shot, and if we’re wrong, we waste a good chunk of our user’s bandwidth for nothing. To help us be a lot more intentional with choosing how to prerender, let’s pull it out of our current setup altogether and beef up the logic we use to pull the trigger.</p>\\n<p>For this separate set of logic, instead of just doing something like increasing the delay before firing the action, ProbaClick also allows you to set a maximum hover count to do so. If a user hovers over an element a certain number of times OR if the total hover duration time is met, that event fires.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">makeHint</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">href<span class=\\\"token punctuation\\\">,</span> type</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">let</span> link <span class=\\\"token operator\\\">=</span> <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">createElement</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"link\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  link<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">setAttribute</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"rel\\\"</span><span class=\\\"token punctuation\\\">,</span> type<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  link<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">setAttribute</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"href\\\"</span><span class=\\\"token punctuation\\\">,</span> href<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">head</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">appendChild</span><span class=\\\"token punctuation\\\">(</span>link<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword control-flow\\\">return</span> href<span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">let</span> hasBeenPrefetched <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token function\\\"><span class=\\\"token maybe-class-name\\\">ProbaClick</span></span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"a\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token function-variable function\\\">callback</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">link</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">let</span> href <span class=\\\"token operator\\\">=</span> link<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getAttribute</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"href\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>hasBeenPrefetched<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">includes</span><span class=\\\"token punctuation\\\">(</span>href<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      hasBeenPrefetched<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">push</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token function\\\">makeHint</span><span class=\\\"token punctuation\\\">(</span>href<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">\\\"prefetch\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">let</span> hasBeenPrerendered <span class=\\\"token operator\\\">=</span> <span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token function\\\"><span class=\\\"token maybe-class-name\\\">ProbaClick</span></span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"a\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token literal-property property\\\">delay</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">1000</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token literal-property property\\\">count</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">3</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token function-variable function\\\">callback</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">link</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">let</span> href <span class=\\\"token operator\\\">=</span> link<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getAttribute</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"href\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>hasBeenPrerendered<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      hasBeenPrerendered <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">makeHint</span><span class=\\\"token punctuation\\\">(</span>href<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">\\\"prerender\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>With that change, we’re generating hints based on the following criteria:</p>\\n<p><strong>Prefetch</strong> when user collectively hovers over a link for 500ms. <strong>Prerender</strong> when user collectively hovers over a link for 1000ms, OR when they’ve hovered 3 different times.</p>\\n<p>This feels more appropriate, given the fact that <code>prefetch</code> and <code>prerender</code> hints do different things in different ways.</p>\\n<h2>4. <em>Do not</em> prefetch or prerender pages on someone else’s site.</h2>\\n<p>The main reason for this is the fact that you didn’t build that other site, and so you probably don’t know in detail how it’s constructed – including its page weight, code quality, or maybe even some insecure practices it may be employing. By prefetching or prerendering someone else’s site, you necessarily take on a notable level of risk. The level of this risk obviously varies from site to site, but on the whole, it’s enough for me to say “naaah” to the practice altogether.</p>\\n<p>This is particularly a big deal when prerendering pages. As mentioned earlier, prerendering is resource-intensive and involves more than just “fetching” a page document for later rendering. A <code>prerender</code> hint <em>prerenders</em> the page, which includes fetching and execution of the page’s sub-resources. It’s a feat.</p>\\n<p>So, let’s say you publish a blog post encouraging people to donate to a GoFundMe cause, and your post contains a link to the donation page. To quicken the subsequent render when someone clicks that link, you <em>could</em> prerender it in the background. But don’t, for these reasons:</p>\\n<ul>\\n<li>You might not be aware of the fact that its main JavaScript file is a 500MB behemoth. And that’s just one file, before it’s even been parsed and executed. By prerendering that page, you just maxed out your user’s mobile data plan for the month, when they MIGHT not even have visited the page anyway.</li>\\n<li>You have no idea what kind of third party scripts that site may be using, much less the impact it may have on your own site’s performance and security.</li>\\n</ul>\\n<p>So, let’s make a modification to <em>not</em> prefetch or prerender any links that belong to a different domain than our own.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">makeHint</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">href<span class=\\\"token punctuation\\\">,</span> type</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">let</span> link <span class=\\\"token operator\\\">=</span> <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">createElement</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"link\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  link<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">setAttribute</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"rel\\\"</span><span class=\\\"token punctuation\\\">,</span> type<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  link<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">setAttribute</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"href\\\"</span><span class=\\\"token punctuation\\\">,</span> href<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">head</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">appendChild</span><span class=\\\"token punctuation\\\">(</span>link<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword control-flow\\\">return</span> href<span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">isExternalLink</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">href</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token operator\\\">!</span>href<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">match</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token regex\\\"><span class=\\\"token regex-delimiter\\\">/</span><span class=\\\"token regex-source language-regex\\\"><span class=\\\"token anchor function\\\">^</span><span class=\\\"token escape\\\">\\\\/</span></span><span class=\\\"token regex-delimiter\\\">/</span></span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">&#x26;&#x26;</span> <span class=\\\"token operator\\\">!</span>href<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">includes</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token dom variable\\\">window</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">location</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">host</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">let</span> hasBeenPrefetched <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token function\\\"><span class=\\\"token maybe-class-name\\\">ProbaClick</span></span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"a\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token function-variable function\\\">callback</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">link</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">let</span> href <span class=\\\"token operator\\\">=</span> link<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getAttribute</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"href\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token function\\\">isExternalLink</span><span class=\\\"token punctuation\\\">(</span>href<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token keyword control-flow\\\">return</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>hasBeenPrefetched<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">includes</span><span class=\\\"token punctuation\\\">(</span>href<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      hasBeenPrefetched<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">push</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token function\\\">makeHint</span><span class=\\\"token punctuation\\\">(</span>href<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">\\\"prefetch\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">let</span> hasBeenPrerendered <span class=\\\"token operator\\\">=</span> <span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token function\\\"><span class=\\\"token maybe-class-name\\\">ProbaClick</span></span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"a\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token literal-property property\\\">delay</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">1000</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token literal-property property\\\">count</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">3</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token function-variable function\\\">callback</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">link</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">let</span> href <span class=\\\"token operator\\\">=</span> link<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getAttribute</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"href\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token function\\\">isExternalLink</span><span class=\\\"token punctuation\\\">(</span>href<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token keyword control-flow\\\">return</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>hasBeenPrerendered<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      hasBeenPrerendered <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">makeHint</span><span class=\\\"token punctuation\\\">(</span>href<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">\\\"prerender\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<h2>Clean-Up Time</h2>\\n<p>Nice! We’ve got the meat of our code written, but let’s tidy some things up a bit:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">let</span> hasBeen <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token literal-property property\\\">prefetch</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token literal-property property\\\">prerender</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">makeHint</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">href<span class=\\\"token punctuation\\\">,</span> type</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">let</span> link <span class=\\\"token operator\\\">=</span> <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">createElement</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"link\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  link<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">setAttribute</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"rel\\\"</span><span class=\\\"token punctuation\\\">,</span> type<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  link<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">setAttribute</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"href\\\"</span><span class=\\\"token punctuation\\\">,</span> href<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">head</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">appendChild</span><span class=\\\"token punctuation\\\">(</span>link<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword control-flow\\\">return</span> href<span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">isExternalLink</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">href</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token operator\\\">!</span>href<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">match</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token regex\\\"><span class=\\\"token regex-delimiter\\\">/</span><span class=\\\"token regex-source language-regex\\\"><span class=\\\"token anchor function\\\">^</span><span class=\\\"token escape\\\">\\\\/</span></span><span class=\\\"token regex-delimiter\\\">/</span></span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">&#x26;&#x26;</span> <span class=\\\"token operator\\\">!</span>href<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">includes</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token dom variable\\\">window</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">location</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">host</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">maybeMakeHint</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\"><span class=\\\"token punctuation\\\">{</span> link<span class=\\\"token punctuation\\\">,</span> type<span class=\\\"token punctuation\\\">,</span> max <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword null nil\\\">null</span> <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span></span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">let</span> href <span class=\\\"token operator\\\">=</span> link<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">getAttribute</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"href\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token function\\\">isExternalLink</span><span class=\\\"token punctuation\\\">(</span>href<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token keyword control-flow\\\">return</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span>hasBeen<span class=\\\"token punctuation\\\">[</span>type<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">includes</span><span class=\\\"token punctuation\\\">(</span>href<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token keyword control-flow\\\">return</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span>max <span class=\\\"token operator\\\">!==</span> <span class=\\\"token keyword null nil\\\">null</span> <span class=\\\"token operator\\\">&#x26;&#x26;</span> hasBeen<span class=\\\"token punctuation\\\">[</span>type<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">length</span> <span class=\\\"token operator\\\">>=</span> max<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token keyword control-flow\\\">return</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  hasBeen<span class=\\\"token punctuation\\\">[</span>type<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">push</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token function\\\">makeHint</span><span class=\\\"token punctuation\\\">(</span>href<span class=\\\"token punctuation\\\">,</span> type<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token function\\\"><span class=\\\"token maybe-class-name\\\">ProbaClick</span></span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"a\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token function-variable function\\\">callback</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">link</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token function\\\">maybeMakeHint</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n      link<span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token literal-property property\\\">type</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"prefetch\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token function\\\"><span class=\\\"token maybe-class-name\\\">ProbaClick</span></span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"a\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token literal-property property\\\">delay</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">1000</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token literal-property property\\\">count</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">3</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token function-variable function\\\">callback</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">link</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token function\\\">maybeMakeHint</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n      link<span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token literal-property property\\\">type</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"prerender\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token literal-property property\\\">max</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>There we have it: a few lines of untested code following some higly-opinionated best-ish practices related to using JavaScript to generate <code>prerender</code> and <code>prefetch</code> resource hints. If you have a better way to implement anything here, have any additions, or if you take deep offense to something I said, say something! At the very least, I hope you walk away from all of this thinking things like this:</p>\\n<ul>\\n<li>“There really are quite a few things I need to be careful about when using these tactics in my own application.”</li>\\n<li>“I just feel like I have better clarity into how these hints work and how they differ.”</li>\\n<li>“The level of general interest and excitability I experienced when reading this post was high enough for me to tweet about it.”</li>\\n</ul>\\n<p>Thanks for reading!</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 50,
        "title": "Why Using reduce() to Sequentially Resolve Promises Works",
        "slug": "why-using-reduce-to-sequentially-resolve-promises-works",
        "html": "<p>A guest post in which I explore why JavaScript’s reduce() method is able to help sequentually resolve a collection of Promise objects.</p>\n",
        "feature_image": "",
        "status": "published",
        "created_at": 1539752400000,
        "published_at": 1539752400000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>A guest post in which I explore why JavaScript’s reduce() method is able to help sequentually resolve a collection of Promise objects.</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 51,
        "title": "Introducing Better Resource Hints for WordPress",
        "slug": "introducing-better-resource-hints-wordpress-plugin",
        "html": "<p>It’s easy to rattle off a bunch of ways you can improve the performance of your website:</p>\n<ul>\n<li>minify your CSS &#x26; JS</li>\n<li>optimize your images</li>\n<li>cache the crap out of it</li>\n<li>use a CDN</li>\n<li>etc.</li>\n</ul>\n<p>Those are all important, but there’s also a more modern, less-discussed approach that can almost immediately earn you some serious performance points: <strong>resource hints</strong>. Sparing the <a href=\"https://www.w3.org/TR/resource-hints/\" target=\"_blank\" rel=\"noopener\">long, detailed explanation of what these actually are</a>, you can think of them as rules you give the browser for how and when it downloads resources needed for your website, including CSS, JS, images, fonts, and any other assets. When the browser follows these rules, your site loads and becomes interactive more quickly, causing metrics like time to interactive and perceptual speed index to improve.</p>\n<p>And now, it’s a lot easier to implement and manage these hints on your WordPress site.</p>\n<p>I just introduced <a href=\"https://wordpress.org/plugins/better-resource-hints/\" target=\"_blank\" rel=\"noopener\">Better Resource Hints</a>, a WordPress plugin that enables you to intelligently implement different resource hints for your website with little intimidation or complicated configuration. Just by turning it on, the plugin will take a conservative but effective approach to setting up these hints, and allow you to beef it up if needed.</p>\n<p>Specifically, this plugin leverages the following types of hints:</p>\n<p><strong>Preconnecting</strong> – This one is similar to the more common hint “dns-prefetch,” but a more beefier version. Instead of just resolving the DNS as early as possible, the preconnect hint handles TLS negotiations and TCP handshakes, resulting in reduced page latency.</p>\n<p><strong>Preloading</strong> – Preloading occurs when the browser is told it can start downloading an asset in the background early during page load, instead of waiting until the asset is explicitly called to start the process. This hint is most beneficial for assets loaded later on in the page, but are nonetheless essential to the page’s functionality. More often than not, the type of asset that benefits most from this is JavaScript, but it can be used for any type of resource. Enabling this results in an overall faster load time, and quicker time to interactive.</p>\n<p><strong>Prefetching</strong> – Prefetching assets is similar to preloading, but the assets are downloaded in low priority for the purpose of caching them for later use. For example, if a user hits your home page and is likely to go to a page that uses a heavy JavaScript file, it’s wise to prefetch that asset on the home page, so it’s cached and ready to go on the next. Again, the result is a quicker subsequent page load, quicker time to interactive, and an improved overall user experience. This is different from DNS prefetching, which will only resolve the DNS of a resource’s host, and not actually download the resource itself.</p>\n<p><strong>Server Push</strong> – If enabled, server push will tell your server to start delivering an asset before the browser even asks for it. This results in a much faster delivery of key assets, and it be toggled on for both preloaded, prefetched, and preconnected assets. Note: This feature requires a server that supports server push, and is the most experimental strategy this plugin provides.</p>\n<p>There’s not much to lose here. <a href=\"https://wordpress.org/plugins/better-resource-hints/\" target=\"_blank\" rel=\"noopener\">Download the plugin</a>, activate it, and start measuring your performance gains using a tool like Google Lighthouse. Regardless of the results, <a href=\"/contact\" target=\"_blank\" rel=\"noopener\">let me know!</a> I want to know what I can do to make the plugin better in any way.</p>\n",
        "feature_image": "",
        "status": "published",
        "created_at": 1526706000000,
        "published_at": 1526706000000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>It’s easy to rattle off a bunch of ways you can improve the performance of your website:</p>\\n<ul>\\n<li>minify your CSS &#x26; JS</li>\\n<li>optimize your images</li>\\n<li>cache the crap out of it</li>\\n<li>use a CDN</li>\\n<li>etc.</li>\\n</ul>\\n<p>Those are all important, but there’s also a more modern, less-discussed approach that can almost immediately earn you some serious performance points: <strong>resource hints</strong>. Sparing the <a href=\\\"https://www.w3.org/TR/resource-hints/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">long, detailed explanation of what these actually are</a>, you can think of them as rules you give the browser for how and when it downloads resources needed for your website, including CSS, JS, images, fonts, and any other assets. When the browser follows these rules, your site loads and becomes interactive more quickly, causing metrics like time to interactive and perceptual speed index to improve.</p>\\n<p>And now, it’s a lot easier to implement and manage these hints on your WordPress site.</p>\\n<p>I just introduced <a href=\\\"https://wordpress.org/plugins/better-resource-hints/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Better Resource Hints</a>, a WordPress plugin that enables you to intelligently implement different resource hints for your website with little intimidation or complicated configuration. Just by turning it on, the plugin will take a conservative but effective approach to setting up these hints, and allow you to beef it up if needed.</p>\\n<p>Specifically, this plugin leverages the following types of hints:</p>\\n<p><strong>Preconnecting</strong> – This one is similar to the more common hint “dns-prefetch,” but a more beefier version. Instead of just resolving the DNS as early as possible, the preconnect hint handles TLS negotiations and TCP handshakes, resulting in reduced page latency.</p>\\n<p><strong>Preloading</strong> – Preloading occurs when the browser is told it can start downloading an asset in the background early during page load, instead of waiting until the asset is explicitly called to start the process. This hint is most beneficial for assets loaded later on in the page, but are nonetheless essential to the page’s functionality. More often than not, the type of asset that benefits most from this is JavaScript, but it can be used for any type of resource. Enabling this results in an overall faster load time, and quicker time to interactive.</p>\\n<p><strong>Prefetching</strong> – Prefetching assets is similar to preloading, but the assets are downloaded in low priority for the purpose of caching them for later use. For example, if a user hits your home page and is likely to go to a page that uses a heavy JavaScript file, it’s wise to prefetch that asset on the home page, so it’s cached and ready to go on the next. Again, the result is a quicker subsequent page load, quicker time to interactive, and an improved overall user experience. This is different from DNS prefetching, which will only resolve the DNS of a resource’s host, and not actually download the resource itself.</p>\\n<p><strong>Server Push</strong> – If enabled, server push will tell your server to start delivering an asset before the browser even asks for it. This results in a much faster delivery of key assets, and it be toggled on for both preloaded, prefetched, and preconnected assets. Note: This feature requires a server that supports server push, and is the most experimental strategy this plugin provides.</p>\\n<p>There’s not much to lose here. <a href=\\\"https://wordpress.org/plugins/better-resource-hints/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Download the plugin</a>, activate it, and start measuring your performance gains using a tool like Google Lighthouse. Regardless of the results, <a href=\\\"/contact\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">let me know!</a> I want to know what I can do to make the plugin better in any way.</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 52,
        "title": "Using the posts_where Filter in WordPress",
        "slug": "using-the-posts-where-filter-in-wordpress",
        "html": "<p>If you’ve spent 20 seconds in WordPress development, you’ve likely worked with, cursed, and fallen in love with the WP_Query class – one of the most useful, commonly used tools in any given WordPress website or application.</p>\n<p>Aside from being responsible for the main query on any given page or post, it serves as the go-to way to interface with your database in tons of different contexts. Most commonly, you might see it used to retrieve data like custom post types. For example, getting all of the cat massage tutorials in a site:</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token variable\">$massageQuery</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WP_Query</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>    <span class=\"token string single-quoted-string\">'post_type'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'cat_massage_tutorial'</span><span class=\"token punctuation\">,</span>    <span class=\"token string single-quoted-string\">'posts_per_page'</span> <span class=\"token operator\">=></span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Even more than that, you can use this class to make slightly more complex queries based on meta data attached to different posts. Let’s get all the cat massage tutorials whose difficulty level are above 8:</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token variable\">$massageQuery</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WP_Query</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>    <span class=\"token string single-quoted-string\">'post_type'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'cat_massage_tutorial'</span><span class=\"token punctuation\">,</span>    <span class=\"token string single-quoted-string\">'posts_per_page'</span> <span class=\"token operator\">=></span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>    <span class=\"token string single-quoted-string\">'meta_query'</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span>        <span class=\"token punctuation\">[</span>            <span class=\"token string single-quoted-string\">'key'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'difficulty'</span><span class=\"token punctuation\">,</span>            <span class=\"token string single-quoted-string\">'compare'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'>'</span><span class=\"token punctuation\">,</span>            <span class=\"token string single-quoted-string\">'value'</span> <span class=\"token operator\">=></span> <span class=\"token number\">8</span><span class=\"token punctuation\">,</span>            <span class=\"token string single-quoted-string\">'type'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'numeric'</span>        <span class=\"token punctuation\">]</span>    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>That’s all really neat, and honestly, relatively common to see. So, let’s do something a little more interesting and gather a set of posts not easily queryable by WP_Query out of the box.</p>\n<p>Imagine that we want all of the “long” cat massage tutorials in our database – those whose content have at least a certain number of characters. This information isn’t stored in post meta, so we can’t rely on out-of-the-box functionality of WP_Query. So, how do we collect only the “long” posts in our database?</p>\n<h3>One option: Loop through all the things.</h3>\n<p>We <em>could</em> do something like get all the posts, and then loop over each retrieved post in our PHP, filtering out those under a certain character count. But this is inefficient and bit more cumbersome compared to another option we have.</p>\n<h3>Better option: Use the ‘posts_where’ filter to modify the ‘where’ clause in your WP_Query.</h3>\n<p>By modifying the SQL query underlying our WP_Query, the work can be efficiently offloaded to where it <em>should</em> be done, rather than dealing with it elsewhere, like in template logic.</p>\n<p><strong>First, create a WP_Query object querying for all of our posts.</strong></p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token variable\">$massageQuery</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WP_Query</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>    <span class=\"token string single-quoted-string\">'post_type'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'cat_massage_tutorial'</span><span class=\"token punctuation\">,</span>    <span class=\"token string single-quoted-string\">'posts_per_page'</span> <span class=\"token operator\">=></span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p><strong>In our arguments, pass a</strong> <strong><code>query_label</code></strong> <strong>key and value. This isn’t a WP_Query option – it’s a totally arbitrary key we’re passing that we’ll use later to identify our query.</strong></p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token variable\">$massageQuery</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WP_Query</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>    <span class=\"token string single-quoted-string\">'query_label'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'our_cat_massage_query'</span><span class=\"token punctuation\">,</span>    <span class=\"token string single-quoted-string\">'post_type'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'cat_massage_tutorial'</span><span class=\"token punctuation\">,</span>    <span class=\"token string single-quoted-string\">'posts_per_page'</span> <span class=\"token operator\">=></span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p><strong>Next up, we need to filter part of the SQL statement that’s retrieving stuff from our database.</strong></p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token function\">add_filter</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'posts_where'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$where</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$query</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>    <span class=\"token comment\">//-- Stuff will go here.    return $where;}, 10, 2);</span>\n</code></pre></div>\n<p><strong>Using the</strong> <strong><code>query_label</code></strong> <strong>key we passed earlier, make sure we’re only doing this on our specific query.</strong></p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token function\">add_filter</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'posts_where'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$where</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$query</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>    <span class=\"token variable\">$label</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$query</span><span class=\"token operator\">-></span><span class=\"token property\">query</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'query_label'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">??</span> <span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">;</span>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$label</span> <span class=\"token operator\">===</span> <span class=\"token string single-quoted-string\">'our_cat_massage_query'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>        <span class=\"token comment\">//-- More stuff will go here.    }    return $where;}, 10, 2);</span>\n</code></pre></div>\n<p><strong>Now, append a condition to the</strong> <strong><code>where</code></strong> <strong>clause of that query.</strong> You’ll obviously need to have a baseline understanding of SQL here. In this case, we’re grabbing all the posts whose content is more than 1200 characters.</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token function\">add_filter</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'posts_where'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$where</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$query</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>    <span class=\"token variable\">$label</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$query</span><span class=\"token operator\">-></span><span class=\"token property\">query</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'query_label'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">??</span> <span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">;</span>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$label</span> <span class=\"token operator\">===</span> <span class=\"token string single-quoted-string\">'our_cat_massage_query'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>        <span class=\"token keyword\">global</span> <span class=\"token variable\">$wpdb</span><span class=\"token punctuation\">;</span>        <span class=\"token variable\">$where</span> <span class=\"token operator\">.=</span> <span class=\"token string double-quoted-string\">\" AND LENGTH(<span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token variable\">$wpdb</span><span class=\"token operator\">-></span><span class=\"token property\">prefix</span><span class=\"token punctuation\">}</span></span>posts.post_content) > 1200\"</span><span class=\"token punctuation\">;</span>    <span class=\"token punctuation\">}</span>    <span class=\"token keyword\">return</span> <span class=\"token variable\">$where</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Now, our WP_Query object will return exactly what we defined in our arguments, but within the scope of how we filtered our <code>where</code> clause. All <em>without</em> needing to be clever with any other PHP.</p>\n<h3>“When am I ever going to need this?”</h3>\n<p>I don’t know. This WordPress development we’re talking about. Always be ready.</p>\n<h3>“This doesn’t make me feel very good.”</h3>\n<p>I’m right there with you. When querying like this, making a WP_Query object and then writing a filter in a different location is far less than elegant, and I’m certainly open to more effective ways so do this without getting abandoning use of the tool altogether. Do you have a better solution? Share it!</p>\n<p>For better or for worse, I hope this will help tackle a task using WP_Query in the future. That said, if you’re struggling with this or anything related in your own application, I’m available for hire. <a href=\"/contact\" target=\"_blank\" rel=\"noopener\">Get in touch</a>!</p>\n",
        "feature_image": "",
        "status": "published",
        "created_at": 1524632400000,
        "published_at": 1524632400000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>If you’ve spent 20 seconds in WordPress development, you’ve likely worked with, cursed, and fallen in love with the WP_Query class – one of the most useful, commonly used tools in any given WordPress website or application.</p>\\n<p>Aside from being responsible for the main query on any given page or post, it serves as the go-to way to interface with your database in tons of different contexts. Most commonly, you might see it used to retrieve data like custom post types. For example, getting all of the cat massage tutorials in a site:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token variable\\\">$massageQuery</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">WP_Query</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">[</span>    <span class=\\\"token string single-quoted-string\\\">'post_type'</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token string single-quoted-string\\\">'cat_massage_tutorial'</span><span class=\\\"token punctuation\\\">,</span>    <span class=\\\"token string single-quoted-string\\\">'posts_per_page'</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token operator\\\">-</span><span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>Even more than that, you can use this class to make slightly more complex queries based on meta data attached to different posts. Let’s get all the cat massage tutorials whose difficulty level are above 8:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token variable\\\">$massageQuery</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">WP_Query</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">[</span>    <span class=\\\"token string single-quoted-string\\\">'post_type'</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token string single-quoted-string\\\">'cat_massage_tutorial'</span><span class=\\\"token punctuation\\\">,</span>    <span class=\\\"token string single-quoted-string\\\">'posts_per_page'</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token operator\\\">-</span><span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">,</span>    <span class=\\\"token string single-quoted-string\\\">'meta_query'</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">[</span>        <span class=\\\"token punctuation\\\">[</span>            <span class=\\\"token string single-quoted-string\\\">'key'</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token string single-quoted-string\\\">'difficulty'</span><span class=\\\"token punctuation\\\">,</span>            <span class=\\\"token string single-quoted-string\\\">'compare'</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token string single-quoted-string\\\">'>'</span><span class=\\\"token punctuation\\\">,</span>            <span class=\\\"token string single-quoted-string\\\">'value'</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token number\\\">8</span><span class=\\\"token punctuation\\\">,</span>            <span class=\\\"token string single-quoted-string\\\">'type'</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token string single-quoted-string\\\">'numeric'</span>        <span class=\\\"token punctuation\\\">]</span>    <span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>That’s all really neat, and honestly, relatively common to see. So, let’s do something a little more interesting and gather a set of posts not easily queryable by WP_Query out of the box.</p>\\n<p>Imagine that we want all of the “long” cat massage tutorials in our database – those whose content have at least a certain number of characters. This information isn’t stored in post meta, so we can’t rely on out-of-the-box functionality of WP_Query. So, how do we collect only the “long” posts in our database?</p>\\n<h3>One option: Loop through all the things.</h3>\\n<p>We <em>could</em> do something like get all the posts, and then loop over each retrieved post in our PHP, filtering out those under a certain character count. But this is inefficient and bit more cumbersome compared to another option we have.</p>\\n<h3>Better option: Use the ‘posts_where’ filter to modify the ‘where’ clause in your WP_Query.</h3>\\n<p>By modifying the SQL query underlying our WP_Query, the work can be efficiently offloaded to where it <em>should</em> be done, rather than dealing with it elsewhere, like in template logic.</p>\\n<p><strong>First, create a WP_Query object querying for all of our posts.</strong></p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token variable\\\">$massageQuery</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">WP_Query</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">[</span>    <span class=\\\"token string single-quoted-string\\\">'post_type'</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token string single-quoted-string\\\">'cat_massage_tutorial'</span><span class=\\\"token punctuation\\\">,</span>    <span class=\\\"token string single-quoted-string\\\">'posts_per_page'</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token operator\\\">-</span><span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p><strong>In our arguments, pass a</strong> <strong><code>query_label</code></strong> <strong>key and value. This isn’t a WP_Query option – it’s a totally arbitrary key we’re passing that we’ll use later to identify our query.</strong></p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token variable\\\">$massageQuery</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">WP_Query</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">[</span>    <span class=\\\"token string single-quoted-string\\\">'query_label'</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token string single-quoted-string\\\">'our_cat_massage_query'</span><span class=\\\"token punctuation\\\">,</span>    <span class=\\\"token string single-quoted-string\\\">'post_type'</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token string single-quoted-string\\\">'cat_massage_tutorial'</span><span class=\\\"token punctuation\\\">,</span>    <span class=\\\"token string single-quoted-string\\\">'posts_per_page'</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token operator\\\">-</span><span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p><strong>Next up, we need to filter part of the SQL statement that’s retrieving stuff from our database.</strong></p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token function\\\">add_filter</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string single-quoted-string\\\">'posts_where'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">$where</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token variable\\\">$query</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>    <span class=\\\"token comment\\\">//-- Stuff will go here.    return $where;}, 10, 2);</span>\\n</code></pre></div>\\n<p><strong>Using the</strong> <strong><code>query_label</code></strong> <strong>key we passed earlier, make sure we’re only doing this on our specific query.</strong></p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token function\\\">add_filter</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string single-quoted-string\\\">'posts_where'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">$where</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token variable\\\">$query</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>    <span class=\\\"token variable\\\">$label</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token variable\\\">$query</span><span class=\\\"token operator\\\">-></span><span class=\\\"token property\\\">query</span><span class=\\\"token punctuation\\\">[</span><span class=\\\"token string single-quoted-string\\\">'query_label'</span><span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">??</span> <span class=\\\"token string single-quoted-string\\\">''</span><span class=\\\"token punctuation\\\">;</span>    <span class=\\\"token keyword\\\">if</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">$label</span> <span class=\\\"token operator\\\">===</span> <span class=\\\"token string single-quoted-string\\\">'our_cat_massage_query'</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>        <span class=\\\"token comment\\\">//-- More stuff will go here.    }    return $where;}, 10, 2);</span>\\n</code></pre></div>\\n<p><strong>Now, append a condition to the</strong> <strong><code>where</code></strong> <strong>clause of that query.</strong> You’ll obviously need to have a baseline understanding of SQL here. In this case, we’re grabbing all the posts whose content is more than 1200 characters.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token function\\\">add_filter</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string single-quoted-string\\\">'posts_where'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">$where</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token variable\\\">$query</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>    <span class=\\\"token variable\\\">$label</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token variable\\\">$query</span><span class=\\\"token operator\\\">-></span><span class=\\\"token property\\\">query</span><span class=\\\"token punctuation\\\">[</span><span class=\\\"token string single-quoted-string\\\">'query_label'</span><span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">??</span> <span class=\\\"token string single-quoted-string\\\">''</span><span class=\\\"token punctuation\\\">;</span>    <span class=\\\"token keyword\\\">if</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">$label</span> <span class=\\\"token operator\\\">===</span> <span class=\\\"token string single-quoted-string\\\">'our_cat_massage_query'</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>        <span class=\\\"token keyword\\\">global</span> <span class=\\\"token variable\\\">$wpdb</span><span class=\\\"token punctuation\\\">;</span>        <span class=\\\"token variable\\\">$where</span> <span class=\\\"token operator\\\">.=</span> <span class=\\\"token string double-quoted-string\\\">\\\" AND LENGTH(<span class=\\\"token interpolation\\\"><span class=\\\"token punctuation\\\">{</span><span class=\\\"token variable\\\">$wpdb</span><span class=\\\"token operator\\\">-></span><span class=\\\"token property\\\">prefix</span><span class=\\\"token punctuation\\\">}</span></span>posts.post_content) > 1200\\\"</span><span class=\\\"token punctuation\\\">;</span>    <span class=\\\"token punctuation\\\">}</span>    <span class=\\\"token keyword\\\">return</span> <span class=\\\"token variable\\\">$where</span><span class=\\\"token punctuation\\\">;</span><span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">10</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">2</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>Now, our WP_Query object will return exactly what we defined in our arguments, but within the scope of how we filtered our <code>where</code> clause. All <em>without</em> needing to be clever with any other PHP.</p>\\n<h3>“When am I ever going to need this?”</h3>\\n<p>I don’t know. This WordPress development we’re talking about. Always be ready.</p>\\n<h3>“This doesn’t make me feel very good.”</h3>\\n<p>I’m right there with you. When querying like this, making a WP_Query object and then writing a filter in a different location is far less than elegant, and I’m certainly open to more effective ways so do this without getting abandoning use of the tool altogether. Do you have a better solution? Share it!</p>\\n<p>For better or for worse, I hope this will help tackle a task using WP_Query in the future. That said, if you’re struggling with this or anything related in your own application, I’m available for hire. <a href=\\\"/contact\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Get in touch</a>!</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 53,
        "title": "Preloading JavaScript Assets in WordPress",
        "slug": "preloading-javascript-in-wordpress",
        "html": "<p>Squeezing every last drop of performance out of your website on any platform is an always-changing, never-ending, often addictive battle.</p>\n<p>Among the several tactics you can employ in this fight, leveraging <a href=\"https://www.w3.org/TR/resource-hints\" target=\"_blank\" rel=\"noopener\">resource hints</a> is a modern approach that can yield some significant ROI – with preloading is a particularly impactful place to start. <a href=\"https://www.smashingmagazine.com/2016/02/preload-what-is-it-good-for/\" target=\"_blank\" rel=\"noopener\">It’s a topic worth learning about in more depth yourself</a>, but in short, preloading directs a browser to asynchronously load an asset as soon as possible in the background, so it’s ready to be used when the page calls for it. While the <em>amount</em> of data being loaded by your page won’t change, the start-to-end process of it all will go more quickly, impacting metrics like <a href=\"https://web.dev/interactive/\" target=\"_blank\" rel=\"noopener\">TTI</a>.</p>\n<p>Preloading is most useful for fetching resources that are discovered late within the page life cycle – things like fonts or images that are referenced from within a stylesheet, or other assets that are requested via JavaScript. But it’s also been used to prioritize top-level assets on a page, like your main JavaScript files:</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>html</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>head</span><span class=\"token punctuation\">></span></span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>preload<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://my-script.js<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">as</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>script<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>head</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>body</span><span class=\"token punctuation\">></span></span>\n\t\t<span class=\"token comment\">&#x3C;!-- a bunch o' content --></span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://my-script.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>script</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>html</span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<p>When a page like this loads, the browser is told to download the referenced asset at high priority, beating out the priority placed on other resources that might have been requested.</p>\n<h2>What This Doesn’t Mean</h2>\n<p>To be fair, a setup like this won’t <em>guarantee</em> you great gains in raw performance, and that’s because the browser’s already <em>really</em> good at this sort of thing. For the past several years, browsers have implement a practice called “speculative scanning,” or “preload scanning.” Per this process, as the browser is building the DOM for the page, it will parse the HTML document for resources it’ll eventually need (JavaScript, CSS, etc.), and <a href=\"https://hacks.mozilla.org/2017/09/building-the-dom-faster-speculative-parsing-async-defer-and-preload/\" target=\"_blank\" rel=\"noopener\">begin downloading those in the background</a>. You get this for free, right out of the box.</p>\n<p>But what this process <em>won’t</em> do for you is tell the browser which assets it finds are <em>most</em> important (it’ll default to its own logic for that – usually by placement on the page). In the WordPress space especially, this is where the <code>preload</code> hint is especially handy. Depending on the site, a WordPress application often enqueues several different JavaScript, CSS, and image resources all at once, with a lot of those having low priority on certain pages, and higher priority on others. Indiciating which ones are most crucial can give the browser a leg up when your site loads.</p>\n<h2>Automate JavaScript Preloading in WordPress</h2>\n<p>In WordPress, it’s easy enough to manually spit out a <code>link ref=\"preload\"</code> tag for each file you’d like to preload, but it’s kind of a pain to set up if you’re managing a site with a lot of different scripts being loaded throughout the frame of the page. You want this automated, and you want that automation to be smart about which scripts are chosen to be preloaded.</p>\n<p>The most straightforward solution to this is to <strong>loop over your registered scripts preload them in the header.</strong> This can be achieved by simply running the following few lines of code in your application. You <em>could</em> drop them in your theme’s <code>functions.php</code> file, but don’t. Instead, just <a href=\"https://macarthur.me/posts/creating-the-simplest-wordpress-plugin\">make a really simple plugin</a>. It’s almost always a better option.</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token function\">add_action</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'wp_head'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">global</span> <span class=\"token variable\">$wp_scripts</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$wp_scripts</span><span class=\"token operator\">-></span><span class=\"token property\">queue</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$handle</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$script</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$wp_scripts</span><span class=\"token operator\">-></span><span class=\"token property\">registered</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$handle</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">//-- If version is set, append to end of source.</span>\n    <span class=\"token variable\">$source</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$script</span><span class=\"token operator\">-></span><span class=\"token property\">src</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$script</span><span class=\"token operator\">-></span><span class=\"token property\">ver</span> <span class=\"token operator\">?</span> <span class=\"token string double-quoted-string\">\"?ver=<span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token variable\">$script</span><span class=\"token operator\">-></span><span class=\"token property\">ver</span><span class=\"token punctuation\">}</span></span>\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">//-- Spit out the tag.</span>\n    <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&#x3C;link rel='preload' href='<span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token variable\">$source</span><span class=\"token punctuation\">}</span></span>' as='script'/>\\n\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Here’s what’s going on: On the <code>wp_head</code> hook (which fires after our scripts have been enqueued), we’re looping through our registered scripts and printing out a <code>link</code> tag in our <code>head</code> for each resource. In the end, we’ve given our registered JavaScript resources priority over every other asset that the browser has otherwise discovered for download.</p>\n<p>Two notes about this setup:</p>\n<p><strong>1. We’re hooking into</strong> <strong><code>wp_head</code></strong> <strong>with an early priority to spit out our</strong> <strong><code>link</code></strong> <strong>tags.</strong> We’re choosing this hook because it fires after our scripts have been enqueued, and it allows us to get as close to the top of the page as possible. The priority of <code>1</code> means it’ll fire early on – before most other stuff gets printed in the head. The <code>wp_print_scripts</code> or <code>wp_print_styles</code> hooks would also work just fine – it’d just mean that our hints are generated a little farther down on the page.</p>\n<p><strong>2. We’re making sure the URLs of these assets match</strong> <em><strong>exactly</strong></em><strong>, including the version.</strong> You’ll notice that if a version isn’t set on an asset we’re looping over, not even the <code>?</code> is attached to our source URL. That’s because if the <code>href</code> in your <code>link</code> tag doesn’t match the <code>src</code> attribute of your <code>script</code> tag, the browser will think these are two different resources, and you’ll have gained nothing.</p>\n<p><strong>3. We’re preloading even the scripts that are enqueued in the</strong> <strong><code>&#x3C;head></code>****.</strong> It might seem counterintuitive, since the browser should give them relatively high priority due to where they’re located. But it’s possible that other scripts may compete with these, and we want to deliberately give <em>ours</em> the highest priority, regardless of where the actual <code>&#x3C;script></code> tags are placed.</p>\n<h2>Think About Scoping</h2>\n<p>With this setup, we’re preloading every enqueued script out of the box, and as a result, it’s possible that we’re setting priority to scripts of less concern to us. So, for your specific use case, consider introducing some logic that would make this a little more intentional. For example, if you want to explicitly prioiritze your theme’s scripts, you might only generate the hint when the script’s path is found within your theme’s directory.</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token function\">add_action</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'wp_head'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">global</span> <span class=\"token variable\">$wp_scripts</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$wp_scripts</span><span class=\"token operator\">-></span><span class=\"token property\">queue</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$handle</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$script</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$wp_scripts</span><span class=\"token operator\">-></span><span class=\"token property\">registered</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$handle</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// This script's doesn't belong in my theme; don't preload.</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">strpos</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$script</span><span class=\"token operator\">-></span><span class=\"token property\">src</span><span class=\"token punctuation\">,</span> <span class=\"token string double-quoted-string\">\"/themes/mytheme/\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$script</span><span class=\"token operator\">-></span><span class=\"token property\">extra</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'group'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token variable\">$script</span><span class=\"token operator\">-></span><span class=\"token property\">extra</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'group'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token variable\">$source</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$script</span><span class=\"token operator\">-></span><span class=\"token property\">src</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$script</span><span class=\"token operator\">-></span><span class=\"token property\">ver</span> <span class=\"token operator\">?</span> <span class=\"token string double-quoted-string\">\"?ver=<span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token variable\">$script</span><span class=\"token operator\">-></span><span class=\"token property\">ver</span><span class=\"token punctuation\">}</span></span>\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&#x3C;link rel='preload' href='<span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token variable\">$source</span><span class=\"token punctuation\">}</span></span>' as='script'/>\\n\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h2>Verify It’s Working</h2>\n<p>Open the source on your page. You should see tags for each one of your footer-enqueued JavaScript files that look like this in your header:</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">'</span>preload<span class=\"token punctuation\">'</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">'</span>https://whatever-source.js?v=123<span class=\"token punctuation\">'</span></span> <span class=\"token attr-name\">as</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">'</span>script<span class=\"token punctuation\">'</span></span><span class=\"token punctuation\">/></span></span>\n</code></pre></div>\n<p>Now, look for the <code>script</code> tag in your footer that loads each respective file, and verify that the sources match exactly.</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">'</span>https://whatever-source.js?v=123<span class=\"token punctuation\">'</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>script</span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<p>Next, if you’re using Chrome, go into your developer tools, select the “Network” tab and refresh your page. Filter by JS files only, and you should see something like this:</p>\n<p><img src='/proxy/d3c3d665-c07a-44ef-8b86-a5a60e0993c9' alt='' loading='lazy' /></p>\n<p>Each of those files at the top should have a priority of “High” in the order you preloaded them.</p>\n<h2>Measure Your Performance Results!</h2>\n<p>Obviously, all of this is pointless unless there are measurable performance gains that come out of it. When I was testing a specific WordPress application with a great deal of plugin-enqueued scripts, I saw some pretty encouraging numbers. By nature of the a local development environment, these results varied, but were consistently positive.</p>\n<p>Lighthouse Performance Results:</p>\n<hr>\n<p><strong>Overall Score:</strong> 2-5 point improvement</p>\n<p><strong>First Meaningful Paint:</strong> As high as ~20% improvement</p>\n<p><strong>First Interactive:</strong> As high as ~15% improvement</p>\n<p><strong>Perceptual Speed Index:</strong> As high as ~20% improvement</p>\n<hr>\n<p>This is for a very specific JavaScript-heavy use case, running on my local machine using Chrome’s built-in Lighthouse auditing tool. I did some quick testing with a less script-heavy marketing site, and those improvements fell down to the 3-5% range. Regardless of the actual numbers, it’s hard to deny those are some significant improvements. And for such a quick, low-impact win, you’d be a fool to turn those savings down.</p>\n<p>Did you see similar improvements? Share your results when you measure them!</p>\n<h2>This <em>Should</em> Be Safe, but Test Thoroughly</h2>\n<p>All this snippet is doing is preloading scripts that are already being loaded on your page. It doesn’t rearrange load or execution order, mess with <code>async</code> or <code>defer</code>, or anything else. So, like leveraging any other resource hints responsibly, it <strong>should</strong> be relatively safe. Even so, be a good developer and test before deploying to production.</p>\n<p>Hope this tip leads you to some notable performance gains! As always, shoot any feedback, corrections, or improvements my way!</p>\n",
        "feature_image": "https://images.pexels.com/photos/8775/traffic-car-vehicle-black.jpg",
        "status": "published",
        "created_at": 1522904400000,
        "published_at": 1522904400000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "updated_at": 1589778000000,
        "updated_by": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>Squeezing every last drop of performance out of your website on any platform is an always-changing, never-ending, often addictive battle.</p>\\n<p>Among the several tactics you can employ in this fight, leveraging <a href=\\\"https://www.w3.org/TR/resource-hints\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">resource hints</a> is a modern approach that can yield some significant ROI – with preloading is a particularly impactful place to start. <a href=\\\"https://www.smashingmagazine.com/2016/02/preload-what-is-it-good-for/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">It’s a topic worth learning about in more depth yourself</a>, but in short, preloading directs a browser to asynchronously load an asset as soon as possible in the background, so it’s ready to be used when the page calls for it. While the <em>amount</em> of data being loaded by your page won’t change, the start-to-end process of it all will go more quickly, impacting metrics like <a href=\\\"https://web.dev/interactive/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">TTI</a>.</p>\\n<p>Preloading is most useful for fetching resources that are discovered late within the page life cycle – things like fonts or images that are referenced from within a stylesheet, or other assets that are requested via JavaScript. But it’s also been used to prioritize top-level assets on a page, like your main JavaScript files:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>html</span><span class=\\\"token punctuation\\\">></span></span>\\n\\t<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>head</span><span class=\\\"token punctuation\\\">></span></span>\\n\\t\\t<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>link</span> <span class=\\\"token attr-name\\\">rel</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>preload<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token attr-name\\\">href</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>https://my-script.js<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token attr-name\\\">as</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>script<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token punctuation\\\">/></span></span>\\n\\t<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>head</span><span class=\\\"token punctuation\\\">></span></span>\\n\\t<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>body</span><span class=\\\"token punctuation\\\">></span></span>\\n\\t\\t<span class=\\\"token comment\\\">&#x3C;!-- a bunch o' content --></span>\\n\\t\\t<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>script</span> <span class=\\\"token attr-name\\\">src</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>https://my-script.js<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token script\\\"></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>script</span><span class=\\\"token punctuation\\\">></span></span>\\n\\t<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>body</span><span class=\\\"token punctuation\\\">></span></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>html</span><span class=\\\"token punctuation\\\">></span></span>\\n</code></pre></div>\\n<p>When a page like this loads, the browser is told to download the referenced asset at high priority, beating out the priority placed on other resources that might have been requested.</p>\\n<h2>What This Doesn’t Mean</h2>\\n<p>To be fair, a setup like this won’t <em>guarantee</em> you great gains in raw performance, and that’s because the browser’s already <em>really</em> good at this sort of thing. For the past several years, browsers have implement a practice called “speculative scanning,” or “preload scanning.” Per this process, as the browser is building the DOM for the page, it will parse the HTML document for resources it’ll eventually need (JavaScript, CSS, etc.), and <a href=\\\"https://hacks.mozilla.org/2017/09/building-the-dom-faster-speculative-parsing-async-defer-and-preload/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">begin downloading those in the background</a>. You get this for free, right out of the box.</p>\\n<p>But what this process <em>won’t</em> do for you is tell the browser which assets it finds are <em>most</em> important (it’ll default to its own logic for that – usually by placement on the page). In the WordPress space especially, this is where the <code>preload</code> hint is especially handy. Depending on the site, a WordPress application often enqueues several different JavaScript, CSS, and image resources all at once, with a lot of those having low priority on certain pages, and higher priority on others. Indiciating which ones are most crucial can give the browser a leg up when your site loads.</p>\\n<h2>Automate JavaScript Preloading in WordPress</h2>\\n<p>In WordPress, it’s easy enough to manually spit out a <code>link ref=\\\"preload\\\"</code> tag for each file you’d like to preload, but it’s kind of a pain to set up if you’re managing a site with a lot of different scripts being loaded throughout the frame of the page. You want this automated, and you want that automation to be smart about which scripts are chosen to be preloaded.</p>\\n<p>The most straightforward solution to this is to <strong>loop over your registered scripts preload them in the header.</strong> This can be achieved by simply running the following few lines of code in your application. You <em>could</em> drop them in your theme’s <code>functions.php</code> file, but don’t. Instead, just <a href=\\\"https://macarthur.me/posts/creating-the-simplest-wordpress-plugin\\\">make a really simple plugin</a>. It’s almost always a better option.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token function\\\">add_action</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string single-quoted-string\\\">'wp_head'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">global</span> <span class=\\\"token variable\\\">$wp_scripts</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">foreach</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">$wp_scripts</span><span class=\\\"token operator\\\">-></span><span class=\\\"token property\\\">queue</span> <span class=\\\"token keyword\\\">as</span> <span class=\\\"token variable\\\">$handle</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token variable\\\">$script</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token variable\\\">$wp_scripts</span><span class=\\\"token operator\\\">-></span><span class=\\\"token property\\\">registered</span><span class=\\\"token punctuation\\\">[</span><span class=\\\"token variable\\\">$handle</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token comment\\\">//-- If version is set, append to end of source.</span>\\n    <span class=\\\"token variable\\\">$source</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token variable\\\">$script</span><span class=\\\"token operator\\\">-></span><span class=\\\"token property\\\">src</span> <span class=\\\"token operator\\\">.</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">$script</span><span class=\\\"token operator\\\">-></span><span class=\\\"token property\\\">ver</span> <span class=\\\"token operator\\\">?</span> <span class=\\\"token string double-quoted-string\\\">\\\"?ver=<span class=\\\"token interpolation\\\"><span class=\\\"token punctuation\\\">{</span><span class=\\\"token variable\\\">$script</span><span class=\\\"token operator\\\">-></span><span class=\\\"token property\\\">ver</span><span class=\\\"token punctuation\\\">}</span></span>\\\"</span> <span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string double-quoted-string\\\">\\\"\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token comment\\\">//-- Spit out the tag.</span>\\n    <span class=\\\"token keyword\\\">echo</span> <span class=\\\"token string double-quoted-string\\\">\\\"&#x3C;link rel='preload' href='<span class=\\\"token interpolation\\\"><span class=\\\"token punctuation\\\">{</span><span class=\\\"token variable\\\">$source</span><span class=\\\"token punctuation\\\">}</span></span>' as='script'/>\\\\n\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>Here’s what’s going on: On the <code>wp_head</code> hook (which fires after our scripts have been enqueued), we’re looping through our registered scripts and printing out a <code>link</code> tag in our <code>head</code> for each resource. In the end, we’ve given our registered JavaScript resources priority over every other asset that the browser has otherwise discovered for download.</p>\\n<p>Two notes about this setup:</p>\\n<p><strong>1. We’re hooking into</strong> <strong><code>wp_head</code></strong> <strong>with an early priority to spit out our</strong> <strong><code>link</code></strong> <strong>tags.</strong> We’re choosing this hook because it fires after our scripts have been enqueued, and it allows us to get as close to the top of the page as possible. The priority of <code>1</code> means it’ll fire early on – before most other stuff gets printed in the head. The <code>wp_print_scripts</code> or <code>wp_print_styles</code> hooks would also work just fine – it’d just mean that our hints are generated a little farther down on the page.</p>\\n<p><strong>2. We’re making sure the URLs of these assets match</strong> <em><strong>exactly</strong></em><strong>, including the version.</strong> You’ll notice that if a version isn’t set on an asset we’re looping over, not even the <code>?</code> is attached to our source URL. That’s because if the <code>href</code> in your <code>link</code> tag doesn’t match the <code>src</code> attribute of your <code>script</code> tag, the browser will think these are two different resources, and you’ll have gained nothing.</p>\\n<p><strong>3. We’re preloading even the scripts that are enqueued in the</strong> <strong><code>&#x3C;head></code>****.</strong> It might seem counterintuitive, since the browser should give them relatively high priority due to where they’re located. But it’s possible that other scripts may compete with these, and we want to deliberately give <em>ours</em> the highest priority, regardless of where the actual <code>&#x3C;script></code> tags are placed.</p>\\n<h2>Think About Scoping</h2>\\n<p>With this setup, we’re preloading every enqueued script out of the box, and as a result, it’s possible that we’re setting priority to scripts of less concern to us. So, for your specific use case, consider introducing some logic that would make this a little more intentional. For example, if you want to explicitly prioiritze your theme’s scripts, you might only generate the hint when the script’s path is found within your theme’s directory.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token function\\\">add_action</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string single-quoted-string\\\">'wp_head'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">global</span> <span class=\\\"token variable\\\">$wp_scripts</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">foreach</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">$wp_scripts</span><span class=\\\"token operator\\\">-></span><span class=\\\"token property\\\">queue</span> <span class=\\\"token keyword\\\">as</span> <span class=\\\"token variable\\\">$handle</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token variable\\\">$script</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token variable\\\">$wp_scripts</span><span class=\\\"token operator\\\">-></span><span class=\\\"token property\\\">registered</span><span class=\\\"token punctuation\\\">[</span><span class=\\\"token variable\\\">$handle</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token comment\\\">// This script's doesn't belong in my theme; don't preload.</span>\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token function\\\">strpos</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">$script</span><span class=\\\"token operator\\\">-></span><span class=\\\"token property\\\">src</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string double-quoted-string\\\">\\\"/themes/mytheme/\\\"</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">===</span> <span class=\\\"token constant boolean\\\">false</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">continue</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">isset</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">$script</span><span class=\\\"token operator\\\">-></span><span class=\\\"token property\\\">extra</span><span class=\\\"token punctuation\\\">[</span><span class=\\\"token string single-quoted-string\\\">'group'</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">&#x26;&#x26;</span> <span class=\\\"token variable\\\">$script</span><span class=\\\"token operator\\\">-></span><span class=\\\"token property\\\">extra</span><span class=\\\"token punctuation\\\">[</span><span class=\\\"token string single-quoted-string\\\">'group'</span><span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">===</span> <span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token variable\\\">$source</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token variable\\\">$script</span><span class=\\\"token operator\\\">-></span><span class=\\\"token property\\\">src</span> <span class=\\\"token operator\\\">.</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">$script</span><span class=\\\"token operator\\\">-></span><span class=\\\"token property\\\">ver</span> <span class=\\\"token operator\\\">?</span> <span class=\\\"token string double-quoted-string\\\">\\\"?ver=<span class=\\\"token interpolation\\\"><span class=\\\"token punctuation\\\">{</span><span class=\\\"token variable\\\">$script</span><span class=\\\"token operator\\\">-></span><span class=\\\"token property\\\">ver</span><span class=\\\"token punctuation\\\">}</span></span>\\\"</span> <span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string double-quoted-string\\\">\\\"\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token keyword\\\">echo</span> <span class=\\\"token string double-quoted-string\\\">\\\"&#x3C;link rel='preload' href='<span class=\\\"token interpolation\\\"><span class=\\\"token punctuation\\\">{</span><span class=\\\"token variable\\\">$source</span><span class=\\\"token punctuation\\\">}</span></span>' as='script'/>\\\\n\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<h2>Verify It’s Working</h2>\\n<p>Open the source on your page. You should see tags for each one of your footer-enqueued JavaScript files that look like this in your header:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>link</span> <span class=\\\"token attr-name\\\">rel</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">'</span>preload<span class=\\\"token punctuation\\\">'</span></span> <span class=\\\"token attr-name\\\">href</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">'</span>https://whatever-source.js?v=123<span class=\\\"token punctuation\\\">'</span></span> <span class=\\\"token attr-name\\\">as</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">'</span>script<span class=\\\"token punctuation\\\">'</span></span><span class=\\\"token punctuation\\\">/></span></span>\\n</code></pre></div>\\n<p>Now, look for the <code>script</code> tag in your footer that loads each respective file, and verify that the sources match exactly.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>script</span> <span class=\\\"token attr-name\\\">src</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">'</span>https://whatever-source.js?v=123<span class=\\\"token punctuation\\\">'</span></span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token script\\\"></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>script</span><span class=\\\"token punctuation\\\">></span></span>\\n</code></pre></div>\\n<p>Next, if you’re using Chrome, go into your developer tools, select the “Network” tab and refresh your page. Filter by JS files only, and you should see something like this:</p>\\n<p><img src='/proxy/d3c3d665-c07a-44ef-8b86-a5a60e0993c9' alt='' loading='lazy' /></p>\\n<p>Each of those files at the top should have a priority of “High” in the order you preloaded them.</p>\\n<h2>Measure Your Performance Results!</h2>\\n<p>Obviously, all of this is pointless unless there are measurable performance gains that come out of it. When I was testing a specific WordPress application with a great deal of plugin-enqueued scripts, I saw some pretty encouraging numbers. By nature of the a local development environment, these results varied, but were consistently positive.</p>\\n<p>Lighthouse Performance Results:</p>\\n<hr>\\n<p><strong>Overall Score:</strong> 2-5 point improvement</p>\\n<p><strong>First Meaningful Paint:</strong> As high as ~20% improvement</p>\\n<p><strong>First Interactive:</strong> As high as ~15% improvement</p>\\n<p><strong>Perceptual Speed Index:</strong> As high as ~20% improvement</p>\\n<hr>\\n<p>This is for a very specific JavaScript-heavy use case, running on my local machine using Chrome’s built-in Lighthouse auditing tool. I did some quick testing with a less script-heavy marketing site, and those improvements fell down to the 3-5% range. Regardless of the actual numbers, it’s hard to deny those are some significant improvements. And for such a quick, low-impact win, you’d be a fool to turn those savings down.</p>\\n<p>Did you see similar improvements? Share your results when you measure them!</p>\\n<h2>This <em>Should</em> Be Safe, but Test Thoroughly</h2>\\n<p>All this snippet is doing is preloading scripts that are already being loaded on your page. It doesn’t rearrange load or execution order, mess with <code>async</code> or <code>defer</code>, or anything else. So, like leveraging any other resource hints responsibly, it <strong>should</strong> be relatively safe. Even so, be a good developer and test before deploying to production.</p>\\n<p>Hope this tip leads you to some notable performance gains! As always, shoot any feedback, corrections, or improvements my way!</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 54,
        "title": "Creating the Simplest WordPress Plugin",
        "slug": "creating-the-simplest-wordpress-plugin",
        "html": "<p>If you’re making modifications to the functionality of your WordPress site or application, there are <em>generally</em> two places where people put the code to do it.</p>\n<ol>\n<li>A theme’s functions.php file.</li>\n<li>A plugin.</li>\n</ol>\n<p>Given the choice, which option should you almost always choose?</p>\n<p><strong>A plugin.</strong></p>\n<p>Why? The list of reasons is longer than this, but here are the big ones:</p>\n<p><strong>1. Features are better organized and isolated, making it easier to debug.</strong> For example, if your application is having an issue, you can start by toggling individual plugins rather than your entire theme. If the the bug goes away when a particular plugin has been deactivated, you’ve just narrowed the down the range of possible causes.</p>\n<p><strong>2. You can update your theme without worrying about losing any unrelated functionality.</strong> Let’s say I’ve purchased a premium theme and also have a lazy loading plugin installed. When updates are made to the theme, or if I change themes altogether, my lazy loading should be unaffected, because that feature is contained in its own plugin.</p>\n<p>I’ll probably be referencing this plugin-over-functions.php suggestion in my posts, so here’s a brief set of instructions on creating the most basic WordPress plugin you can use to build out a feature for your site. It’s void of any opinions on structure, design, or anything else. It’s just bare bones framework for making what WordPress recognizes as a plugin it can activate. That’s it.</p>\n<p><strong>1. In your</strong> <strong><code>wp-content/plugins/</code></strong> <strong>directory, create a folder named</strong> <strong><code>simplest-plugin</code>****.</strong></p>\n<p><strong>2. Inside that folder, create a</strong> <strong><code>simplest-plugin.php</code></strong> <strong>file.</strong></p>\n<p><strong>3. Open up that newly created file and add a header comment.</strong> There are several pieces of information a plugin’s header comment <em>should</em> have, and <a href=\"https://developer.wordpress.org/plugins/the-basics/header-requirements/\" target=\"_blank\" rel=\"noopener\">you can read about them here</a>, but I mean it when I say we’re creating the <em>simplest</em> plugin, so I’m just going to add a plugin name:</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&#x3C;?php</span>\n\n<span class=\"token comment\">/*Plugin Name: Simplest Plugin*/</span></span>\n</code></pre></div>\n<p><strong>4. Confirm the plugin exists and can be activated.</strong> Head to your <code>wp-admin/plugins.php</code> page and scroll down to find your inactive plugin.</p>\n<p><img src='/proxy/4b9dfd07-bd4c-4d08-8034-c907e713befd' alt='' loading='lazy' /></p>\n<p>It doesn’t have much – no description, version, author, or details, and you <em>should</em> include all of these things, but that’s not the point of this post. The point here is that you now have the barest-of-bones framework in which you can build functionality into your site or application.</p>\n<p>It’s that simple!</p>\n",
        "feature_image": "https://cdn.pixabay.com/photo/2014/02/13/07/28/wordpress-265132_1280.jpg",
        "status": "published",
        "created_at": 1522818000000,
        "published_at": 1522818000000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>If you’re making modifications to the functionality of your WordPress site or application, there are <em>generally</em> two places where people put the code to do it.</p>\\n<ol>\\n<li>A theme’s functions.php file.</li>\\n<li>A plugin.</li>\\n</ol>\\n<p>Given the choice, which option should you almost always choose?</p>\\n<p><strong>A plugin.</strong></p>\\n<p>Why? The list of reasons is longer than this, but here are the big ones:</p>\\n<p><strong>1. Features are better organized and isolated, making it easier to debug.</strong> For example, if your application is having an issue, you can start by toggling individual plugins rather than your entire theme. If the the bug goes away when a particular plugin has been deactivated, you’ve just narrowed the down the range of possible causes.</p>\\n<p><strong>2. You can update your theme without worrying about losing any unrelated functionality.</strong> Let’s say I’ve purchased a premium theme and also have a lazy loading plugin installed. When updates are made to the theme, or if I change themes altogether, my lazy loading should be unaffected, because that feature is contained in its own plugin.</p>\\n<p>I’ll probably be referencing this plugin-over-functions.php suggestion in my posts, so here’s a brief set of instructions on creating the most basic WordPress plugin you can use to build out a feature for your site. It’s void of any opinions on structure, design, or anything else. It’s just bare bones framework for making what WordPress recognizes as a plugin it can activate. That’s it.</p>\\n<p><strong>1. In your</strong> <strong><code>wp-content/plugins/</code></strong> <strong>directory, create a folder named</strong> <strong><code>simplest-plugin</code>****.</strong></p>\\n<p><strong>2. Inside that folder, create a</strong> <strong><code>simplest-plugin.php</code></strong> <strong>file.</strong></p>\\n<p><strong>3. Open up that newly created file and add a header comment.</strong> There are several pieces of information a plugin’s header comment <em>should</em> have, and <a href=\\\"https://developer.wordpress.org/plugins/the-basics/header-requirements/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">you can read about them here</a>, but I mean it when I say we’re creating the <em>simplest</em> plugin, so I’m just going to add a plugin name:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token php language-php\\\"><span class=\\\"token delimiter important\\\">&#x3C;?php</span>\\n\\n<span class=\\\"token comment\\\">/*Plugin Name: Simplest Plugin*/</span></span>\\n</code></pre></div>\\n<p><strong>4. Confirm the plugin exists and can be activated.</strong> Head to your <code>wp-admin/plugins.php</code> page and scroll down to find your inactive plugin.</p>\\n<p><img src='/proxy/4b9dfd07-bd4c-4d08-8034-c907e713befd' alt='' loading='lazy' /></p>\\n<p>It doesn’t have much – no description, version, author, or details, and you <em>should</em> include all of these things, but that’s not the point of this post. The point here is that you now have the barest-of-bones framework in which you can build functionality into your site or application.</p>\\n<p>It’s that simple!</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 55,
        "title": "Let’s Stop Making it Cool to Hate jQuery",
        "slug": "lets-stop-making-it-cool-to-hate-jquery",
        "html": "<p>When I started in development, beginning a new project often felt like drowning and then being asked to write some functioning JavaScript. At the time, all I needed to do was perform some DOM stuff — make an element disappear on a click, add some classes, or animate a dropdown. For all of these tasks, jQuery provided functionality that was simple to implement, reliable across browsers, and most important at the time, easy for me to understand what the heck was going on.</p>\n<p>Since then, JavaScript APIs and features have matured, browsers have stepped up their game, and educational resources have become even more accessible. As a result, dependence on jQuery has expectedly decreased. But as an unwelcomed side effect, it’s also become very cool to dump on it with a passionate, fiery rage.</p>\n<p>I won’t say that you <em>can’t</em> hate jQuery, but you do need to have a legitimate reason that you can articulate, because the case to give the library the reverence it deserves is pretty solid, and the case that we should quickly run from it because “ewwww, it’s jQuery” is weak, and based on some concerns that I think are largely out of proportion.</p>\n<h3>jQuery helped make the web – and you – what they are today.</h3>\n<p>Because of how undisputed it is, we don’t even need to spend much time discussing the technical problems jQuery helped solve when it was introduced – the inconsistent browser support of JavaScript features, the lacking or convoluted JavaScript APIs, and other challenges. The fact that jQuery made development a heck of a lot faster and easier isn’t questioned. And for that, it deserves respect, as well as for the impact it had on the evolution and adoption of the language as we know it today.</p>\n<p>On top of that, there’s a decent chance it also left a mark on who you are as a developer. Especially if you consider yourself to be “self-taught”, the authors of jQuery helped make entry into and competency within this field a little less painful. In fact, if it weren’t for the smoother learning curve jQuery provided, many might have thrown in the towel altogether.</p>\n<p>Of course, I’m mainly speaking from personal experience. When I started myself, working with <code>$('.class').slideDown()</code> was far less intimidating than trying to write a CSS class with an easing transition, and then apply that class with <code>document.querySelector('.class').classList.add('is-open')</code>. And trying to take it to the next level with a vanilla rendition that would allow for dynamic height transitions was totally out of the question. (Speaking of, I’ve made a ~600 byte modern version of jQuery’s <code>slide</code> utilities that <a href=\"https://github.com/alexmacarthur/slide-element\" target=\"_blank\" rel=\"noopener\">you should check out</a>.)</p>\n<p>I was able to do the work required of me with less training and time, and it gave me a level of satisfaction through my productivity that kept me interested in sticking with the discipline. The psychology behind it all seems to be very akin to Dave Ramsey’s <a href=\"https://www.ramseysolutions.com/debt/how-the-debt-snowball-method-works\" target=\"_blank\" rel=\"noopener\">debt snowball method</a>. The quick wins built momentum, encouraging me to take on more in-depth, challenging tasks as I went along. Thanks to the easy-to-grasp-and-get-crap-done API the library provided, jQuery (and other libraries like it) undeniably played a role in how effectively I became immersed in the field.</p>\n<p><em><strong>“But if you’re gonna learn JavaScript, learn JavaScript! Not some abstraction of it!”</strong></em> Agreed, but take note of the type of people I’m discussing here. I’m not focusing on the people who have intentionally invested time to exclusively <em>learn</em> from the ground up, like those who’ve done so within a coding bootcamp, university curriculum, or some other structured learning. I’m speaking of the people who are already in the trenches, in that increasingly common position of being asked to do the work while simultaneously learning how any of it works. In these cases, developers can’t afford to slow their pace of production by diving into the fundamentals of JavaScript and abstain from learning abstractions like jQuery first, which often already lay hold of the codebase in which they’re working. For these people, jQuery allowed people to deliver the value being asked of them, while serving as a catalyst to immerse them into the field of web development and thereby catapulting them into continued learning.</p>\n<h3>It’s probably not hurting anybody.</h3>\n<p>While a lot of the dismissal of jQuery often just sounds like “because jQuery,” one of the more common concrete objections is the performance implications of using or sticking with the library. And it usually comes in two parts.</p>\n<p><em><strong>“jQuery is HUGE!”</strong></em> Legitimate concern, but if we’re loading our scripts like we should (at the bottom of the page so they don’t block rendering, via <code>defer</code>/<code>async</code> attributes, etc.), this concern becomes significantly uh… smaller. None of these tactics completely eliminate the need to think about it, since the time required to load, parse, and execute JavaScript still impact’s user experience (namely, <a href=\"https://web.dev/interactive/\" target=\"_blank\" rel=\"noopener\">Time to Interactive</a>), but to fiercely dismiss a library exclusively because of the ~30kb of minified, gzipped weight it adds to your application just isn’t good enough.</p>\n<p>That ‘good enough’ level drops even further when you consider how willing we are to throw in other modern packages of similar file size without a second thought. Often, the same people who want to violently kill jQuery are the same ones who are completely fine loading React + friends onto a marketing page for a lead form. But if those people also claim to so adamantly prioritize performance, the math isn’t exactly in their favor. Using <a href=\"https://bundlephobia.com/\" target=\"_blank\" rel=\"noopener\">Bundlephobia</a>, here’s how the sizes of each library line up:</p>\n<table>\n<thead>\n<tr>\n<th>Library</th>\n<th>Minified + Gzipped</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><a href=\"https://bundlephobia.com/package/react@17.0.2\" target=\"_blank\" rel=\"noopener\">React</a> + <a href=\"https://bundlephobia.com/package/react-dom@17.0.2\" target=\"_blank\" rel=\"noopener\">React DOM</a> (17.0.2)</td>\n<td>42.2kb</td>\n</tr>\n<tr>\n<td><a href=\"https://bundlephobia.com/package/jquery@3.6.0\" target=\"_blank\" rel=\"noopener\">jQuery (v3.6.0)</a></td>\n<td>30.4kb</td>\n</tr>\n</tbody>\n</table>\n<p>Without fail, bringing up these numbers raises the tantential objection that a comparison like this isn’t black &#x26; white: “<em>for specific use cases, React’s bundle size is permissible due to its specific strengths</em>.” To which I would agree, and then engage in a hearty dialogue over whether React is the only library that can claim such an exception. But even so, at this point, the goalposts have moved. We’re no longer arguing about whether a library’s size should preclude you from using it, but rather, how specific characteristics of that it may or may not warrant it.</p>\n<p>So, what about the people who are concerned less about bundle size and take more serious issue with the performance of the library’s code execution itself?</p>\n<p><em><strong>“jQuery is an unperformant abstraction!”</strong></em> This is the objection to jQuery in which I place the most sympathy. I like it when my JavaScript does things fast and efficiently, and specifically when it comes to DOM manipulations, native APIs and other libraries (like React) of similar size just perform better than jQuery for the type of work they were designed for. But therein lies the point… these libraries weren’t designed to compete in the same way. From the beginning, jQuery was largely used to alleviate beef we had with browsers and to make singular tasks a little easier. React, on the other hand, is designed to build reactive, declarative, state-managed user interfaces. Because of React’s underlying purpose, it’s no surprise that DOM manipulation is faster and easier to maintain. But I’d never dream of swapping out jQuery with React to handle simple, separated interactions in light of that. Implementation apples and oranges.</p>\n<p>Related to that, the circumstances in which jQuery is often used just doesn’t even warrant this type of performance. I’m <em>not</em> saying it’s unimportant – just that it’s not worth upending your workflow just to get back a shred of page reflow no one would ever notice. The ROI of rushing to strip out jQuery on this basis alone is tremendously low, making it another insufficient excuse to detest it. Sometimes, it’s just a marketing site, and no one’s going to throw up their hands because your pop-up modal didn’t render seven milliseconds faster.</p>\n<h3>But! You probably shouldn’t use jQuery for a new project.</h3>\n<p>Don’t think I’m trying to make the case that we should still lean toward grabbing jQuery for a new project. I’m not. As I’ve said, today’s browsers’ JavaScript implementations are <em>good</em> – good enough that your time is better invested in starting with vanilla JavaScript rather than an abstraction for simple needs, and all things being equal, we should be reaching for the approach that performs better too. Read that crisp &#x26; clear:</p>\n<p><strong>If you’re starting a new project, I</strong> <em><strong>don’t</strong></em> <strong>think jQuery should be on the list of resources to leverage.</strong></p>\n<p>But if you’re working with a codebase that incorporates jQuery, it <em>really is OK</em> to keep using it. You’re not a bad person, and you’re not a crappy developer. In fact, if you’re probably one of the smarter ones, because you’re not frantically running from a library that still does a darn good job at what it was designed to do.</p>\n<p>So, don’t fret. When the time is right, dispose of jQuery. But when you do, do it out of smart decision making – when the time is right, when the ROI is significant, and when your project calls for it. Nothing else.</p>\n",
        "feature_image": "",
        "status": "published",
        "created_at": 1521435600000,
        "published_at": 1521435600000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "updated_at": 1622955600000,
        "updated_by": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>When I started in development, beginning a new project often felt like drowning and then being asked to write some functioning JavaScript. At the time, all I needed to do was perform some DOM stuff — make an element disappear on a click, add some classes, or animate a dropdown. For all of these tasks, jQuery provided functionality that was simple to implement, reliable across browsers, and most important at the time, easy for me to understand what the heck was going on.</p>\\n<p>Since then, JavaScript APIs and features have matured, browsers have stepped up their game, and educational resources have become even more accessible. As a result, dependence on jQuery has expectedly decreased. But as an unwelcomed side effect, it’s also become very cool to dump on it with a passionate, fiery rage.</p>\\n<p>I won’t say that you <em>can’t</em> hate jQuery, but you do need to have a legitimate reason that you can articulate, because the case to give the library the reverence it deserves is pretty solid, and the case that we should quickly run from it because “ewwww, it’s jQuery” is weak, and based on some concerns that I think are largely out of proportion.</p>\\n<h3>jQuery helped make the web – and you – what they are today.</h3>\\n<p>Because of how undisputed it is, we don’t even need to spend much time discussing the technical problems jQuery helped solve when it was introduced – the inconsistent browser support of JavaScript features, the lacking or convoluted JavaScript APIs, and other challenges. The fact that jQuery made development a heck of a lot faster and easier isn’t questioned. And for that, it deserves respect, as well as for the impact it had on the evolution and adoption of the language as we know it today.</p>\\n<p>On top of that, there’s a decent chance it also left a mark on who you are as a developer. Especially if you consider yourself to be “self-taught”, the authors of jQuery helped make entry into and competency within this field a little less painful. In fact, if it weren’t for the smoother learning curve jQuery provided, many might have thrown in the towel altogether.</p>\\n<p>Of course, I’m mainly speaking from personal experience. When I started myself, working with <code>$('.class').slideDown()</code> was far less intimidating than trying to write a CSS class with an easing transition, and then apply that class with <code>document.querySelector('.class').classList.add('is-open')</code>. And trying to take it to the next level with a vanilla rendition that would allow for dynamic height transitions was totally out of the question. (Speaking of, I’ve made a ~600 byte modern version of jQuery’s <code>slide</code> utilities that <a href=\\\"https://github.com/alexmacarthur/slide-element\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">you should check out</a>.)</p>\\n<p>I was able to do the work required of me with less training and time, and it gave me a level of satisfaction through my productivity that kept me interested in sticking with the discipline. The psychology behind it all seems to be very akin to Dave Ramsey’s <a href=\\\"https://www.ramseysolutions.com/debt/how-the-debt-snowball-method-works\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">debt snowball method</a>. The quick wins built momentum, encouraging me to take on more in-depth, challenging tasks as I went along. Thanks to the easy-to-grasp-and-get-crap-done API the library provided, jQuery (and other libraries like it) undeniably played a role in how effectively I became immersed in the field.</p>\\n<p><em><strong>“But if you’re gonna learn JavaScript, learn JavaScript! Not some abstraction of it!”</strong></em> Agreed, but take note of the type of people I’m discussing here. I’m not focusing on the people who have intentionally invested time to exclusively <em>learn</em> from the ground up, like those who’ve done so within a coding bootcamp, university curriculum, or some other structured learning. I’m speaking of the people who are already in the trenches, in that increasingly common position of being asked to do the work while simultaneously learning how any of it works. In these cases, developers can’t afford to slow their pace of production by diving into the fundamentals of JavaScript and abstain from learning abstractions like jQuery first, which often already lay hold of the codebase in which they’re working. For these people, jQuery allowed people to deliver the value being asked of them, while serving as a catalyst to immerse them into the field of web development and thereby catapulting them into continued learning.</p>\\n<h3>It’s probably not hurting anybody.</h3>\\n<p>While a lot of the dismissal of jQuery often just sounds like “because jQuery,” one of the more common concrete objections is the performance implications of using or sticking with the library. And it usually comes in two parts.</p>\\n<p><em><strong>“jQuery is HUGE!”</strong></em> Legitimate concern, but if we’re loading our scripts like we should (at the bottom of the page so they don’t block rendering, via <code>defer</code>/<code>async</code> attributes, etc.), this concern becomes significantly uh… smaller. None of these tactics completely eliminate the need to think about it, since the time required to load, parse, and execute JavaScript still impact’s user experience (namely, <a href=\\\"https://web.dev/interactive/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Time to Interactive</a>), but to fiercely dismiss a library exclusively because of the ~30kb of minified, gzipped weight it adds to your application just isn’t good enough.</p>\\n<p>That ‘good enough’ level drops even further when you consider how willing we are to throw in other modern packages of similar file size without a second thought. Often, the same people who want to violently kill jQuery are the same ones who are completely fine loading React + friends onto a marketing page for a lead form. But if those people also claim to so adamantly prioritize performance, the math isn’t exactly in their favor. Using <a href=\\\"https://bundlephobia.com/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Bundlephobia</a>, here’s how the sizes of each library line up:</p>\\n<table>\\n<thead>\\n<tr>\\n<th>Library</th>\\n<th>Minified + Gzipped</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td><a href=\\\"https://bundlephobia.com/package/react@17.0.2\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">React</a> + <a href=\\\"https://bundlephobia.com/package/react-dom@17.0.2\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">React DOM</a> (17.0.2)</td>\\n<td>42.2kb</td>\\n</tr>\\n<tr>\\n<td><a href=\\\"https://bundlephobia.com/package/jquery@3.6.0\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">jQuery (v3.6.0)</a></td>\\n<td>30.4kb</td>\\n</tr>\\n</tbody>\\n</table>\\n<p>Without fail, bringing up these numbers raises the tantential objection that a comparison like this isn’t black &#x26; white: “<em>for specific use cases, React’s bundle size is permissible due to its specific strengths</em>.” To which I would agree, and then engage in a hearty dialogue over whether React is the only library that can claim such an exception. But even so, at this point, the goalposts have moved. We’re no longer arguing about whether a library’s size should preclude you from using it, but rather, how specific characteristics of that it may or may not warrant it.</p>\\n<p>So, what about the people who are concerned less about bundle size and take more serious issue with the performance of the library’s code execution itself?</p>\\n<p><em><strong>“jQuery is an unperformant abstraction!”</strong></em> This is the objection to jQuery in which I place the most sympathy. I like it when my JavaScript does things fast and efficiently, and specifically when it comes to DOM manipulations, native APIs and other libraries (like React) of similar size just perform better than jQuery for the type of work they were designed for. But therein lies the point… these libraries weren’t designed to compete in the same way. From the beginning, jQuery was largely used to alleviate beef we had with browsers and to make singular tasks a little easier. React, on the other hand, is designed to build reactive, declarative, state-managed user interfaces. Because of React’s underlying purpose, it’s no surprise that DOM manipulation is faster and easier to maintain. But I’d never dream of swapping out jQuery with React to handle simple, separated interactions in light of that. Implementation apples and oranges.</p>\\n<p>Related to that, the circumstances in which jQuery is often used just doesn’t even warrant this type of performance. I’m <em>not</em> saying it’s unimportant – just that it’s not worth upending your workflow just to get back a shred of page reflow no one would ever notice. The ROI of rushing to strip out jQuery on this basis alone is tremendously low, making it another insufficient excuse to detest it. Sometimes, it’s just a marketing site, and no one’s going to throw up their hands because your pop-up modal didn’t render seven milliseconds faster.</p>\\n<h3>But! You probably shouldn’t use jQuery for a new project.</h3>\\n<p>Don’t think I’m trying to make the case that we should still lean toward grabbing jQuery for a new project. I’m not. As I’ve said, today’s browsers’ JavaScript implementations are <em>good</em> – good enough that your time is better invested in starting with vanilla JavaScript rather than an abstraction for simple needs, and all things being equal, we should be reaching for the approach that performs better too. Read that crisp &#x26; clear:</p>\\n<p><strong>If you’re starting a new project, I</strong> <em><strong>don’t</strong></em> <strong>think jQuery should be on the list of resources to leverage.</strong></p>\\n<p>But if you’re working with a codebase that incorporates jQuery, it <em>really is OK</em> to keep using it. You’re not a bad person, and you’re not a crappy developer. In fact, if you’re probably one of the smarter ones, because you’re not frantically running from a library that still does a darn good job at what it was designed to do.</p>\\n<p>So, don’t fret. When the time is right, dispose of jQuery. But when you do, do it out of smart decision making – when the time is right, when the ROI is significant, and when your project calls for it. Nothing else.</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 56,
        "title": "Build Your Own Simple Lazy Loading Functionality in WordPress",
        "slug": "build-your-own-simple-lazy-loading-functionality-in-wordpress",
        "html": "<p>When you’re looking to incorporate any given feature into your WordPress application, there’s rarely a shortage of third-party plugins out there to make it happen. But sometimes, whether you’re trying to avoid the inevitable complexity an unfamiliar third-party plugin introduces, or for some other reason, you might feel called to take a stab at developing that feature on your own. Lazy loading images could be one of these features, and fortunately, it’s fairly simple to set it up yourself and start reaping the performance benefits.</p>\n<p>I’m assuming here that you have full development dominion over your WordPress application, and that you’re relatively familiar with the <a href=\"https://codex.wordpress.org/Plugin_API\" target=\"_blank\" rel=\"noopener\">WordPress Plugin API</a> – the characteristic hook system that makes WordPress development as flexible as it is. While we <em>could</em> set up lazy loading without a plugin by putting everything inside your theme’s <code>functions.php</code> file, we’ll be rolling our own extremely basic plugin. This is generally a good idea over just using your theme – it’ll separate concerns a little better, you’ll be able to switch themes without losing functionality, and it’ll be easy to toggle whenever like, which is particularly helpful when debugging.</p>\n<p><em>Know this:</em> I won’t be going in-depth on the philosophy of what makes a well-crafted WordPress plugin. Experiment and argue about all that jazz on your own. I’m just gonna give you the bare bones of what it takes to make a lazy loading plugin with just a few lines of code. Let’s get started.</p>\n<h2>Set Up Your Plugin</h2>\n<p>In your plugins directory, create a <code>simple-lazy-loading</code> directory and a file inside it named <code>simple-lazy-loading.php</code>. Open that file, and place the following at the top:</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&#x3C;?php</span>\n\n<span class=\"token doc-comment comment\">/** Plugin Name: Simple Lazy Loading*/</span></span>\n</code></pre></div>\n<p>At bare minimum, you now have a plugin that can be activated in the the WordPress admin. Head there and switch it on.</p>\n<p><img src='/proxy/606cd0c9-357c-4343-8877-2550e1c62e02' alt='' loading='lazy' /></p>\n<p>After you’ve done that, open up the file you just created and we’re ready to go!</p>\n<h2>Let’s Get Lazy</h2>\n<p>You can lazy load a lot of things, but here, we’re just focusing on lazy loading images stored in your WordPress database that are spit out as post or page content. Basically, images you upload and use via the WordPress admin.</p>\n<p>To do this, let’s use <a href=\"https://github.com/ApoorvSaxena/lozad.js\" target=\"_blank\" rel=\"noopener\">Lozad</a> for our lazy loading JavaScript library. It has no jQuery dependency, appears to be pretty actively maintained, and it leverages the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API\" target=\"_blank\" rel=\"noopener\">Intersection Observer API</a>, which will get you better performance, especially as browser support grows in the future. In the meantime, there’s a <a href=\"https://github.com/w3c/IntersectionObserver/tree/master/polyfill\" target=\"_blank\" rel=\"noopener\">polyfill</a> you can include.</p>\n<h3>Getting Lozad Up on Its Feet</h3>\n<p><strong>First, enqueue the Lozad library.</strong> We’ll also want to throw in the official W3C polyfill for the Intersection Observer API. We’ll enqueue both of these in the footer because we’re responsible web developers and don’t want these scripts to block page rendering.</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token function\">add_action</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'wp_enqueue_scripts'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token function\">wp_enqueue_script</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'intersection-observer-polyfill'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'path-to-intersection-observer.js'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">null</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">true</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token function\">wp_enqueue_script</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'lozad'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'https://cdn.jsdelivr.net/npm/lozad@1.3.0/dist/lozad.min.js'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'intersection-observer-polyfill'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">null</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">true</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p><strong>Next, initialize Lozad.</strong> Out of the box, a “lozad” class is used to watch for elements to be lazy loaded, but since we’re going to modify the configuration a bit anyway, let’s change that to a more generic “lazy-load” class. Also, note that I’m just using <code>wp_add_inline_script</code> here, since the amount of JS we’re writing is small. You’re welcome to put that in a separate JS file – just make sure it executes after <code>lozad</code> is loaded.</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token function\">add_action</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'wp_enqueue_scripts'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">wp_enqueue_script</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'intersection-observer-polyfill'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'path-to-intersection-observer.js'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">null</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">true</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">wp_enqueue_script</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'lozad'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'https://cdn.jsdelivr.net/npm/lozad@1.3.0/dist/lozad.min.js'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'intersection-observer-polyfill'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">null</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">true</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">wp_add_inline_script</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'lozad'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'</span>\n<span class=\"token string single-quoted-string\">        lozad(\".lazy-load\").observe();</span>\n<span class=\"token string single-quoted-string\">    '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p><em>Neat! But what if I don’t want to target elements by class?</em> No problem! Instead of defining a class to be watched, you can pass in a <code>NodeList</code>. In that case, our <code>wp_add_inline_script</code> section would look something more like this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token function\">wp_add_inline_script</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'lozad'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'</span>\n<span class=\"token string single-quoted-string\">\tvar myElements = document.querySelectorAll(\"#main img\");</span>\n<span class=\"token string single-quoted-string\">\tlozad(myElements).observe();</span>\n<span class=\"token string single-quoted-string\">'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>If we set things up this way, Lozad will watch for any images that are children to <code>#main</code>.</p>\n<p><strong>Our next step is to add our target class to every image we want to lazy load, as well as change the</strong> <strong><code>src</code></strong> <strong>attribute to</strong> <strong><code>data-src</code>****.</strong> This will prevent the browser from loading the images by default (which would block the rest of the page from rendering), and only do so when <code>lozad</code> changes <code>data-src</code> back to <code>src</code>, which will happen when users scroll to those images.</p>\n<p>For any images on custom pages outside of the WordPress database, it’s pretty easy to set up the attributes we need. Just manually do it. Unfortunately, working with the images that are stored in the database will require that we filter everything via <code>the_content</code> hook. I don’t <em>love</em> the idea of having to filter post content like this, but if you’re properly caching your site like you should be, this is less of an issue, at least in terms of performance.</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token function\">add_filter</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'the_content'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$content</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">//-- Change src to data attributes.</span>\n\t<span class=\"token variable\">$content</span> <span class=\"token operator\">=</span> <span class=\"token function\">preg_replace</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"/&#x3C;img(.*?)(src=)(.*?)>/i\"</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'&#x3C;img$1data-$2$3>'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$content</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    \t<span class=\"token comment\">//-- Change srcset to data attributes.</span>\n  <span class=\"token variable\">$content</span> <span class=\"token operator\">=</span> <span class=\"token function\">preg_replace</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"/&#x3C;img(.*?)(srcset=)(.*?)>/i\"</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'&#x3C;img$1data-$2$3>'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$content</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\">//-- Add .lazy-load class to each image that already has a class.</span>\n\t<span class=\"token variable\">$content</span> <span class=\"token operator\">=</span> <span class=\"token function\">preg_replace</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'/&#x3C;img(.*?)class=\\\"(.*?)\\\"(.*?)>/i'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'&#x3C;img$1class=\"$2 lazy-load\"$3>'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$content</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\">//-- Add .lazy-load class to each image that doesn't already have a class.</span>\n\t<span class=\"token variable\">$content</span> <span class=\"token operator\">=</span> <span class=\"token function\">preg_replace</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'/&#x3C;img((.(?!class=))*)\\/?>/i'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'&#x3C;img class=\"lazy-load\"$1>'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$content</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">return</span> <span class=\"token variable\">$content</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>We’re doing three separate things with our filter here.</p>\n<ul>\n<li>Changing <code>src</code> and <code>srcset</code> attributes to <code>data-src</code> and <code>data-srcset</code> on each image.</li>\n<li>Adding a <code>lazy-load</code> class to each image so Lozad can properly target the images we want to lazy load.</li>\n<li>Adding a <code>lazy-load</code> class to each image that doesn’t already have a class attached to it.</li>\n</ul>\n<p><strong>Technically, you’re done.</strong> Now, each page on which you have content populated from the WordPress editor, images should <em>not</em> load by default, and instead load only when they come into view. But that might not be good enough.</p>\n<h3>Let’s Make It All Prettier</h3>\n<p>If images only load when they come into view, you’ll see an ugly pop on the page when that happens. To make everything happen in a prettier fashion, we have some options at our disposal.</p>\n<p><strong>Let’s adjust the</strong> <strong><code>rootMargin</code></strong> <strong>so images start loading when they’re</strong> <em><strong>about</strong></em> <strong>to come into view.</strong> This way, they can be ready to go before the user even gets there, and everything will appear much more seamless. Go back to our <code>wp_add_inline_script</code> call:</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token function\">wp_add_inline_script</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'lozad'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'</span>\n<span class=\"token string single-quoted-string\">\tlozad(\".lazy-load\", {</span>\n<span class=\"token string single-quoted-string\">\t\trootMargin: \"300px 0px\"</span>\n<span class=\"token string single-quoted-string\">\t}).observe();</span>\n<span class=\"token string single-quoted-string\">'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Now, when images come within 300px of being visible, Lozad will trigger them to start loading. Feel free to adjust that value as you see fit.</p>\n<p><strong>We can also add a class after our images load, so they fade in a super pretty, majestic way.</strong> Do that by adding a <code>loaded</code> callback:</p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token function\">wp_add_inline_script</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'lozad'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'</span>\n<span class=\"token string single-quoted-string\">\tlozad(\".lazy-load\", {</span>\n<span class=\"token string single-quoted-string\">\t\trootMargin: \"300px 0px\",</span>\n<span class=\"token string single-quoted-string\">\t\tloaded: function (el) {</span>\n<span class=\"token string single-quoted-string\">\t\t\tel.classList.add(\"is-loaded\");</span>\n<span class=\"token string single-quoted-string\">\t\t}</span>\n<span class=\"token string single-quoted-string\">\t}).observe();</span>\n<span class=\"token string single-quoted-string\">'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>And add some CSS that’ll hide the images until they’re fully loaded, and then allow them to fade in. Note that if you do add the following CSS, you’ll need to enqueue it in a stylesheet or by some other means.</p>\n<div class=\"remark-highlight\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\"><span class=\"token class\">.lazy-load</span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">transition</span><span class=\"token punctuation\">:</span> opacity <span class=\"token number\">.15</span><span class=\"token unit\">s</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">opacity</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\"><span class=\"token class\">.lazy-load</span><span class=\"token class\">.is-loaded</span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">opacity</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Neat! Now, every image will now have an <code>opacity</code> of <code>0</code>, until they’re loaded in, when <code>is-loaded</code> will fade them in.</p>\n<h3>Soon, This May All Be Meaningless</h3>\n<p>Lazy loading is a good, responsible thing to implement, but, all of this will likely be possible by default in browsers. In fact, <a href=\"https://web.dev/native-lazy-loading/\" target=\"_blank\" rel=\"noopener\">Chromium-based browsers and Firefox already do have a native API for it</a>. So, pay attention. In a short while, all of what I’ve just showed you might be pointless, and I will need to put a sad disclaimer at the top of this post that you might just be wasting your time by reading this.</p>\n<p>Hope this helps!</p>\n",
        "feature_image": "https://images.pexels.com/photos/196655/pexels-photo-196655.jpeg",
        "status": "published",
        "created_at": 1519275600000,
        "published_at": 1519275600000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "updated_at": 1599541200000,
        "updated_by": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>When you’re looking to incorporate any given feature into your WordPress application, there’s rarely a shortage of third-party plugins out there to make it happen. But sometimes, whether you’re trying to avoid the inevitable complexity an unfamiliar third-party plugin introduces, or for some other reason, you might feel called to take a stab at developing that feature on your own. Lazy loading images could be one of these features, and fortunately, it’s fairly simple to set it up yourself and start reaping the performance benefits.</p>\\n<p>I’m assuming here that you have full development dominion over your WordPress application, and that you’re relatively familiar with the <a href=\\\"https://codex.wordpress.org/Plugin_API\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">WordPress Plugin API</a> – the characteristic hook system that makes WordPress development as flexible as it is. While we <em>could</em> set up lazy loading without a plugin by putting everything inside your theme’s <code>functions.php</code> file, we’ll be rolling our own extremely basic plugin. This is generally a good idea over just using your theme – it’ll separate concerns a little better, you’ll be able to switch themes without losing functionality, and it’ll be easy to toggle whenever like, which is particularly helpful when debugging.</p>\\n<p><em>Know this:</em> I won’t be going in-depth on the philosophy of what makes a well-crafted WordPress plugin. Experiment and argue about all that jazz on your own. I’m just gonna give you the bare bones of what it takes to make a lazy loading plugin with just a few lines of code. Let’s get started.</p>\\n<h2>Set Up Your Plugin</h2>\\n<p>In your plugins directory, create a <code>simple-lazy-loading</code> directory and a file inside it named <code>simple-lazy-loading.php</code>. Open that file, and place the following at the top:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token php language-php\\\"><span class=\\\"token delimiter important\\\">&#x3C;?php</span>\\n\\n<span class=\\\"token doc-comment comment\\\">/** Plugin Name: Simple Lazy Loading*/</span></span>\\n</code></pre></div>\\n<p>At bare minimum, you now have a plugin that can be activated in the the WordPress admin. Head there and switch it on.</p>\\n<p><img src='/proxy/606cd0c9-357c-4343-8877-2550e1c62e02' alt='' loading='lazy' /></p>\\n<p>After you’ve done that, open up the file you just created and we’re ready to go!</p>\\n<h2>Let’s Get Lazy</h2>\\n<p>You can lazy load a lot of things, but here, we’re just focusing on lazy loading images stored in your WordPress database that are spit out as post or page content. Basically, images you upload and use via the WordPress admin.</p>\\n<p>To do this, let’s use <a href=\\\"https://github.com/ApoorvSaxena/lozad.js\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Lozad</a> for our lazy loading JavaScript library. It has no jQuery dependency, appears to be pretty actively maintained, and it leverages the <a href=\\\"https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Intersection Observer API</a>, which will get you better performance, especially as browser support grows in the future. In the meantime, there’s a <a href=\\\"https://github.com/w3c/IntersectionObserver/tree/master/polyfill\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">polyfill</a> you can include.</p>\\n<h3>Getting Lozad Up on Its Feet</h3>\\n<p><strong>First, enqueue the Lozad library.</strong> We’ll also want to throw in the official W3C polyfill for the Intersection Observer API. We’ll enqueue both of these in the footer because we’re responsible web developers and don’t want these scripts to block page rendering.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token function\\\">add_action</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string single-quoted-string\\\">'wp_enqueue_scripts'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n   <span class=\\\"token function\\\">wp_enqueue_script</span><span class=\\\"token punctuation\\\">(</span> <span class=\\\"token string single-quoted-string\\\">'intersection-observer-polyfill'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string single-quoted-string\\\">'path-to-intersection-observer.js'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constant\\\">null</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constant boolean\\\">true</span> <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n   <span class=\\\"token function\\\">wp_enqueue_script</span><span class=\\\"token punctuation\\\">(</span> <span class=\\\"token string single-quoted-string\\\">'lozad'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string single-quoted-string\\\">'https://cdn.jsdelivr.net/npm/lozad@1.3.0/dist/lozad.min.js'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token string single-quoted-string\\\">'intersection-observer-polyfill'</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constant\\\">null</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constant boolean\\\">true</span> <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p><strong>Next, initialize Lozad.</strong> Out of the box, a “lozad” class is used to watch for elements to be lazy loaded, but since we’re going to modify the configuration a bit anyway, let’s change that to a more generic “lazy-load” class. Also, note that I’m just using <code>wp_add_inline_script</code> here, since the amount of JS we’re writing is small. You’re welcome to put that in a separate JS file – just make sure it executes after <code>lozad</code> is loaded.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token function\\\">add_action</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string single-quoted-string\\\">'wp_enqueue_scripts'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token function\\\">wp_enqueue_script</span><span class=\\\"token punctuation\\\">(</span> <span class=\\\"token string single-quoted-string\\\">'intersection-observer-polyfill'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string single-quoted-string\\\">'path-to-intersection-observer.js'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constant\\\">null</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constant boolean\\\">true</span> <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token function\\\">wp_enqueue_script</span><span class=\\\"token punctuation\\\">(</span> <span class=\\\"token string single-quoted-string\\\">'lozad'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string single-quoted-string\\\">'https://cdn.jsdelivr.net/npm/lozad@1.3.0/dist/lozad.min.js'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token string single-quoted-string\\\">'intersection-observer-polyfill'</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constant\\\">null</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constant boolean\\\">true</span> <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token function\\\">wp_add_inline_script</span><span class=\\\"token punctuation\\\">(</span> <span class=\\\"token string single-quoted-string\\\">'lozad'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string single-quoted-string\\\">'</span>\\n<span class=\\\"token string single-quoted-string\\\">        lozad(\\\".lazy-load\\\").observe();</span>\\n<span class=\\\"token string single-quoted-string\\\">    '</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p><em>Neat! But what if I don’t want to target elements by class?</em> No problem! Instead of defining a class to be watched, you can pass in a <code>NodeList</code>. In that case, our <code>wp_add_inline_script</code> section would look something more like this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token function\\\">wp_add_inline_script</span><span class=\\\"token punctuation\\\">(</span> <span class=\\\"token string single-quoted-string\\\">'lozad'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string single-quoted-string\\\">'</span>\\n<span class=\\\"token string single-quoted-string\\\">\\tvar myElements = document.querySelectorAll(\\\"#main img\\\");</span>\\n<span class=\\\"token string single-quoted-string\\\">\\tlozad(myElements).observe();</span>\\n<span class=\\\"token string single-quoted-string\\\">'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>If we set things up this way, Lozad will watch for any images that are children to <code>#main</code>.</p>\\n<p><strong>Our next step is to add our target class to every image we want to lazy load, as well as change the</strong> <strong><code>src</code></strong> <strong>attribute to</strong> <strong><code>data-src</code>****.</strong> This will prevent the browser from loading the images by default (which would block the rest of the page from rendering), and only do so when <code>lozad</code> changes <code>data-src</code> back to <code>src</code>, which will happen when users scroll to those images.</p>\\n<p>For any images on custom pages outside of the WordPress database, it’s pretty easy to set up the attributes we need. Just manually do it. Unfortunately, working with the images that are stored in the database will require that we filter everything via <code>the_content</code> hook. I don’t <em>love</em> the idea of having to filter post content like this, but if you’re properly caching your site like you should be, this is less of an issue, at least in terms of performance.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token function\\\">add_filter</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string single-quoted-string\\\">'the_content'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token variable\\\">$content</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n\\t<span class=\\\"token comment\\\">//-- Change src to data attributes.</span>\\n\\t<span class=\\\"token variable\\\">$content</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">preg_replace</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string double-quoted-string\\\">\\\"/&#x3C;img(.*?)(src=)(.*?)>/i\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string single-quoted-string\\\">'&#x3C;img$1data-$2$3>'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token variable\\\">$content</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    \\t<span class=\\\"token comment\\\">//-- Change srcset to data attributes.</span>\\n  <span class=\\\"token variable\\\">$content</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">preg_replace</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string double-quoted-string\\\">\\\"/&#x3C;img(.*?)(srcset=)(.*?)>/i\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string single-quoted-string\\\">'&#x3C;img$1data-$2$3>'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token variable\\\">$content</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n\\t<span class=\\\"token comment\\\">//-- Add .lazy-load class to each image that already has a class.</span>\\n\\t<span class=\\\"token variable\\\">$content</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">preg_replace</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string single-quoted-string\\\">'/&#x3C;img(.*?)class=\\\\\\\"(.*?)\\\\\\\"(.*?)>/i'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string single-quoted-string\\\">'&#x3C;img$1class=\\\"$2 lazy-load\\\"$3>'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token variable\\\">$content</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n\\t<span class=\\\"token comment\\\">//-- Add .lazy-load class to each image that doesn't already have a class.</span>\\n\\t<span class=\\\"token variable\\\">$content</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">preg_replace</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string single-quoted-string\\\">'/&#x3C;img((.(?!class=))*)\\\\/?>/i'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string single-quoted-string\\\">'&#x3C;img class=\\\"lazy-load\\\"$1>'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token variable\\\">$content</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n\\t<span class=\\\"token keyword\\\">return</span> <span class=\\\"token variable\\\">$content</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>We’re doing three separate things with our filter here.</p>\\n<ul>\\n<li>Changing <code>src</code> and <code>srcset</code> attributes to <code>data-src</code> and <code>data-srcset</code> on each image.</li>\\n<li>Adding a <code>lazy-load</code> class to each image so Lozad can properly target the images we want to lazy load.</li>\\n<li>Adding a <code>lazy-load</code> class to each image that doesn’t already have a class attached to it.</li>\\n</ul>\\n<p><strong>Technically, you’re done.</strong> Now, each page on which you have content populated from the WordPress editor, images should <em>not</em> load by default, and instead load only when they come into view. But that might not be good enough.</p>\\n<h3>Let’s Make It All Prettier</h3>\\n<p>If images only load when they come into view, you’ll see an ugly pop on the page when that happens. To make everything happen in a prettier fashion, we have some options at our disposal.</p>\\n<p><strong>Let’s adjust the</strong> <strong><code>rootMargin</code></strong> <strong>so images start loading when they’re</strong> <em><strong>about</strong></em> <strong>to come into view.</strong> This way, they can be ready to go before the user even gets there, and everything will appear much more seamless. Go back to our <code>wp_add_inline_script</code> call:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token function\\\">wp_add_inline_script</span><span class=\\\"token punctuation\\\">(</span> <span class=\\\"token string single-quoted-string\\\">'lozad'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string single-quoted-string\\\">'</span>\\n<span class=\\\"token string single-quoted-string\\\">\\tlozad(\\\".lazy-load\\\", {</span>\\n<span class=\\\"token string single-quoted-string\\\">\\t\\trootMargin: \\\"300px 0px\\\"</span>\\n<span class=\\\"token string single-quoted-string\\\">\\t}).observe();</span>\\n<span class=\\\"token string single-quoted-string\\\">'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>Now, when images come within 300px of being visible, Lozad will trigger them to start loading. Feel free to adjust that value as you see fit.</p>\\n<p><strong>We can also add a class after our images load, so they fade in a super pretty, majestic way.</strong> Do that by adding a <code>loaded</code> callback:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token function\\\">wp_add_inline_script</span><span class=\\\"token punctuation\\\">(</span> <span class=\\\"token string single-quoted-string\\\">'lozad'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string single-quoted-string\\\">'</span>\\n<span class=\\\"token string single-quoted-string\\\">\\tlozad(\\\".lazy-load\\\", {</span>\\n<span class=\\\"token string single-quoted-string\\\">\\t\\trootMargin: \\\"300px 0px\\\",</span>\\n<span class=\\\"token string single-quoted-string\\\">\\t\\tloaded: function (el) {</span>\\n<span class=\\\"token string single-quoted-string\\\">\\t\\t\\tel.classList.add(\\\"is-loaded\\\");</span>\\n<span class=\\\"token string single-quoted-string\\\">\\t\\t}</span>\\n<span class=\\\"token string single-quoted-string\\\">\\t}).observe();</span>\\n<span class=\\\"token string single-quoted-string\\\">'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>And add some CSS that’ll hide the images until they’re fully loaded, and then allow them to fade in. Note that if you do add the following CSS, you’ll need to enqueue it in a stylesheet or by some other means.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-css\\\"><code class=\\\"language-css\\\"><span class=\\\"token selector\\\"><span class=\\\"token class\\\">.lazy-load</span></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token property\\\">transition</span><span class=\\\"token punctuation\\\">:</span> opacity <span class=\\\"token number\\\">.15</span><span class=\\\"token unit\\\">s</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token property\\\">opacity</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">0</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token selector\\\"><span class=\\\"token class\\\">.lazy-load</span><span class=\\\"token class\\\">.is-loaded</span></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token property\\\">opacity</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p>Neat! Now, every image will now have an <code>opacity</code> of <code>0</code>, until they’re loaded in, when <code>is-loaded</code> will fade them in.</p>\\n<h3>Soon, This May All Be Meaningless</h3>\\n<p>Lazy loading is a good, responsible thing to implement, but, all of this will likely be possible by default in browsers. In fact, <a href=\\\"https://web.dev/native-lazy-loading/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Chromium-based browsers and Firefox already do have a native API for it</a>. So, pay attention. In a short while, all of what I’ve just showed you might be pointless, and I will need to put a sad disclaimer at the top of this post that you might just be wasting your time by reading this.</p>\\n<p>Hope this helps!</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 57,
        "title": "Building a Lambda Function with Netlify",
        "slug": "building-a-lambda-function-with-netlify",
        "html": "<p>A while back, I wrote my first Lambda function with Firebase. Like every Lambda function tutorial on the web shows you how to do, mine processes a payment via Stripe when someone purchases a license for <a href=\"https://typeitjs.com/\" target=\"_blank\" rel=\"noopener\">TypeIt</a>, the most versatile JavaScript animated typing utility on the planet. The process was pretty straightforward – Firebase’s CLI, documentation, and support are all great. Even so, I had some reservations about the setup.</p>\n<p>First off, TypeIt’s site is hosted with Netlify, with which I am madly in love, so development of the function felt… detached. I couldn’t easily manage everything within the same repository, and I had to keep tabs on three different services to make this all happen – Netlify, Firebase, and Stripe.</p>\n<p>Second, I’m a cheapskate, and Firebase doesn’t have a free tier that permits calls to external services like Stripe. Maybe that’s changed, but last I checked, this was the case.</p>\n<p>With all that in mind, I nearly peed myself when Netlify’s Lambda function service was rolled out, and I immediately dove into migrating my Firebase function to Netlify. It was so fun, I’ve documented that experience. I’ll quickly take you through how to leverage some of the features that make Netlify great, in combination with the power of a Lambda function. Hopefully, you’ll get a sense of why a service like this with a provider like this is uniquely awesome.</p>\n<p>I’ll be using some pretty bare bones here, but you can implement the function with any type of static application you want – Jekyll, Gatsby, whatever. <em>Just make sure you have a static site you’re able to host with Netlify, and that it uses webpack (we’ll be using its</em> <em><code>DefinePlugin</code>__, specifically).</em> I’m starting with an <code>index.html</code> file, some CSS, JavaScript, and some tools to pull it all together. You can see the full setup <a href=\"https://github.com/alexmacarthur/netlify-function-example\" target=\"_blank\" rel=\"noopener\">here</a>. You’ll also need a Stripe account, which you can get for free <a href=\"https://dashboard.stripe.com/register\" target=\"_blank\" rel=\"noopener\">here</a>.</p>\n<p>Letz do dis.</p>\n<h2>Setting Up Our Function</h2>\n<p>I’m going to assume you have a basic JAMStack project already set up &#x26; ready to go, including a <code>package.json</code> file. After that groundwork is laid, walk through these steps:</p>\n<p><strong>Create directories to store your Lambda code.</strong> One of these will contain your pre-compiled source code, and the other will be where Netlify puts the production-ready code. Locally, we’ll only be serving out of the <code>lambda-src</code> directory, and so creating that <code>lambda</code> directory is technically unnecessary (later, when we deploy, Netlify will create that directory automatically), but we’ll go ahead and do it here for better clarity in what’s going on.</p>\n<p><code>mkdir lambda-src lambda</code></p>\n<p><strong>Install the Netlify Lambda CLI.</strong> This will give us the ability to develop &#x26; test the function locally before deploying it to Netlify.</p>\n<p><code>npm install netlify-lambda -D</code></p>\n<p><strong>Create a</strong> <strong><code>netlify.toml</code></strong> <strong>file,</strong> which will contain the required configuration information for our function’s deployment.</p>\n<p><code>touch netlify.toml</code></p>\n<p>The <code>netlify.toml</code> file is responsible for defining things like build commands, our publish directory, environment variables, and most notably for what we’re doing here, where our Lambda function directory will be. It’s worth mentioning that you can also set this directory in the admin, but that’s slightly less cool.</p>\n<p>After defining that directory as well as a couple other nice-to-haves, we’re left with this, which sits in the root of our project. For more information on how this file works and its capabilities, <a href=\"https://www.netlify.com/docs/netlify-toml-reference/\" target=\"_blank\" rel=\"noopener\">read the documentation</a>;</p>\n<div class=\"remark-highlight\"><pre class=\"language-text\"><code class=\"language-text\"># netlify.toml\n\n[build]\n  command = &#x26;quot;npm run build&#x26;quot;\n  publish = &#x26;quot;src&#x26;quot;\n  functions = &#x26;quot;lambda&#x26;quot;</code></pre></div>\n<p>Translation: On build, Netlify will build our stuff using the specified build command, serve our site from the <code>src</code> directory, and serve our function from the <code>lambda</code> directory.</p>\n<p><strong>Next, let’s set up some actions in our</strong> <strong><code>package.json</code></strong> <strong>to run our code locally and build it for production.</strong></p>\n<p>We’ll configure everything to run a small development server <em>and</em> a Lambda function server at the same time. To do this, we’ll use the <code>concurrently</code> package, which will need to be installed as well:</p>\n<p><code>npm install concurrently -D</code></p>\n<p>Following that, our <code>scripts</code> will look something like this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>  <span class=\"token property\">\"lambda-serve\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"netlify-lambda serve lambda-src\"</span><span class=\"token punctuation\">,</span>  <span class=\"token property\">\"lambda-build\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"netlify-lambda build lambda-src\"</span><span class=\"token punctuation\">,</span>  <span class=\"token property\">\"build\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"NODE_ENV=production webpack &#x26;&#x26; npm run lambda-build\"</span><span class=\"token punctuation\">,</span>  <span class=\"token property\">\"dev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"NODE_ENV=development concurrently \\\"webpack-dev-server --content-base src/\\\" \\\"npm run lambda-serve\\\"\"</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>When <code>npm run dev</code> is fired, we’ll have a working development server for loading our static page, as well as a local endpoint for our function. Notice that we’re not passing any function-specific information to these commands – <code>netlify-lambda</code> will pull all that it needs from our <code>netlify.toml</code> file.</p>\n<p><strong>After that, let’s define some variables we’ll need.</strong> Specifically, I’m talking about Stripe publishable and secret keys, which are 1) pieces of sensitive information we don’t want to commit to our repository, and 2) not the same between our development and production environments.</p>\n<p>It’s possible to define things like this in a <code>netlify.toml</code> file, but because of those sensitivity concerns, we’re going to set these values in Netlify’s admin under the “Build &#x26; deploy” section. This will prevent us from having to commit them to version control. You can get these keys from your Stripe dashboard.</p>\n<p><img src='/proxy/8758bdca-9e18-4ed1-a26a-a5c86a529b23' alt='Defining our Environment Variables' loading='lazy' /></p>\n<p>You’ll notice I also threw our <code>LAMBDA_ENDPOINT</code> in there too. More on that in a second.</p>\n<p>To access these Stripe keys locally, we’ll be using the <a href=\"https://github.com/motdotla/dotenv\" target=\"_blank\" rel=\"noopener\">dotenv</a> (thanks to <a href=\"https://www.hawksworx.com/\" target=\"_blank\" rel=\"noopener\">Phil Hawksworth</a> for that tip!). What it does is pretty simple: when we reference an environment variable that isn’t defined in Node’s <code>process.env</code> object (like when we’re working locally), fill it in by referring to a <code>.env</code> file we’ll have in our project. This file <em>won’t</em> be committed to the repository, and will only contain test keys. That said, put this file into your <code>.gitignore</code> file to prevent it from ever being pushed up. This is… <em>key</em>.</p>\n<div class=\"remark-highlight\"><pre class=\"language-text\"><code class=\"language-text\">echo &#x26;quot;.env&#x26;quot; &#x26;gt;&#x26;gt; .gitignore</code></pre></div>\n<p>Install the package and create that <code>.env</code> file.</p>\n<div class=\"remark-highlight\"><pre class=\"language-text\"><code class=\"language-text\">npm install dotenv -D\ntouch .env</code></pre></div>\n<p>In that file, go ahead and fill the Stripe variables with test keys, but ignore the <code>LAMBDA_ENDPOINT</code> variable until the next section.</p>\n<div class=\"remark-highlight\"><pre class=\"language-text\"><code class=\"language-text\">STRIPE_PUBLISHABLE_KEY=&#x26;quot;XXXXXX&#x26;quot;\nSTRIPE_SECRET_KEY=&#x26;quot;XXXXXX&#x26;quot;\nLAMBDA_ENDPOINT=&#x26;quot;http://localhost:9000/purchase&#x26;quot;</code></pre></div>\n<h3>Actually Writing Some Lambda Code</h3>\n<p><strong>Create a</strong> <strong><code>purchase.js</code></strong> <strong>file inside</strong> <strong><code>lambda-src</code>****.</strong> When we’re ready to post to our function, the name of the file inside of the <code>lambda</code> directory will become our endpoint. For us, when using <code>netlify-lambda</code> locally, this will be <code>http://localhost:9000/purchase</code>. After we deploy, you’ll use your site’s URL: <code>https://your-site-name.netlify.com/.netlify/functions/purchase</code>. You saw me already set this for each of our enviornments using the <code>LAMBDA_ENDPOINT</code> variable in the Netlify admin and our local <code>.env</code> file.</p>\n<p>Kick off our function’s code by initializing <code>dotenv</code> and authenticating with Stripe. This will load any variables in our <code>.env</code> file into <code>process.env</code>, unless those variables are already set. Because of this, code is flexible regardless of our environment.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// purchase.js</span>\n\n<span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'dotenv'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">config</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> stripe <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'stripe'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">STRIPE_SECRET_KEY</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p><strong>Now, let’s set appropriate headers.</strong> We’ll want to make sure we’re allowing access to our function via AJAX, and also ensure that we can pass data successfully. For now, I’m just going to open it up to requests from any domain, but you’ll want to change that when you deploy. Because I want to later leverage JavaScript’s enhanced object literals, I also saved a default status code:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// purchase.js</span>\n\n<span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'dotenv'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">config</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> stripe <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'stripe'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">STRIPE_SECRET_KEY</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> statusCode <span class=\"token operator\">=</span> <span class=\"token number\">200</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> headers <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>  \n\t<span class=\"token string-property property\">\"Access-Control-Allow-Origin\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"*\"</span><span class=\"token punctuation\">,</span>  \n\t<span class=\"token string-property property\">\"Access-Control-Allow-Headers\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Content-Type\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p><strong>Next up, create a Lambda function handler.</strong> This is where the magic happens. Just to make sure things are working as they should, I’m gonna immediately return a response with a unique message in the body. If you’ve built Lambda functions with AWS and this looks vaguely familiar, there’s a reason for that. <a href=\"https://functions-beta--www.netlify.com/docs/lambda-functions/\" target=\"_blank\" rel=\"noopener\">Netlify deploys your function to AWS</a>.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// purchase.js</span>\n\nexports<span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">handler</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n\t<span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>    \n\t\tstatusCode<span class=\"token punctuation\">,</span>    \n\t\theaders<span class=\"token punctuation\">,</span>    \n\t\t<span class=\"token literal-property property\">body</span><span class=\"token operator\">:</span> <span class=\"token string\">'Let there be light!'</span>  \n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Quick thing: I’m using an <code>async</code> function for my Lambda. This is because we’ll later be doing some asynchronous work, and I prefer the cleaner syntax. But if you prefer to write something a little more verbose, you’ll need to return a <code>callback</code> method to return your response, which would look like this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// purchase.js</span>\n\nexports<span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">handler</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event<span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">,</span> callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n\t<span class=\"token keyword control-flow\">return</span> <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token keyword null nil\">null</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>    \n\t\tstatusCode<span class=\"token punctuation\">,</span>    \n\t\theaders<span class=\"token punctuation\">,</span>    \n\t\t<span class=\"token literal-property property\">body</span><span class=\"token operator\">:</span> <span class=\"token string\">'Let there be light!'</span>  \n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Now, if we run <code>npm run lambda-serve</code> and head to <code>http://localhost:9000/purchase</code>, we should see ‘Let there be light!’ in the browser. Good sign!</p>\n<p><strong>Add a small check to make sure we’re only dealing with POST requests.</strong> For the longest time, I was having an issue correctly parsing data from a request, only to discover it was because it wasn’t the data from my POST request I was trying to parse – it was from a preflight OPTIONS request that comes in to ensure the CORS protocol is understood. To prevent this from happening, use this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// purchase.js</span>\n\nexports<span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">handler</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n\t<span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span><span class=\"token property-access\">httpMethod</span> <span class=\"token operator\">!==</span> <span class=\"token string\">\"POST\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>    \n\t\t<span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>      \n\t\t\t<span class=\"token literal-property property\">statusCode</span><span class=\"token operator\">:</span> <span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// &#x3C;-- Important!      </span>\n\t\t\theaders<span class=\"token punctuation\">,</span>      \n\t\t\t<span class=\"token literal-property property\">body</span><span class=\"token operator\">:</span> <span class=\"token string\">\"This was not a POST request!\"</span>    \n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>  \n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Here, it’s especially important to make sure you’re returning a valid <code>200</code> status code. If you don’t, that preflight request will fail, and a CORS-related error will be thrown.</p>\n<p><strong>Now we can reliably parse the body and make sure we have everything we need.</strong> If we don’t, execute the callback with a message of some sort.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// purchase.js</span>\n\nexports<span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">handler</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token comment\">// We only care to do anything if this is our POST request.</span>\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span><span class=\"token property-access\">httpMethod</span> <span class=\"token operator\">!==</span> <span class=\"token string\">\"POST\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n      statusCode<span class=\"token punctuation\">,</span>\n      headers<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">body</span><span class=\"token operator\">:</span> <span class=\"token string\">\"This was not a POST request!\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Parse the body contents into an object.</span>\n  <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">parse</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span><span class=\"token property-access\">body</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Make sure we have all required data. Otherwise, get outta here.</span>\n  <span class=\"token keyword control-flow\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>data<span class=\"token punctuation\">.</span><span class=\"token property-access\">token</span> <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>data<span class=\"token punctuation\">.</span><span class=\"token property-access\">amount</span> <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>data<span class=\"token punctuation\">.</span><span class=\"token property-access\">idempotency_key</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> message <span class=\"token operator\">=</span> <span class=\"token string\">\"Required information is missing!\"</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">error</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n      statusCode<span class=\"token punctuation\">,</span>\n      headers<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">body</span><span class=\"token operator\">:</span> <span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">status</span><span class=\"token operator\">:</span> <span class=\"token string\">\"failed\"</span><span class=\"token punctuation\">,</span>\n        message\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>While we’re here, let’s break down this <code>data.token</code>, <code>data.amount</code>, and <code>data.idempotency_key</code> stuff for which we’re checking.</p>\n<p><code>token</code>: This will be the unique payment token be generated by our checkout form on the front end. In it, the user’s email address is also included, which comes in handy to trigger email receipts.</p>\n<p><code>amount</code>: This will be the price of the widget, measured in cents. So, <code>1000</code> is actually <code>$10.00</code>.</p>\n<p><code>idempotency_key</code>: This is a good idea to pass to better <a href=\"https://stripe.com/docs/api?lang=curl#idempotent_requests\" target=\"_blank\" rel=\"noopener\">prevent the same operation from being accidentally performed twice</a>. It doesn’t necessarily matter what that value actually is – just that it’s unique.</p>\n<p><strong>If the body has everything we require, pass it to Stripe to create a charge.</strong> After we get a response back, we’re returning the status of that charge back to the browser. Feel free to elaborate on this as you see fit. Create customers, trigger emails following a successful charge, whatever you like. The point is we create a charge and immediately let the browser know if it was successful or not.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// purchase.js</span>\n\n<span class=\"token keyword\">let</span> charge<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword control-flow\">try</span> <span class=\"token punctuation\">{</span>\n  charge <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> stripe<span class=\"token punctuation\">.</span><span class=\"token property-access\">charges</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">create</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">currency</span><span class=\"token operator\">:</span> <span class=\"token string\">\"usd\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">amount</span><span class=\"token operator\">:</span> data<span class=\"token punctuation\">.</span><span class=\"token property-access\">amount</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">source</span><span class=\"token operator\">:</span> data<span class=\"token punctuation\">.</span><span class=\"token property-access\">token</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">id</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">receipt_email</span><span class=\"token operator\">:</span> data<span class=\"token punctuation\">.</span><span class=\"token property-access\">token</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">email</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">description</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">charge for a widget</span><span class=\"token template-punctuation string\">`</span></span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">idempotency_key</span><span class=\"token operator\">:</span> data<span class=\"token punctuation\">.</span><span class=\"token property-access\">idempotency_key</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword control-flow\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> message <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span><span class=\"token property-access\">message</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">error</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">statusCode</span><span class=\"token operator\">:</span> <span class=\"token number\">424</span><span class=\"token punctuation\">,</span>\n    headers<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">body</span><span class=\"token operator\">:</span> <span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">status</span><span class=\"token operator\">:</span> <span class=\"token string\">\"failed\"</span><span class=\"token punctuation\">,</span>\n      message\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> status <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>charge <span class=\"token operator\">===</span> <span class=\"token keyword null nil\">null</span> <span class=\"token operator\">||</span> charge<span class=\"token punctuation\">.</span><span class=\"token property-access\">status</span> <span class=\"token operator\">!==</span> <span class=\"token string\">\"succeeded\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token string\">\"failed\"</span> <span class=\"token operator\">:</span> charge<span class=\"token punctuation\">.</span><span class=\"token property-access\">status</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n  statusCode<span class=\"token punctuation\">,</span>\n  headers<span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">body</span><span class=\"token operator\">:</span> <span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    status<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">message</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Charge successfully created!\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h2>Setting Up the Front End</h2>\n<p>At this point, we’re ready to start work on the front end, which will consist of generating a Stripe token and then posting it via AJAX to our Lambda function. To keep it simple, we’re going to be using Stripe Checkout to do this. Basically, just drop it in and you’re ready to go.</p>\n<p><strong>Add the Stripe Checkout script to the bottom of the body in your</strong> <strong><code>index.html</code></strong> <strong>file, and add a button that’ll be used to open the checkout form.</strong></p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>button</span><span class=\"token punctuation\">></span></span>  \n\tClick to Buy! <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>strong</span><span class=\"token punctuation\">></span></span>$10<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>strong</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>button</span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://checkout.stripe.com/checkout.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>script</span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<p><strong>Configure webpack to make our environment variables available on the front end.</strong> Much like we did before, we’ll initialize <code>dotenv</code> so we can access environment variables locally. At the top of our <code>webpack.config.js</code> file, let’s add this:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// front-end.js</span>\n\n<span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'dotenv'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">config</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> webpack <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'webpack'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// webpack configuration...</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Same as before, we’re letting <code>dotenv</code> fill in the <code>process.env</code> gaps if a particular variable isn’t already defined. Below that, we expose those variables to our JavaScript using webpack’s <code>DefinePlugin</code>.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// webpack.config.js</span>\n\nmodule<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">entry</span><span class=\"token operator\">:</span> <span class=\"token string\">'./src/front-end.js'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">output</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span> __dirname <span class=\"token operator\">+</span> <span class=\"token string\">'/src'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">filename</span><span class=\"token operator\">:</span> <span class=\"token string\">'bundle.js'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">webpack<span class=\"token punctuation\">.</span>DefinePlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token constant\">LAMBDA_ENDPOINT</span><span class=\"token operator\">:</span> <span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LAMBDA_ENDPOINT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token constant\">STRIPE_PUBLISHABLE_KEY</span><span class=\"token operator\">:</span> <span class=\"token known-class-name class-name\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">stringify</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token property-access\">env</span><span class=\"token punctuation\">.</span><span class=\"token constant\">STRIPE_PUBLISHABLE_KEY</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p><strong>Now, let’s create a Stripe Checkout handler in our front-end.js file, and include that bundled</strong> <strong><code>bundle.js</code></strong> <strong>file at the bottom of</strong> <strong><code>index.html</code>****.</strong></p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// front-end.js</span>\n\n<span class=\"token keyword\">const</span> handler <span class=\"token operator\">=</span> <span class=\"token maybe-class-name\">StripeCheckout</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">configure</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">key</span><span class=\"token operator\">:</span> <span class=\"token constant\">STRIPE_PUBLISHABLE_KEY</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">image</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://stripe.com/img/documentation/checkout/marketplace.png\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">locale</span><span class=\"token operator\">:</span> <span class=\"token string\">\"auto\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">token</span><span class=\"token operator\">:</span> <span class=\"token parameter\">token</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// We'll fill this out in a second.</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p><strong>Let’s open our checkout form when someone clicks the button.</strong></p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// front-end.js</span>\n\n<span class=\"token comment\">// Stripe handles pricing in cents, so this is actually $10.00.</span>\n<span class=\"token keyword\">const</span> amount <span class=\"token operator\">=</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"button\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  handler<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    amount<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Test Shop\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">description</span><span class=\"token operator\">:</span> <span class=\"token string\">\"A Fantastic New Widget\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>At this point, when a user clicks the button on our page, a beautiful Stripe checkout form should pop up, ready to collect that user’s payment information. Once that form is submitted, we send that information to our function.</p>\n<p><strong>Send the generated token to our Lambda function via AJAX.</strong> Add this to your <code>front-end.js</code> file, right after our token is generated. I’m using the browser’s <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API\" target=\"_blank\" rel=\"noopener\">Fetch API</a>, but really doesn’t matter what you choose.</p>\n<div class=\"remark-highlight\"><pre class=\"language-text\"><code class=\"language-text\">// front-end.js\n\nconst handler = StripeCheckout.configure({\n  // -- Other stuff we&#x26;#39;ve already gone through.\n  token: async (token) =&#x26;gt; {\n    let response, data;\n\n    try {\n      response = await fetch(LAMBDA_ENDPOINT, {\n        method: &#x26;quot;POST&#x26;quot;,\n        body: JSON.stringify({\n          token,\n          amount,\n          idempotency_key: uuid()\n        }),\n        headers: new Headers({\n          &#x26;quot;Content-Type&#x26;quot;: &#x26;quot;application/json&#x26;quot;\n        })\n      });\n\n      data = await response.json();\n    } catch (error) {\n      console.error(error.message);\n      return;\n    }\n  };</code></pre></div>\n<p>To generate our <code>idempotency_key</code>, I’m using the <a href=\"https://www.npmjs.com/package/uuid\" target=\"_blank\" rel=\"noopener\">uuid</a> package. It’s really unique (lol). Run <code>npm install uuid -D</code> and import it at the top of your file.</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// front-end.js</span>\n\n<span class=\"token keyword module\">import</span> <span class=\"token imports\">uuid</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'uuid/v4'</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Great, we’ve thrown a bunch of code together. Now…</p>\n<p><strong>Let’s spin it up locally!</strong> If you recall the actions we set up, using <code>npm run dev</code> will spin up a webpack dev server, as well as trigger <code>netlify-lambda</code> to serve our function. Run that command, and our application should be available at <code>http://localhost:8080</code>. Click the button, enter your payment information (use <code>4242424242424242</code> for the card number in development mode), and you <em>should</em> see a successful response in the console. Of course, this is web development we’re doing here, where very little goes right the first time, so have some patience as you work out any issues you have standing it up.</p>\n<h2>Time to Deploy!</h2>\n<p><strong>Let’s get this sucka live.</strong> Put all this into a repository, log into your Netlify account, hook up the tubes, and set your environment variables, if you haven’t already. Because of our <code>netlify.toml</code> file, Netlify should already know from where to serve your function. Once that’s done, you should see our <code>purchase.js</code> function listed on the ‘Functions’ page, where logging will be available to view, should you need it. When you’re debugging, you can dump logs into this window by using <code>console.log()</code>.</p>\n<h2>Resources</h2>\n<p>If you want to dig into this particular example more yourself, check out <a href=\"https://github.com/alexmacarthur/netlify-function-example\" target=\"_blank\" rel=\"noopener\">the repo on Github</a>. There, I have a simple working demo that actually submits a fake payment to Stripe. If you wish that payment to be not fake, we can have that arranged.</p>\n<p>When you’re ready to explore Lambda functions with Netlify yourself, <a href=\"https://www.netlify.com/docs/functions/\" target=\"_blank\" rel=\"noopener\">dig in here</a>.</p>\n<h2>Make Sense?</h2>\n<p>I hope this process was generally easy to follow without a whole lot of frustration. If you do have any questions, corrections, or tips for improving it, reach out!</p>\n",
        "feature_image": "https://images.pexels.com/photos/238118/pexels-photo-238118.jpeg?w=1260&amp;h=750&amp;dpr=2&amp;auto=compress&amp;cs=tinysrgb",
        "status": "published",
        "created_at": 1518066000000,
        "published_at": 1518066000000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "updated_at": 1559710800000,
        "updated_by": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>A while back, I wrote my first Lambda function with Firebase. Like every Lambda function tutorial on the web shows you how to do, mine processes a payment via Stripe when someone purchases a license for <a href=\\\"https://typeitjs.com/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">TypeIt</a>, the most versatile JavaScript animated typing utility on the planet. The process was pretty straightforward – Firebase’s CLI, documentation, and support are all great. Even so, I had some reservations about the setup.</p>\\n<p>First off, TypeIt’s site is hosted with Netlify, with which I am madly in love, so development of the function felt… detached. I couldn’t easily manage everything within the same repository, and I had to keep tabs on three different services to make this all happen – Netlify, Firebase, and Stripe.</p>\\n<p>Second, I’m a cheapskate, and Firebase doesn’t have a free tier that permits calls to external services like Stripe. Maybe that’s changed, but last I checked, this was the case.</p>\\n<p>With all that in mind, I nearly peed myself when Netlify’s Lambda function service was rolled out, and I immediately dove into migrating my Firebase function to Netlify. It was so fun, I’ve documented that experience. I’ll quickly take you through how to leverage some of the features that make Netlify great, in combination with the power of a Lambda function. Hopefully, you’ll get a sense of why a service like this with a provider like this is uniquely awesome.</p>\\n<p>I’ll be using some pretty bare bones here, but you can implement the function with any type of static application you want – Jekyll, Gatsby, whatever. <em>Just make sure you have a static site you’re able to host with Netlify, and that it uses webpack (we’ll be using its</em> <em><code>DefinePlugin</code>__, specifically).</em> I’m starting with an <code>index.html</code> file, some CSS, JavaScript, and some tools to pull it all together. You can see the full setup <a href=\\\"https://github.com/alexmacarthur/netlify-function-example\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">here</a>. You’ll also need a Stripe account, which you can get for free <a href=\\\"https://dashboard.stripe.com/register\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">here</a>.</p>\\n<p>Letz do dis.</p>\\n<h2>Setting Up Our Function</h2>\\n<p>I’m going to assume you have a basic JAMStack project already set up &#x26; ready to go, including a <code>package.json</code> file. After that groundwork is laid, walk through these steps:</p>\\n<p><strong>Create directories to store your Lambda code.</strong> One of these will contain your pre-compiled source code, and the other will be where Netlify puts the production-ready code. Locally, we’ll only be serving out of the <code>lambda-src</code> directory, and so creating that <code>lambda</code> directory is technically unnecessary (later, when we deploy, Netlify will create that directory automatically), but we’ll go ahead and do it here for better clarity in what’s going on.</p>\\n<p><code>mkdir lambda-src lambda</code></p>\\n<p><strong>Install the Netlify Lambda CLI.</strong> This will give us the ability to develop &#x26; test the function locally before deploying it to Netlify.</p>\\n<p><code>npm install netlify-lambda -D</code></p>\\n<p><strong>Create a</strong> <strong><code>netlify.toml</code></strong> <strong>file,</strong> which will contain the required configuration information for our function’s deployment.</p>\\n<p><code>touch netlify.toml</code></p>\\n<p>The <code>netlify.toml</code> file is responsible for defining things like build commands, our publish directory, environment variables, and most notably for what we’re doing here, where our Lambda function directory will be. It’s worth mentioning that you can also set this directory in the admin, but that’s slightly less cool.</p>\\n<p>After defining that directory as well as a couple other nice-to-haves, we’re left with this, which sits in the root of our project. For more information on how this file works and its capabilities, <a href=\\\"https://www.netlify.com/docs/netlify-toml-reference/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">read the documentation</a>;</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-text\\\"><code class=\\\"language-text\\\"># netlify.toml\\n\\n[build]\\n  command = &#x26;quot;npm run build&#x26;quot;\\n  publish = &#x26;quot;src&#x26;quot;\\n  functions = &#x26;quot;lambda&#x26;quot;</code></pre></div>\\n<p>Translation: On build, Netlify will build our stuff using the specified build command, serve our site from the <code>src</code> directory, and serve our function from the <code>lambda</code> directory.</p>\\n<p><strong>Next, let’s set up some actions in our</strong> <strong><code>package.json</code></strong> <strong>to run our code locally and build it for production.</strong></p>\\n<p>We’ll configure everything to run a small development server <em>and</em> a Lambda function server at the same time. To do this, we’ll use the <code>concurrently</code> package, which will need to be installed as well:</p>\\n<p><code>npm install concurrently -D</code></p>\\n<p>Following that, our <code>scripts</code> will look something like this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-json\\\"><code class=\\\"language-json\\\"><span class=\\\"token property\\\">\\\"scripts\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>  <span class=\\\"token property\\\">\\\"lambda-serve\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"netlify-lambda serve lambda-src\\\"</span><span class=\\\"token punctuation\\\">,</span>  <span class=\\\"token property\\\">\\\"lambda-build\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"netlify-lambda build lambda-src\\\"</span><span class=\\\"token punctuation\\\">,</span>  <span class=\\\"token property\\\">\\\"build\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"NODE_ENV=production webpack &#x26;&#x26; npm run lambda-build\\\"</span><span class=\\\"token punctuation\\\">,</span>  <span class=\\\"token property\\\">\\\"dev\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"NODE_ENV=development concurrently \\\\\\\"webpack-dev-server --content-base src/\\\\\\\" \\\\\\\"npm run lambda-serve\\\\\\\"\\\"</span><span class=\\\"token punctuation\\\">,</span><span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p>When <code>npm run dev</code> is fired, we’ll have a working development server for loading our static page, as well as a local endpoint for our function. Notice that we’re not passing any function-specific information to these commands – <code>netlify-lambda</code> will pull all that it needs from our <code>netlify.toml</code> file.</p>\\n<p><strong>After that, let’s define some variables we’ll need.</strong> Specifically, I’m talking about Stripe publishable and secret keys, which are 1) pieces of sensitive information we don’t want to commit to our repository, and 2) not the same between our development and production environments.</p>\\n<p>It’s possible to define things like this in a <code>netlify.toml</code> file, but because of those sensitivity concerns, we’re going to set these values in Netlify’s admin under the “Build &#x26; deploy” section. This will prevent us from having to commit them to version control. You can get these keys from your Stripe dashboard.</p>\\n<p><img src='/proxy/8758bdca-9e18-4ed1-a26a-a5c86a529b23' alt='Defining our Environment Variables' loading='lazy' /></p>\\n<p>You’ll notice I also threw our <code>LAMBDA_ENDPOINT</code> in there too. More on that in a second.</p>\\n<p>To access these Stripe keys locally, we’ll be using the <a href=\\\"https://github.com/motdotla/dotenv\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">dotenv</a> (thanks to <a href=\\\"https://www.hawksworx.com/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Phil Hawksworth</a> for that tip!). What it does is pretty simple: when we reference an environment variable that isn’t defined in Node’s <code>process.env</code> object (like when we’re working locally), fill it in by referring to a <code>.env</code> file we’ll have in our project. This file <em>won’t</em> be committed to the repository, and will only contain test keys. That said, put this file into your <code>.gitignore</code> file to prevent it from ever being pushed up. This is… <em>key</em>.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">echo &#x26;quot;.env&#x26;quot; &#x26;gt;&#x26;gt; .gitignore</code></pre></div>\\n<p>Install the package and create that <code>.env</code> file.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">npm install dotenv -D\\ntouch .env</code></pre></div>\\n<p>In that file, go ahead and fill the Stripe variables with test keys, but ignore the <code>LAMBDA_ENDPOINT</code> variable until the next section.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">STRIPE_PUBLISHABLE_KEY=&#x26;quot;XXXXXX&#x26;quot;\\nSTRIPE_SECRET_KEY=&#x26;quot;XXXXXX&#x26;quot;\\nLAMBDA_ENDPOINT=&#x26;quot;http://localhost:9000/purchase&#x26;quot;</code></pre></div>\\n<h3>Actually Writing Some Lambda Code</h3>\\n<p><strong>Create a</strong> <strong><code>purchase.js</code></strong> <strong>file inside</strong> <strong><code>lambda-src</code>****.</strong> When we’re ready to post to our function, the name of the file inside of the <code>lambda</code> directory will become our endpoint. For us, when using <code>netlify-lambda</code> locally, this will be <code>http://localhost:9000/purchase</code>. After we deploy, you’ll use your site’s URL: <code>https://your-site-name.netlify.com/.netlify/functions/purchase</code>. You saw me already set this for each of our enviornments using the <code>LAMBDA_ENDPOINT</code> variable in the Netlify admin and our local <code>.env</code> file.</p>\\n<p>Kick off our function’s code by initializing <code>dotenv</code> and authenticating with Stripe. This will load any variables in our <code>.env</code> file into <code>process.env</code>, unless those variables are already set. Because of this, code is flexible regardless of our environment.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token comment\\\">// purchase.js</span>\\n\\n<span class=\\\"token function\\\">require</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'dotenv'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">config</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> stripe <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">require</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'stripe'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">(</span>process<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">env</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">STRIPE_SECRET_KEY</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p><strong>Now, let’s set appropriate headers.</strong> We’ll want to make sure we’re allowing access to our function via AJAX, and also ensure that we can pass data successfully. For now, I’m just going to open it up to requests from any domain, but you’ll want to change that when you deploy. Because I want to later leverage JavaScript’s enhanced object literals, I also saved a default status code:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token comment\\\">// purchase.js</span>\\n\\n<span class=\\\"token function\\\">require</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'dotenv'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">config</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">const</span> stripe <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">require</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'stripe'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">(</span>process<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">env</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">STRIPE_SECRET_KEY</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> statusCode <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">200</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">const</span> headers <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>  \\n\\t<span class=\\\"token string-property property\\\">\\\"Access-Control-Allow-Origin\\\"</span> <span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"*\\\"</span><span class=\\\"token punctuation\\\">,</span>  \\n\\t<span class=\\\"token string-property property\\\">\\\"Access-Control-Allow-Headers\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"Content-Type\\\"</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p><strong>Next up, create a Lambda function handler.</strong> This is where the magic happens. Just to make sure things are working as they should, I’m gonna immediately return a response with a unique message in the body. If you’ve built Lambda functions with AWS and this looks vaguely familiar, there’s a reason for that. <a href=\\\"https://functions-beta--www.netlify.com/docs/lambda-functions/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Netlify deploys your function to AWS</a>.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token comment\\\">// purchase.js</span>\\n\\nexports<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method-variable function-variable method function property-access\\\">handler</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">async</span> <span class=\\\"token keyword\\\">function</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">event</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>  \\n\\t<span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token punctuation\\\">{</span>    \\n\\t\\tstatusCode<span class=\\\"token punctuation\\\">,</span>    \\n\\t\\theaders<span class=\\\"token punctuation\\\">,</span>    \\n\\t\\t<span class=\\\"token literal-property property\\\">body</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">'Let there be light!'</span>  \\n\\t<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p>Quick thing: I’m using an <code>async</code> function for my Lambda. This is because we’ll later be doing some asynchronous work, and I prefer the cleaner syntax. But if you prefer to write something a little more verbose, you’ll need to return a <code>callback</code> method to return your response, which would look like this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token comment\\\">// purchase.js</span>\\n\\nexports<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method-variable function-variable method function property-access\\\">handler</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">function</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">event<span class=\\\"token punctuation\\\">,</span> context<span class=\\\"token punctuation\\\">,</span> callback</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>  \\n\\t<span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token function\\\">callback</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword null nil\\\">null</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span>    \\n\\t\\tstatusCode<span class=\\\"token punctuation\\\">,</span>    \\n\\t\\theaders<span class=\\\"token punctuation\\\">,</span>    \\n\\t\\t<span class=\\\"token literal-property property\\\">body</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">'Let there be light!'</span>  \\n\\t<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p>Now, if we run <code>npm run lambda-serve</code> and head to <code>http://localhost:9000/purchase</code>, we should see ‘Let there be light!’ in the browser. Good sign!</p>\\n<p><strong>Add a small check to make sure we’re only dealing with POST requests.</strong> For the longest time, I was having an issue correctly parsing data from a request, only to discover it was because it wasn’t the data from my POST request I was trying to parse – it was from a preflight OPTIONS request that comes in to ensure the CORS protocol is understood. To prevent this from happening, use this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token comment\\\">// purchase.js</span>\\n\\nexports<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method-variable function-variable method function property-access\\\">handler</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">async</span> <span class=\\\"token keyword\\\">function</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">event</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>  \\n\\t<span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span>event<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">httpMethod</span> <span class=\\\"token operator\\\">!==</span> <span class=\\\"token string\\\">\\\"POST\\\"</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>    \\n\\t\\t<span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token punctuation\\\">{</span>      \\n\\t\\t\\t<span class=\\\"token literal-property property\\\">statusCode</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">200</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token comment\\\">// &#x3C;-- Important!      </span>\\n\\t\\t\\theaders<span class=\\\"token punctuation\\\">,</span>      \\n\\t\\t\\t<span class=\\\"token literal-property property\\\">body</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"This was not a POST request!\\\"</span>    \\n\\t\\t<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>  \\n\\t<span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p>Here, it’s especially important to make sure you’re returning a valid <code>200</code> status code. If you don’t, that preflight request will fail, and a CORS-related error will be thrown.</p>\\n<p><strong>Now we can reliably parse the body and make sure we have everything we need.</strong> If we don’t, execute the callback with a message of some sort.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token comment\\\">// purchase.js</span>\\n\\nexports<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method-variable function-variable method function property-access\\\">handler</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">async</span> <span class=\\\"token keyword\\\">function</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">event</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n\\n  <span class=\\\"token comment\\\">// We only care to do anything if this is our POST request.</span>\\n  <span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span>event<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">httpMethod</span> <span class=\\\"token operator\\\">!==</span> <span class=\\\"token string\\\">\\\"POST\\\"</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token punctuation\\\">{</span>\\n      statusCode<span class=\\\"token punctuation\\\">,</span>\\n      headers<span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token literal-property property\\\">body</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"This was not a POST request!\\\"</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token comment\\\">// Parse the body contents into an object.</span>\\n  <span class=\\\"token keyword\\\">const</span> data <span class=\\\"token operator\\\">=</span> <span class=\\\"token known-class-name class-name\\\">JSON</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">parse</span><span class=\\\"token punctuation\\\">(</span>event<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">body</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token comment\\\">// Make sure we have all required data. Otherwise, get outta here.</span>\\n  <span class=\\\"token keyword control-flow\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>data<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">token</span> <span class=\\\"token operator\\\">||</span> <span class=\\\"token operator\\\">!</span>data<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">amount</span> <span class=\\\"token operator\\\">||</span> <span class=\\\"token operator\\\">!</span>data<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">idempotency_key</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">const</span> message <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"Required information is missing!\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">error</span><span class=\\\"token punctuation\\\">(</span>message<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token punctuation\\\">{</span>\\n      statusCode<span class=\\\"token punctuation\\\">,</span>\\n      headers<span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token literal-property property\\\">body</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token known-class-name class-name\\\">JSON</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">stringify</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token literal-property property\\\">status</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"failed\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n        message\\n      <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>While we’re here, let’s break down this <code>data.token</code>, <code>data.amount</code>, and <code>data.idempotency_key</code> stuff for which we’re checking.</p>\\n<p><code>token</code>: This will be the unique payment token be generated by our checkout form on the front end. In it, the user’s email address is also included, which comes in handy to trigger email receipts.</p>\\n<p><code>amount</code>: This will be the price of the widget, measured in cents. So, <code>1000</code> is actually <code>$10.00</code>.</p>\\n<p><code>idempotency_key</code>: This is a good idea to pass to better <a href=\\\"https://stripe.com/docs/api?lang=curl#idempotent_requests\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">prevent the same operation from being accidentally performed twice</a>. It doesn’t necessarily matter what that value actually is – just that it’s unique.</p>\\n<p><strong>If the body has everything we require, pass it to Stripe to create a charge.</strong> After we get a response back, we’re returning the status of that charge back to the browser. Feel free to elaborate on this as you see fit. Create customers, trigger emails following a successful charge, whatever you like. The point is we create a charge and immediately let the browser know if it was successful or not.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token comment\\\">// purchase.js</span>\\n\\n<span class=\\\"token keyword\\\">let</span> charge<span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword control-flow\\\">try</span> <span class=\\\"token punctuation\\\">{</span>\\n  charge <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword control-flow\\\">await</span> stripe<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">charges</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">create</span><span class=\\\"token punctuation\\\">(</span>\\n    <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token literal-property property\\\">currency</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"usd\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token literal-property property\\\">amount</span><span class=\\\"token operator\\\">:</span> data<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">amount</span><span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token literal-property property\\\">source</span><span class=\\\"token operator\\\">:</span> data<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">token</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">id</span><span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token literal-property property\\\">receipt_email</span><span class=\\\"token operator\\\">:</span> data<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">token</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">email</span><span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token literal-property property\\\">description</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">charge for a widget</span><span class=\\\"token template-punctuation string\\\">`</span></span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token literal-property property\\\">idempotency_key</span><span class=\\\"token operator\\\">:</span> data<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">idempotency_key</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword control-flow\\\">catch</span> <span class=\\\"token punctuation\\\">(</span>e<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">let</span> message <span class=\\\"token operator\\\">=</span> e<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">message</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token console class-name\\\">console</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">error</span><span class=\\\"token punctuation\\\">(</span>message<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token literal-property property\\\">statusCode</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">424</span><span class=\\\"token punctuation\\\">,</span>\\n    headers<span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token literal-property property\\\">body</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token known-class-name class-name\\\">JSON</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">stringify</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token literal-property property\\\">status</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"failed\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n      message\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token keyword\\\">const</span> status <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span>charge <span class=\\\"token operator\\\">===</span> <span class=\\\"token keyword null nil\\\">null</span> <span class=\\\"token operator\\\">||</span> charge<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">status</span> <span class=\\\"token operator\\\">!==</span> <span class=\\\"token string\\\">\\\"succeeded\\\"</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">?</span> <span class=\\\"token string\\\">\\\"failed\\\"</span> <span class=\\\"token operator\\\">:</span> charge<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">status</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword control-flow\\\">return</span> <span class=\\\"token punctuation\\\">{</span>\\n  statusCode<span class=\\\"token punctuation\\\">,</span>\\n  headers<span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token literal-property property\\\">body</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token known-class-name class-name\\\">JSON</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">stringify</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n    status<span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token literal-property property\\\">message</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"Charge successfully created!\\\"</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<h2>Setting Up the Front End</h2>\\n<p>At this point, we’re ready to start work on the front end, which will consist of generating a Stripe token and then posting it via AJAX to our Lambda function. To keep it simple, we’re going to be using Stripe Checkout to do this. Basically, just drop it in and you’re ready to go.</p>\\n<p><strong>Add the Stripe Checkout script to the bottom of the body in your</strong> <strong><code>index.html</code></strong> <strong>file, and add a button that’ll be used to open the checkout form.</strong></p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>button</span><span class=\\\"token punctuation\\\">></span></span>  \\n\\tClick to Buy! <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>strong</span><span class=\\\"token punctuation\\\">></span></span>$10<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>strong</span><span class=\\\"token punctuation\\\">></span></span>\\n<span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>button</span><span class=\\\"token punctuation\\\">></span></span>\\n</code></pre></div>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-html\\\"><code class=\\\"language-html\\\"><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>script</span> <span class=\\\"token attr-name\\\">src</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>https://checkout.stripe.com/checkout.js<span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token script\\\"></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>script</span><span class=\\\"token punctuation\\\">></span></span>\\n</code></pre></div>\\n<p><strong>Configure webpack to make our environment variables available on the front end.</strong> Much like we did before, we’ll initialize <code>dotenv</code> so we can access environment variables locally. At the top of our <code>webpack.config.js</code> file, let’s add this:</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token comment\\\">// front-end.js</span>\\n\\n<span class=\\\"token function\\\">require</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'dotenv'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">config</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> webpack <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">require</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'webpack'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\nmodule<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">exports</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token comment\\\">// webpack configuration...</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p>Same as before, we’re letting <code>dotenv</code> fill in the <code>process.env</code> gaps if a particular variable isn’t already defined. Below that, we expose those variables to our JavaScript using webpack’s <code>DefinePlugin</code>.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token comment\\\">// webpack.config.js</span>\\n\\nmodule<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">exports</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token literal-property property\\\">entry</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">'./src/front-end.js'</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token literal-property property\\\">output</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token literal-property property\\\">path</span><span class=\\\"token operator\\\">:</span> __dirname <span class=\\\"token operator\\\">+</span> <span class=\\\"token string\\\">'/src'</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token literal-property property\\\">filename</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">'bundle.js'</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token literal-property property\\\">plugins</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">[</span>\\n    <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">webpack<span class=\\\"token punctuation\\\">.</span>DefinePlugin</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token constant\\\">LAMBDA_ENDPOINT</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token known-class-name class-name\\\">JSON</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">stringify</span><span class=\\\"token punctuation\\\">(</span>process<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">env</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">LAMBDA_ENDPOINT</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token constant\\\">STRIPE_PUBLISHABLE_KEY</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token known-class-name class-name\\\">JSON</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">stringify</span><span class=\\\"token punctuation\\\">(</span>process<span class=\\\"token punctuation\\\">.</span><span class=\\\"token property-access\\\">env</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">STRIPE_PUBLISHABLE_KEY</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token punctuation\\\">]</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p><strong>Now, let’s create a Stripe Checkout handler in our front-end.js file, and include that bundled</strong> <strong><code>bundle.js</code></strong> <strong>file at the bottom of</strong> <strong><code>index.html</code>****.</strong></p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token comment\\\">// front-end.js</span>\\n\\n<span class=\\\"token keyword\\\">const</span> handler <span class=\\\"token operator\\\">=</span> <span class=\\\"token maybe-class-name\\\">StripeCheckout</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">configure</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token literal-property property\\\">key</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token constant\\\">STRIPE_PUBLISHABLE_KEY</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token literal-property property\\\">image</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"https://stripe.com/img/documentation/checkout/marketplace.png\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token literal-property property\\\">locale</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"auto\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token function-variable function\\\">token</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token parameter\\\">token</span> <span class=\\\"token arrow operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token comment\\\">// We'll fill this out in a second.</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p><strong>Let’s open our checkout form when someone clicks the button.</strong></p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token comment\\\">// front-end.js</span>\\n\\n<span class=\\\"token comment\\\">// Stripe handles pricing in cents, so this is actually $10.00.</span>\\n<span class=\\\"token keyword\\\">const</span> amount <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">1000</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token dom variable\\\">document</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">querySelector</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"button\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">addEventListener</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"click\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">function</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  handler<span class=\\\"token punctuation\\\">.</span><span class=\\\"token method function property-access\\\">open</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n    amount<span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token literal-property property\\\">name</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"Test Shop\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token literal-property property\\\">description</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"A Fantastic New Widget\\\"</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>At this point, when a user clicks the button on our page, a beautiful Stripe checkout form should pop up, ready to collect that user’s payment information. Once that form is submitted, we send that information to our function.</p>\\n<p><strong>Send the generated token to our Lambda function via AJAX.</strong> Add this to your <code>front-end.js</code> file, right after our token is generated. I’m using the browser’s <a href=\\\"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Fetch API</a>, but really doesn’t matter what you choose.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-text\\\"><code class=\\\"language-text\\\">// front-end.js\\n\\nconst handler = StripeCheckout.configure({\\n  // -- Other stuff we&#x26;#39;ve already gone through.\\n  token: async (token) =&#x26;gt; {\\n    let response, data;\\n\\n    try {\\n      response = await fetch(LAMBDA_ENDPOINT, {\\n        method: &#x26;quot;POST&#x26;quot;,\\n        body: JSON.stringify({\\n          token,\\n          amount,\\n          idempotency_key: uuid()\\n        }),\\n        headers: new Headers({\\n          &#x26;quot;Content-Type&#x26;quot;: &#x26;quot;application/json&#x26;quot;\\n        })\\n      });\\n\\n      data = await response.json();\\n    } catch (error) {\\n      console.error(error.message);\\n      return;\\n    }\\n  };</code></pre></div>\\n<p>To generate our <code>idempotency_key</code>, I’m using the <a href=\\\"https://www.npmjs.com/package/uuid\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">uuid</a> package. It’s really unique (lol). Run <code>npm install uuid -D</code> and import it at the top of your file.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token comment\\\">// front-end.js</span>\\n\\n<span class=\\\"token keyword module\\\">import</span> <span class=\\\"token imports\\\">uuid</span> <span class=\\\"token keyword module\\\">from</span> <span class=\\\"token string\\\">'uuid/v4'</span><span class=\\\"token punctuation\\\">;</span>\\n</code></pre></div>\\n<p>Great, we’ve thrown a bunch of code together. Now…</p>\\n<p><strong>Let’s spin it up locally!</strong> If you recall the actions we set up, using <code>npm run dev</code> will spin up a webpack dev server, as well as trigger <code>netlify-lambda</code> to serve our function. Run that command, and our application should be available at <code>http://localhost:8080</code>. Click the button, enter your payment information (use <code>4242424242424242</code> for the card number in development mode), and you <em>should</em> see a successful response in the console. Of course, this is web development we’re doing here, where very little goes right the first time, so have some patience as you work out any issues you have standing it up.</p>\\n<h2>Time to Deploy!</h2>\\n<p><strong>Let’s get this sucka live.</strong> Put all this into a repository, log into your Netlify account, hook up the tubes, and set your environment variables, if you haven’t already. Because of our <code>netlify.toml</code> file, Netlify should already know from where to serve your function. Once that’s done, you should see our <code>purchase.js</code> function listed on the ‘Functions’ page, where logging will be available to view, should you need it. When you’re debugging, you can dump logs into this window by using <code>console.log()</code>.</p>\\n<h2>Resources</h2>\\n<p>If you want to dig into this particular example more yourself, check out <a href=\\\"https://github.com/alexmacarthur/netlify-function-example\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">the repo on Github</a>. There, I have a simple working demo that actually submits a fake payment to Stripe. If you wish that payment to be not fake, we can have that arranged.</p>\\n<p>When you’re ready to explore Lambda functions with Netlify yourself, <a href=\\\"https://www.netlify.com/docs/functions/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">dig in here</a>.</p>\\n<h2>Make Sense?</h2>\\n<p>I hope this process was generally easy to follow without a whole lot of frustration. If you do have any questions, corrections, or tips for improving it, reach out!</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 58,
        "title": "Removing Usernames from Password Reset Emails",
        "slug": "removing-usernames-from-password-reset-urls-in-woocommerce",
        "html": "<p>Securely handling personal information on the web is a pretty big deal, and one of the ways you do that is making sure none of it’s sent via query string in a URL. Things like this are bad:</p>\n<p><code>https://your-site.com?email=booger%40email.com</code></p>\n<p>In fact, Google has some clear policies explicitly prohibiting certain information from being passed through a URL, including things like <a href=\"https://developers.google.com/analytics/solutions/crm-integration#user_id\" target=\"_blank\" rel=\"noopener\">“email addresses, user logins, social security numbers, phone numbers or any piece of data that is deemed to be”PII\"</a>. And if you do send any of this information to Google, <a href=\"https://support.google.com/adwords/answer/6389382?hl=en\" target=\"_blank\" rel=\"noopener\">you’ll be penalized</a> until the issue is resolved.</p>\n<h3>A Vulnerability in WooCommerce</h3>\n<p>Out of the box, the WordPress e-commerce plugin <a href=\"https://woocommerce.com/\" target=\"_blank\" rel=\"noopener\">WooCommerce</a> has a weak spot in this area. Password reset emails contain a link for a user to click to reset his/her password. That link, however, contains information that could be passed to a third party (like Google Analytics), posing a threat to users’ privacy, and penalizing you for enabling it.</p>\n<p>That vulnerable information is a username. Or, as WordPress often handles it, a user login. I’ll be using “username” here because I like it more. For example: <code>http://my-site.com/settings/account/lost-password/?key=NaEYetJTi6fI2HKaNfxT&#x26;login=bartjansen</code></p>\n<p>To better protect private information like this, the solution is relatively straightforward: <strong>Instead of passing a username, use an ID</strong>. An ID will be unique to the WordPress instance, and make it much more difficult to use to identify an individual. And from what I’ve read, <a href=\"https://support.google.com/adwords/answer/6389382?hl=en\" target=\"_blank\" rel=\"noopener\">Google endorses this type of approach</a>.</p>\n<h3>How Do I Fix This?</h3>\n<p>Long term, WooCommerce should change how it handles password reset emails, and I’ve already submitted a pull request to make that happen. But in the meantime, it’s relatively easy to fix it on your own site right with a few bits of code. Let’s dig into your theme…</p>\n<h3>Change How a Password Reset Link is Constructed</h3>\n<p>In each of the password reset email templates included within WooCommerce, we’ll want to use the available <code>$user_login</code> variable to get the user’s ID, and use that to construct a link that does <strong>not</strong> include a username.</p>\n<p>To do this, you’ll want to copy each of these templates into a <code>woocommerce</code> directory inside your active theme. Keep the file structure in tact as you do. For example, <code>woocommerce/templates/emails/plain/customer-reset-password.php</code> will be placed in <code>your-theme-woocommerce/emails/plain/customer-reset-password.php</code>. Then, start editing.</p>\n<p><strong>woocommerce/templates/emails/plain/customer-reset-password.php</strong></p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&#x3C;?</span><span class=\"token function\">phpif</span> <span class=\"token punctuation\">(</span> <span class=\"token operator\">!</span> <span class=\"token function\">defined</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'ABSPATH'</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>    <span class=\"token keyword\">exit</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Exit if accessed directly}// Getting the user ID here!$user_id = get_user_by('login', $user_login)->ID;echo \"= \" . $email_heading . \" =\\n\\n\";echo __( 'Someone requested that the password be reset for the following account:', 'woocommerce' ) . \"\\r\\n\\r\\n\";echo esc_url( network_home_url( '/' ) ) . \"\\r\\n\\r\\n\";echo sprintf( __( 'Username: %s', 'woocommerce' ), $user_login ) . \"\\r\\n\\r\\n\";echo __( 'If this was a mistake, just ignore this email and nothing will happen.', 'woocommerce' ) . \"\\r\\n\\r\\n\";echo __( 'To reset your password, visit the following address:', 'woocommerce' ) . \"\\r\\n\\r\\n\";// Passing the user ID here!echo esc_url( add_query_arg( array( 'key' => $reset_key, 'id' => $user_id ), wc_get_endpoint_url( 'lost-password', '', wc_get_page_permalink( 'myaccount' ) ) ) ) . \"\\r\\n\";echo \"\\n=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=\\n\\n\";echo apply_filters( 'woocommerce_email_footer_text', get_option( 'woocommerce_email_footer_text' ) );</span></span>\n</code></pre></div>\n<p><strong>woocommerce/templates/emails/customer-reset-password.php</strong></p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&#x3C;?</span><span class=\"token function\">phpif</span> <span class=\"token punctuation\">(</span> <span class=\"token operator\">!</span> <span class=\"token function\">defined</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'ABSPATH'</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>    <span class=\"token keyword\">exit</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Exit if accessed directly}// Getting the user ID here!$user_id = get_user_by('login', $user_login)->ID;</span><span class=\"token delimiter important\">?></span></span><span class=\"token php language-php\"><span class=\"token delimiter important\">&#x3C;?php</span> <span class=\"token function\">do_action</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'woocommerce_email_header'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$email_heading</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$email</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token php language-php\"><span class=\"token delimiter important\">&#x3C;?php</span> <span class=\"token function\">_e</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'Someone requested that the password be reset for the following account:'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'woocommerce'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token php language-php\"><span class=\"token delimiter important\">&#x3C;?php</span> <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span> <span class=\"token function\">__</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'Username: %s'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'woocommerce'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$user_login</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token php language-php\"><span class=\"token delimiter important\">&#x3C;?php</span> <span class=\"token function\">_e</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'If this was a mistake, just ignore this email and nothing will happen.'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'woocommerce'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token php language-php\"><span class=\"token delimiter important\">&#x3C;?php</span> <span class=\"token function\">_e</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'To reset your password, visit the following address:'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'woocommerce'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>p</span><span class=\"token punctuation\">></span></span>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>a</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>link<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token php language-php\"><span class=\"token delimiter important\">&#x3C;?php</span> <span class=\"token keyword\">echo</span> <span class=\"token function\">esc_url</span><span class=\"token punctuation\">(</span> <span class=\"token function\">add_query_arg</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'key'</span> <span class=\"token operator\">=></span> <span class=\"token variable\">$reset_key</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'id'</span> <span class=\"token operator\">=></span> <span class=\"token variable\">$user_id</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">wc_get_endpoint_url</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'lost-password'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token function\">wc_get_page_permalink</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'myaccount'</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>            <span class=\"token php language-php\"><span class=\"token delimiter important\">&#x3C;?php</span> <span class=\"token function\">_e</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'Click here to reset your password'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'woocommerce'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>a</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token php language-php\"><span class=\"token delimiter important\">&#x3C;?php</span> <span class=\"token function\">do_action</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'woocommerce_email_footer'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$email</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span>\n</code></pre></div>\n<h3>Process a User ID URL Variable Instead of Username</h3>\n<p>Next, we need to remove the action that requires a user login be passed in the URL, and replace it with one that accepts an <code>id</code>. We can then use that value to get the username, which will still be used when the user clicks the generated link. Do this inside your theme’s <code>functions.php</code> file.</p>\n<p><strong>functions.php</strong></p>\n<div class=\"remark-highlight\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token function\">remove_action</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'template_redirect'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'WC_Form_Handler::redirect_reset_password_link'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token function\">add_action</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'template_redirect'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token function\">is_account_page</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token operator\">!</span> <span class=\"token keyword\">empty</span><span class=\"token punctuation\">(</span> <span class=\"token global\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'key'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">&#x26;&#x26;</span> <span class=\"token operator\">!</span> <span class=\"token keyword\">empty</span><span class=\"token punctuation\">(</span> <span class=\"token global\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'id'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>        <span class=\"token comment\">//-- Get the username by user ID.        $user_login = get_user_by('id', $_GET['id'])->user_login;        $value = sprintf( '%s:%s', wp_unslash( $user_login ), wp_unslash( $_GET['key'] ) );        WC_Shortcode_My_Account::set_reset_password_cookie( $value );        wp_safe_redirect( add_query_arg( 'show-reset-form', 'true', wc_lostpassword_url() ) );        exit;    }});</span>\n</code></pre></div>\n<p>Finished. Now, when users request to reset their passwords, the links they’re sent via email will contain no reference to a username. Instead, it’ll be something like this: <code>http://my-site.com/settings/account/lost-password/?key=NaEYetJTi6fI2HKaNfxT&#x26;id=23423</code></p>\n<p>Your customers are safer, and you’ll have less to worry about.</p>\n",
        "feature_image": "",
        "status": "published",
        "created_at": 1517806800000,
        "published_at": 1517806800000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>Securely handling personal information on the web is a pretty big deal, and one of the ways you do that is making sure none of it’s sent via query string in a URL. Things like this are bad:</p>\\n<p><code>https://your-site.com?email=booger%40email.com</code></p>\\n<p>In fact, Google has some clear policies explicitly prohibiting certain information from being passed through a URL, including things like <a href=\\\"https://developers.google.com/analytics/solutions/crm-integration#user_id\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">“email addresses, user logins, social security numbers, phone numbers or any piece of data that is deemed to be”PII\\\"</a>. And if you do send any of this information to Google, <a href=\\\"https://support.google.com/adwords/answer/6389382?hl=en\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">you’ll be penalized</a> until the issue is resolved.</p>\\n<h3>A Vulnerability in WooCommerce</h3>\\n<p>Out of the box, the WordPress e-commerce plugin <a href=\\\"https://woocommerce.com/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">WooCommerce</a> has a weak spot in this area. Password reset emails contain a link for a user to click to reset his/her password. That link, however, contains information that could be passed to a third party (like Google Analytics), posing a threat to users’ privacy, and penalizing you for enabling it.</p>\\n<p>That vulnerable information is a username. Or, as WordPress often handles it, a user login. I’ll be using “username” here because I like it more. For example: <code>http://my-site.com/settings/account/lost-password/?key=NaEYetJTi6fI2HKaNfxT&#x26;login=bartjansen</code></p>\\n<p>To better protect private information like this, the solution is relatively straightforward: <strong>Instead of passing a username, use an ID</strong>. An ID will be unique to the WordPress instance, and make it much more difficult to use to identify an individual. And from what I’ve read, <a href=\\\"https://support.google.com/adwords/answer/6389382?hl=en\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Google endorses this type of approach</a>.</p>\\n<h3>How Do I Fix This?</h3>\\n<p>Long term, WooCommerce should change how it handles password reset emails, and I’ve already submitted a pull request to make that happen. But in the meantime, it’s relatively easy to fix it on your own site right with a few bits of code. Let’s dig into your theme…</p>\\n<h3>Change How a Password Reset Link is Constructed</h3>\\n<p>In each of the password reset email templates included within WooCommerce, we’ll want to use the available <code>$user_login</code> variable to get the user’s ID, and use that to construct a link that does <strong>not</strong> include a username.</p>\\n<p>To do this, you’ll want to copy each of these templates into a <code>woocommerce</code> directory inside your active theme. Keep the file structure in tact as you do. For example, <code>woocommerce/templates/emails/plain/customer-reset-password.php</code> will be placed in <code>your-theme-woocommerce/emails/plain/customer-reset-password.php</code>. Then, start editing.</p>\\n<p><strong>woocommerce/templates/emails/plain/customer-reset-password.php</strong></p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token php language-php\\\"><span class=\\\"token delimiter important\\\">&#x3C;?</span><span class=\\\"token function\\\">phpif</span> <span class=\\\"token punctuation\\\">(</span> <span class=\\\"token operator\\\">!</span> <span class=\\\"token function\\\">defined</span><span class=\\\"token punctuation\\\">(</span> <span class=\\\"token string single-quoted-string\\\">'ABSPATH'</span> <span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>    <span class=\\\"token keyword\\\">exit</span><span class=\\\"token punctuation\\\">;</span> <span class=\\\"token comment\\\">// Exit if accessed directly}// Getting the user ID here!$user_id = get_user_by('login', $user_login)->ID;echo \\\"= \\\" . $email_heading . \\\" =\\\\n\\\\n\\\";echo __( 'Someone requested that the password be reset for the following account:', 'woocommerce' ) . \\\"\\\\r\\\\n\\\\r\\\\n\\\";echo esc_url( network_home_url( '/' ) ) . \\\"\\\\r\\\\n\\\\r\\\\n\\\";echo sprintf( __( 'Username: %s', 'woocommerce' ), $user_login ) . \\\"\\\\r\\\\n\\\\r\\\\n\\\";echo __( 'If this was a mistake, just ignore this email and nothing will happen.', 'woocommerce' ) . \\\"\\\\r\\\\n\\\\r\\\\n\\\";echo __( 'To reset your password, visit the following address:', 'woocommerce' ) . \\\"\\\\r\\\\n\\\\r\\\\n\\\";// Passing the user ID here!echo esc_url( add_query_arg( array( 'key' => $reset_key, 'id' => $user_id ), wc_get_endpoint_url( 'lost-password', '', wc_get_page_permalink( 'myaccount' ) ) ) ) . \\\"\\\\r\\\\n\\\";echo \\\"\\\\n=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=\\\\n\\\\n\\\";echo apply_filters( 'woocommerce_email_footer_text', get_option( 'woocommerce_email_footer_text' ) );</span></span>\\n</code></pre></div>\\n<p><strong>woocommerce/templates/emails/customer-reset-password.php</strong></p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token php language-php\\\"><span class=\\\"token delimiter important\\\">&#x3C;?</span><span class=\\\"token function\\\">phpif</span> <span class=\\\"token punctuation\\\">(</span> <span class=\\\"token operator\\\">!</span> <span class=\\\"token function\\\">defined</span><span class=\\\"token punctuation\\\">(</span> <span class=\\\"token string single-quoted-string\\\">'ABSPATH'</span> <span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>    <span class=\\\"token keyword\\\">exit</span><span class=\\\"token punctuation\\\">;</span> <span class=\\\"token comment\\\">// Exit if accessed directly}// Getting the user ID here!$user_id = get_user_by('login', $user_login)->ID;</span><span class=\\\"token delimiter important\\\">?></span></span><span class=\\\"token php language-php\\\"><span class=\\\"token delimiter important\\\">&#x3C;?php</span> <span class=\\\"token function\\\">do_action</span><span class=\\\"token punctuation\\\">(</span> <span class=\\\"token string single-quoted-string\\\">'woocommerce_email_header'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token variable\\\">$email_heading</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token variable\\\">$email</span> <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span> <span class=\\\"token delimiter important\\\">?></span></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>p</span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token php language-php\\\"><span class=\\\"token delimiter important\\\">&#x3C;?php</span> <span class=\\\"token function\\\">_e</span><span class=\\\"token punctuation\\\">(</span> <span class=\\\"token string single-quoted-string\\\">'Someone requested that the password be reset for the following account:'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string single-quoted-string\\\">'woocommerce'</span> <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span> <span class=\\\"token delimiter important\\\">?></span></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>p</span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>p</span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token php language-php\\\"><span class=\\\"token delimiter important\\\">&#x3C;?php</span> <span class=\\\"token function\\\">printf</span><span class=\\\"token punctuation\\\">(</span> <span class=\\\"token function\\\">__</span><span class=\\\"token punctuation\\\">(</span> <span class=\\\"token string single-quoted-string\\\">'Username: %s'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string single-quoted-string\\\">'woocommerce'</span> <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token variable\\\">$user_login</span> <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span> <span class=\\\"token delimiter important\\\">?></span></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>p</span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>p</span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token php language-php\\\"><span class=\\\"token delimiter important\\\">&#x3C;?php</span> <span class=\\\"token function\\\">_e</span><span class=\\\"token punctuation\\\">(</span> <span class=\\\"token string single-quoted-string\\\">'If this was a mistake, just ignore this email and nothing will happen.'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string single-quoted-string\\\">'woocommerce'</span> <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span> <span class=\\\"token delimiter important\\\">?></span></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>p</span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>p</span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token php language-php\\\"><span class=\\\"token delimiter important\\\">&#x3C;?php</span> <span class=\\\"token function\\\">_e</span><span class=\\\"token punctuation\\\">(</span> <span class=\\\"token string single-quoted-string\\\">'To reset your password, visit the following address:'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string single-quoted-string\\\">'woocommerce'</span> <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span> <span class=\\\"token delimiter important\\\">?></span></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>p</span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>p</span><span class=\\\"token punctuation\\\">></span></span>    <span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>a</span> <span class=\\\"token attr-name\\\">class</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span>link<span class=\\\"token punctuation\\\">\\\"</span></span> <span class=\\\"token attr-name\\\">href</span><span class=\\\"token attr-value\\\"><span class=\\\"token punctuation attr-equals\\\">=</span><span class=\\\"token punctuation\\\">\\\"</span><span class=\\\"token php language-php\\\"><span class=\\\"token delimiter important\\\">&#x3C;?php</span> <span class=\\\"token keyword\\\">echo</span> <span class=\\\"token function\\\">esc_url</span><span class=\\\"token punctuation\\\">(</span> <span class=\\\"token function\\\">add_query_arg</span><span class=\\\"token punctuation\\\">(</span> <span class=\\\"token keyword\\\">array</span><span class=\\\"token punctuation\\\">(</span> <span class=\\\"token string single-quoted-string\\\">'key'</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token variable\\\">$reset_key</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string single-quoted-string\\\">'id'</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token variable\\\">$user_id</span> <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token function\\\">wc_get_endpoint_url</span><span class=\\\"token punctuation\\\">(</span> <span class=\\\"token string single-quoted-string\\\">'lost-password'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string single-quoted-string\\\">''</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token function\\\">wc_get_page_permalink</span><span class=\\\"token punctuation\\\">(</span> <span class=\\\"token string single-quoted-string\\\">'myaccount'</span> <span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span> <span class=\\\"token delimiter important\\\">?></span></span><span class=\\\"token punctuation\\\">\\\"</span></span><span class=\\\"token punctuation\\\">></span></span>            <span class=\\\"token php language-php\\\"><span class=\\\"token delimiter important\\\">&#x3C;?php</span> <span class=\\\"token function\\\">_e</span><span class=\\\"token punctuation\\\">(</span> <span class=\\\"token string single-quoted-string\\\">'Click here to reset your password'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string single-quoted-string\\\">'woocommerce'</span> <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span> <span class=\\\"token delimiter important\\\">?></span></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>a</span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>p</span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;</span>p</span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token tag\\\"><span class=\\\"token tag\\\"><span class=\\\"token punctuation\\\">&#x3C;/</span>p</span><span class=\\\"token punctuation\\\">></span></span><span class=\\\"token php language-php\\\"><span class=\\\"token delimiter important\\\">&#x3C;?php</span> <span class=\\\"token function\\\">do_action</span><span class=\\\"token punctuation\\\">(</span> <span class=\\\"token string single-quoted-string\\\">'woocommerce_email_footer'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token variable\\\">$email</span> <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span> <span class=\\\"token delimiter important\\\">?></span></span>\\n</code></pre></div>\\n<h3>Process a User ID URL Variable Instead of Username</h3>\\n<p>Next, we need to remove the action that requires a user login be passed in the URL, and replace it with one that accepts an <code>id</code>. We can then use that value to get the username, which will still be used when the user clicks the generated link. Do this inside your theme’s <code>functions.php</code> file.</p>\\n<p><strong>functions.php</strong></p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-php\\\"><code class=\\\"language-php\\\"><span class=\\\"token function\\\">remove_action</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string single-quoted-string\\\">'template_redirect'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string single-quoted-string\\\">'WC_Form_Handler::redirect_reset_password_link'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span><span class=\\\"token function\\\">add_action</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string single-quoted-string\\\">'template_redirect'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span> <span class=\\\"token function\\\">is_account_page</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">&#x26;&#x26;</span> <span class=\\\"token operator\\\">!</span> <span class=\\\"token keyword\\\">empty</span><span class=\\\"token punctuation\\\">(</span> <span class=\\\"token global\\\">$_GET</span><span class=\\\"token punctuation\\\">[</span><span class=\\\"token string single-quoted-string\\\">'key'</span><span class=\\\"token punctuation\\\">]</span> <span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">&#x26;&#x26;</span> <span class=\\\"token operator\\\">!</span> <span class=\\\"token keyword\\\">empty</span><span class=\\\"token punctuation\\\">(</span> <span class=\\\"token global\\\">$_GET</span><span class=\\\"token punctuation\\\">[</span><span class=\\\"token string single-quoted-string\\\">'id'</span><span class=\\\"token punctuation\\\">]</span> <span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>        <span class=\\\"token comment\\\">//-- Get the username by user ID.        $user_login = get_user_by('id', $_GET['id'])->user_login;        $value = sprintf( '%s:%s', wp_unslash( $user_login ), wp_unslash( $_GET['key'] ) );        WC_Shortcode_My_Account::set_reset_password_cookie( $value );        wp_safe_redirect( add_query_arg( 'show-reset-form', 'true', wc_lostpassword_url() ) );        exit;    }});</span>\\n</code></pre></div>\\n<p>Finished. Now, when users request to reset their passwords, the links they’re sent via email will contain no reference to a username. Instead, it’ll be something like this: <code>http://my-site.com/settings/account/lost-password/?key=NaEYetJTi6fI2HKaNfxT&#x26;id=23423</code></p>\\n<p>Your customers are safer, and you’ll have less to worry about.</p>\\n\"}]],\"sections\":[[10,0]]}"
      },
      {
        "id": 59,
        "title": "Selecting Elements with No Class",
        "slug": "selecting-elements-with-no-class",
        "html": "<p>If you’ve been a developer for more than 7 minutes, you’ve probably felt uncomfortably pressured into doing something weird with your code, like specifically styling plain, classless, attribute-less elements. Don’t ask for the details, just accept the reality of this happening sometimes.</p>\n<p>When I meet scenarios like this, by default, I instantly architecting the most terrible, complicated solution that’s tied to my unique context.</p>\n<div class=\"remark-highlight\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\"><span class=\"token class\">.page-whatever-wordpress-plugin</span>  <span class=\"token class\">.this-class</span>  <span class=\"token combinator\">+</span> <span class=\"token class\">.that-class</span>  <span class=\"token combinator\">></span> h3<span class=\"token pseudo-class\">:nth-child</span><span class=\"token punctuation\">(</span><span class=\"token n-th\"><span class=\"token number\">3</span></span><span class=\"token punctuation\">)</span>  <span class=\"token combinator\">~</span> span</span> <span class=\"token punctuation\">{</span>  <span class=\"token property\">font-weight</span><span class=\"token punctuation\">:</span> bold<span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>For obvious reasons, solutions like this <em>usually</em> quickly pass by, and I’m forced to step back and rubber duck the problem verbally. Thankfully, for this problem, that conversation was over pretty quickly, when I realized we already have a solution for this.</p>\n<h3>Use the negation pseudo-class to select elements that do <strong>not</strong> have something.</h3>\n<p>Or, as you might otherwise call it, the <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/:not\" target=\"_blank\" rel=\"noopener\">:not() selector</a>.</p>\n<p>This trick isn’t new, but I’d usually seen it used to avoid selecting elements by a specific attribute <em>value</em>. For example:</p>\n<ul>\n<li>Selecting all elements that don’t have a <code>whatever-class-i-want-to-avoid</code> class:</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">*<span class=\"token pseudo-class\">:not</span><span class=\"token punctuation\">(</span><span class=\"token class\">.whatever-class-i-want-to-avoid</span><span class=\"token punctuation\">)</span></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n</code></pre></div>\n<ul>\n<li>Select all elements that don’t have a <code>data-id</code> of 33.</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">*<span class=\"token pseudo-class\">:not</span><span class=\"token punctuation\">(</span><span class=\"token attribute\"><span class=\"token punctuation\">[</span><span class=\"token attr-name\">data-id</span><span class=\"token operator\">=</span><span class=\"token attr-value\">\"33\"</span><span class=\"token punctuation\">]</span></span><span class=\"token punctuation\">)</span></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>But this time, I don’t care about what the value is. I want to know if the attribute exists on the element at all.</p>\n<h3>You can use the negation pseudo-class to (not) select only by attribute too. <em>crazy text</em></h3>\n<p>And remember, <code>class</code> <em>is</em> just an HTML attribute. Meaning, we can do completely permissible, non-hacky things like this:</p>\n<ul>\n<li>Select all elements that have no class:</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">*<span class=\"token pseudo-class\">:not</span><span class=\"token punctuation\">(</span><span class=\"token attribute\"><span class=\"token punctuation\">[</span><span class=\"token attr-name\">class</span><span class=\"token punctuation\">]</span></span><span class=\"token punctuation\">)</span></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n</code></pre></div>\n<ul>\n<li>Select elements that have a class attribute whose value is empty:</li>\n</ul>\n<div class=\"remark-highlight\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">*<span class=\"token pseudo-class\">:not</span><span class=\"token punctuation\">(</span><span class=\"token attribute\"><span class=\"token punctuation\">[</span><span class=\"token attr-name\">class</span><span class=\"token operator\">=</span><span class=\"token attr-value\">\"\"</span><span class=\"token punctuation\">]</span></span><span class=\"token punctuation\">)</span></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Beyond that, we can do a wide range of things more concerned with the <em>existence</em> of an attribute rather than the attribute’s value. <a href=\"https://codepen.io/alexmacarthur/pen/zpJeeG/\" target=\"_blank\" rel=\"noopener\">See a brief example on CodePen.</a></p>\n<p>And with that, another weird, one-off challenge resolved with tools we already had available to us.</p>\n<p><a href=\"830c1c7d-ea74-49e6-bd03-86c76d1852ea\" target=\"_blank\" rel=\"noopener\">2020-04-13-why-webpacker-wouldnt-compile-assets-in-a-specific-environment</a></p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">A while back, I started working in a Rails application in which I needed to introduce a JavaScript file that’d be compiled with Webpacker. To do so, I created the file in my `packs` directory and loaded it up via `content_for`:\n\n\n```text\n&#x26;lt;% content_for(:body_assets) do %&#x26;gt;\n  &#x26;lt;%= javascript_pack_tag(&#x26;quot;some-file&#x26;quot;) %&#x26;gt;\n&#x26;lt;% end %&#x26;gt;\n```\n\n\nLocally, things worked great! But once I deployed, integration tests running in the CI pipeline would unexpectedly fail, even though the same tests were _passing_ on my machine. After some time spent troubleshooting, it turned out to be one primary issue, which was drawn out by my misunderstanding of how Webpacker loads configuration settings for an environment. This is a quick review of the entire debugging process.\n\n\n## Problem #1: A `manifest.json` file wasn’t being generated.\n\n\nAs Rails is running a request and the `javascript_pack_tag` method is encountered, it’ll reference a `manifest.json` file in order to load the correct assets. If that file doesn’t exist, Rails vomits. This is the sort of error you’ll see:\n\n\n```text\nActionView::Template::Error: Webpacker can&#x26;#39;t find some-script in /my/app/path/public/packs/manifest.json. Possible causes:\n\n1\\. You want to set webpacker.yml value of compile to true for your environment\n   unless you are using the `webpack -w` or the webpack-dev-server.\n2\\. webpack has not yet re-run to reflect updates.\n3\\. You have misconfigured Webpacker&#x26;#39;s config/webpacker.yml file.\n4\\. Your webpack configuration is not creating a manifest.\n```\n\n\nThis made sense. Upon deploy, Webpacker was apparently not being told to compile assets _before_ requests were made or _as_ they were made, and so that file was never getting correctly generated.\n\n\n### Solution: Ensure my `webpacker.yml` file has `compile` set to `true`.\n\n\nIn all of my environments _except_ `production`, I wanted to set `compile` to `true`, so that on each request, Rails would check to see if it needs to compile assets before continuing. Instead of duplicating this change in my `development` and `test` environments, I opted to make it the default, since `production` already had it explicitly set to `false`.\n\n\n```yaml\ndefault: &#x26;amp;default  compile: truedevelopment:  &#x26;lt;&#x26;lt;:    *default    # other settings...test:  &#x26;lt;&#x26;lt;: *default  # other settings...production:  &#x26;lt;&#x26;lt;: *default  compile:    false    # other settings...\n```\n\n\nI felt good about this… until it failed.\n\n\n## Problem #2: Webpacker wasn’t respecting default settings in its configuration file.\n\n\nAfter some brief internal rage, I noticed a particular log that I must have passed over earlier:\n\n\n```text\nRAILS_ENV=build environment is not defined in config/webpacker.yml, falling back to production environment\n```\n\n\nMy tests were being run in the `build` environment – not `test`. And as it turns out, **Webpacker will fall back** **`production`** **if it can’t find the specified environment.** _This_ is why my assets weren’t being compiled. A `build` environment wasn’t set in my Webpacker configuration file, so it was falling back to `production`, which was explicitly telling Webpacker to _not_ compile assets.\n\n\n### Solution: Ensure my environment exists in the `webpacker.yml` file.\n\n\nLike most bugs that tempt you to rip your hair out, the solution turned out to be two lines:\n\n\n```yaml\nbuild:    &#x26;lt;&#x26;lt;: *default\n```\n\n\nSure, enough. All was green after that change.\n\n\n## Key Takeaway: Read Your Logs Good.\n\n\nWhat bit me here is some assumptions I made about how Webpacker loaded a configuration. The amount of time dealing with the consequences of those assumptions might have been avoided if I had been just a little more thorough in reading through the error logs. Don’t make this mistake yourself!</code></pre></div>\n",
        "feature_image": "",
        "status": "published",
        "created_at": 1514782800000,
        "published_at": 1514782800000,
        "published_by": 1,
        "created_by": 1,
        "author_id": 1,
        "mobiledoc": "{\"version\":\"0.3.1\",\"markups\":[],\"atoms\":[],\"cards\":[[\"html\",{\"cardName\":\"html\",\"html\":\"<p>If you’ve been a developer for more than 7 minutes, you’ve probably felt uncomfortably pressured into doing something weird with your code, like specifically styling plain, classless, attribute-less elements. Don’t ask for the details, just accept the reality of this happening sometimes.</p>\\n<p>When I meet scenarios like this, by default, I instantly architecting the most terrible, complicated solution that’s tied to my unique context.</p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-css\\\"><code class=\\\"language-css\\\"><span class=\\\"token selector\\\"><span class=\\\"token class\\\">.page-whatever-wordpress-plugin</span>  <span class=\\\"token class\\\">.this-class</span>  <span class=\\\"token combinator\\\">+</span> <span class=\\\"token class\\\">.that-class</span>  <span class=\\\"token combinator\\\">></span> h3<span class=\\\"token pseudo-class\\\">:nth-child</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token n-th\\\"><span class=\\\"token number\\\">3</span></span><span class=\\\"token punctuation\\\">)</span>  <span class=\\\"token combinator\\\">~</span> span</span> <span class=\\\"token punctuation\\\">{</span>  <span class=\\\"token property\\\">font-weight</span><span class=\\\"token punctuation\\\">:</span> bold<span class=\\\"token punctuation\\\">;</span><span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p>For obvious reasons, solutions like this <em>usually</em> quickly pass by, and I’m forced to step back and rubber duck the problem verbally. Thankfully, for this problem, that conversation was over pretty quickly, when I realized we already have a solution for this.</p>\\n<h3>Use the negation pseudo-class to select elements that do <strong>not</strong> have something.</h3>\\n<p>Or, as you might otherwise call it, the <a href=\\\"https://developer.mozilla.org/en-US/docs/Web/CSS/:not\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">:not() selector</a>.</p>\\n<p>This trick isn’t new, but I’d usually seen it used to avoid selecting elements by a specific attribute <em>value</em>. For example:</p>\\n<ul>\\n<li>Selecting all elements that don’t have a <code>whatever-class-i-want-to-avoid</code> class:</li>\\n</ul>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-css\\\"><code class=\\\"language-css\\\"><span class=\\\"token selector\\\">*<span class=\\\"token pseudo-class\\\">:not</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token class\\\">.whatever-class-i-want-to-avoid</span><span class=\\\"token punctuation\\\">)</span></span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<ul>\\n<li>Select all elements that don’t have a <code>data-id</code> of 33.</li>\\n</ul>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-css\\\"><code class=\\\"language-css\\\"><span class=\\\"token selector\\\">*<span class=\\\"token pseudo-class\\\">:not</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token attribute\\\"><span class=\\\"token punctuation\\\">[</span><span class=\\\"token attr-name\\\">data-id</span><span class=\\\"token operator\\\">=</span><span class=\\\"token attr-value\\\">\\\"33\\\"</span><span class=\\\"token punctuation\\\">]</span></span><span class=\\\"token punctuation\\\">)</span></span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p>But this time, I don’t care about what the value is. I want to know if the attribute exists on the element at all.</p>\\n<h3>You can use the negation pseudo-class to (not) select only by attribute too. <em>crazy text</em></h3>\\n<p>And remember, <code>class</code> <em>is</em> just an HTML attribute. Meaning, we can do completely permissible, non-hacky things like this:</p>\\n<ul>\\n<li>Select all elements that have no class:</li>\\n</ul>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-css\\\"><code class=\\\"language-css\\\"><span class=\\\"token selector\\\">*<span class=\\\"token pseudo-class\\\">:not</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token attribute\\\"><span class=\\\"token punctuation\\\">[</span><span class=\\\"token attr-name\\\">class</span><span class=\\\"token punctuation\\\">]</span></span><span class=\\\"token punctuation\\\">)</span></span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<ul>\\n<li>Select elements that have a class attribute whose value is empty:</li>\\n</ul>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-css\\\"><code class=\\\"language-css\\\"><span class=\\\"token selector\\\">*<span class=\\\"token pseudo-class\\\">:not</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token attribute\\\"><span class=\\\"token punctuation\\\">[</span><span class=\\\"token attr-name\\\">class</span><span class=\\\"token operator\\\">=</span><span class=\\\"token attr-value\\\">\\\"\\\"</span><span class=\\\"token punctuation\\\">]</span></span><span class=\\\"token punctuation\\\">)</span></span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span>\\n</code></pre></div>\\n<p>Beyond that, we can do a wide range of things more concerned with the <em>existence</em> of an attribute rather than the attribute’s value. <a href=\\\"https://codepen.io/alexmacarthur/pen/zpJeeG/\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">See a brief example on CodePen.</a></p>\\n<p>And with that, another weird, one-off challenge resolved with tools we already had available to us.</p>\\n<p><a href=\\\"830c1c7d-ea74-49e6-bd03-86c76d1852ea\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">2020-04-13-why-webpacker-wouldnt-compile-assets-in-a-specific-environment</a></p>\\n<div class=\\\"remark-highlight\\\"><pre class=\\\"language-unknown\\\"><code class=\\\"language-unknown\\\">A while back, I started working in a Rails application in which I needed to introduce a JavaScript file that’d be compiled with Webpacker. To do so, I created the file in my `packs` directory and loaded it up via `content_for`:\\n\\n\\n```text\\n&#x26;lt;% content_for(:body_assets) do %&#x26;gt;\\n  &#x26;lt;%= javascript_pack_tag(&#x26;quot;some-file&#x26;quot;) %&#x26;gt;\\n&#x26;lt;% end %&#x26;gt;\\n```\\n\\n\\nLocally, things worked great! But once I deployed, integration tests running in the CI pipeline would unexpectedly fail, even though the same tests were _passing_ on my machine. After some time spent troubleshooting, it turned out to be one primary issue, which was drawn out by my misunderstanding of how Webpacker loads configuration settings for an environment. This is a quick review of the entire debugging process.\\n\\n\\n## Problem #1: A `manifest.json` file wasn’t being generated.\\n\\n\\nAs Rails is running a request and the `javascript_pack_tag` method is encountered, it’ll reference a `manifest.json` file in order to load the correct assets. If that file doesn’t exist, Rails vomits. This is the sort of error you’ll see:\\n\\n\\n```text\\nActionView::Template::Error: Webpacker can&#x26;#39;t find some-script in /my/app/path/public/packs/manifest.json. Possible causes:\\n\\n1\\\\. You want to set webpacker.yml value of compile to true for your environment\\n   unless you are using the `webpack -w` or the webpack-dev-server.\\n2\\\\. webpack has not yet re-run to reflect updates.\\n3\\\\. You have misconfigured Webpacker&#x26;#39;s config/webpacker.yml file.\\n4\\\\. Your webpack configuration is not creating a manifest.\\n```\\n\\n\\nThis made sense. Upon deploy, Webpacker was apparently not being told to compile assets _before_ requests were made or _as_ they were made, and so that file was never getting correctly generated.\\n\\n\\n### Solution: Ensure my `webpacker.yml` file has `compile` set to `true`.\\n\\n\\nIn all of my environments _except_ `production`, I wanted to set `compile` to `true`, so that on each request, Rails would check to see if it needs to compile assets before continuing. Instead of duplicating this change in my `development` and `test` environments, I opted to make it the default, since `production` already had it explicitly set to `false`.\\n\\n\\n```yaml\\ndefault: &#x26;amp;default  compile: truedevelopment:  &#x26;lt;&#x26;lt;:    *default    # other settings...test:  &#x26;lt;&#x26;lt;: *default  # other settings...production:  &#x26;lt;&#x26;lt;: *default  compile:    false    # other settings...\\n```\\n\\n\\nI felt good about this… until it failed.\\n\\n\\n## Problem #2: Webpacker wasn’t respecting default settings in its configuration file.\\n\\n\\nAfter some brief internal rage, I noticed a particular log that I must have passed over earlier:\\n\\n\\n```text\\nRAILS_ENV=build environment is not defined in config/webpacker.yml, falling back to production environment\\n```\\n\\n\\nMy tests were being run in the `build` environment – not `test`. And as it turns out, **Webpacker will fall back** **`production`** **if it can’t find the specified environment.** _This_ is why my assets weren’t being compiled. A `build` environment wasn’t set in my Webpacker configuration file, so it was falling back to `production`, which was explicitly telling Webpacker to _not_ compile assets.\\n\\n\\n### Solution: Ensure my environment exists in the `webpacker.yml` file.\\n\\n\\nLike most bugs that tempt you to rip your hair out, the solution turned out to be two lines:\\n\\n\\n```yaml\\nbuild:    &#x26;lt;&#x26;lt;: *default\\n```\\n\\n\\nSure, enough. All was green after that change.\\n\\n\\n## Key Takeaway: Read Your Logs Good.\\n\\n\\nWhat bit me here is some assumptions I made about how Webpacker loaded a configuration. The amount of time dealing with the consequences of those assumptions might have been avoided if I had been just a little more thorough in reading through the error logs. Don’t make this mistake yourself!</code></pre></div>\\n\"}]],\"sections\":[[10,0]]}"
      }
    ]
  }
}
